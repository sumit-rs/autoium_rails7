// @joint/core@4.1.2 downloaded from https://ga.jspm.io/npm:@joint/core@4.1.2/joint.mjs

const{round:t,floor:e,PI:n}=Math;const r={linear:function(t,e,n){var r=t[1]-t[0];var i=e[1]-e[0];return(n-t[0])/r*i+e[0]||0}};const normalizeAngle=function(t){return t%360+(t<0?360:0)};const snapToGrid$1=function(e,n){return n*t(e/n)};const toDeg=function(t){return 180*t/n%360};const toRad=function(t,e){e=e||false;t=e?t:t%360;return t*n/180};const random=function(t,n){if(n===void 0){n=t===void 0?1:t;t=0}else if(n<t){const e=t;t=n;n=e}return e(Math.random()*(n-t+1)+t)};const{cos:i,sin:o,atan2:s}=Math;const bearing=function(t,e){var n=toRad(t.y);var r=toRad(e.y);var a=t.x;var c=e.x;var l=toRad(c-a);var u=o(l)*i(r);var h=i(n)*o(r)-o(n)*i(r)*i(l);var d=toDeg(s(u,h));var f=["NE","E","SE","S","SW","W","NW","N"];var p=d-22.5;p<0&&(p+=360);p=parseInt(p/45);return f[p]};const squaredLength=function(t,e){var n=t.x;var r=t.y;var i=e.x;var o=e.y;return(n-=i)*n+(r-=o)*r};const length=function(t,e){return Math.sqrt(squaredLength(t,e))};const a={Point:1,Line:2,Ellipse:3,Rect:4,Polyline:5,Polygon:6,Curve:7,Path:8};const{abs:c,cos:l,sin:u,sqrt:h,min:d,max:f,atan2:p,round:g,pow:v,PI:m}=Math;const Point=function(t,e){if(!(this instanceof Point))return new Point(t,e);if(typeof t==="string"){var n=t.split(t.indexOf("@")===-1?" ":"@");t=parseFloat(n[0]);e=parseFloat(n[1])}else if(Object(t)===t){e=t.y;t=t.x}this.x=t===void 0?0:t;this.y=e===void 0?0:e};Point.fromPolar=function(t,e,n){n=new Point(n);var r=c(t*l(e));var i=c(t*u(e));var o=normalizeAngle(toDeg(e));if(o<90)i=-i;else if(o<180){r=-r;i=-i}else o<270&&(r=-r);return new Point(n.x+r,n.y+i)};Point.random=function(t,e,n,r){return new Point(random(t,e),random(n,r))};Point.prototype={type:a.Point,chooseClosest:function(t){var e=t.length;if(e===1)return new Point(t[0]);var n=null;var r=Infinity;for(var i=0;i<e;i++){var o=new Point(t[i]);var s=this.squaredDistance(o);if(s<r){n=o;r=s}}return n},adhereToRect:function(t){if(t.containsPoint(this))return this;this.x=d(f(this.x,t.x),t.x+t.width);this.y=d(f(this.y,t.y),t.y+t.height);return this},angleBetween:function(t,e){var n=this.equals(t)||this.equals(e)?NaN:this.theta(e)-this.theta(t);n<0&&(n+=360);return n},bearing:function(t){return bearing(this,t)},changeInAngle:function(t,e,n){return this.clone().offset(-t,-e).theta(n)-this.theta(n)},clone:function(){return new Point(this)},cross:function(t,e){return t&&e?(e.x-this.x)*(t.y-this.y)-(e.y-this.y)*(t.x-this.x):NaN},difference:function(t,e){if(Object(t)===t){e=t.y;t=t.x}return new Point(this.x-(t||0),this.y-(e||0))},distance:function(t){return length(this,t)},dot:function(t){return t?this.x*t.x+this.y*t.y:NaN},equals:function(t){return!!t&&this.x===t.x&&this.y===t.y},lerp:function(t,e){var n=this.x;var r=this.y;return new Point((1-e)*n+e*t.x,(1-e)*r+e*t.y)},magnitude:function(){return h(this.x*this.x+this.y*this.y)||.01},manhattanDistance:function(t){return c(t.x-this.x)+c(t.y-this.y)},move:function(t,e){var n=toRad(new Point(t).theta(this));var r=this.offset(l(n)*e,-u(n)*e);return r},normalize:function(t){var e=(t||1)/this.magnitude();return this.scale(e,e)},offset:function(t,e){if(Object(t)===t){e=t.y;t=t.x}this.x+=t||0;this.y+=e||0;return this},reflection:function(t){return new Point(t).move(this,this.distance(t))},rotate:function(t,e){if(e===0)return this;t=t||new Point(0,0);e=toRad(normalizeAngle(-e));var n=l(e);var r=u(e);var i=n*(this.x-t.x)-r*(this.y-t.y)+t.x;var o=r*(this.x-t.x)+n*(this.y-t.y)+t.y;this.x=i;this.y=o;return this},round:function(t){let e=1;if(t)switch(t){case 1:e=10;break;case 2:e=100;break;case 3:e=1e3;break;default:e=v(10,t);break}this.x=g(this.x*e)/e;this.y=g(this.y*e)/e;return this},scale:function(t,e,n){n=n&&new Point(n)||new Point(0,0);this.x=n.x+t*(this.x-n.x);this.y=n.y+e*(this.y-n.y);return this},snapToGrid:function(t,e){this.x=snapToGrid$1(this.x,t);this.y=snapToGrid$1(this.y,e||t);return this},squaredDistance:function(t){return squaredLength(this,t)},theta:function(t){t=new Point(t);var e=-(t.y-this.y);var n=t.x-this.x;var r=p(e,n);r<0&&(r=2*m+r);return 180*r/m},toJSON:function(){return{x:this.x,y:this.y}},toPolar:function(t){t=t&&new Point(t)||new Point(0,0);var e=this.x;var n=this.y;this.x=h((e-t.x)*(e-t.x)+(n-t.y)*(n-t.y));this.y=toRad(t.theta(new Point(e,n)));return this},toString:function(){return this.x+"@"+this.y},serialize:function(){return this.x+","+this.y},update:function(t,e){if(Object(t)===t){e=t.y;t=t.x}this.x=t||0;this.y=e||0;return this},vectorAngle:function(t){var e=new Point(0,0);return e.angleBetween(this,t)}};Point.prototype.translate=Point.prototype.offset;const y=Point;const{max:b,min:x}=Math;const Line=function(t,e){if(!(this instanceof Line))return new Line(t,e);if(t instanceof Line)return new Line(t.start,t.end);this.start=new Point(t);this.end=new Point(e)};Line.prototype={type:a.Line,angle:function(){var t=new Point(this.start.x+1,this.start.y);return this.start.angleBetween(this.end,t)},bbox:function(){var t=x(this.start.x,this.end.x);var e=x(this.start.y,this.end.y);var n=b(this.start.x,this.end.x);var r=b(this.start.y,this.end.y);return new Rect(t,e,n-t,r-e)},bearing:function(){return bearing(this.start,this.end)},clone:function(){return new Line(this.start,this.end)},closestPoint:function(t){return this.pointAt(this.closestPointNormalizedLength(t))},closestPointLength:function(t){return this.closestPointNormalizedLength(t)*this.length()},closestPointNormalizedLength:function(t){var e=this.vector().dot(new Line(this.start,t).vector());var n=x(1,b(0,e/this.squaredLength()));return n!==n?0:n},closestPointTangent:function(t){return this.tangentAt(this.closestPointNormalizedLength(t))},containsPoint:function(t){var e=this.start;var n=this.end;if(e.cross(t,n)!==0)return false;var r=this.length();return!(new Line(e,t).length()>r)&&!(new Line(t,n).length()>r)},divideAt:function(t){var e=this.pointAt(t);return[new Line(this.start,e),new Line(e,this.end)]},divideAtLength:function(t){var e=this.pointAtLength(t);return[new Line(this.start,e),new Line(e,this.end)]},equals:function(t){return!!t&&this.start.x===t.start.x&&this.start.y===t.start.y&&this.end.x===t.end.x&&this.end.y===t.end.y},intersect:function(t,e){if(t&&t.intersectionWithLine){var n=t.intersectionWithLine(this,e);n&&t instanceof Line&&(n=n[0]);return n}return null},intersectionWithLine:function(t){var e=new Point(this.end.x-this.start.x,this.end.y-this.start.y);var n=new Point(t.end.x-t.start.x,t.end.y-t.start.y);var r=e.x*n.y-e.y*n.x;var i=new Point(t.start.x-this.start.x,t.start.y-this.start.y);var o=i.x*n.y-i.y*n.x;var s=i.x*e.y-i.y*e.x;if(r===0||o*r<0||s*r<0)return null;if(r>0){if(o>r||s>r)return null}else if(o<r||s<r)return null;return[new Point(this.start.x+o*e.x/r,this.start.y+o*e.y/r)]},isDifferentiable:function(){return!this.start.equals(this.end)},length:function(){return length(this.start,this.end)},midpoint:function(){return new Point((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)},parallel:function(t){const e=this.clone();if(!this.isDifferentiable())return e;const{start:n,end:r}=e;const i=n.clone().rotate(r,270);const o=r.clone().rotate(n,90);n.move(o,t);r.move(i,t);return e},pointAt:function(t){var e=this.start;var n=this.end;return t<=0?e.clone():t>=1?n.clone():e.lerp(n,t)},pointAtLength:function(t){var e=this.start;var n=this.end;var r=true;if(t<0){r=false;t=-t}var i=this.length();return t>=i?r?n.clone():e.clone():this.pointAt((r?t:i-t)/i)},pointOffset:function(t){t=new Point(t);var e=this.start;var n=this.end;var r=(n.x-e.x)*(t.y-e.y)-(n.y-e.y)*(t.x-e.x);return r/this.length()},rotate:function(t,e){this.start.rotate(t,e);this.end.rotate(t,e);return this},round:function(t){this.start.round(t);this.end.round(t);return this},scale:function(t,e,n){this.start.scale(t,e,n);this.end.scale(t,e,n);return this},setLength:function(t){var e=this.length();if(!e)return this;var n=t/e;return this.scale(n,n,this.start)},squaredLength:function(){return squaredLength(this.start,this.end)},tangentAt:function(t){if(!this.isDifferentiable())return null;var e=this.start;var n=this.end;var r=this.pointAt(t);var i=new Line(e,n);i.translate(r.x-e.x,r.y-e.y);return i},tangentAtLength:function(t){if(!this.isDifferentiable())return null;var e=this.start;var n=this.end;var r=this.pointAtLength(t);var i=new Line(e,n);i.translate(r.x-e.x,r.y-e.y);return i},toString:function(){return this.start.toString()+" "+this.end.toString()},serialize:function(){return this.start.serialize()+" "+this.end.serialize()},translate:function(t,e){this.start.translate(t,e);this.end.translate(t,e);return this},vector:function(){return new Point(this.end.x-this.start.x,this.end.y-this.start.y)}};Line.prototype.intersection=Line.prototype.intersect;const w=Line;const{sqrt:A,round:P,pow:T}=Math;const Ellipse$1=function(t,e,n){if(!(this instanceof Ellipse$1))return new Ellipse$1(t,e,n);if(t instanceof Ellipse$1)return new Ellipse$1(new Point(t.x,t.y),t.a,t.b);t=new Point(t);this.x=t.x;this.y=t.y;this.a=e;this.b=n};Ellipse$1.fromRect=function(t){t=new Rect(t);return new Ellipse$1(t.center(),t.width/2,t.height/2)};Ellipse$1.prototype={type:a.Ellipse,bbox:function(){return new Rect(this.x-this.a,this.y-this.b,2*this.a,2*this.b)},
/**
     * @returns {g.Point}
     */
center:function(){return new Point(this.x,this.y)},clone:function(){return new Ellipse$1(this)},
/**
     * @param {g.Point} p
     * @returns {boolean}
     */
containsPoint:function(t){return this.normalizedDistance(t)<=1},equals:function(t){return!!t&&t.x===this.x&&t.y===this.y&&t.a===this.a&&t.b===this.b},inflate:function(t,e){t===void 0&&(t=0);e===void 0&&(e=t);this.a+=2*t;this.b+=2*e;return this},intersectionWithLine:function(t){var e=[];var n=t.start;var r=t.end;var i=this.a;var o=this.b;var s=t.vector();var a=n.difference(new Point(this));var c=new Point(s.x/(i*i),s.y/(o*o));var l=new Point(a.x/(i*i),a.y/(o*o));var u=s.dot(c);var h=s.dot(l);var d=a.dot(l)-1;var f=h*h-u*d;if(f<0)return null;if(f>0){var p=A(f);var g=(-h-p)/u;var v=(-h+p)/u;if((g<0||1<g)&&(v<0||1<v))return null;0<=g&&g<=1&&e.push(n.lerp(r,g));0<=v&&v<=1&&e.push(n.lerp(r,v))}else{var m=-h/u;if(!(0<=m&&m<=1))return null;e.push(n.lerp(r,m))}return e},intersectionWithLineFromCenterToPoint:function(t,e){t=new Point(t);e&&t.rotate(new Point(this.x,this.y),e);var n=t.x-this.x;var r=t.y-this.y;var i;if(n===0){i=this.bbox().pointNearestToPoint(t);return e?i.rotate(new Point(this.x,this.y),-e):i}var o=r/n;var s=o*o;var a=this.a*this.a;var c=this.b*this.b;var l=A(1/(1/a+s/c));l=n<0?-l:l;var u=o*l;i=new Point(this.x+l,this.y+u);return e?i.rotate(new Point(this.x,this.y),-e):i},
/**
     * @param {g.Point} point
     * @returns {number} result < 1 - inside ellipse, result == 1 - on ellipse boundary, result > 1 - outside
     */
normalizedDistance:function(t){var e=t.x;var n=t.y;var r=this.a;var i=this.b;var o=this.x;var s=this.y;return(e-o)*(e-o)/(r*r)+(n-s)*(n-s)/(i*i)},round:function(t){let e=1;if(t)switch(t){case 1:e=10;break;case 2:e=100;break;case 3:e=1e3;break;default:e=T(10,t);break}this.x=P(this.x*e)/e;this.y=P(this.y*e)/e;this.a=P(this.a*e)/e;this.b=P(this.b*e)/e;return this},
/** Compute angle between tangent and x axis
     * @param {g.Point} p Point of tangency, it has to be on ellipse boundaries.
     * @returns {number} angle between tangent and x axis
     */
tangentTheta:function(t){var e=30;var n=t.x;var r=t.y;var i=this.a;var o=this.b;var s=this.bbox().center();var a=s.x;var c=s.y;var l=n>s.x+i/2;var u=n<s.x-i/2;var h,d;if(l||u){h=n>s.x?r-e:r+e;d=i*i/(n-a)-i*i*(r-c)*(h-c)/(o*o*(n-a))+a}else{d=r>s.y?n+e:n-e;h=o*o/(r-c)-o*o*(n-a)*(d-a)/(i*i*(r-c))+c}return new Point(d,h).theta(t)},toString:function(){return new Point(this.x,this.y).toString()+" "+this.a+" "+this.b}};const E=Ellipse$1;const{abs:S,cos:k,sin:L,min:C,max:_,round:M,pow:N}=Math;const Rect=function(t,e,n,r){if(!(this instanceof Rect))return new Rect(t,e,n,r);if(Object(t)===t){e=t.y;n=t.width;r=t.height;t=t.x}this.x=t===void 0?0:t;this.y=e===void 0?0:e;this.width=n===void 0?0:n;this.height=r===void 0?0:r};Rect.fromEllipse=function(t){t=new Ellipse$1(t);return new Rect(t.x-t.a,t.y-t.b,2*t.a,2*t.b)};Rect.fromPointUnion=function(...t){if(t.length===0)return null;const e=new Point;let n,r,i,o;n=r=Infinity;i=o=-Infinity;for(let s=0;s<t.length;s++){e.update(t[s]);const a=e.x;const c=e.y;a<n&&(n=a);a>i&&(i=a);c<r&&(r=c);c>o&&(o=c)}return new Rect(n,r,i-n,o-r)};Rect.fromRectUnion=function(...t){if(t.length===0)return null;const e=new Rect;let n,r,i,o;n=r=Infinity;i=o=-Infinity;for(let s=0;s<t.length;s++){e.update(t[s]);const a=e.x;const c=e.y;const l=a+e.width;const u=c+e.height;a<n&&(n=a);l>i&&(i=l);c<r&&(r=c);u>o&&(o=u)}return new Rect(n,r,i-n,o-r)};Rect.prototype={type:a.Rect,bbox:function(t){return this.clone().rotateAroundCenter(t)},rotateAroundCenter:function(t){if(!t)return this;const{width:e,height:n}=this;const r=toRad(t);const i=S(L(r));const o=S(k(r));const s=e*o+n*i;const a=e*i+n*o;this.x+=(e-s)/2;this.y+=(n-a)/2;this.width=s;this.height=a;return this},bottomLeft:function(){return new Point(this.x,this.y+this.height)},bottomLine:function(){return new Line(this.bottomLeft(),this.bottomRight())},bottomMiddle:function(){return new Point(this.x+this.width/2,this.y+this.height)},center:function(){return new Point(this.x+this.width/2,this.y+this.height/2)},clone:function(){return new Rect(this)},containsPoint:function(t,e){let n,r;t&&typeof t!=="string"?({x:n=0,y:r=0}=t):({x:n,y:r}=new Point(t));return e&&e.strict?n>this.x&&n<this.x+this.width&&r>this.y&&r<this.y+this.height:n>=this.x&&n<=this.x+this.width&&r>=this.y&&r<=this.y+this.height},containsRect:function(t){var e=new Rect(this).normalize();var n=new Rect(t).normalize();var r=e.width;var i=e.height;var o=n.width;var s=n.height;if(!r||!i||!o||!s)return false;var a=e.x;var c=e.y;var l=n.x;var u=n.y;o+=l;r+=a;s+=u;i+=c;return a<=l&&o<=r&&c<=u&&s<=i},corner:function(){return new Point(this.x+this.width,this.y+this.height)},equals:function(t){var e=new Rect(this).normalize();var n=new Rect(t).normalize();return e.x===n.x&&e.y===n.y&&e.width===n.width&&e.height===n.height},inflate:function(t,e){t===void 0&&(t=0);e===void 0&&(e=t);this.x-=t;this.y-=e;this.width+=2*t;this.height+=2*e;return this},intersect:function(t){var e=this.origin();var n=this.corner();var r=t.origin();var i=t.corner();if(i.x<=e.x||i.y<=e.y||r.x>=n.x||r.y>=n.y)return null;var o=_(e.x,r.x);var s=_(e.y,r.y);return new Rect(o,s,C(n.x,i.x)-o,C(n.y,i.y)-s)},intersectionWithLine:function(t){var e=this;var n=[e.topLine(),e.rightLine(),e.bottomLine(),e.leftLine()];var r=[];var i=[];var o,s;var a=n.length;for(s=0;s<a;s++){o=t.intersect(n[s]);if(o!==null&&i.indexOf(o.toString())<0){r.push(o);i.push(o.toString())}}return r.length>0?r:null},intersectionWithLineFromCenterToPoint:function(t,e){t=new Point(t);var n=new Point(this.x+this.width/2,this.y+this.height/2);var r;e&&t.rotate(n,e);var i=[this.topLine(),this.rightLine(),this.bottomLine(),this.leftLine()];var o=new Line(n,t);for(var s=i.length-1;s>=0;--s){var a=i[s].intersection(o);if(a!==null){r=a;break}}r&&e&&r.rotate(n,-e);return r},leftLine:function(){return new Line(this.topLeft(),this.bottomLeft())},leftMiddle:function(){return new Point(this.x,this.y+this.height/2)},maxRectScaleToFit:function(t,e){t=new Rect(t);e||(e=t.center());var n,r,i,o,s,a,c,l;var u=e.x;var h=e.y;n=r=i=o=s=a=c=l=Infinity;var d=t.topLeft();d.x<u&&(n=(this.x-u)/(d.x-u));d.y<h&&(s=(this.y-h)/(d.y-h));var f=t.bottomRight();f.x>u&&(r=(this.x+this.width-u)/(f.x-u));f.y>h&&(a=(this.y+this.height-h)/(f.y-h));var p=t.topRight();p.x>u&&(i=(this.x+this.width-u)/(p.x-u));p.y<h&&(c=(this.y-h)/(p.y-h));var g=t.bottomLeft();g.x<u&&(o=(this.x-u)/(g.x-u));g.y>h&&(l=(this.y+this.height-h)/(g.y-h));return{sx:C(n,r,i,o),sy:C(s,a,c,l)}},maxRectUniformScaleToFit:function(t,e){var n=this.maxRectScaleToFit(t,e);return C(n.sx,n.sy)},moveAndExpand:function(t){this.x+=t.x||0;this.y+=t.y||0;this.width+=t.width||0;this.height+=t.height||0;return this},normalize:function(){var t=this.x;var e=this.y;var n=this.width;var r=this.height;if(this.width<0){t=this.x+this.width;n=-this.width}if(this.height<0){e=this.y+this.height;r=-this.height}this.x=t;this.y=e;this.width=n;this.height=r;return this},offset:function(t,e){return Point.prototype.offset.call(this,t,e)},origin:function(){return new Point(this.x,this.y)},pointNearestToPoint:function(t){t=new Point(t);if(this.containsPoint(t)){var e=this.sideNearestToPoint(t);switch(e){case"right":return new Point(this.x+this.width,t.y);case"left":return new Point(this.x,t.y);case"bottom":return new Point(t.x,this.y+this.height);case"top":return new Point(t.x,this.y)}}return t.adhereToRect(this)},rightLine:function(){return new Line(this.topRight(),this.bottomRight())},rightMiddle:function(){return new Point(this.x+this.width,this.y+this.height/2)},round:function(t){let e=1;if(t)switch(t){case 1:e=10;break;case 2:e=100;break;case 3:e=1e3;break;default:e=N(10,t);break}this.x=M(this.x*e)/e;this.y=M(this.y*e)/e;this.width=M(this.width*e)/e;this.height=M(this.height*e)/e;return this},scale:function(t,e,n){n=this.origin().scale(t,e,n);this.x=n.x;this.y=n.y;this.width*=t;this.height*=e;return this},sideNearestToPoint:function(t){t=new Point(t);var e=t.x-this.x;var n=this.x+this.width-t.x;var r=t.y-this.y;var i=this.y+this.height-t.y;var o=e;var s="left";if(n<o){o=n;s="right"}if(r<o){o=r;s="top"}i<o&&(s="bottom");return s},snapToGrid:function(t,e){var n=this.origin().snapToGrid(t,e);var r=this.corner().snapToGrid(t,e);this.x=n.x;this.y=n.y;this.width=r.x-n.x;this.height=r.y-n.y;return this},toJSON:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},topLine:function(){return new Line(this.topLeft(),this.topRight())},topMiddle:function(){return new Point(this.x+this.width/2,this.y)},topRight:function(){return new Point(this.x+this.width,this.y)},toString:function(){return this.origin().toString()+" "+this.corner().toString()},union:function(t){return Rect.fromRectUnion(this,t)},update:function(t,e,n,r){if(Object(t)===t){e=t.y;n=t.width;r=t.height;t=t.x}this.x=t||0;this.y=e||0;this.width=n||0;this.height=r||0;return this}};Rect.prototype.bottomRight=Rect.prototype.corner;Rect.prototype.topLeft=Rect.prototype.origin;Rect.prototype.translate=Rect.prototype.offset;const O=Rect;function parsePoints(t){const e=t.trim();if(e==="")return[];const n=[];const r=e.split(/\b\s*,\s*|,\s*|\s+/);const i=r.length;for(let t=0;t<i;t+=2)n.push({x:+r[t],y:+r[t+1]});return n}function clonePoints(t){const e=t.length;if(e===0)return[];const n=[];for(let r=0;r<e;r++){const e=t[r].clone();n.push(e)}return n}function convexHull(t){const{abs:e}=Math;var n;var r;var i=t.length;if(i===0)return[];var o;for(n=0;n<i;n++)(o===void 0||t[n].y<o.y||t[n].y===o.y&&t[n].x>o.x)&&(o=t[n]);var s=[];for(n=0;n<i;n++){var a=o.theta(t[n]);a===0&&(a=360);var c=[t[n],n,a];s.push(c)}s.sort((function(t,e){var n=t[2]-e[2];n===0&&(n=e[1]-t[1]);return n}));if(s.length>2){var l=s[s.length-1];s.unshift(l)}var u={};var h=[];var d;var f;var p;var g;var v;var m;while(s.length!==0){d=s.pop();f=d[0];if(!u.hasOwnProperty(d[0]+"@@"+d[1])){var y=false;while(!y)if(h.length<2){h.push(d);y=true}else{p=h.pop();g=p[0];v=h.pop();m=v[0];var b=m.cross(g,f);if(b<0){h.push(v);h.push(p);h.push(d);y=true}else if(b===0){var x=1e-10;var w=g.angleBetween(m,f);if(e(w-180)<x){u[p[0]+"@@"+p[1]]=g;h.push(v)}else if(g.equals(f)||m.equals(g)){u[p[0]+"@@"+p[1]]=g;h.push(v)}else if(e((w+1)%360-1)<x){h.push(v);s.push(p)}}else{u[p[0]+"@@"+p[1]]=g;h.push(v)}}}}h.length>2&&h.pop();var A;var P=-1;r=h.length;for(n=0;n<r;n++){var T=h[n][1];if(A===void 0||T<A){A=T;P=n}}var E=[];if(P>0){var S=h.slice(P);var k=h.slice(0,P);E=S.concat(k)}else E=h;var L=[];r=E.length;for(n=0;n<r;n++)L.push(E[n][0]);return L}const Polyline$1=function(t){if(!(this instanceof Polyline$1))return new Polyline$1(t);if(typeof t==="string")return new Polyline$1.parse(t);this.points=Array.isArray(t)?t.map(Point):[]};Polyline$1.parse=function(t){return new Polyline$1(parsePoints(t))};Polyline$1.fromRect=function(t){return new Polyline$1([t.topLeft(),t.topRight(),t.bottomRight(),t.bottomLeft(),t.topLeft()])};Polyline$1.prototype={type:a.Polyline,bbox:function(){var t=Infinity;var e=-Infinity;var n=Infinity;var r=-Infinity;var i=this.points;var o=i.length;if(o===0)return null;for(var s=0;s<o;s++){var a=i[s];var c=a.x;var l=a.y;c<t&&(t=c);c>e&&(e=c);l<n&&(n=l);l>r&&(r=l)}return new Rect(t,n,e-t,r-n)},clone:function(){return new Polyline$1(clonePoints(this.points))},closestPoint:function(t){var e=this.closestPointLength(t);return this.pointAtLength(e)},closestPointLength:function(t){var e=this.lengthPoints();var n=e.length;if(n===0)return 0;if(n===1)return 0;var r;var i=Infinity;var o=0;var s=n-1;for(var a=0;a<s;a++){var c=new Line(e[a],e[a+1]);var l=c.length();var u=c.closestPointNormalizedLength(t);var h=c.pointAt(u);var d=h.squaredDistance(t);if(d<i){i=d;r=o+u*l}o+=l}return r},closestPointNormalizedLength:function(t){var e=this.closestPointLength(t);if(e===0)return 0;var n=this.length();return n===0?0:e/n},closestPointTangent:function(t){var e=this.closestPointLength(t);return this.tangentAtLength(e)},containsPoint:function(t){var e=this.points;var n=e.length;if(n===0)return false;var r=t.x;var i=t.y;var o=n-1;var s=0;var a=0;var c=new Line;var l=new Line;var u=new Point;for(;s<n;s++){var h=e[o];var d=e[s];if(t.equals(h))return true;c.start=h;c.end=d;if(c.containsPoint(t))return true;if(i<=h.y&&i>d.y||i>h.y&&i<=d.y){var f=h.x-r>d.x-r?h.x-r:d.x-r;if(f>=0){u.x=r+f;u.y=i;l.start=t;l.end=u;c.intersect(l)&&a++}}o=s}return a%2===1},close:function(){const{start:t,end:e,points:n}=this;t&&e&&!t.equals(e)&&n.push(t.clone());return this},lengthPoints:function(){return this.points},convexHull:function(){return new Polyline$1(convexHull(this.points))},equals:function(t){if(!t)return false;var e=this.points;var n=t.points;var r=e.length;if(n.length!==r)return false;for(var i=0;i<r;i++){var o=e[i];var s=t.points[i];if(!o.equals(s))return false}return true},intersectionWithLine:function(t){var e=new Line(t);var n=[];var r=this.lengthPoints();var i=new Line;for(var o=0,s=r.length-1;o<s;o++){i.start=r[o];i.end=r[o+1];var a=e.intersectionWithLine(i);a&&n.push(a[0])}return n.length>0?n:null},isDifferentiable:function(){var t=this.points;var e=t.length;if(e===0)return false;var n=new Line;var r=e-1;for(var i=0;i<r;i++){n.start=t[i];n.end=t[i+1];if(n.isDifferentiable())return true}return false},length:function(){var t=this.lengthPoints();var e=t.length;if(e===0)return 0;var n=0;var r=e-1;for(var i=0;i<r;i++)n+=t[i].distance(t[i+1]);return n},pointAt:function(t){var e=this.lengthPoints();var n=e.length;if(n===0)return null;if(n===1)return e[0].clone();if(t<=0)return e[0].clone();if(t>=1)return e[n-1].clone();var r=this.length();var i=r*t;return this.pointAtLength(i)},pointAtLength:function(t){var e=this.lengthPoints();var n=e.length;if(n===0)return null;if(n===1)return e[0].clone();var r=true;if(t<0){r=false;t=-t}var i=0;var o=n-1;for(var s=0;s<o;s++){var a=r?s:o-1-s;var c=e[a];var l=e[a+1];var u=new Line(c,l);var h=c.distance(l);if(t<=i+h)return u.pointAtLength((r?1:-1)*(t-i));i+=h}var d=r?e[n-1]:e[0];return d.clone()},round:function(t){var e=this.points;var n=e.length;for(var r=0;r<n;r++)e[r].round(t);return this},scale:function(t,e,n){var r=this.points;var i=r.length;for(var o=0;o<i;o++)r[o].scale(t,e,n);return this},simplify:function(t={}){const e=this.points;if(e.length<3)return this;const n=t.threshold||1e-10;let r=0;while(e[r+2]){const t=r;const i=r+1;const o=r+2;const s=e[t];const a=e[i];const c=e[o];const l=new Line(s,c);const u=l.closestPoint(a);const h=u.distance(a);h<=n?e.splice(i,1):r+=1}return this},tangentAt:function(t){var e=this.lengthPoints();var n=e.length;if(n===0)return null;if(n===1)return null;t<0&&(t=0);t>1&&(t=1);var r=this.length();var i=r*t;return this.tangentAtLength(i)},tangentAtLength:function(t){var e=this.lengthPoints();var n=e.length;if(n===0)return null;if(n===1)return null;var r=true;if(t<0){r=false;t=-t}var i;var o=0;var s=n-1;for(var a=0;a<s;a++){var c=r?a:s-1-a;var l=e[c];var u=e[c+1];var h=new Line(l,u);var d=l.distance(u);if(h.isDifferentiable()){if(t<=o+d)return h.tangentAtLength((r?1:-1)*(t-o));i=h}o+=d}if(i){var f=r?1:0;return i.tangentAt(f)}return null},toString:function(){return this.points+""},translate:function(t,e){var n=this.points;var r=n.length;for(var i=0;i<r;i++)n[i].translate(t,e);return this},serialize:function(){var t=this.points;var e=t.length;if(e===0)return"";var n="";for(var r=0;r<e;r++){var i=t[r];n+=i.x+","+i.y+" "}return n.trim()}};Object.defineProperty(Polyline$1.prototype,"start",{configurable:true,enumerable:true,get:function(){var t=this.points;var e=t.length;return e===0?null:this.points[0]}});Object.defineProperty(Polyline$1.prototype,"end",{configurable:true,enumerable:true,get:function(){var t=this.points;var e=t.length;return e===0?null:this.points[e-1]}});const{abs:R,sqrt:B,min:I,max:F,pow:D}=Math;const Curve=function(t,e,n,r){if(!(this instanceof Curve))return new Curve(t,e,n,r);if(t instanceof Curve)return new Curve(t.start,t.controlPoint1,t.controlPoint2,t.end);this.start=new Point(t);this.controlPoint1=new Point(e);this.controlPoint2=new Point(n);this.end=new Point(r)};Curve.throughPoints=function(){function getCurveControlPoints(t){var e=[];var n=[];var r=t.length-1;var i;if(r==1){e[0]=new Point((2*t[0].x+t[1].x)/3,(2*t[0].y+t[1].y)/3);n[0]=new Point(2*e[0].x-t[0].x,2*e[0].y-t[0].y);return[e,n]}var o=[];for(i=1;i<r-1;i++)o[i]=4*t[i].x+2*t[i+1].x;o[0]=t[0].x+2*t[1].x;o[r-1]=(8*t[r-1].x+t[r].x)/2;var s=getFirstControlPoints(o);for(i=1;i<r-1;++i)o[i]=4*t[i].y+2*t[i+1].y;o[0]=t[0].y+2*t[1].y;o[r-1]=(8*t[r-1].y+t[r].y)/2;var a=getFirstControlPoints(o);for(i=0;i<r;i++){e.push(new Point(s[i],a[i]));i<r-1?n.push(new Point(2*t[i+1].x-s[i+1],2*t[i+1].y-a[i+1])):n.push(new Point((t[r].x+s[r-1])/2,(t[r].y+a[r-1])/2))}return[e,n]}function getFirstControlPoints(t){var e=t.length;var n=[];var r=[];var i=2;n[0]=t[0]/i;for(var o=1;o<e;o++){r[o]=1/i;i=(o<e-1?4:3.5)-r[o];n[o]=(t[o]-n[o-1])/i}for(o=1;o<e;o++)n[e-o-1]-=r[e-o]*n[e-o];return n}return function(t){if(!t||Array.isArray(t)&&t.length<2)throw new Error("At least 2 points are required");var e=getCurveControlPoints(t);var n=[];var r=e[0].length;for(var i=0;i<r;i++){var o=new Point(e[0][i].x,e[0][i].y);var s=new Point(e[1][i].x,e[1][i].y);n.push(new Curve(t[i],o,s,t[i+1]))}return n}}();Curve.prototype={type:a.Curve,bbox:function(){var t=this.start;var e=this.controlPoint1;var n=this.controlPoint2;var r=this.end;var i=t.x;var o=t.y;var s=e.x;var a=e.y;var c=n.x;var l=n.y;var u=r.x;var h=r.y;var d=new Array;var f=new Array;var p=[new Array,new Array];var g,v,m,y;var b,x;var w,A;for(var P=0;P<2;++P){if(P===0){v=6*i-12*s+6*c;g=-3*i+9*s-9*c+3*u;m=3*s-3*i}else{v=6*o-12*a+6*l;g=-3*o+9*a-9*l+3*h;m=3*a-3*o}if(R(g)<1e-12){if(R(v)<1e-12)continue;y=-m/v;0<y&&y<1&&f.push(y)}else{w=v*v-4*m*g;A=B(w);if(!(w<0)){b=(-v+A)/(2*g);0<b&&b<1&&f.push(b);x=(-v-A)/(2*g);0<x&&x<1&&f.push(x)}}}var T=f.length;var E=T;var S;var k,L;while(T--){y=f[T];S=1-y;k=S*S*S*i+3*S*S*y*s+3*S*y*y*c+y*y*y*u;p[0][T]=k;L=S*S*S*o+3*S*S*y*a+3*S*y*y*l+y*y*y*h;p[1][T]=L;d[T]={X:k,Y:L}}f[E]=0;f[E+1]=1;d[E]={X:i,Y:o};d[E+1]={X:u,Y:h};p[0][E]=i;p[1][E]=o;p[0][E+1]=u;p[1][E+1]=h;f.length=E+2;p[0].length=E+2;p[1].length=E+2;d.length=E+2;var C=I.apply(null,p[0]);var _=I.apply(null,p[1]);var M=F.apply(null,p[0]);var N=F.apply(null,p[1]);return new Rect(C,_,M-C,N-_)},clone:function(){return new Curve(this.start,this.controlPoint1,this.controlPoint2,this.end)},closestPoint:function(t,e){return this.pointAtT(this.closestPointT(t,e))},closestPointLength:function(t,e){e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision;var r=e.subdivisions===void 0?this.getSubdivisions({precision:n}):e.subdivisions;var i={precision:n,subdivisions:r};return this.lengthAtT(this.closestPointT(t,i),i)},closestPointNormalizedLength:function(t,e){e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision;var r=e.subdivisions===void 0?this.getSubdivisions({precision:n}):e.subdivisions;var i={precision:n,subdivisions:r};var o=this.closestPointLength(t,i);if(!o)return 0;var s=this.length(i);return s===0?0:o/s},closestPointT:function(t,e){e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision;var r=e.subdivisions===void 0?this.getSubdivisions({precision:n}):e.subdivisions;var i;var o;var s;var a;var c;var l;var u;var h=r.length;var d=h?1/h:0;for(var f=0;f<h;f++){var p=r[f];var g=p.start.distance(t);var v=p.end.distance(t);var m=g+v;if(!u||m<u){i=p;o=f*d;s=(f+1)*d;a=g;c=v;l=p.start.distance(p.end);u=m}}var y=D(10,-n);while(true){var b=a?R(a-c)/a:0;var x=c?R(a-c)/c:0;var w=b<y||x<y;var A=!a||a<l*y;var P=!c||c<l*y;var T=A||P;if(w||T)return a<=c?o:s;var E=i.divide(.5);d/=2;var S=E[0].start.distance(t);var k=E[0].end.distance(t);var L=S+k;var C=E[1].start.distance(t);var _=E[1].end.distance(t);var M=C+_;if(L<=M){i=E[0];s-=d;a=S;c=k}else{i=E[1];o+=d;a=C;c=_}}},closestPointTangent:function(t,e){return this.tangentAtT(this.closestPointT(t,e))},containsPoint:function(t,e){var n=this.toPolyline(e);return n.containsPoint(t)},divideAt:function(t,e){if(t<=0)return this.divideAtT(0);if(t>=1)return this.divideAtT(1);var n=this.tAt(t,e);return this.divideAtT(n)},divideAtLength:function(t,e){var n=this.tAtLength(t,e);return this.divideAtT(n)},divideAtT:function(t){var e=this.start;var n=this.controlPoint1;var r=this.controlPoint2;var i=this.end;if(t<=0)return[new Curve(e,e,e,e),new Curve(e,n,r,i)];if(t>=1)return[new Curve(e,n,r,i),new Curve(i,i,i,i)];var o=this.getSkeletonPoints(t);var s=o.startControlPoint1;var a=o.startControlPoint2;var c=o.divider;var l=o.dividerControlPoint1;var u=o.dividerControlPoint2;return[new Curve(e,s,a,c),new Curve(c,l,u,i)]},endpointDistance:function(){return this.start.distance(this.end)},equals:function(t){return!!t&&this.start.x===t.start.x&&this.start.y===t.start.y&&this.controlPoint1.x===t.controlPoint1.x&&this.controlPoint1.y===t.controlPoint1.y&&this.controlPoint2.x===t.controlPoint2.x&&this.controlPoint2.y===t.controlPoint2.y&&this.end.x===t.end.x&&this.end.y===t.end.y},getSkeletonPoints:function(t){var e=this.start;var n=this.controlPoint1;var r=this.controlPoint2;var i=this.end;if(t<=0)return{startControlPoint1:e.clone(),startControlPoint2:e.clone(),divider:e.clone(),dividerControlPoint1:n.clone(),dividerControlPoint2:r.clone()};if(t>=1)return{startControlPoint1:n.clone(),startControlPoint2:r.clone(),divider:i.clone(),dividerControlPoint1:i.clone(),dividerControlPoint2:i.clone()};var o=new Line(e,n).pointAt(t);var s=new Line(n,r).pointAt(t);var a=new Line(r,i).pointAt(t);var c=new Line(o,s).pointAt(t);var l=new Line(s,a).pointAt(t);var u=new Line(c,l).pointAt(t);var h={startControlPoint1:o,startControlPoint2:c,divider:u,dividerControlPoint1:l,dividerControlPoint2:a};return h},getSubdivisions:function(t){t=t||{};var e=t.precision===void 0?this.PRECISION:t.precision;var n=this.start;var r=this.controlPoint1;var i=this.controlPoint2;var o=this.end;var s=[new Curve(n,r,i,o)];if(e===0)return s;var a=!this.isDifferentiable();if(a)return s;var c=this.endpointDistance();var l=D(10,-e);var u=2;var h=r.cross(n,o)===0&&i.cross(n,o)===0;h&&(u=2*e);var d=0;while(true){d+=1;var f=[];var p=s.length;for(var g=0;g<p;g++){var v=s[g];var m=v.divide(.5);f.push(m[0],m[1])}var y=0;var b=f.length;for(var x=0;x<b;x++){var w=f[x];y+=w.endpointDistance()}if(d>=u){var A=y!==0?(y-c)/y:0;if(A<l)return f}s=f;c=y}},isDifferentiable:function(){var t=this.start;var e=this.controlPoint1;var n=this.controlPoint2;var r=this.end;return!(t.equals(e)&&e.equals(n)&&n.equals(r))},length:function(t){t=t||{};var e=t.precision===void 0?this.PRECISION:t.precision;var n=t.subdivisions===void 0?this.getSubdivisions({precision:e}):t.subdivisions;var r=0;var i=n.length;for(var o=0;o<i;o++){var s=n[o];r+=s.endpointDistance()}return r},lengthAtT:function(t,e){if(t<=0)return 0;e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision;var r=this.divide(t)[0];var i=r.length({precision:n});return i},pointAt:function(t,e){if(t<=0)return this.start.clone();if(t>=1)return this.end.clone();var n=this.tAt(t,e);return this.pointAtT(n)},pointAtLength:function(t,e){var n=this.tAtLength(t,e);return this.pointAtT(n)},pointAtT:function(t){return t<=0?this.start.clone():t>=1?this.end.clone():this.getSkeletonPoints(t).divider},PRECISION:3,round:function(t){this.start.round(t);this.controlPoint1.round(t);this.controlPoint2.round(t);this.end.round(t);return this},scale:function(t,e,n){this.start.scale(t,e,n);this.controlPoint1.scale(t,e,n);this.controlPoint2.scale(t,e,n);this.end.scale(t,e,n);return this},tangentAt:function(t,e){if(!this.isDifferentiable())return null;t<0?t=0:t>1&&(t=1);var n=this.tAt(t,e);return this.tangentAtT(n)},tangentAtLength:function(t,e){if(!this.isDifferentiable())return null;var n=this.tAtLength(t,e);return this.tangentAtT(n)},tangentAtT:function(t){if(!this.isDifferentiable())return null;t<0?t=0:t>1&&(t=1);var e=this.getSkeletonPoints(t);var n=e.startControlPoint2;var r=e.dividerControlPoint1;var i=e.divider;var o=new Line(n,r);o.translate(i.x-n.x,i.y-n.y);return o},tAt:function(t,e){if(t<=0)return 0;if(t>=1)return 1;e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision;var r=e.subdivisions===void 0?this.getSubdivisions({precision:n}):e.subdivisions;var i={precision:n,subdivisions:r};var o=this.length(i);var s=o*t;return this.tAtLength(s,i)},tAtLength:function(t,e){var n=true;if(t<0){n=false;t=-t}e=e||{};var r=e.precision===void 0?this.PRECISION:e.precision;var i=e.subdivisions===void 0?this.getSubdivisions({precision:r}):e.subdivisions;var o={precision:r,subdivisions:i};var s;var a;var c;var l;var u;var h=0;var d=i.length;var f=1/d;for(var p=0;p<d;p++){var g=n?p:d-1-p;var v=i[p];var m=v.endpointDistance();if(t<=h+m){s=v;a=g*f;c=(g+1)*f;l=n?t-h:m+h-t;u=n?m+h-t:t-h;break}h+=m}if(!s)return n?1:0;var y=this.length(o);var b=D(10,-r);while(true){var x;x=y!==0?l/y:0;if(x<b)return a;x=y!==0?u/y:0;if(x<b)return c;var w;var A;var P=s.divide(.5);f/=2;var T=P[0].endpointDistance();var E=P[1].endpointDistance();if(l<=T){s=P[0];c-=f;w=l;A=T-w}else{s=P[1];a+=f;w=l-T;A=E-w}l=w;u=A}},toPoints:function(t){t=t||{};var e=t.precision===void 0?this.PRECISION:t.precision;var n=t.subdivisions===void 0?this.getSubdivisions({precision:e}):t.subdivisions;var r=[n[0].start.clone()];var i=n.length;for(var o=0;o<i;o++){var s=n[o];r.push(s.end.clone())}return r},toPolyline:function(t){return new Polyline$1(this.toPoints(t))},toString:function(){return this.start+" "+this.controlPoint1+" "+this.controlPoint2+" "+this.end},translate:function(t,e){this.start.translate(t,e);this.controlPoint1.translate(t,e);this.controlPoint2.translate(t,e);this.end.translate(t,e);return this}};Curve.prototype.divide=Curve.prototype.divideAtT;function extend$1(t){var e;var n;var r=[];n=arguments.length;for(e=1;e<n;e++)r.push(arguments[e]);if(!t)throw new Error("Missing a parent object.");var i=Object.create(t);n=r.length;for(e=0;e<n;e++){var o=r[e];var s;var a;for(a in o)if(o.hasOwnProperty(a)){delete i[a];s=Object.getOwnPropertyDescriptor(o,a);Object.defineProperty(i,a,s)}}return i}const Path$1=function(t){if(!(this instanceof Path$1))return new Path$1(t);if(typeof t==="string")return new Path$1.parse(t);this.segments=[];var e;var n;if(t)if(Array.isArray(t)&&t.length!==0){t=t.reduce((function(t,e){return t.concat(e)}),[]);n=t.length;if(t[0].isSegment)for(e=0;e<n;e++){var r=t[e];this.appendSegment(r)}else{var i=null;for(e=0;e<n;e++){var o=t[e];if(!(o instanceof Line||o instanceof Curve))throw new Error("Cannot construct a path segment from the provided object.");e===0&&this.appendSegment(Path$1.createSegment("M",o.start));i&&!i.end.equals(o.start)&&this.appendSegment(Path$1.createSegment("M",o.start));o instanceof Line?this.appendSegment(Path$1.createSegment("L",o.end)):o instanceof Curve&&this.appendSegment(Path$1.createSegment("C",o.controlPoint1,o.controlPoint2,o.end));i=o}}}else if(t.isSegment)this.appendSegment(t);else if(t instanceof Line){this.appendSegment(Path$1.createSegment("M",t.start));this.appendSegment(Path$1.createSegment("L",t.end))}else if(t instanceof Curve){this.appendSegment(Path$1.createSegment("M",t.start));this.appendSegment(Path$1.createSegment("C",t.controlPoint1,t.controlPoint2,t.end))}else{if(!(t instanceof Polyline$1))throw new Error("Cannot construct a path from the provided object.");if(!(t.points&&t.points.length!==0))return;n=t.points.length;for(e=0;e<n;e++){var s=t.points[e];e===0?this.appendSegment(Path$1.createSegment("M",s)):this.appendSegment(Path$1.createSegment("L",s))}}else;};Path$1.parse=function(t){if(!t)return new Path$1;var e=new Path$1;var n=/(?:[a-zA-Z] *)(?:(?:-?\d+(?:\.\d+)?(?:e[-+]?\d+)? *,? *)|(?:-?\.\d+ *,? *))+|(?:[a-zA-Z] *)(?! |\d|-|\.)/g;var r=t.match(n);var i=r.length;for(var o=0;o<i;o++){var s=r[o];var a=/(?:[a-zA-Z])|(?:(?:-?\d+(?:\.\d+)?(?:e[-+]?\d+)?))|(?:(?:-?\.\d+))/g;var c=s.match(a);var l=Path$1.createSegment.apply(this,c);e.appendSegment(l)}return e};Path$1.createSegment=function(t){if(!t)throw new Error("Type must be provided.");var e=Path$1.segmentTypes[t];if(!e)throw new Error(t+" is not a recognized path segment type.");var n=[];var r=arguments.length;for(var i=1;i<r;i++)n.push(arguments[i]);return applyToNew(e,n)};Path$1.prototype={type:a.Path,appendSegment:function(t){var e=this.segments;var n=e.length;var r;var i=n!==0?e[n-1]:null;var o=null;if(Array.isArray(t)){t=t.reduce((function(t,e){return t.concat(e)}),[]);if(!t[0].isSegment)throw new Error("Segments required.");var s=t.length;for(var a=0;a<s;a++){var c=t[a];r=this.prepareSegment(c,i,o);e.push(r);i=r}}else{if(!t||!t.isSegment)throw new Error("Segment required.");r=this.prepareSegment(t,i,o);e.push(r)}},bbox:function(){var t=this.segments;var e=t.length;if(e===0)return null;var n;for(var r=0;r<e;r++){var i=t[r];if(i.isVisible){var o=i.bbox();n=n?n.union(o):o}}if(n)return n;var s=t[e-1];return new Rect(s.end.x,s.end.y,0,0)},clone:function(){var t=this.segments;var e=t.length;var n=new Path$1;for(var r=0;r<e;r++){var i=t[r].clone();n.appendSegment(i)}return n},closestPoint:function(t,e){var n=this.closestPointT(t,e);return n?this.pointAtT(n):null},closestPointLength:function(t,e){e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision;var r=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:n}):e.segmentSubdivisions;var i={precision:n,segmentSubdivisions:r};var o=this.closestPointT(t,i);return o?this.lengthAtT(o,i):0},closestPointNormalizedLength:function(t,e){e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision;var r=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:n}):e.segmentSubdivisions;var i={precision:n,segmentSubdivisions:r};var o=this.closestPointLength(t,i);if(o===0)return 0;var s=this.length(i);return s===0?0:o/s},closestPointT:function(t,e){var n=this.segments;var r=n.length;if(r===0)return null;e=e||{};var i=e.precision===void 0?this.PRECISION:e.precision;var o=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions;var s;var a=Infinity;for(var c=0;c<r;c++){var l=n[c];var u=o[c];if(l.isVisible){var h=l.closestPointT(t,{precision:i,subdivisions:u});var d=l.pointAtT(h);var f=new Line(d,t).squaredLength();if(f<a){s={segmentIndex:c,value:h};a=f}}}return s||{segmentIndex:r-1,value:1}},closestPointTangent:function(t,e){var n=this.segments;var r=n.length;if(r===0)return null;e=e||{};var i=e.precision===void 0?this.PRECISION:e.precision;var o=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions;var s;var a=Infinity;for(var c=0;c<r;c++){var l=n[c];var u=o[c];if(l.isDifferentiable()){var h=l.closestPointT(t,{precision:i,subdivisions:u});var d=l.pointAtT(h);var f=new Line(d,t).squaredLength();if(f<a){s=l.tangentAtT(h);a=f}}}return s||null},containsPoint:function(t,e){var n=this.toPolylines(e);if(!n)return false;var r=n.length;var i=0;for(var o=0;o<r;o++){var s=n[o];s.containsPoint(t)&&i++}return i%2===1},divideAt:function(t,e){var n=this.segments;var r=n.length;if(r===0)return null;t<0&&(t=0);t>1&&(t=1);e=e||{};var i=e.precision===void 0?this.PRECISION:e.precision;var o=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions;var s={precision:i,segmentSubdivisions:o};var a=this.length(s);var c=a*t;return this.divideAtLength(c,s)},divideAtLength:function(t,e){var n=this.segments.length;if(n===0)return null;var r=true;if(t<0){r=false;t=-t}e=e||{};var i=e.precision===void 0?this.PRECISION:e.precision;var o=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions;var s;var a;var c=0;var l;var u;var h;var d;var f;for(s=0;s<n;s++){var p=r?s:n-1-s;a=this.getSegment(p);var g=o[p];var v=a.length({precision:i,subdivisions:g});if(a.isDifferentiable()){h=a;d=p;if(t<=c+v){u=p;l=a.divideAtLength((r?1:-1)*(t-c),{precision:i,subdivisions:g});break}}c+=v}if(!h)return null;if(!l){u=d;f=r?1:0;l=h.divideAtT(f)}var m=this.clone();m.replaceSegment(u,l);var y=u;var b=u+1;var x=u+2;if(!l[0].isDifferentiable()){m.removeSegment(y);b-=1;x-=1}var w=m.getSegment(b).start;m.insertSegment(b,Path$1.createSegment("M",w));x+=1;if(!l[1].isDifferentiable()){m.removeSegment(x-1);x-=1}var A=x-y-1;for(s=x;s<m.segments.length;s++){var P=this.getSegment(s-A);a=m.getSegment(s);if(a.type==="Z"&&!P.subpathStartSegment.end.equals(a.subpathStartSegment.end)){var T=Path$1.createSegment("L",P.end);m.replaceSegment(s,T)}}var E=new Path$1(m.segments.slice(0,b));var S=new Path$1(m.segments.slice(b));return[E,S]},equals:function(t){if(!t)return false;var e=this.segments;var n=t.segments;var r=e.length;if(n.length!==r)return false;for(var i=0;i<r;i++){var o=e[i];var s=n[i];if(o.type!==s.type||!o.equals(s))return false}return true},getSegment:function(t){var e=this.segments;var n=e.length;if(n===0)throw new Error("Path has no segments.");t<0&&(t=n+t);if(t>=n||t<0)throw new Error("Index out of range.");return e[t]},getSegmentSubdivisions:function(t){var e=this.segments;var n=e.length;t=t||{};var r=t.precision===void 0?this.PRECISION:t.precision;var i=[];for(var o=0;o<n;o++){var s=e[o];var a=s.getSubdivisions({precision:r});i.push(a)}return i},getSubpaths:function(){const t=this.clone().validate();const e=t.segments;const n=e.length;const r=[];for(let t=0;t<n;t++){const n=e[t];n.isSubpathStart?r.push(new Path$1(n)):r[r.length-1].appendSegment(n)}return r},insertSegment:function(t,e){var n=this.segments;var r=n.length;t<0&&(t=r+t+1);if(t>r||t<0)throw new Error("Index out of range.");var i;var o=null;var s=null;if(r!==0)if(t>=1){o=n[t-1];s=o.nextSegment}else s=n[0];if(Array.isArray(e)){e=e.reduce((function(t,e){return t.concat(e)}),[]);if(!e[0].isSegment)throw new Error("Segments required.");var a=e.length;for(var c=0;c<a;c++){var l=e[c];i=this.prepareSegment(l,o,s);n.splice(t+c,0,i);o=i}}else{if(!e||!e.isSegment)throw new Error("Segment required.");i=this.prepareSegment(e,o,s);n.splice(t,0,i)}},intersectionWithLine:function(t,e){var n=null;var r=this.toPolylines(e);if(!r)return null;for(var i=0,o=r.length;i<o;i++){var s=r[i];var a=t.intersect(s);if(a){n||(n=[]);Array.isArray(a)?Array.prototype.push.apply(n,a):n.push(a)}}return n},isDifferentiable:function(){var t=this.segments;var e=t.length;for(var n=0;n<e;n++){var r=t[n];if(r.isDifferentiable())return true}return false},isValid:function(){var t=this.segments;var e=t.length===0||t[0].type==="M";return e},length:function(t){var e=this.segments;var n=e.length;if(n===0)return 0;t=t||{};var r=t.precision===void 0?this.PRECISION:t.precision;var i=t.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:r}):t.segmentSubdivisions;var o=0;for(var s=0;s<n;s++){var a=e[s];var c=i[s];o+=a.length({subdivisions:c})}return o},lengthAtT:function(t,e){var n=this.segments;var r=n.length;if(r===0)return 0;var i=t.segmentIndex;if(i<0)return 0;var o=t.value;if(i>=r){i=r-1;o=1}else o<0?o=0:o>1&&(o=1);e=e||{};var s=e.precision===void 0?this.PRECISION:e.precision;var a=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:s}):e.segmentSubdivisions;var c;var l=0;for(var u=0;u<i;u++){var h=n[u];c=a[u];l+=h.length({precisison:s,subdivisions:c})}h=n[i];c=a[i];l+=h.lengthAtT(o,{precisison:s,subdivisions:c});return l},pointAt:function(t,e){var n=this.segments;var r=n.length;if(r===0)return null;if(t<=0)return this.start.clone();if(t>=1)return this.end.clone();e=e||{};var i=e.precision===void 0?this.PRECISION:e.precision;var o=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions;var s={precision:i,segmentSubdivisions:o};var a=this.length(s);var c=a*t;return this.pointAtLength(c,s)},pointAtLength:function(t,e){var n=this.segments;var r=n.length;if(r===0)return null;if(t===0)return this.start.clone();var i=true;if(t<0){i=false;t=-t}e=e||{};var o=e.precision===void 0?this.PRECISION:e.precision;var s=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:o}):e.segmentSubdivisions;var a;var c=0;for(var l=0;l<r;l++){var u=i?l:r-1-l;var h=n[u];var d=s[u];var f=h.length({precision:o,subdivisions:d});if(h.isVisible){if(t<=c+f)return h.pointAtLength((i?1:-1)*(t-c),{precision:o,subdivisions:d});a=h}c+=f}if(a)return i?a.end:a.start;var p=n[r-1];return p.end.clone()},pointAtT:function(t){var e=this.segments;var n=e.length;if(n===0)return null;var r=t.segmentIndex;if(r<0)return e[0].pointAtT(0);if(r>=n)return e[n-1].pointAtT(1);var i=t.value;i<0?i=0:i>1&&(i=1);return e[r].pointAtT(i)},PRECISION:3,prepareSegment:function(t,e,n){t.previousSegment=e;t.nextSegment=n;e&&(e.nextSegment=t);n&&(n.previousSegment=t);var r=t;if(t.isSubpathStart){t.subpathStartSegment=t;r=n}r&&this.updateSubpathStartSegment(r);return t},removeSegment:function(t){var e=this.segments;var n=e.length;if(n===0)throw new Error("Path has no segments.");t<0&&(t=n+t);if(t>=n||t<0)throw new Error("Index out of range.");var r=e.splice(t,1)[0];var i=r.previousSegment;var o=r.nextSegment;i&&(i.nextSegment=o);o&&(o.previousSegment=i);r.isSubpathStart&&o&&this.updateSubpathStartSegment(o)},replaceSegment:function(t,e){var n=this.segments;var r=n.length;if(r===0)throw new Error("Path has no segments.");t<0&&(t=r+t);if(t>=r||t<0)throw new Error("Index out of range.");var i;var o=n[t];var s=o.previousSegment;var a=o.nextSegment;var c=o.isSubpathStart;if(Array.isArray(e)){e=e.reduce((function(t,e){return t.concat(e)}),[]);if(!e[0].isSegment)throw new Error("Segments required.");n.splice(t,1);var l=e.length;for(var u=0;u<l;u++){var h=e[u];i=this.prepareSegment(h,s,a);n.splice(t+u,0,i);s=i;c&&i.isSubpathStart&&(c=false)}}else{if(!e||!e.isSegment)throw new Error("Segment required.");i=this.prepareSegment(e,s,a);n.splice(t,1,i);c&&i.isSubpathStart&&(c=false)}c&&a&&this.updateSubpathStartSegment(a)},round:function(t){var e=this.segments;var n=e.length;for(var r=0;r<n;r++){var i=e[r];i.round(t)}return this},scale:function(t,e,n){var r=this.segments;var i=r.length;for(var o=0;o<i;o++){var s=r[o];s.scale(t,e,n)}return this},segmentAt:function(t,e){var n=this.segmentIndexAt(t,e);return n?this.getSegment(n):null},segmentAtLength:function(t,e){var n=this.segmentIndexAtLength(t,e);return n?this.getSegment(n):null},segmentIndexAt:function(t,e){var n=this.segments;var r=n.length;if(r===0)return null;t<0&&(t=0);t>1&&(t=1);e=e||{};var i=e.precision===void 0?this.PRECISION:e.precision;var o=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions;var s={precision:i,segmentSubdivisions:o};var a=this.length(s);var c=a*t;return this.segmentIndexAtLength(c,s)},segmentIndexAtLength:function(t,e){var n=this.segments;var r=n.length;if(r===0)return null;var i=true;if(t<0){i=false;t=-t}e=e||{};var o=e.precision===void 0?this.PRECISION:e.precision;var s=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:o}):e.segmentSubdivisions;var a=null;var c=0;for(var l=0;l<r;l++){var u=i?l:r-1-l;var h=n[u];var d=s[u];var f=h.length({precision:o,subdivisions:d});if(h.isVisible){if(t<=c+f)return u;a=u}c+=f}return a},serialize:function(){if(!this.isValid())throw new Error("Invalid path segments.");return this.toString()},tangentAt:function(t,e){var n=this.segments;var r=n.length;if(r===0)return null;t<0&&(t=0);t>1&&(t=1);e=e||{};var i=e.precision===void 0?this.PRECISION:e.precision;var o=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions;var s={precision:i,segmentSubdivisions:o};var a=this.length(s);var c=a*t;return this.tangentAtLength(c,s)},tangentAtLength:function(t,e){var n=this.segments;var r=n.length;if(r===0)return null;var i=true;if(t<0){i=false;t=-t}e=e||{};var o=e.precision===void 0?this.PRECISION:e.precision;var s=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:o}):e.segmentSubdivisions;var a;var c=0;for(var l=0;l<r;l++){var u=i?l:r-1-l;var h=n[u];var d=s[u];var f=h.length({precision:o,subdivisions:d});if(h.isDifferentiable()){if(t<=c+f)return h.tangentAtLength((i?1:-1)*(t-c),{precision:o,subdivisions:d});a=h}c+=f}if(a){var p=i?1:0;return a.tangentAtT(p)}return null},tangentAtT:function(t){var e=this.segments;var n=e.length;if(n===0)return null;var r=t.segmentIndex;if(r<0)return e[0].tangentAtT(0);if(r>=n)return e[n-1].tangentAtT(1);var i=t.value;i<0?i=0:i>1&&(i=1);return e[r].tangentAtT(i)},toPoints:function(t){var e=this.segments;var n=e.length;if(n===0)return null;t=t||{};var r=t.precision===void 0?this.PRECISION:t.precision;var i=t.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:r}):t.segmentSubdivisions;var o=[];var s=[];for(var a=0;a<n;a++){var c=e[a];if(c.isVisible){var l=i[a];if(l.length>0){var u=l.map((function(t){return t.start}));Array.prototype.push.apply(s,u)}else s.push(c.start)}else if(s.length>0){s.push(e[a-1].end);o.push(s);s=[]}}if(s.length>0){s.push(this.end);o.push(s)}return o},toPolylines:function(t){var e=[];var n=this.toPoints(t);if(!n)return null;for(var r=0,i=n.length;r<i;r++)e.push(new Polyline$1(n[r]));return e},toString:function(){var t=this.segments;var e=t.length;var n="";for(var r=0;r<e;r++){var i=t[r];n+=i.serialize()+" "}return n.trim()},translate:function(t,e){var n=this.segments;var r=n.length;for(var i=0;i<r;i++){var o=n[i];o.translate(t,e)}return this},updateSubpathStartSegment:function(t){var e=t.previousSegment;while(t&&!t.isSubpathStart){t.subpathStartSegment=e?e.subpathStartSegment:null;e=t;t=t.nextSegment}},validate:function(){this.isValid()||this.insertSegment(0,Path$1.createSegment("M",0,0));return this}};Object.defineProperty(Path$1.prototype,"start",{configurable:true,enumerable:true,get:function(){var t=this.segments;var e=t.length;if(e===0)return null;for(var n=0;n<e;n++){var r=t[n];if(r.isVisible)return r.start}return t[e-1].end}});Object.defineProperty(Path$1.prototype,"end",{configurable:true,enumerable:true,get:function(){var t=this.segments;var e=t.length;if(e===0)return null;for(var n=e-1;n>=0;n--){var r=t[n];if(r.isVisible)return r.end}return t[e-1].end}});function applyToNew(t,e){e.unshift(null);return new(Function.prototype.bind.apply(t,e))}var z={bbox:function(){throw new Error("Declaration missing for virtual function.")},clone:function(){throw new Error("Declaration missing for virtual function.")},closestPoint:function(){throw new Error("Declaration missing for virtual function.")},closestPointLength:function(){throw new Error("Declaration missing for virtual function.")},closestPointNormalizedLength:function(){throw new Error("Declaration missing for virtual function.")},closestPointT:function(t){if(this.closestPointNormalizedLength)return this.closestPointNormalizedLength(t);throw new Error("Neither closestPointT() nor closestPointNormalizedLength() function is implemented.")},closestPointTangent:function(){throw new Error("Declaration missing for virtual function.")},divideAt:function(){throw new Error("Declaration missing for virtual function.")},divideAtLength:function(){throw new Error("Declaration missing for virtual function.")},divideAtT:function(t){if(this.divideAt)return this.divideAt(t);throw new Error("Neither divideAtT() nor divideAt() function is implemented.")},equals:function(){throw new Error("Declaration missing for virtual function.")},getSubdivisions:function(){throw new Error("Declaration missing for virtual function.")},isDifferentiable:function(){throw new Error("Declaration missing for virtual function.")},isSegment:true,isSubpathStart:false,isVisible:true,length:function(){throw new Error("Declaration missing for virtual function.")},lengthAtT:function(t){if(t<=0)return 0;var e=this.length();return t>=1?e:e*t},nextSegment:null,pointAt:function(){throw new Error("Declaration missing for virtual function.")},pointAtLength:function(){throw new Error("Declaration missing for virtual function.")},pointAtT:function(t){if(this.pointAt)return this.pointAt(t);throw new Error("Neither pointAtT() nor pointAt() function is implemented.")},previousSegment:null,round:function(){throw new Error("Declaration missing for virtual function.")},subpathStartSegment:null,scale:function(){throw new Error("Declaration missing for virtual function.")},serialize:function(){throw new Error("Declaration missing for virtual function.")},tangentAt:function(){throw new Error("Declaration missing for virtual function.")},tangentAtLength:function(){throw new Error("Declaration missing for virtual function.")},tangentAtT:function(t){if(this.tangentAt)return this.tangentAt(t);throw new Error("Neither tangentAtT() nor tangentAt() function is implemented.")},toString:function(){throw new Error("Declaration missing for virtual function.")},translate:function(){throw new Error("Declaration missing for virtual function.")}};Object.defineProperty(z,"end",{configurable:true,enumerable:true,writable:true});Object.defineProperty(z,"start",{configurable:true,enumerable:true,get:function(){if(!this.previousSegment)throw new Error("Missing previous segment. (This segment cannot be the first segment of a path; OR segment has not yet been added to a path.)");return this.previousSegment.end}});Object.defineProperty(z,"type",{configurable:true,enumerable:true,get:function(){throw new Error("Bad segment declaration. No type specified.")}});var Lineto=function(){var t=[];var e=arguments.length;for(var n=0;n<e;n++)t.push(arguments[n]);if(!(this instanceof Lineto))return applyToNew(Lineto,t);if(e===0)throw new Error("Lineto constructor expects a line, 1 point, or 2 coordinates (none provided).");var r;if(t[0]instanceof Line){if(e===1){this.end=t[0].end.clone();return this}throw new Error("Lineto constructor expects a line, 1 point, or 2 coordinates ("+e+" lines provided).")}if(typeof t[0]==="string"||typeof t[0]==="number"){if(e===2){this.end=new Point(+t[0],+t[1]);return this}if(e<2)throw new Error("Lineto constructor expects a line, 1 point, or 2 coordinates ("+e+" coordinates provided).");var i;r=[];for(n=0;n<e;n+=2){i=t.slice(n,n+2);r.push(applyToNew(Lineto,i))}return r}if(e===1){this.end=new Point(t[0]);return this}var o;r=[];for(n=0;n<e;n+=1){o=t[n];r.push(new Lineto(o))}return r};var j={clone:function(){return new Lineto(this.end)},divideAt:function(t){var e=new Line(this.start,this.end);var n=e.divideAt(t);return[new Lineto(n[0]),new Lineto(n[1])]},divideAtLength:function(t){var e=new Line(this.start,this.end);var n=e.divideAtLength(t);return[new Lineto(n[0]),new Lineto(n[1])]},getSubdivisions:function(){return[]},isDifferentiable:function(){return!!this.previousSegment&&!this.start.equals(this.end)},round:function(t){this.end.round(t);return this},scale:function(t,e,n){this.end.scale(t,e,n);return this},serialize:function(){var t=this.end;return this.type+" "+t.x+" "+t.y},toString:function(){return this.type+" "+this.start+" "+this.end},translate:function(t,e){this.end.translate(t,e);return this}};Object.defineProperty(j,"type",{configurable:true,enumerable:true,value:"L"});Lineto.prototype=extend$1(z,Line.prototype,j);var Curveto=function(){var t=[];var e=arguments.length;for(var n=0;n<e;n++)t.push(arguments[n]);if(!(this instanceof Curveto))return applyToNew(Curveto,t);if(e===0)throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates (none provided).");var r;if(t[0]instanceof Curve){if(e===1){this.controlPoint1=t[0].controlPoint1.clone();this.controlPoint2=t[0].controlPoint2.clone();this.end=t[0].end.clone();return this}throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates ("+e+" curves provided).")}if(typeof t[0]==="string"||typeof t[0]==="number"){if(e===6){this.controlPoint1=new Point(+t[0],+t[1]);this.controlPoint2=new Point(+t[2],+t[3]);this.end=new Point(+t[4],+t[5]);return this}if(e<6)throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates ("+e+" coordinates provided).");var i;r=[];for(n=0;n<e;n+=6){i=t.slice(n,n+6);r.push(applyToNew(Curveto,i))}return r}if(e===3){this.controlPoint1=new Point(t[0]);this.controlPoint2=new Point(t[1]);this.end=new Point(t[2]);return this}if(e<3)throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates ("+e+" points provided).");var o;r=[];for(n=0;n<e;n+=3){o=t.slice(n,n+3);r.push(applyToNew(Curveto,o))}return r};var G={clone:function(){return new Curveto(this.controlPoint1,this.controlPoint2,this.end)},divideAt:function(t,e){var n=new Curve(this.start,this.controlPoint1,this.controlPoint2,this.end);var r=n.divideAt(t,e);return[new Curveto(r[0]),new Curveto(r[1])]},divideAtLength:function(t,e){var n=new Curve(this.start,this.controlPoint1,this.controlPoint2,this.end);var r=n.divideAtLength(t,e);return[new Curveto(r[0]),new Curveto(r[1])]},divideAtT:function(t){var e=new Curve(this.start,this.controlPoint1,this.controlPoint2,this.end);var n=e.divideAtT(t);return[new Curveto(n[0]),new Curveto(n[1])]},isDifferentiable:function(){if(!this.previousSegment)return false;var t=this.start;var e=this.controlPoint1;var n=this.controlPoint2;var r=this.end;return!(t.equals(e)&&e.equals(n)&&n.equals(r))},round:function(t){this.controlPoint1.round(t);this.controlPoint2.round(t);this.end.round(t);return this},scale:function(t,e,n){this.controlPoint1.scale(t,e,n);this.controlPoint2.scale(t,e,n);this.end.scale(t,e,n);return this},serialize:function(){var t=this.controlPoint1;var e=this.controlPoint2;var n=this.end;return this.type+" "+t.x+" "+t.y+" "+e.x+" "+e.y+" "+n.x+" "+n.y},toString:function(){return this.type+" "+this.start+" "+this.controlPoint1+" "+this.controlPoint2+" "+this.end},translate:function(t,e){this.controlPoint1.translate(t,e);this.controlPoint2.translate(t,e);this.end.translate(t,e);return this}};Object.defineProperty(G,"type",{configurable:true,enumerable:true,value:"C"});Curveto.prototype=extend$1(z,Curve.prototype,G);var Moveto=function(){var t=[];var e=arguments.length;for(var n=0;n<e;n++)t.push(arguments[n]);if(!(this instanceof Moveto))return applyToNew(Moveto,t);if(e===0)throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates (none provided).");var r;if(t[0]instanceof Line){if(e===1){this.end=t[0].end.clone();return this}throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates ("+e+" lines provided).")}if(t[0]instanceof Curve){if(e===1){this.end=t[0].end.clone();return this}throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates ("+e+" curves provided).")}if(typeof t[0]==="string"||typeof t[0]==="number"){if(e===2){this.end=new Point(+t[0],+t[1]);return this}if(e<2)throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates ("+e+" coordinates provided).");var i;r=[];for(n=0;n<e;n+=2){i=t.slice(n,n+2);n===0?r.push(applyToNew(Moveto,i)):r.push(applyToNew(Lineto,i))}return r}if(e===1){this.end=new Point(t[0]);return this}var o;r=[];for(n=0;n<e;n+=1){o=t[n];n===0?r.push(new Moveto(o)):r.push(new Lineto(o))}return r};var U={bbox:function(){return null},clone:function(){return new Moveto(this.end)},closestPoint:function(){return this.end.clone()},closestPointNormalizedLength:function(){return 0},closestPointLength:function(){return 0},closestPointT:function(){return 1},closestPointTangent:function(){return null},divideAt:function(){return[this.clone(),this.clone()]},divideAtLength:function(){return[this.clone(),this.clone()]},equals:function(t){return this.end.equals(t.end)},getSubdivisions:function(){return[]},isDifferentiable:function(){return false},isSubpathStart:true,isVisible:false,length:function(){return 0},lengthAtT:function(){return 0},pointAt:function(){return this.end.clone()},pointAtLength:function(){return this.end.clone()},pointAtT:function(){return this.end.clone()},round:function(t){this.end.round(t);return this},scale:function(t,e,n){this.end.scale(t,e,n);return this},serialize:function(){var t=this.end;return this.type+" "+t.x+" "+t.y},tangentAt:function(){return null},tangentAtLength:function(){return null},tangentAtT:function(){return null},toString:function(){return this.type+" "+this.end},translate:function(t,e){this.end.translate(t,e);return this}};Object.defineProperty(U,"start",{configurable:true,enumerable:true,get:function(){throw new Error("Illegal access. Moveto segments should not need a start property.")}});Object.defineProperty(U,"type",{configurable:true,enumerable:true,value:"M"});Moveto.prototype=extend$1(z,U);var Closepath=function(){var t=[];var e=arguments.length;for(var n=0;n<e;n++)t.push(arguments[n]);if(!(this instanceof Closepath))return applyToNew(Closepath,t);if(e>0)throw new Error("Closepath constructor expects no arguments.");return this};var W={clone:function(){return new Closepath},divideAt:function(t){var e=new Line(this.start,this.end);var n=e.divideAt(t);return[n[1].isDifferentiable()?new Lineto(n[0]):this.clone(),new Lineto(n[1])]},divideAtLength:function(t){var e=new Line(this.start,this.end);var n=e.divideAtLength(t);return[n[1].isDifferentiable()?new Lineto(n[0]):this.clone(),new Lineto(n[1])]},getSubdivisions:function(){return[]},isDifferentiable:function(){return!(!this.previousSegment||!this.subpathStartSegment)&&!this.start.equals(this.end)},round:function(){return this},scale:function(){return this},serialize:function(){return this.type},toString:function(){return this.type+" "+this.start+" "+this.end},translate:function(){return this}};Object.defineProperty(W,"end",{configurable:true,enumerable:true,get:function(){if(!this.subpathStartSegment)throw new Error("Missing subpath start segment. (This segment needs a subpath start segment (e.g. Moveto); OR segment has not yet been added to a path.)");return this.subpathStartSegment.end}});Object.defineProperty(W,"type",{configurable:true,enumerable:true,value:"Z"});Closepath.prototype=extend$1(z,Line.prototype,W);var H=Path$1.segmentTypes={L:Lineto,C:Curveto,M:Moveto,Z:Closepath,z:Closepath};Path$1.regexSupportedData=new RegExp("^[\\s\\d"+Object.keys(H).join("")+",.]*$");Path$1.isDataSupported=function(t){return typeof t==="string"&&this.regexSupportedData.test(t)};const q={curveThroughPoints:function(t){console.warn("deprecated");return new Path$1(Curve.throughPoints(t)).serialize()},getCurveControlPoints:function(t){console.warn("deprecated");var e=[];var n=[];var r=t.length-1;var i;if(r==1){e[0]=new Point((2*t[0].x+t[1].x)/3,(2*t[0].y+t[1].y)/3);n[0]=new Point(2*e[0].x-t[0].x,2*e[0].y-t[0].y);return[e,n]}var o=[];for(i=1;i<r-1;i++)o[i]=4*t[i].x+2*t[i+1].x;o[0]=t[0].x+2*t[1].x;o[r-1]=(8*t[r-1].x+t[r].x)/2;var s=this.getFirstControlPoints(o);for(i=1;i<r-1;++i)o[i]=4*t[i].y+2*t[i+1].y;o[0]=t[0].y+2*t[1].y;o[r-1]=(8*t[r-1].y+t[r].y)/2;var a=this.getFirstControlPoints(o);for(i=0;i<r;i++){e.push(new Point(s[i],a[i]));i<r-1?n.push(new Point(2*t[i+1].x-s[i+1],2*t[i+1].y-a[i+1])):n.push(new Point((t[r].x+s[r-1])/2,(t[r].y+a[r-1])/2))}return[e,n]},getCurveDivider:function(t,e,n,r){console.warn("deprecated");var i=new Curve(t,e,n,r);return function divideCurve(t){var e=i.divide(t);return[{p0:e[0].start,p1:e[0].controlPoint1,p2:e[0].controlPoint2,p3:e[0].end},{p0:e[1].start,p1:e[1].controlPoint1,p2:e[1].controlPoint2,p3:e[1].end}]}},getFirstControlPoints:function(t){console.warn("deprecated");var e=t.length;var n=[];var r=[];var i=2;n[0]=t[0]/i;for(var o=1;o<e;o++){r[o]=1/i;i=(o<e-1?4:3.5)-r[o];n[o]=(t[o]-n[o-1])/i}for(o=1;o<e;o++)n[e-o-1]-=r[e-o]*n[e-o];return n},getInversionSolver:function(t,e,n,r){console.warn("deprecated");var i=new Curve(t,e,n,r);return function solveInversion(t){return i.closestPointT(t)}}};const Polygon$1=function(t){if(!(this instanceof Polygon$1))return new Polygon$1(t);if(typeof t==="string")return new Polygon$1.parse(t);this.points=Array.isArray(t)?t.map(Point):[]};Polygon$1.parse=function(t){return new Polygon$1(parsePoints(t))};Polygon$1.fromRect=function(t){return new Polygon$1([t.topLeft(),t.topRight(),t.bottomRight(),t.bottomLeft()])};Polygon$1.prototype=extend$1(Polyline$1.prototype,{type:a.Polygon,clone:function(){return new Polygon$1(clonePoints(this.points))},convexHull:function(){return new Polygon$1(convexHull(this.points))},lengthPoints:function(){const{start:t,end:e,points:n}=this;return n.length<=1||t.equals(e)?n:[...n,t.clone()]}});function exists(t,e,n,r){switch(t.type){case a.Line:switch(e.type){case a.Line:return lineWithLine(t,e)}break;case a.Ellipse:switch(e.type){case a.Line:return ellipseWithLine(t,e);case a.Ellipse:return ellipseWithEllipse(t,e)}break;case a.Rect:switch(e.type){case a.Line:return rectWithLine(t,e);case a.Ellipse:return rectWithEllipse(t,e);case a.Rect:return rectWithRect(t,e)}break;case a.Polyline:switch(e.type){case a.Line:return polylineWithLine(t,e);case a.Ellipse:return polylineWithEllipse(t,e);case a.Rect:return polylineWithRect(t,e);case a.Polyline:return polylineWithPolyline(t,e)}break;case a.Polygon:switch(e.type){case a.Line:return polygonWithLine(t,e);case a.Ellipse:return polygonWithEllipse(t,e);case a.Rect:return polygonWithRect(t,e);case a.Polyline:return polygonWithPolyline(t,e);case a.Polygon:return polygonWithPolygon(t,e)}break;case a.Path:switch(e.type){case a.Line:return pathWithLine(t,e,n);case a.Ellipse:return pathWithEllipse(t,e,n);case a.Rect:return pathWithRect(t,e,n);case a.Polyline:return pathWithPolyline(t,e,n);case a.Polygon:return pathWithPolygon(t,e,n);case a.Path:return pathWithPath(t,e,n,r)}break}switch(e.type){case a.Ellipse:case a.Rect:case a.Polyline:case a.Polygon:case a.Path:return exists(e,t,r,n);default:throw Error(`The intersection for ${t} and ${e} could not be found.`)}}function lineWithLine(t,e){const n=t.start.x;const r=t.start.y;const i=t.end.x;const o=t.end.y;const s=e.start.x;const a=e.start.y;const c=e.end.x;const l=e.end.y;const u=i-n;const h=o-r;const d=c-s;const f=l-a;const p=n-s;const g=r-a;const v=u*f-d*h;const m=(u*g-h*p)/v;const y=(d*g-f*p)/v;return m>=0&&m<=1&&y>=0&&y<=1}function ellipseWithLine(t,e){const n=t.a;const r=t.b;const i=t.x;const o=t.y;const s=e.start.x-i;const a=e.end.x-i;const c=e.start.y-o;const l=e.end.y-o;const u=n*n;const h=r*r;const d=a-s;const f=l-c;const p=d*d/u+f*f/h;const g=2*s*d/u+2*c*f/h;const v=s*s/u+c*c/h-1;const m=g*g-4*p*v;if(m===0){const t=-g/2/p;return t>=0&&t<=1}if(m>0){const t=Math.sqrt(m);const e=(-g+t)/2/p;const n=(-g-t)/2/p;return e>=0&&e<=1||n>=0&&n<=1}return false}function ellipseWithEllipse(t,e){return _ellipsesIntersection(t,0,e,0)}function rectWithLine(t,e){const{start:n,end:r}=e;const{x:i,y:o,width:s,height:a}=t;return!(n.x>i+s&&r.x>i+s||n.x<i&&r.x<i||n.y>o+a&&r.y>o+a||n.y<o&&r.y<o)&&(!(!t.containsPoint(e.start)&&!t.containsPoint(e.end))||(lineWithLine(t.topLine(),e)||lineWithLine(t.rightLine(),e)||lineWithLine(t.bottomLine(),e)||lineWithLine(t.leftLine(),e)))}function rectWithEllipse(t,e){return!!rectWithRect(t,Rect.fromEllipse(e))&&polygonWithEllipse(Polygon$1.fromRect(t),e)}function rectWithRect(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}function polylineWithLine(t,e){return _polylineWithLine(t,e,{interior:false})}function polylineWithEllipse(t,e){return _polylineWithEllipse(t,e,{interior:false})}function polylineWithRect(t,e){return _polylineWithRect(t,e,{interior:false})}function polylineWithPolyline(t,e){return _polylineWithPolyline(t,e,{interior:false})}function polygonWithLine(t,e){return _polylineWithLine(t,e,{interior:true})}function polygonWithEllipse(t,e){return _polylineWithEllipse(t,e,{interior:true})}function polygonWithRect(t,e){return _polylineWithRect(t,e,{interior:true})}function polygonWithPolyline(t,e){return _polylineWithPolyline(t,e,{interior:true})}function polygonWithPolygon(t,e){return _polylineWithPolygon(t,e,{interior:true})}function pathWithLine(t,e,n){return t.getSubpaths().some((t=>{const[r]=t.toPolylines(n);const{type:i}=t.getSegment(-1);return i==="Z"?polygonWithLine(r,e):polylineWithLine(r,e)}))}function pathWithEllipse(t,e,n){return t.getSubpaths().some((t=>{const[r]=t.toPolylines(n);const{type:i}=t.getSegment(-1);return i==="Z"?polygonWithEllipse(r,e):polylineWithEllipse(r,e)}))}function pathWithRect(t,e,n){return pathWithPolygon(t,Polygon$1.fromRect(e),n)}function pathWithPolyline(t,e,n){return _pathWithPolyline(t,e,n,{interior:false})}function pathWithPolygon(t,e,n){return _pathWithPolyline(t,e,n,{interior:true})}function pathWithPath(t,e,n,r){return t.getSubpaths().some((t=>{const[i]=t.toPolylines(n);const{type:o}=t.getSegment(-1);return o==="Z"?pathWithPolygon(e,i,r):pathWithPolyline(e,i,r)}))}function _polylineWithLine(t,e,n={}){const{interior:r=false}=n;let i;if(r){if(t.containsPoint(e.start))return true;const{start:n,end:r,points:o}=t;i=r.equals(n)?o:[...o,n]}else i=t.points;const{length:o}=i;const s=new Line;for(let t=0;t<o-1;t++){s.start=i[t];s.end=i[t+1];if(lineWithLine(e,s))return true}return false}function _polylineWithEllipse(t,e,n={}){const{start:r,end:i,points:o}=t;if(e.containsPoint(r))return true;let s;const{interior:a=false}=n;if(a){if(t.containsPoint(e.center()))return true;s=i.equals(r)?o:[...o,r]}else s=o;const{length:c}=s;const l=new Line;for(let t=0;t<c-1;t++){l.start=s[t];l.end=s[t+1];if(ellipseWithLine(e,l))return true}return false}function _polylineWithRect(t,e,n){const r=Polygon$1.fromRect(e);return _polylineWithPolygon(t,r,n)}function _pathWithPolyline(t,e,n,r){return t.getSubpaths().some((t=>{const[i]=t.toPolylines(n);const{type:o}=t.getSegment(-1);return o==="Z"?_polylineWithPolygon(e,i,r):_polylineWithPolyline(e,i,r)}))}function _polylineWithPolyline(t,e,n={}){const{interior:r=false}=n;let i;if(r){const{start:n}=e;if(t.containsPoint(n))return true;i=t.clone().close()}else i=t;const o=e.points;const{length:s}=o;const a=new Line;for(let t=0;t<s-1;t++){a.start=o[t];a.end=o[t+1];if(polylineWithLine(i,a))return true}return false}function _polylineWithPolygon(t,e,n){return e.containsPoint(t.start)||_polylineWithPolyline(t,e.clone().close(),n)}function _ellipsesIntersection(t,e,n,r){const{cos:i,sin:o}=Math;const s=o(e);const a=i(e);const c=o(r);const l=i(r);const u=s*s;const h=a*a;const d=s*a;const f=c*c;const p=l*l;const g=c*l;const v=t.a*t.a;const m=t.b*t.b;const y=n.a*n.a;const b=n.b*n.b;const x=v*u+m*h;const w=y*f+b*p;const A=v*h+m*u;const P=y*p+b*f;let T=2*(m-v)*d;let E=2*(b-y)*g;let S=-2*x*t.x-T*t.y;let k=-2*w*n.x-E*n.y;let L=-T*t.x-2*A*t.y;let C=-E*n.x-2*P*n.y;const _=x*t.x*t.x+A*t.y*t.y+T*t.x*t.y-v*m;const M=w*n.x*n.x+P*n.y*n.y+E*n.x*n.y-y*b;T/=2;E/=2;S/=2;k/=2;L/=2;C/=2;const N=det3([[x,T,S],[T,A,L],[S,L,_]]);const O=det3([[w,E,k],[E,P,C],[k,C,M]]);const R=.33333333*(det3([[w,T,S],[E,A,L],[k,L,_]])+det3([[x,E,S],[T,P,L],[S,C,_]])+det3([[x,T,k],[T,A,C],[S,L,M]]));const B=.33333333*(det3([[x,E,k],[T,P,C],[S,C,M]])+det3([[w,T,k],[E,A,C],[k,L,M]])+det3([[w,E,S],[E,P,L],[k,C,_]]));const I=det2([[N,R],[R,B]]);const F=det2([[N,B],[R,O]]);const D=det2([[R,B],[B,O]]);const z=det2([[2*I,F],[F,2*D]]);return!(z>0&&(B>0||R>0))}function det2(t){return t[0][0]*t[1][1]-t[0][1]*t[1][0]}function det3(t){return t[0][0]*t[1][1]*t[2][2]-t[0][0]*t[1][2]*t[2][1]-t[0][1]*t[1][0]*t[2][2]+t[0][1]*t[1][2]*t[2][0]+t[0][2]*t[1][0]*t[2][1]-t[0][2]*t[1][1]*t[2][0]}var Y=Object.freeze(Object.defineProperty({__proto__:null,ellipseWithEllipse:ellipseWithEllipse,ellipseWithLine:ellipseWithLine,exists:exists,lineWithLine:lineWithLine,pathWithEllipse:pathWithEllipse,pathWithLine:pathWithLine,pathWithPath:pathWithPath,pathWithPolygon:pathWithPolygon,pathWithPolyline:pathWithPolyline,pathWithRect:pathWithRect,polygonWithEllipse:polygonWithEllipse,polygonWithLine:polygonWithLine,polygonWithPolygon:polygonWithPolygon,polygonWithPolyline:polygonWithPolyline,polygonWithRect:polygonWithRect,polylineWithEllipse:polylineWithEllipse,polylineWithLine:polylineWithLine,polylineWithPolyline:polylineWithPolyline,polylineWithRect:polylineWithRect,rectWithEllipse:rectWithEllipse,rectWithLine:rectWithLine,rectWithRect:rectWithRect},Symbol.toStringTag,{value:"Module"}));const X=Y;var Z=Object.freeze(Object.defineProperty({__proto__:null,Curve:Curve,Ellipse:Ellipse$1,Line:Line,Path:Path$1,Point:Point,Polygon:Polygon$1,Polyline:Polyline$1,Rect:Rect,bezier:q,ellipse:E,intersection:X,line:w,normalizeAngle:normalizeAngle,point:y,random:random,rect:O,scale:r,snapToGrid:snapToGrid$1,toDeg:toDeg,toRad:toRad,types:a},Symbol.toStringTag,{value:"Module"}));const J=function(){var t=typeof window==="object"&&!!window.SVGAngle;if(!t)return function(){throw new Error("SVG is required to use Vectorizer.")};var e={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns/",xml:"http://www.w3.org/XML/1998/namespace",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml"};var n="1.1";var r=Math;var i=r.PI;var o=r.atan2;var s=r.sqrt;var a=r.min;var c=r.max;var l=r.cos;var u=r.sin;var V=function(t,n,r){if(!(this instanceof V))return V.apply(Object.create(V.prototype),arguments);if(t){V.isV(t)&&(t=t.node);n=n||{};if(V.isString(t)){t=t.trim();if(t.toLowerCase()==="svg")t=V.createSvgDocument();else if(t[0]==="<"){var i=V.createSvgDocument(t);if(i.childNodes.length>1){var o=[];var s,a;for(s=0,a=i.childNodes.length;s<a;s++){var c=i.childNodes[s];o.push(new V(document.importNode(c,true)))}return o}t=document.importNode(i.firstChild,true)}else t=document.createElementNS(e.svg,t);V.ensureId(t)}this.node=t;this.setAttributes(n);r&&this.append(r);return this}};var h=V.prototype;Object.defineProperty(h,"id",{enumerable:true,get:function(){return this.node.id},set:function(t){this.node.id=t}});
/**
     * @param {SVGGElement} toElem
     * @returns {SVGMatrix}
     */h.getTransformToElement=function(t){var e=this.node;if(V.isSVGGraphicsElement(t)&&V.isSVGGraphicsElement(e)){var n=V.toNode(t).getScreenCTM();var r=e.getScreenCTM();if(n&&r)return n.inverse().multiply(r)}return V.createSVGMatrix()};
/**
     * @param {SVGMatrix} matrix
     * @param {Object=} opt
     * @returns {Vectorizer|SVGMatrix} Setter / Getter
     */h.transform=function(t,e){var n=this.node;if(V.isUndefined(t))return V.transformStringToMatrix(this.attr("transform"));if(e&&e.absolute)return this.attr("transform",V.matrixToTransformString(t));var r=V.createSVGTransform(t);n.transform.baseVal.appendItem(r);return this};h.translate=function(t,e,n){n=n||{};e=e||0;var r=this.attr("transform")||"";var i=V.parseTransformString(r);r=i.value;if(V.isUndefined(t))return i.translate;r=r.replace(/translate\([^)]*\)/g,"").trim();var o=n.absolute?t:i.translate.tx+t;var s=n.absolute?e:i.translate.ty+e;var a="translate("+o+","+s+")";this.attr("transform",(a+" "+r).trim());return this};h.rotate=function(t,e,n,r){r=r||{};var i=this.attr("transform")||"";var o=V.parseTransformString(i);i=o.value;if(V.isUndefined(t))return o.rotate;i=i.replace(/rotate\([^)]*\)/g,"").trim();t%=360;var s=r.absolute?t:o.rotate.angle+t;var a=e!==void 0&&n!==void 0?","+e+","+n:"";var c="rotate("+s+a+")";this.attr("transform",(i+" "+c).trim());return this};h.scale=function(t,e){e=V.isUndefined(e)?t:e;var n=this.attr("transform")||"";var r=V.parseTransformString(n);n=r.value;if(V.isUndefined(t))return r.scale;n=n.replace(/scale\([^)]*\)/g,"").trim();var i="scale("+t+","+e+")";this.attr("transform",(n+" "+i).trim());return this};h.bbox=function(t,e){var n;var r=this.node;var i=r.ownerSVGElement;if(!i)return new Rect(0,0,0,0);try{n=r.getBBox()}catch(t){n={x:r.clientLeft,y:r.clientTop,width:r.clientWidth,height:r.clientHeight}}if(t)return new Rect(n);var o=this.getTransformToElement(e||i);return V.transformRect(n,o)};h.getBBox=function(t){var e={};var n;var r=this.node;var i=r.ownerSVGElement;if(!i||!V.isSVGGraphicsElement(r))return new Rect(0,0,0,0);if(t){t.target&&(e.target=V.toNode(t.target));t.recursive&&(e.recursive=t.recursive)}if(e.recursive){var o=this.children();var s=o.length;if(s===0)return this.getBBox({target:e.target,recursive:false});e.target||(e.target=this);for(var a=0;a<s;a++){var c=o[a];var l;l=c.children().length===0?c.getBBox({target:e.target,recursive:false}):c.getBBox({target:e.target,recursive:true});n=n?n.union(l):l}return n}try{n=r.getBBox()}catch(t){n={x:r.clientLeft,y:r.clientTop,width:r.clientWidth,height:r.clientHeight}}if(e.target){var u=this.getTransformToElement(e.target);return V.transformRect(n,u)}return new Rect(n)};function createTextPathNode(t,e){t||(t={});var n=V("textPath");var r=t.d;if(r&&t["xlink:href"]===void 0){var i=V("path").attr("d",r).appendTo(e.defs());n.attr("xlink:href","#"+i.id)}V.isObject(t)&&n.attr(t);return n.node}function annotateTextLine(t,e,n){n||(n={});var r=n.includeAnnotationIndices;var i=n.eol;var o=n.lineHeight;var s=n.baseSize;var a=0;var c={};var l=e.length-1;for(var u=0;u<=l;u++){var h=e[u];var d=null;if(V.isObject(h)){var f=h.attrs;var p=V("tspan",f);var g=p.node;var v=h.t;i&&u===l&&(v+=i);g.textContent=v;var m=f.class;m&&p.addClass(m);r&&p.attr("annotations",h.annotations);d=parseFloat(f["font-size"]);isFinite(d)||(d=s);d&&d>a&&(a=d)}else{i&&u===l&&(h+=i);g=document.createTextNode(h||" ");s&&s>a&&(a=s)}t.appendChild(g)}a&&(c.maxFontSize=a);o?c.lineHeight=o:a&&(c.lineHeight=a*1.2);return c}var d=/em$/;function convertEmToPx(t,e){var n=parseFloat(t);return d.test(t)?n*e:n}function calculateDY(t,e,n,r){if(!Array.isArray(e))return 0;var i=e.length;if(!i)return 0;var o=e[0];var s=convertEmToPx(o.maxFontSize,n)||n;var a=0;var c=convertEmToPx(r,n);for(var l=1;l<i;l++){o=e[l];var u=convertEmToPx(o.lineHeight,n)||c;a+=u}var h=convertEmToPx(o.maxFontSize,n)||n;var d;switch(t){case"middle":d=s/2-.15*h-a/2;break;case"bottom":d=-.25*h-a;break;case"top":default:d=.8*s;break}return d}h.text=function(t,n){if(t&&typeof t!=="string")throw new Error("Vectorizer: text() expects the first argument to be a string.");t=V.sanitizeText(t);n||(n={});var r=n.displayEmpty;var i=n.eol;var o=n.textPath;var s=n.textVerticalAnchor;var a=s==="middle"||s==="bottom"||s==="top";var c=n.x;c===void 0&&(c=this.attr("x")||0);var l=n.includeAnnotationIndices;var u=n.annotations;u&&!V.isArray(u)&&(u=[u]);var h=n.lineHeight;var f=h==="auto";var p=f?"1.5em":h||"1em";this.empty();this.attr({"xml:space":"preserve",display:t||r?null:"none"});var g=parseFloat(this.attr("font-size"));if(!g){g=16;(a||u)&&this.attr("font-size",g)}var v=document;var m;if(o){typeof o==="string"&&(o={d:o});m=createTextPathNode(o,this)}else m=v.createDocumentFragment();var y=0;var b=t.split("\n");var x=[];var w;for(var A=0,P=b.length-1;A<=P;A++){var T=p;var E="v-line";var S=v.createElementNS(e.svg,"tspan");var k=b[A];var L;if(k)if(u){var C=V.annotateString(k,u,{offset:-y,includeAnnotationIndices:l});L=annotateTextLine(S,C,{includeAnnotationIndices:l,eol:A!==P&&i,lineHeight:f?null:p,baseSize:g});var _=L.lineHeight;_&&f&&A!==0&&(T=_);A===0&&(w=L.maxFontSize*.8)}else{i&&A!==P&&(k+=i);S.textContent=k}else{S.textContent="-";E+=" v-empty-line";var M=S.style;M.fillOpacity=0;M.strokeOpacity=0;if(u){L={};C=V.findAnnotationsAtIndex(u,y);let t=g;for(let e=C.length;e>0;e--){const n=C[e-1].attrs;if(!n||!("font-size"in n))continue;const r=parseFloat(n["font-size"]);if(isFinite(r)){t=r;break}}f&&(A>0?T=t*1.2:w=t*.8);S.setAttribute("font-size",t);L.maxFontSize=t}}L&&x.push(L);A>0&&S.setAttribute("dy",T);(A>0||o)&&S.setAttribute("x",c);S.className.baseVal=E;m.appendChild(S);y+=k.length+1}if(a)if(u)T=calculateDY(s,x,g,p);else if(s==="top")T="0.8em";else{var N;if(P>0){N=parseFloat(p)||1;N*=P;d.test(p)||(N/=g)}else N=0;switch(s){case"middle":T=.3-N/2+"em";break;case"bottom":T=-N-.3+"em";break}}else if(s===0)T="0em";else if(s)T=s;else{T=0;this.attr("y")===null&&this.attr("y",w||"0.8em")}m.firstChild.setAttribute("dy",T);this.append(m);return this};
/**
     * @public
     * @param {string} name
     * @returns {Vectorizer}
     */h.removeAttr=function(t){const e=g[t];const{ns:n,local:r}=V.qualifyAttr(e);const i=this.node;n?i.hasAttributeNS(n,r)&&i.removeAttributeNS(n,r):i.hasAttribute(e)&&i.removeAttribute(e);return this};h.attr=function(t,e){if(V.isUndefined(t)){var n=this.node.attributes;var r={};for(var i=0;i<n.length;i++)r[n[i].name]=n[i].value;return r}if(V.isString(t)&&V.isUndefined(e))return this.node.getAttribute(g[t]);if(typeof t==="object")for(var o in t)t.hasOwnProperty(o)&&this.setAttribute(o,t[o]);else this.setAttribute(t,e);return this};h.normalizePath=function(){var t=this.tagName();t==="PATH"&&this.attr("d",V.normalizePathData(this.attr("d")));return this};h.remove=function(){this.node.parentNode&&this.node.parentNode.removeChild(this.node);return this};h.empty=function(){while(this.node.firstChild)this.node.removeChild(this.node.firstChild);return this};
/**
     * @private
     * @param {object} attrs
     * @returns {Vectorizer}
     */h.setAttributes=function(t){for(var e in t)t.hasOwnProperty(e)&&this.setAttribute(e,t[e]);return this};h.append=function(t){V.isArray(t)||(t=[t]);for(var e=0,n=t.length;e<n;e++)this.node.appendChild(V.toNode(t[e]));return this};h.prepend=function(t){var e=this.node.firstChild;return e?V(e).before(t):this.append(t)};h.before=function(t){var e=this.node;var n=e.parentNode;if(n){V.isArray(t)||(t=[t]);for(var r=0,i=t.length;r<i;r++)n.insertBefore(V.toNode(t[r]),e)}return this};h.appendTo=function(t){V.toNode(t).appendChild(this.node);return this};h.svg=function(){return this.node instanceof window.SVGSVGElement?this:V(this.node.ownerSVGElement)};h.tagName=function(){return this.node.tagName.toUpperCase()};h.defs=function(){var t=this.svg()||this;var e=t.node.getElementsByTagName("defs")[0];return e?V(e):V("defs").appendTo(t)};h.clone=function(){var t=V(this.node.cloneNode(true));t.node.id=V.uniqueId();return t};h.findOne=function(t){var e=this.node.querySelector(t);return e?V(e):void 0};h.find=function(t){var e=[];var n=this.node.querySelectorAll(t);if(n)for(var r=0;r<n.length;r++)e.push(V(n[r]));return e};h.children=function(){var t=this.node.childNodes;var e=[];for(var n=0;n<t.length;n++){var r=t[n];r.nodeType===1&&e.push(V(t[n]))}return e};h.parent=function(){return V(this.node.parentNode)||null},h.index=function(){var t=0;var e=this.node.previousSibling;while(e){e.nodeType===1&&t++;e=e.previousSibling}return t};h.findParentByClass=function(t,e){var n=this.node.ownerSVGElement;var r=this.node.parentNode;while(r&&r!==e&&r!==n){var i=V(r);if(i.hasClass(t))return i;r=r.parentNode}return null};h.contains=function(t){var e=this.node;var n=V.toNode(t);var r=n&&n.parentNode;return e===r||!!(r&&r.nodeType===1&&e.compareDocumentPosition(r)&16)};h.toLocalPoint=function(t,e){var n=this.svg().node;var r=n.createSVGPoint();r.x=t;r.y=e;try{var i=r.matrixTransform(n.getScreenCTM().inverse());var o=this.getTransformToElement(n).inverse()}catch(t){return r}return i.matrixTransform(o)};h.translateCenterToPoint=function(t){var e=this.getBBox({target:this.svg()});var n=e.center();this.translate(t.x-n.x,t.y-n.y);return this};h.translateAndAutoOrient=function(t,e,n){t=new Point(t);e=new Point(e);n||(n=this.svg());var r=this.scale();this.attr("transform","");var i=this.getBBox({target:n}).scale(r.sx,r.sy);var o=V.createSVGTransform();o.setTranslate(-i.x-i.width/2,-i.y-i.height/2);var s=V.createSVGTransform();var a=t.angleBetween(e,t.clone().offset(1,0));a&&s.setRotate(a,0,0);var c=V.createSVGTransform();var l=t.clone().move(e,i.width/2);c.setTranslate(2*t.x-l.x,2*t.y-l.y);var u=this.getTransformToElement(n);var h=V.createSVGTransform();h.setMatrix(c.matrix.multiply(s.matrix.multiply(o.matrix.multiply(u.scale(r.sx,r.sy)))));this.attr("transform",V.matrixToTransformString(h.matrix));return this};h.animateAlongPath=function(t,e){e=V.toNode(e);var n=V.ensureId(e);var r=V("animateMotion",t);var i=V("mpath",{"xlink:href":"#"+n});r.append(i);this.append(r);try{r.node.beginElement()}catch(t){if(document.documentElement.getAttribute("smiling")==="fake"){var o=r.node;o.animators=[];var s=o.getAttribute("id");s&&(id2anim[s]=o);var a=getTargets(o);for(var c=0,l=a.length;c<l;c++){var u=a[c];var h=new Animator(o,u,c);animators.push(h);o.animators[c]=h;h.register()}}}return this};const f=/[^\x20\t\r\n\f]+/g;function getTokenList(t){return V.isString(t)&&t.trim().match(f)||[]}h.hasClass=function(t){return!!V.isString(t)&&this.node.classList.contains(t.trim())};h.addClass=function(t){this.node.classList.add(...getTokenList(t));return this};h.removeClass=function(t){this.node.classList.remove(...getTokenList(t));return this};h.toggleClass=function(t,e){const n=getTokenList(t);for(let t=0;t<n.length;t++)this.node.classList.toggle(n[t],e);return this};h.sample=function(t){t=t||1;var e=this.node;var n=e.getTotalLength();var r=[];var i=0;var o;while(i<n){o=e.getPointAtLength(i);r.push({x:o.x,y:o.y,distance:i});i+=t}return r};h.convertToPath=function(){var t=V("path");t.attr(this.attr());var e=this.convertToPathData();e&&t.attr("d",e);return t};h.convertToPathData=function(){var t=this.tagName();switch(t){case"PATH":return this.attr("d");case"LINE":return V.convertLineToPathData(this.node);case"POLYGON":return V.convertPolygonToPathData(this.node);case"POLYLINE":return V.convertPolylineToPathData(this.node);case"ELLIPSE":return V.convertEllipseToPathData(this.node);case"CIRCLE":return V.convertCircleToPathData(this.node);case"RECT":return V.convertRectToPathData(this.node)}throw new Error(t+" cannot be converted to PATH.")};V.prototype.toGeometryShape=function(){var t,e,n,r,i,o,s,a,c,l,u,h,d,f,p;switch(this.tagName()){case"RECT":t=parseFloat(this.attr("x"))||0;e=parseFloat(this.attr("y"))||0;n=parseFloat(this.attr("width"))||0;r=parseFloat(this.attr("height"))||0;return new Rect(t,e,n,r);case"CIRCLE":i=parseFloat(this.attr("cx"))||0;o=parseFloat(this.attr("cy"))||0;s=parseFloat(this.attr("r"))||0;return new Ellipse$1({x:i,y:o},s,s);case"ELLIPSE":i=parseFloat(this.attr("cx"))||0;o=parseFloat(this.attr("cy"))||0;a=parseFloat(this.attr("rx"))||0;c=parseFloat(this.attr("ry"))||0;return new Ellipse$1({x:i,y:o},a,c);case"POLYLINE":l=V.getPointsFromSvgNode(this);return new Polyline$1(l);case"POLYGON":l=V.getPointsFromSvgNode(this);l.length>1&&l.push(l[0]);return new Polyline$1(l);case"PATH":u=this.attr("d");Path$1.isDataSupported(u)||(u=V.normalizePathData(u));return new Path$1(u);case"LINE":h=parseFloat(this.attr("x1"))||0;f=parseFloat(this.attr("y1"))||0;d=parseFloat(this.attr("x2"))||0;p=parseFloat(this.attr("y2"))||0;return new Line({x:h,y:f},{x:d,y:p})}return this.getBBox()};h.findIntersection=function(t,e){var n=this.svg().node;e=e||n;var r=this.getBBox({target:e});var i=r.center();if(r.intersectionWithLineFromCenterToPoint(t)){var o;var s=this.tagName();if(s==="RECT"){var a=new Rect(parseFloat(this.attr("x")||0),parseFloat(this.attr("y")||0),parseFloat(this.attr("width")),parseFloat(this.attr("height")));var c=this.getTransformToElement(e);var l=V.decomposeMatrix(c);var u=n.createSVGTransform();u.setRotate(-l.rotation,i.x,i.y);var h=V.transformRect(a,u.matrix.multiply(c));o=new Rect(h).intersectionWithLineFromCenterToPoint(t,l.rotation)}else if(s==="PATH"||s==="POLYGON"||s==="POLYLINE"||s==="CIRCLE"||s==="ELLIPSE"){var d=s==="PATH"?this:this.convertToPath();var f=d.sample();var p=Infinity;var g=[];var v,m,y,b,x,w;for(v=0;v<f.length;v++){m=f[v];y=V.createSVGPoint(m.x,m.y);y=y.matrixTransform(this.getTransformToElement(e));m=new Point(y);b=m.distance(i);x=m.distance(t)*1.1;w=b+x;if(w<p){p=w;g=[{sample:m,refDistance:x}]}else w<p+1&&g.push({sample:m,refDistance:x})}g.sort((function(t,e){return t.refDistance-e.refDistance}));g[0]&&(o=g[0].sample)}return o}};
/**
     * @private
     * @param {string} name
     * @param {string} value
     * @returns {Vectorizer}
     */h.setAttribute=function(t,e){const n=this.node;if(e===null){this.removeAttr(t);return this}const r=g[t];const{ns:i}=V.qualifyAttr(r);i?n.setAttributeNS(i,r,e):r==="id"?n.id=e:n.setAttribute(r,e);return this};V.createSvgDocument=function(t){if(t){const r=`<svg xmlns="${e.svg}" xmlns:xlink="${e.xlink}" version="${n}">${t}</svg>`;const{documentElement:i}=V.parseXML(r,{async:false});return i}const r=document.createElementNS(e.svg,"svg");r.setAttributeNS(e.xmlns,"xmlns:xlink",e.xlink);r.setAttribute("version",n);return r};V.createSVGStyle=function(t){const{node:e}=V("style",{type:"text/css"},[V.createCDATASection(t)]);return e},V.createCDATASection=function(t=""){const e=document.implementation.createDocument(null,"xml",null);return e.createCDATASection(t)};V.idCounter=0;V.uniqueId=function(){return"v-"+ ++V.idCounter};V.toNode=function(t){return V.isV(t)?t.node:t.nodeName&&t||t[0]};V.ensureId=function(t){t=V.toNode(t);return t.id||(t.id=V.uniqueId())};V.sanitizeText=function(t){return(t||"").replace(/ /g,"")};V.isUndefined=function(t){return typeof t==="undefined"};V.isString=function(t){return typeof t==="string"};V.isObject=function(t){return t&&typeof t==="object"};V.isArray=Array.isArray;V.parseXML=function(t,e){e=e||{};var n;try{var r=new DOMParser;V.isUndefined(e.async)||(r.async=e.async);n=r.parseFromString(t,"text/xml")}catch(t){n=void 0}if(!n||n.getElementsByTagName("parsererror").length)throw new Error("Invalid XML: "+t);return n};const p=Object.create(null);["baseFrequency","baseProfile","clipPathUnits","contentScriptType","contentStyleType","diffuseConstant","edgeMode","externalResourcesRequired","filterRes","filterUnits","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].forEach((t=>p[t]=t));p.xlinkShow="xlink:show";p.xlinkRole="xlink:role";p.xlinkActuate="xlink:actuate";p.xlinkHref="xlink:href";p.xlinkType="xlink:type";p.xlinkTitle="xlink:title";p.xmlBase="xml:base";p.xmlLang="xml:lang";p.xmlSpace="xml:space";const g=new Proxy(p,{get(t,e){return V.supportCamelCaseAttributes?e in t?t[e]:t[e]=e.replace(/[A-Z]/g,"-$&").toLowerCase():e}});Object.defineProperty(V,"attributeNames",{enumerable:true,value:g,writable:false});Object.defineProperty(V,"supportCamelCaseAttributes",{enumerable:true,value:true,writable:true});
/**
     * @param {string} name
     * @returns {{ns: string|null, local: string}} namespace and attribute name
     */V.qualifyAttr=function(t){if(t.indexOf(":")!==-1){var n=t.split(":");return{ns:e[n[0]],local:n[1]}}return{ns:null,local:t}};V.transformSeparatorRegex=/[ ,]+/;V.transformRegex=/\b\w+\([^()]+\)/g;V.transformFunctionRegex=/\b(\w+)\(([^()]+)\)/;V.transformTranslateRegex=/\btranslate\(([^()]+)\)/;V.transformRotateRegex=/\brotate\(([^()]+)\)/;V.transformScaleRegex=/\bscale\(([^()]+)\)/;V.transformStringToMatrix=function(t){let e=V.createSVGMatrix();const n=t&&t.match(V.transformRegex);if(!n)return e;const r=n.length;for(let t=0;t<r;t++){const r=n[t];const i=r.match(V.transformFunctionRegex);if(i){let t,n,r,o,s;let a=V.createSVGMatrix();const c=i[1].toLowerCase();const l=i[2].split(V.transformSeparatorRegex);switch(c){case"scale":t=parseFloat(l[0]);n=l[1]===void 0?t:parseFloat(l[1]);a=a.scaleNonUniform(t,n);break;case"translate":r=parseFloat(l[0]);o=parseFloat(l[1]);a=a.translate(r,o);break;case"rotate":s=parseFloat(l[0]);r=parseFloat(l[1])||0;o=parseFloat(l[2])||0;a=r!==0||o!==0?a.translate(r,o).rotate(s).translate(-r,-o):a.rotate(s);break;case"skewx":s=parseFloat(l[0]);a=a.skewX(s);break;case"skewy":s=parseFloat(l[0]);a=a.skewY(s);break;case"matrix":a.a=parseFloat(l[0]);a.b=parseFloat(l[1]);a.c=parseFloat(l[2]);a.d=parseFloat(l[3]);a.e=parseFloat(l[4]);a.f=parseFloat(l[5]);break;default:continue}e=e.multiply(a)}}return e};V.matrixToTransformString=function(t){t||(t=true);return"matrix("+(t.a!==void 0?t.a:1)+","+(t.b!==void 0?t.b:0)+","+(t.c!==void 0?t.c:0)+","+(t.d!==void 0?t.d:1)+","+(t.e!==void 0?t.e:0)+","+(t.f!==void 0?t.f:0)+")"};V.parseTransformString=function(t){var e,n,r;if(t){var i=V.transformSeparatorRegex;if(t.trim().indexOf("matrix")>=0){var o=V.transformStringToMatrix(t);var s=V.decomposeMatrix(o);e=[s.translateX,s.translateY];r=[s.scaleX,s.scaleY];n=[s.rotation];var a=[];e[0]===0&&e[1]===0||a.push("translate("+e+")");r[0]===1&&r[1]===1||a.push("scale("+r+")");n[0]!==0&&a.push("rotate("+n+")");t=a.join(" ")}else{const o=t.match(V.transformTranslateRegex);o&&(e=o[1].split(i));const s=t.match(V.transformRotateRegex);s&&(n=s[1].split(i));const a=t.match(V.transformScaleRegex);a&&(r=a[1].split(i))}}var c=r&&r[0]?parseFloat(r[0]):1;return{value:t,translate:{tx:e&&e[0]?parseInt(e[0],10):0,ty:e&&e[1]?parseInt(e[1],10):0},rotate:{angle:n&&n[0]?parseInt(n[0],10):0,cx:n&&n[1]?parseInt(n[1],10):void 0,cy:n&&n[2]?parseInt(n[2],10):void 0},scale:{sx:c,sy:r&&r[1]?parseFloat(r[1]):c}}};V.deltaTransformPoint=function(t,e){var n=e.x*t.a+e.y*t.c+0;var r=e.x*t.b+e.y*t.d+0;return{x:n,y:r}};V.decomposeMatrix=function(t){var e=V.deltaTransformPoint(t,{x:0,y:1});var n=V.deltaTransformPoint(t,{x:1,y:0});var r=180/i*o(e.y,e.x)-90;var a=180/i*o(n.y,n.x);return{translateX:t.e,translateY:t.f,scaleX:s(t.a*t.a+t.b*t.b),scaleY:s(t.c*t.c+t.d*t.d),skewX:r,skewY:a,rotation:r}};V.matrixToScale=function(t){var e,n,r,i;if(t){e=V.isUndefined(t.a)?1:t.a;i=V.isUndefined(t.d)?1:t.d;n=t.b;r=t.c}else e=i=1;return{sx:n?s(e*e+n*n):e,sy:r?s(r*r+i*i):i}};V.matrixToRotate=function(t){var e={x:0,y:1};t&&(e=V.deltaTransformPoint(t,e));return{angle:normalizeAngle(toDeg(o(e.y,e.x))-90)}};V.matrixToTranslate=function(t){return{tx:t&&t.e||0,ty:t&&t.f||0}};V.isV=function(t){return t instanceof V};V.isVElement=V.isV;V.isSVGGraphicsElement=function(t){if(!t)return false;t=V.toNode(t);return t instanceof SVGElement&&typeof t.getScreenCTM==="function"};var v=V("svg").node;V.createSVGMatrix=function(t){var e=v.createSVGMatrix();for(var n in t)e[n]=t[n];return e};V.createSVGTransform=function(t){if(!V.isUndefined(t)){t instanceof SVGMatrix||(t=V.createSVGMatrix(t));return v.createSVGTransformFromMatrix(t)}return v.createSVGTransform()};V.createSVGPoint=function(t,e){var n=v.createSVGPoint();n.x=t;n.y=e;return n};V.transformRect=function(t,e){var n=v.createSVGPoint();n.x=t.x;n.y=t.y;var r=n.matrixTransform(e);n.x=t.x+t.width;n.y=t.y;var i=n.matrixTransform(e);n.x=t.x+t.width;n.y=t.y+t.height;var o=n.matrixTransform(e);n.x=t.x;n.y=t.y+t.height;var s=n.matrixTransform(e);var l=a(r.x,i.x,o.x,s.x);var u=c(r.x,i.x,o.x,s.x);var h=a(r.y,i.y,o.y,s.y);var d=c(r.y,i.y,o.y,s.y);return new Rect(l,h,u-l,d-h)};V.transformPoint=function(t,e){return new Point(V.createSVGPoint(t.x,t.y).matrixTransform(e))};V.transformLine=function(t,e){return new Line(V.transformPoint(t.start,e),V.transformPoint(t.end,e))};V.transformPolyline=function(t,e){var n=t instanceof Polyline$1?t.points:t;V.isArray(n)||(n=[]);var r=[];for(var i=0,o=n.length;i<o;i++)r[i]=V.transformPoint(n[i],e);return new Polyline$1(r)};V.styleToObject=function(t){var e={};var n=t.split(";");for(var r=0;r<n.length;r++){var i=n[r];var o=i.split("=");e[o[0].trim()]=o[1].trim()}return e};V.createSlicePathData=function(t,e,n,r){var o=2*i-1e-6;var s=t;var a=e;var c=n;var h=r;var d=(h<c&&(d=c,c=h,h=d),h-c);var f=d<i?"0":"1";var p=l(c);var g=u(c);var v=l(h);var m=u(h);return d>=o?s?"M0,"+a+"A"+a+","+a+" 0 1,1 0,"+-a+"A"+a+","+a+" 0 1,1 0,"+a+"M0,"+s+"A"+s+","+s+" 0 1,0 0,"+-s+"A"+s+","+s+" 0 1,0 0,"+s+"Z":"M0,"+a+"A"+a+","+a+" 0 1,1 0,"+-a+"A"+a+","+a+" 0 1,1 0,"+a+"Z":s?"M"+a*p+","+a*g+"A"+a+","+a+" 0 "+f+",1 "+a*v+","+a*m+"L"+s*v+","+s*m+"A"+s+","+s+" 0 "+f+",0 "+s*p+","+s*g+"Z":"M"+a*p+","+a*g+"A"+a+","+a+" 0 "+f+",1 "+a*v+","+a*m+"L0,0Z"};V.mergeAttrs=function(t,e){for(var n in e)n==="class"?t[n]=t[n]?t[n]+" "+e[n]:e[n]:n==="style"?V.isObject(t[n])&&V.isObject(e[n])?t[n]=V.mergeAttrs(t[n],e[n]):V.isObject(t[n])?t[n]=V.mergeAttrs(t[n],V.styleToObject(e[n])):V.isObject(e[n])?t[n]=V.mergeAttrs(V.styleToObject(t[n]),e[n]):t[n]=V.mergeAttrs(V.styleToObject(t[n]),V.styleToObject(e[n])):t[n]=e[n];return t};V.annotateString=function(t,e,n){e=e||[];n=n||{};var r=n.offset||0;var i=[];var o;var s=[];var a;var c;for(var l=0;l<t.length;l++){a=s[l]=t[l];for(var u=0;u<e.length;u++){var h=e[u];var d=h.start+r;var f=h.end+r;if(l>=d&&l<f){V.isObject(a)?a.attrs=V.mergeAttrs(V.mergeAttrs({},a.attrs),h.attrs):a=s[l]={t:t[l],attrs:h.attrs};n.includeAnnotationIndices&&(a.annotations||(a.annotations=[])).push(u)}}c=s[l-1];if(c)if(V.isObject(a)&&V.isObject(c))if(JSON.stringify(a.attrs)===JSON.stringify(c.attrs))o.t+=a.t;else{i.push(o);o=a}else if(V.isObject(a)){i.push(o);o=a}else if(V.isObject(c)){i.push(o);o=a}else o=(o||"")+a;else o=a}o&&i.push(o);return i};V.findAnnotationsAtIndex=function(t,e){var n=[];t&&t.forEach((function(t){t.start<e&&e<=t.end&&n.push(t)}));return n};V.findAnnotationsBetweenIndexes=function(t,e,n){var r=[];t&&t.forEach((function(t){(e>=t.start&&e<t.end||n>t.start&&n<=t.end||t.start>=e&&t.end<n)&&r.push(t)}));return r};V.shiftAnnotations=function(t,e,n){t&&t.forEach((function(t){if(t.start<e&&t.end>=e)t.end+=n;else if(t.start>=e){t.start+=n;t.end+=n}}));return t};V.convertLineToPathData=function(t){t=V(t);var e=["M",t.attr("x1"),t.attr("y1"),"L",t.attr("x2"),t.attr("y2")].join(" ");return e};V.convertPolygonToPathData=function(t){var e=V.getPointsFromSvgNode(t);return e.length===0?null:V.svgPointsToPath(e)+" Z"};V.convertPolylineToPathData=function(t){var e=V.getPointsFromSvgNode(t);return e.length===0?null:V.svgPointsToPath(e)};V.svgPointsToPath=function(t){for(var e=0,n=t.length;e<n;e++)t[e]=t[e].x+" "+t[e].y;return"M "+t.join(" L")};V.getPointsFromSvgNode=function(t){t=V.toNode(t);var e=[];var n=t.points;if(n)for(var r=0,i=n.numberOfItems;r<i;r++)e.push(n.getItem(r));return e};V.KAPPA=.551784;V.convertCircleToPathData=function(t){t=V(t);var e=parseFloat(t.attr("cx"))||0;var n=parseFloat(t.attr("cy"))||0;var r=parseFloat(t.attr("r"));var i=r*V.KAPPA;var o=["M",e,n-r,"C",e+i,n-r,e+r,n-i,e+r,n,"C",e+r,n+i,e+i,n+r,e,n+r,"C",e-i,n+r,e-r,n+i,e-r,n,"C",e-r,n-i,e-i,n-r,e,n-r,"Z"].join(" ");return o};V.convertEllipseToPathData=function(t){t=V(t);var e=parseFloat(t.attr("cx"))||0;var n=parseFloat(t.attr("cy"))||0;var r=parseFloat(t.attr("rx"));var i=parseFloat(t.attr("ry"))||r;var o=r*V.KAPPA;var s=i*V.KAPPA;var a=["M",e,n-i,"C",e+o,n-i,e+r,n-s,e+r,n,"C",e+r,n+s,e+o,n+i,e,n+i,"C",e-o,n+i,e-r,n+s,e-r,n,"C",e-r,n-s,e-o,n-i,e,n-i,"Z"].join(" ");return a};V.convertRectToPathData=function(t){t=V(t);return V.rectToPath({x:parseFloat(t.attr("x"))||0,y:parseFloat(t.attr("y"))||0,width:parseFloat(t.attr("width"))||0,height:parseFloat(t.attr("height"))||0,rx:parseFloat(t.attr("rx"))||0,ry:parseFloat(t.attr("ry"))||0})};V.rectToPath=function(t){var e;var n=t.x;var r=t.y;var i=t.width;var o=t.height;var s=a(t.rx||t["top-rx"]||0,i/2);var c=a(t.rx||t["bottom-rx"]||0,i/2);var l=a(t.ry||t["top-ry"]||0,o/2);var u=a(t.ry||t["bottom-ry"]||0,o/2);e=s||c||l||u?["M",n,r+l,"v",o-l-u,"a",c,u,0,0,0,c,u,"h",i-2*c,"a",c,u,0,0,0,c,-u,"v",-(o-u-l),"a",s,l,0,0,0,-s,-l,"h",-(i-2*s),"a",s,l,0,0,0,-s,l,"Z"]:["M",n,r,"H",n+i,"V",r+o,"H",n,"V",r,"Z"];return e.join(" ")};V.normalizePathData=function(){var t="\t\n\v\f\r \u2028\u2029";var e=new RegExp("([a-z])["+t+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+t+"]*,?["+t+"]*)+)","ig");var n=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+t+"]*,?["+t+"]*","ig");var r=Math;var i=r.PI;var o=r.sin;var s=r.cos;var a=r.tan;var c=r.asin;var l=r.sqrt;var u=r.abs;function q2c(t,e,n,r,i,o){var s=1/3;var a=2/3;return[s*t+a*n,s*e+a*r,s*i+a*n,s*o+a*r,i,o]}function rotate(t,e,n){var r=t*s(n)-e*o(n);var i=t*o(n)+e*s(n);return{x:r,y:i}}function a2c(t,e,n,r,h,d,f,p,g,v){var m=i*120/180;var y=i/180*(+h||0);var b=[];var x;if(v){C=v[0];_=v[1];k=v[2];L=v[3]}else{x=rotate(t,e,-y);t=x.x;e=x.y;x=rotate(p,g,-y);p=x.x;g=x.y;var w=(t-p)/2;var A=(e-g)/2;var P=w*w/(n*n)+A*A/(r*r);if(P>1){P=l(P);n*=P;r*=P}var T=n*n;var E=r*r;var S=(d==f?-1:1)*l(u((T*E-T*A*A-E*w*w)/(T*A*A+E*w*w)));if(!Number.isFinite(S))return[t,e,p,g,p,g];var k=S*n*A/r+(t+p)/2;var L=S*-r*w/n+(e+g)/2;var C=c(((e-L)/r).toFixed(9));var _=c(((g-L)/r).toFixed(9));C=t<k?i-C:C;_=p<k?i-_:_;C<0&&(C=i*2+C);_<0&&(_=i*2+_);f&&C>_&&(C-=i*2);!f&&_>C&&(_-=i*2)}var M=_-C;if(u(M)>m){var N=_;var O=p;var R=g;_=C+m*(f&&_>C?1:-1);p=k+n*s(_);g=L+r*o(_);b=a2c(p,g,n,r,h,0,f,O,R,[_,N,k,L])}M=_-C;var B=s(C);var I=o(C);var F=s(_);var D=o(_);var z=a(M/4);var j=4/3*(n*z);var G=4/3*(r*z);var U=[t,e];var W=[t+j*I,e-G*B];var H=[p+j*D,g-G*F];var q=[p,g];W[0]=2*U[0]-W[0];W[1]=2*U[1]-W[1];if(v)return[W,H,q].concat(b);b=[W,H,q].concat(b).join().split(",");var Y=[];var X=b.length;for(var Z=0;Z<X;Z++)Y[Z]=Z%2?rotate(b[Z-1],b[Z],y).y:rotate(b[Z],b[Z+1],y).x;return Y}function parsePathString(t){if(!t)return null;var r={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0};var i=[];String(t).replace(e,(function(t,e,o){var s=[];var a=e.toLowerCase();o.replace(n,(function(t,e){e&&s.push(+e)}));if(a==="m"&&s.length>2){i.push([e].concat(s.splice(0,2)));a="l";e=e==="m"?"l":"L"}while(s.length>=r[a]){i.push([e].concat(s.splice(0,r[a])));if(!r[a])break}}));return i}function pathToAbsolute(t){Array.isArray(t)&&Array.isArray(t&&t[0])||(t=parsePathString(t));if(!t||!t.length)return[["M",0,0]];var e=[];var n=0;var r=0;var i=0;var o=0;var s=0;var a;var c=t.length;for(var l=s;l<c;l++){var u=[];e.push(u);var h=t[l];a=h[0];if(a!=a.toUpperCase()){u[0]=a.toUpperCase();var d;var f;switch(u[0]){case"A":u[1]=h[1];u[2]=h[2];u[3]=h[3];u[4]=h[4];u[5]=h[5];u[6]=+h[6]+n;u[7]=+h[7]+r;break;case"V":u[1]=+h[1]+r;break;case"H":u[1]=+h[1]+n;break;case"M":i=+h[1]+n;o=+h[2]+r;d=h.length;for(f=1;f<d;f++)u[f]=+h[f]+(f%2?n:r);break;default:d=h.length;for(f=1;f<d;f++)u[f]=+h[f]+(f%2?n:r);break}}else{var p=h.length;for(var g=0;g<p;g++)u[g]=h[g]}switch(u[0]){case"Z":n=+i;r=+o;break;case"H":n=u[1];break;case"V":r=u[1];break;case"M":i=u[u.length-2];o=u[u.length-1];n=u[u.length-2];r=u[u.length-1];break;default:n=u[u.length-2];r=u[u.length-1];break}}return e}function normalize(t){var e=pathToAbsolute(t);var n={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null};function processPath(t,e,n){var r,i;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];if(!(t[0]in{T:1,Q:1})){e.qx=null;e.qy=null}switch(t[0]){case"M":e.X=t[1];e.Y=t[2];break;case"A":t=parseFloat(t[1])===0||parseFloat(t[2])===0?["L",t[6],t[7]]:["C"].concat(a2c.apply(0,[e.x,e.y].concat(t.slice(1))));break;case"S":if(n==="C"||n==="S"){r=e.x*2-e.bx;i=e.y*2-e.by}else{r=e.x;i=e.y}t=["C",r,i].concat(t.slice(1));break;case"T":if(n==="Q"||n==="T"){e.qx=e.x*2-e.qx;e.qy=e.y*2-e.qy}else{e.qx=e.x;e.qy=e.y}t=["C"].concat(q2c(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1];e.qy=t[2];t=["C"].concat(q2c(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"H":t=["L"].concat(t[1],e.y);break;case"V":t=["L"].concat(e.x,t[1]);break;case"L":break;case"Z":break}return t}function fixArc(t,n){if(t[n].length>7){t[n].shift();var i=t[n];while(i.length){r[n]="A";t.splice(n++,0,["C"].concat(i.splice(0,6)))}t.splice(n,1);s=e.length}}var r=[];var i="";var o="";var s=e.length;for(var a=0;a<s;a++){e[a]&&(i=e[a][0]);if(i!=="C"){r[a]=i;a>0&&(o=r[a-1])}e[a]=processPath(e[a],n,o);r[a]!=="A"&&i==="C"&&(r[a]="C");fixArc(e,a);var c=e[a];var l=c.length;n.x=c[l-2];n.y=c[l-1];n.bx=parseFloat(c[l-4])||n.x;n.by=parseFloat(c[l-3])||n.y}e[0][0]&&e[0][0]==="M"||e.unshift(["M",0,0]);return e}return function(t){return normalize(t).join(",").split(",").join(" ")}}();V.namespace=e;V.g=Z;return V}();const K="[object Arguments]";const Q="[object Array]";const tt="[object Boolean]";const et="[object Date]";const nt="[object Error]";const rt="[object Function]";const it="[object Map]";const ot="[object Number]";const st="[object Null]";const at="[object Object]";const ct="[object RegExp]";const lt="[object Set]";const ut="[object String]";const ht="[object Symbol]";const dt="[object Undefined]";const ft="[object WeakMap]";const pt="[object ArrayBuffer]";const gt="[object DataView]";const vt="[object Float32Array]";const mt="[object Float64Array]";const yt="[object Int8Array]";const bt="[object Int16Array]";const xt="[object Int32Array]";const wt="[object Uint8Array]";const At="[object Uint8ClampedArray]";const Pt="[object Uint16Array]";const Tt="[object Uint32Array]";const Et={[K]:true,[Q]:true,[pt]:true,[gt]:true,[tt]:true,[et]:true,[vt]:true,[mt]:true,[yt]:true,[bt]:true,[xt]:true,[it]:true,[ot]:true,[at]:true,[ct]:true,[lt]:true,[ut]:true,[ht]:true,[wt]:true,[At]:true,[Pt]:true,[Tt]:true,[nt]:false,[rt]:false,[ft]:false};const St="\\ud800-\\udfff";const kt="\\u0300-\\u036f";const Lt="\\ufe20-\\ufe2f";const Ct="\\u20d0-\\u20ff";const _t="\\u1ab0-\\u1aff";const Mt="\\u1dc0-\\u1dff";const Nt=kt+Lt+Ct+_t+Mt;const Ot="\\u2700-\\u27bf";const Rt="a-z\\xdf-\\xf6\\xf8-\\xff";const Bt="\\xac\\xb1\\xd7\\xf7";const It="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf";const Ft="\\u2000-\\u206f";const Dt=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000";const Vt="A-Z\\xc0-\\xd6\\xd8-\\xde";const zt="\\ufe0e\\ufe0f";const jt=Bt+It+Ft+Dt;const Gt="[']";const Ut=`[${jt}]`;const Wt=`[${Nt}]`;const Ht="\\d";const $t=`[${Ot}]`;const qt=`[${Rt}]`;const Yt=`[^${St}${jt+Ht+Ot+Rt+Vt}]`;const Xt="\\ud83c[\\udffb-\\udfff]";const Zt=`(?:${Wt}|${Xt})`;const Jt=`[^${St}]`;const Kt="(?:\\ud83c[\\udde6-\\uddff]){2}";const Qt="[\\ud800-\\udbff][\\udc00-\\udfff]";const te=`[${Vt}]`;const ee="\\u200d";const ne=`(?:${qt}|${Yt})`;const re=`(?:${te}|${Yt})`;const ie=`(?:${Gt}(?:d|ll|m|re|s|t|ve))?`;const oe=`(?:${Gt}(?:D|LL|M|RE|S|T|VE))?`;const se=`${Zt}?`;const ae=`[${zt}]?`;const ce=`(?:${ee}(?:${[Jt,Kt,Qt].join("|")})${ae+se})*`;const le="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])";const ue="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])";const he=ae+se+ce;const de=`(?:${[$t,Kt,Qt].join("|")})${he}`;const fe=RegExp([`${te}?${qt}+${ie}(?=${[Ut,te,"$"].join("|")})`,`${re}+${oe}(?=${[Ut,te+ne,"$"].join("|")})`,`${te}?${ne}+${ie}`,`${te}+${oe}`,ue,le,`${Ht}+`,de].join("|"),"g");const pe=200;const ge="__hash_undefined__";const ve=/^\[object (?:Float(?:32|64)|(?:Int|Uint)(?:8|16|32)|Uint8Clamped)Array\]$/;const me=`[${St}]`;const ye=`${Jt}${Wt}?`;const be=`(?:${[ye,Wt,Kt,Qt,me].join("|")})`;const xe=RegExp(`${Xt}(?=${Xt})|${be+he}`,"g");const we=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/;const Ae=/^\w*$/;const Pe=".".charCodeAt(0);const Te=/\\(\\)?/g;const Ee=RegExp("[^.[\\]]+|\\[(?:([^\"'][^[]*)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))","g");const Se=/^(?:0|[1-9]\d*)$/;const ke=RegExp.prototype.test.bind(/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/);const Le=4294967294;const Ce=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;const hasUnicode=t=>xe.test(t);const unicodeToArray=t=>t.match(xe)||[];const asciiToArray=t=>t.split("");const stringToArray=t=>hasUnicode(t)?unicodeToArray(t):asciiToArray(t);const values=t=>t==null?[]:keys(t).map((e=>t[e]));const keys=t=>isArrayLike(t)?arrayLikeKeys(t):Object.keys(Object(t));const baseKeys=t=>{if(!isPrototype(t))return Object.keys(t);var e=[];for(var n in Object(t))hasOwnProperty.call(t,n)&&n!="constructor"&&e.push(n);return e};const arrayLikeKeys=(t,e)=>{const n=Array.isArray(t);const r=!n&&isObjectLike(t)&&getTag(t)===K;const i=!n&&!r&&isTypedArray(t);const o=n||r||i;const s=t.length;const a=new Array(o?s:0);let c=o?-1:s;while(++c<s)a[c]=`${c}`;for(const n in t)!e&&!hasOwnProperty.call(t,n)||o&&(n==="length"||isIndex(n,s))||a.push(n);return a};const assocIndexOf=(t,e)=>{let{length:n}=t;while(n--)if(eq(t[n][0],e))return n;return-1};const eq=(t,e)=>t===e||t!==t&&e!==e;const isObjectLike=t=>t!=null&&typeof t=="object";const isIterateeCall=(t,e,n)=>{if(!isObject(n))return false;const r=typeof e;const i=r=="number"?isArrayLike(n)&&e>-1&&e<n.length:r=="string"&&e in n;return!!i&&eq(n[e],t)};const isSet=t=>isObjectLike(t)&&getTag(t)==lt;const isMap=t=>isObjectLike(t)&&getTag(t)==it;const isPrototype=t=>{const e=t&&t.constructor;const n=typeof e==="function"&&e.prototype||Object.prototype;return t===n};const assignValue=(t,e,n)=>{const r=t[e];hasOwnProperty.call(t,e)&&eq(r,n)&&(n!==void 0||e in t)||(t[e]=n)};const copyObject=(t,e,n)=>{let r=-1;const i=e.length;while(++r<i){const i=e[r];assignValue(n,i,t[i])}return n};const isArrayLike=t=>t!=null&&typeof t!=="function"&&typeof t.length==="number"&&t.length>-1&&t.length%1===0;const isSymbol=t=>typeof t=="symbol"||isObjectLike(t)&&getTag(t)===ht;const initCloneArray=t=>{const e=t.length;let n=new t.constructor(e);if(e&&typeof t[0]=="string"&&hasOwnProperty.call(t,"index")){n.index=t.index;n.input=t.input}return n};const copyArray=(t,e)=>{let n=-1;const r=t.length;e||(e=new Array(r));while(++n<r)e[n]=t[n];return e};const getTag=t=>t==null?t===void 0?dt:st:Object.prototype.toString.call(t);const cloneArrayBuffer=t=>{const e=new t.constructor(t.byteLength);new Uint8Array(e).set(new Uint8Array(t));return e};const cloneTypedArray=(t,e)=>{const n=e?cloneArrayBuffer(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)};const cloneRegExp=t=>{const e=new t.constructor(t.source,/\w*$/.exec(t));e.lastIndex=t.lastIndex;return e};const initCloneObject=t=>typeof t.constructor!="function"||isPrototype(t)?{}:Object.create(Object.getPrototypeOf(t));const getSymbols=t=>{if(t==null)return[];t=Object(t);const e=Object.getOwnPropertySymbols(t);return e.filter((e=>propertyIsEnumerable.call(t,e)))};const copySymbols=(t,e)=>copyObject(t,getSymbols(t),e);function cloneDataView(t,e){const n=e?cloneArrayBuffer(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}const initCloneByTag=(t,e,n)=>{const r=t.constructor;switch(e){case pt:return cloneArrayBuffer(t);case tt:case et:return new r(+t);case gt:return cloneDataView(t,n);case vt:case mt:case yt:case bt:case xt:case wt:case At:case Pt:case Tt:return cloneTypedArray(t,n);case it:return new r(t);case ot:case ut:return new r(t);case ct:return cloneRegExp(t);case lt:return new r;case ht:return Symbol.prototype.valueOf?Object(Symbol.prototype.valueOf.call(t)):{}}};const isTypedArray=t=>isObjectLike(t)&&ve.test(getTag(t));const getAllKeys=t=>{const e=Object.keys(t);Array.isArray(t)||t==null||e.push(...getSymbols(Object(t)));return e};const getSymbolsIn=t=>{const e=[];while(t){e.push(...getSymbols(t));t=Object.getPrototypeOf(Object(t))}return e};const getAllKeysIn=t=>{const e=[];for(const n in t)e.push(n);Array.isArray(t)||e.push(...getSymbolsIn(t));return e};const getMapData=({__data__:t},e)=>{const n=t;return isKeyable(e)?n[typeof e==="string"?"string":"hash"]:n.map};const equalObjects=(t,e,n,r)=>{const i=getAllKeys(t);const o=i.length;const s=getAllKeys(e);const a=s.length;if(o!=a)return false;let c;let l=o;while(l--){c=i[l];if(!hasOwnProperty.call(e,c))return false}const u=r.get(t);const h=r.get(e);if(u&&h)return u==e&&h==t;let d=true;r.set(t,e);r.set(e,t);let f;let p;while(++l<o){c=i[l];const o=t[c];const s=e[c];if(!(f===void 0?o===s||n(o,s,r):f)){d=false;break}p||(p=c=="constructor")}if(d&&!p){const n=t.constructor;const r=e.constructor;n==r||!("constructor"in t)||!("constructor"in e)||typeof n==="function"&&n instanceof n&&typeof r==="function"&&r instanceof r||(d=false)}r.delete(t);r.delete(e);return d};const baseIsEqual=(t,e,n)=>t===e||(t==null||e==null||!isObjectLike(t)&&!isObjectLike(e)?t!==t&&e!==e:baseIsEqualDeep(t,e,baseIsEqual,n));const baseIsEqualDeep=(t,e,n,r)=>{let i=Array.isArray(t);const o=Array.isArray(e);let s=i?Q:getTag(t);let a=o?Q:getTag(e);s=s==K?at:s;a=a==K?at:a;let c=s==at;const l=a==at;const u=s==a;if(u&&!c){r||(r=new Stack);return i||isTypedArray(t)?equalArrays(t,e,false,n,r):equalByTag(t,e,s,n,r)}const h=c&&hasOwnProperty.call(t,"__wrapped__");const d=l&&hasOwnProperty.call(e,"__wrapped__");if(h||d){const i=h?t.value():t;const o=d?e.value():e;r||(r=new Stack);return n(i,o,r)}if(!u)return false;r||(r=new Stack);return equalObjects(t,e,n,r)};const equalArrays=(t,e,n,r,i)=>{const o=false;const s=t.length;const a=e.length;if(s!=a&&!(o&&a>s))return false;const c=i.get(t);const l=i.get(e);if(c&&l)return c==e&&l==t;let u=-1;let h=true;const d=n?new SetCache:void 0;i.set(t,e);i.set(e,t);while(++u<s){let n;const o=t[u];const s=e[u];if(n!==void 0){if(n)continue;h=false;break}if(d){if(!some(e,((t,e)=>{if(!cacheHas(d,e)&&(o===t||r(o,t,i)))return d.push(e)}))){h=false;break}}else if(!(o===s||r(o,s,i))){h=false;break}}i.delete(t);i.delete(e);return h};const some=(t,e)=>{let n=-1;const r=t==null?0:t.length;while(++n<r)if(e(t[n],n,t))return true;return false};const cacheHas=(t,e)=>t.has(e);const compareArrayBufferTag=(t,e,n,r)=>!(t.byteLength!=e.byteLength||!n(new Uint8Array(t),new Uint8Array(e),r));const equalByTag=(t,e,n,r,i)=>{switch(n){case gt:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return false;t=t.buffer;e=e.buffer;return compareArrayBufferTag(t,e,r,i);case pt:return compareArrayBufferTag(t,e,r,i);case tt:case et:case ot:return eq(+t,+e);case nt:return t.name==e.name&&t.message==e.message;case ct:case ut:return t==`${e}`;case it:var o=mapToArray;case lt:o||(o=setToArray);if(t.size!=e.size)return false;const n=i.get(t);if(n)return n==e;i.set(t,e);const s=equalArrays(o(t),o(e),true,r,i);i.delete(t);return s;case ht:return Symbol.prototype.valueOf.call(t)==Symbol.prototype.valueOf.call(e)}return false};const mapToArray=t=>{let e=-1;let n=Array(t.size);t.forEach(((t,r)=>{n[++e]=[r,t]}));return n};const setToArray=t=>{let e=-1;const n=new Array(t.size);t.forEach((t=>{n[++e]=t}));return n};const isKey=(t,e)=>{if(Array.isArray(t))return false;const n=typeof t;return!(n!=="number"&&n!=="boolean"&&t!=null&&!isSymbol(t))||(Ae.test(t)||!we.test(t)||e!=null&&t in Object(e))};const stringToPath=t=>{const e=[];t.charCodeAt(0)===Pe&&e.push("");t.replace(Ee,((t,n,r,i)=>{let o=t;r?o=i.replace(Te,"$1"):n&&(o=n.trim());e.push(o)}));return e};const castPath=(t,e)=>Array.isArray(t)?t:isKey(t,e)?[t]:stringToPath(`${t}`);const get=(t,e)=>{e=castPath(e,t);let n=0;const r=e.length;while(t!=null&&n<r){t=t[toKey(e[n])];n++}return n&&n==r?t:void 0};function compareAscending(t,e){if(t!==e){const n=t!==void 0;const r=t===null;const i=t===t;const o=isSymbol(t);const s=e!==void 0;const a=e===null;const c=e===e;const l=isSymbol(e);if(!a&&!l&&!o&&t>e||o&&s&&c&&!a&&!l||r&&s&&c||!n&&c||!i)return 1;if(!r&&!o&&!l&&t<e||l&&n&&i&&!r&&!o||a&&n&&i||!s&&i||!c)return-1}return 0}function compareMultiple(t,e,n){let r=-1;const i=t.criteria;const o=e.criteria;const s=i.length;const a=n.length;while(++r<s){const t=r<a?n[r]:null;const e=t&&typeof t==="function"?t:compareAscending;const s=e(i[r],o[r]);if(s)return t&&typeof t!=="function"?s*(t=="desc"?-1:1):s}return t.index-e.index}const diff=(t,e)=>{let includes=(t,e)=>{const n=t==null?0:t.length;return!!n&&t.indexOf(e)>-1};let n=true;const r=[];const i=e.length;if(!t.length)return r;if(e.length>=pe){includes=(t,e)=>t.has(e);n=false;e=new SetCache(e)}t:for(let o in t){let s=t[o];const a=s;s=s!==0?s:0;if(n&&a===a){let t=i;while(t--)if(e[t]===a)continue t;r.push(s)}else includes(e,a)||r.push(s)}return r};const intersect=t=>{const includes=(t,e)=>{const n=t==null?0:t.length;return!!n&&t.indexOf(e)>-1};const cacheHas=(t,e)=>t.has(e);const e=t[0].length;const n=t.length;const r=new Array(n);const i=[];let o;let s=Infinity;let a=n;while(a--){o=t[a];s=Math.min(o.length,s);r[a]=e>=120&&o.length>=120?new SetCache(a&&o):void 0}o=t[0];let c=-1;const l=r[0];t:while(++c<e&&i.length<s){let e=o[c];const s=e;e=e!==0?e:0;if(!(l?cacheHas(l,s):includes(i,s))){a=n;while(--a){const e=r[a];if(!(e?cacheHas(e,s):includes(t[a],s)))continue t}l&&l.push(s);i.push(e)}}return i};const toKey=t=>{if(typeof t==="string"||isSymbol(t))return t;const e=`${t}`;return e=="0"&&1/t==-Infinity?"-0":e};const baseClone=(t,e=false,n=false,r=true,i,o,s,a)=>{let c;i&&(c=s?i(t,o,s,a):i(t));if(c!==void 0)return c;if(!isObject(t))return t;const l=Array.isArray(t);const u=getTag(t);if(l){c=initCloneArray(t);if(!e)return copyArray(t,c)}else{const r=typeof t==="function";if(u===at||u===K||r&&!s){c=n||r?{}:initCloneObject(t);if(!e)return n?copySymbolsIn(t,copyObject(t,Object.keys(t),c)):copySymbols(t,Object.assign(c,t))}else{if(r||!Et[u])return s?t:{};c=initCloneByTag(t,u,e)}}a||(a=new Stack);const h=a.get(t);if(h)return h;a.set(t,c);if(isMap(t)){t.forEach(((o,s)=>{c.set(s,baseClone(o,e,n,r,i,s,t,a))}));return c}if(isSet(t)){t.forEach((o=>{c.add(baseClone(o,e,n,r,i,o,t,a))}));return c}if(isTypedArray(t))return c;const d=r?n?getAllKeysIn:getAllKeys:n?keysIn:keys;const f=l?void 0:d(t);(f||t).forEach(((o,s)=>{if(f){s=o;o=t[s]}assignValue(c,s,baseClone(o,e,n,r,i,s,t,a))}));return c};const copySymbolsIn=(t,e)=>copyObject(t,getSymbolsIn(t),e);const parent=(t,e)=>e.length<2?t:get(t,e.slice(0,-1));const set=(t,e,n)=>{if(!isObject(t))return t;e=castPath(e,t);const r=e.length;const i=r-1;let o=-1;let s=t;while(s!=null&&++o<r){const t=toKey(e[o]);let r=n;if(o!=i){const n=s[t];r=void 0;r===void 0&&(r=isObject(n)?n:isIndex(e[o+1])?[]:{})}assignValue(s,t,r);s=s[t]}return t};const isIndex=(t,e)=>{const n=typeof t;e=e==null?Number.MAX_SAFE_INTEGER:e;return!!e&&(n==="number"||n!=="symbol"&&Se.test(t))&&t>-1&&t%1==0&&t<e};const unset=(t,e)=>{e=castPath(e,t);t=parent(t,e);const n=e[e.length-1];return t==null||delete t[toKey(n)]};const isKeyable=t=>{const e=typeof t;return e==="string"||e==="number"||e==="symbol"||e==="boolean"?t!=="__proto__":t===null};const keysIn=t=>{const e=[];for(const n in t)e.push(n);return e};const toPlainObject=t=>{t=Object(t);const e={};for(const n in t)e[n]=t[n];return e};const safeGet=(t,e)=>{if((e!=="constructor"||typeof t[e]!=="function")&&e!="__proto__")return t[e]};function createAssigner(t,e=false){return(n,...r)=>{let i=-1;let o=r.length;let s=o>1?r[o-1]:void 0;const a=o>2?r[2]:void 0;s=t.length>3&&typeof s==="function"?(o--,s):e?(t,e)=>{if(Array.isArray(t)&&!Array.isArray(e))return e}:void 0;if(a&&isIterateeCall(r[0],r[1],a)){s=o<3?void 0:s;o=1}n=Object(n);while(++i<o){const e=r[i];e&&t(n,e,i,s)}return n}}const baseMerge=(t,e,n,r,i)=>{t!==e&&forIn(e,((o,s)=>{if(isObject(o)){i||(i=new Stack);baseMergeDeep(t,e,s,n,baseMerge,r,i)}else{let n=r?r(t[s],o,`${s}`,t,e,i):void 0;n===void 0&&(n=o);assignMergeValue(t,s,n)}}))};const baseMergeDeep=(t,e,n,r,i,o,s)=>{const a=safeGet(t,n);const c=safeGet(e,n);const l=s.get(c);if(l){assignMergeValue(t,n,l);return}let u=o?o(a,c,`${n}`,t,e,s):void 0;let h=u===void 0;if(h){const t=Array.isArray(c);const e=!t&&isTypedArray(c);u=c;if(t||e)if(Array.isArray(a))u=a;else if(isObjectLike(a)&&isArrayLike(a))u=copyArray(a);else if(e){h=false;u=cloneTypedArray(c,true)}else u=[];else if(isPlainObject(c)||isArguments(c)){u=a;isArguments(a)?u=toPlainObject(a):typeof a!=="function"&&isObject(a)||(u=initCloneObject(c))}else h=false}if(h){s.set(c,u);i(u,c,r,o,s);s.delete(c)}assignMergeValue(t,n,u)};const assignMergeValue=(t,e,n)=>{(n!==void 0&&!eq(t[e],n)||n===void 0&&!(e in t))&&assignValue(t,e,n)};function baseFor(t,e,n){const r=Object(t);const i=n(t);let{length:o}=i;let s=-1;while(o--){const t=i[++s];if(e(r[t],t,r)===false)break}return t}const baseForOwn=(t,e)=>t&&baseFor(t,e,keys);const baseEach=(t,e)=>{if(t==null)return t;if(!isArrayLike(t))return baseForOwn(t,e);const n=t.length;const r=Object(t);let i=-1;while(++i<n)if(e(r[i],i,r)===false)break;return t};function last(t){const e=t==null?0:t.length;return e?t[e-1]:void 0}const _e=Set&&1/setToArray(new Set([void 0,-0]))[1]==1/0?t=>new Set(t):()=>{};function customDefaultsMerge(t,e,n,r,i,o){if(isObject(t)&&isObject(e)){o.set(e,t);baseMerge(t,e,void 0,customDefaultsMerge,o);o.delete(e)}return t}function baseOrderBy(t,e,n){e=e.length?e.map((t=>Array.isArray(t)?e=>get(e,t.length===1?t[0]:t):t)):[t=>t];let r=-1;let i=-1;const o=isArrayLike(t)?new Array(t.length):[];baseEach(t,(t=>{const n=e.map((e=>e(t)));o[++i]={criteria:n,index:++r,value:t}}));return baseSortBy(o,((t,e)=>compareMultiple(t,e,n)))}function baseSortBy(t,e){let{length:n}=t;t.sort(e);while(n--)t[n]=t[n].value;return t}function isStrictComparable(t){return t===t&&!isObject(t)}function matchesStrictComparable(t,e){return n=>n!=null&&(n[t]===e&&(e!==void 0||t in Object(n)))}function hasIn(t,e){return t!=null&&hasPath(t,e,baseHasIn)}function baseMatchesProperty(t,e){return isKey(t)&&isStrictComparable(e)?matchesStrictComparable(toKey(t),e):n=>{const r=get(n,t);return r===void 0&&r===e?hasIn(n,t):baseIsEqual(e,r)}}function baseMatches(t){const e=getMatchData(t);return e.length===1&&e[0][2]?matchesStrictComparable(e[0][0],e[0][1]):n=>n===t||baseIsMatch(n,t,e)}function getMatchData(t){const e=keys(t);let n=e.length;while(n--){const r=e[n];const i=t[r];e[n]=[r,i,isStrictComparable(i)]}return e}function baseIsMatch(t,e,n,r){let i=n.length;const o=i;const s=!r;if(t==null)return!o;let a;let c;t=Object(t);while(i--){a=n[i];if(s&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return false}while(++i<o){a=n[i];const o=a[0];const l=t[o];const u=a[1];if(s&&a[2]){if(l===void 0&&!(o in t))return false}else{const n=new Stack;r&&(c=r(l,u,o,t,e,n));if(!(c===void 0?baseIsEqual(u,l,n):c))return false}}return true}function property(t){return isKey(t)?baseProperty(toKey(t)):basePropertyDeep(t)}function baseProperty(t){return e=>e==null?void 0:e[t]}function basePropertyDeep(t){return e=>get(e,t)}function baseIteratee(t){return typeof t=="function"?t:t==null?t=>t:typeof t=="object"?Array.isArray(t)?baseMatchesProperty(t[0],t[1]):baseMatches(t):property(t)}function getIteratee(){const t=baseIteratee;return arguments.length?t(arguments[0],arguments[1]):t}const arrayReduce=(t,e,n,r)=>{let i=-1;const o=t==null?0:t.length;r&&o&&(n=t[++i]);while(++i<o)n=e(n,t[i],i,t);return n};const baseReduce=(t,e,n,r,i)=>{i(t,((t,i,o)=>{n=r?(r=false,t):e(n,t,i,o)}));return n};function reduce(t,e,n){const r=Array.isArray(t)?arrayReduce:baseReduce;const i=arguments.length<3;return r(t,e,n,i,baseEach)}const isFlattenable=t=>Array.isArray(t)||isArguments(t)||!!(t&&t[Symbol.isConcatSpreadable]);function baseFlatten(t,e,n,r,i){let o=-1;const s=t.length;n||(n=isFlattenable);i||(i=[]);while(++o<s){var a=t[o];e>0&&n(a)?e>1?baseFlatten(a,e-1,n,r,i):i.push(...a):r||(i[i.length]=a)}return i}const isArguments=t=>isObjectLike(t)&&getTag(t)=="[object Arguments]";const basePick=(t,e)=>basePickBy(t,e,((e,n)=>hasIn(t,n)));const basePickBy=(t,e,n)=>{let r=-1;const i=e.length;const o={};while(++r<i){const i=e[r];const s=get(t,i);n(s,i)&&set(o,castPath(i,t),s)}return o};const isLength=t=>typeof t=="number"&&t>-1&&t%1==0&&t<=Number.MAX_SAFE_INTEGER;const baseHasIn=(t,e)=>t!=null&&e in Object(t);const hasPath=(t,e,n)=>{e=castPath(e,t);var r=-1,i=e.length,o=false;while(++r<i){var s=toKey(e[r]);if(!(o=t!=null&&n(t,s)))break;t=t[s]}if(o||++r!=i)return o;i=t==null?0:t.length;return!!i&&isLength(i)&&isIndex(s,i)&&(Array.isArray(t)||isArguments(t))};const asciiWords=t=>t.match(Ce);const unicodeWords=t=>t.match(fe);const words=(t,e)=>{if(e===void 0){const e=ke(t)?unicodeWords(t):asciiWords(t);return e||[]}return t.match(e)||[]};const castSlice=(t,e,n)=>{const{length:r}=t;n=n===void 0?r:n;return!e&&n>=r?t:t.slice(e,n)};const Me=createCaseFirst("toUpperCase");function createCaseFirst(t){return e=>{if(!e)return"";const n=hasUnicode(e)?stringToArray(e):void 0;const r=n?n[0]:e[0];const i=n?castSlice(n,1).join(""):e.slice(1);return r[t]()+i}}function matches(t){return baseMatches(baseClone(t,true))}class Stack{constructor(t){const e=this.__data__=new ListCache(t);this.size=e.size}clear(){this.__data__=new ListCache;this.size=0}delete(t){const e=this.__data__;const n=e.delete(t);this.size=e.size;return n}get(t){return this.__data__.get(t)}has(t){return this.__data__.has(t)}set(t,e){let n=this.__data__;if(n instanceof ListCache){const r=n.__data__;if(r.length<pe-1){r.push([t,e]);this.size=++n.size;return this}n=this.__data__=new MapCache(r)}n.set(t,e);this.size=n.size;return this}}class ListCache{constructor(t){let e=-1;const n=t==null?0:t.length;this.clear();while(++e<n){const n=t[e];this.set(n[0],n[1])}}clear(){this.__data__=[];this.size=0}delete(t){const e=this.__data__;const n=assocIndexOf(e,t);if(n<0)return false;const r=e.length-1;n==r?e.pop():e.splice(n,1);--this.size;return true}get(t){const e=this.__data__;const n=assocIndexOf(e,t);return n<0?void 0:e[n][1]}has(t){return assocIndexOf(this.__data__,t)>-1}set(t,e){const n=this.__data__;const r=assocIndexOf(n,t);if(r<0){++this.size;n.push([t,e])}else n[r][1]=e;return this}}class MapCache{constructor(t){let e=-1;const n=t==null?0:t.length;this.clear();while(++e<n){const n=t[e];this.set(n[0],n[1])}}clear(){this.size=0;this.__data__={hash:new Hash,map:new Map,string:new Hash}}delete(t){const e=getMapData(this,t).delete(t);this.size-=e?1:0;return e}get(t){return getMapData(this,t).get(t)}has(t){return getMapData(this,t).has(t)}set(t,e){const n=getMapData(this,t);const r=n.size;n.set(t,e);this.size+=n.size==r?0:1;return this}}class Hash{constructor(t){let e=-1;const n=t==null?0:t.length;this.clear();while(++e<n){const n=t[e];this.set(n[0],n[1])}}clear(){this.__data__=Object.create(null);this.size=0}delete(t){const e=this.has(t)&&delete this.__data__[t];this.size-=e?1:0;return e}get(t){const e=this.__data__;const n=e[t];return n===ge?void 0:n}has(t){const e=this.__data__;return e[t]!==void 0}set(t,e){const n=this.__data__;this.size+=this.has(t)?0:1;n[t]=e===void 0?ge:e;return this}}class SetCache{constructor(t){let e=-1;const n=t==null?0:t.length;this.__data__=new MapCache;while(++e<n)this.add(t[e])}add(t){this.__data__.set(t,ge);return this}has(t){return this.__data__.has(t)}}SetCache.prototype.push=SetCache.prototype.add;const isBoolean=function(t){var e=Object.prototype.toString;return t===true||t===false||!!t&&typeof t==="object"&&e.call(t)===tt};const isObject=function(t){return!!t&&(typeof t==="object"||typeof t==="function")};const isNumber=function(t){var e=Object.prototype.toString;return typeof t==="number"||!!t&&typeof t==="object"&&e.call(t)===ot};const isString=function(t){var e=Object.prototype.toString;return typeof t==="string"||!!t&&typeof t==="object"&&e.call(t)===ut};const Ne=createAssigner(((t,e)=>{if(isPrototype(e)||isArrayLike(e))copyObject(e,keys(e),t);else for(var n in e)hasOwnProperty.call(e,n)&&assignValue(t,n,e[n])}));const Oe=Ne;const Re=Oe;const supplement=(t,...e)=>{let n=-1;let r=e.length;const i=r>2?e[2]:void 0;i&&isIterateeCall(e[0],e[1],i)&&(r=1);while(++n<r){const r=e[n];if(r==null)continue;const i=Object.keys(r);const o=i.length;let s=-1;while(++s<o){const e=i[s];const n=t[e];(n===void 0||eq(n,Object.prototype[e])&&!hasOwnProperty.call(t,e))&&(t[e]=r[e])}}return t};const Be=supplement;const Ie=function defaultsDeep(...t){t.push(void 0,customDefaultsMerge);return Ve.apply(void 0,t)};const Fe=Ie;const invoke=(t,e,...n)=>{let r=-1;const i=typeof e==="function";const o=isArrayLike(t)?new Array(t.length):[];baseEach(t,(t=>{o[++r]=i?e.apply(t,n):invokeProperty(t,e,...n)}));return o};const invokeProperty=(t,e,...n)=>{e=castPath(e,t);t=parent(t,e);const r=t==null?t:t[toKey(last(e))];return r==null?void 0:r.apply(t,n)};const sortedIndex=(t,e,n)=>{let r=0;let i=t==null?0:t.length;if(i==0)return 0;n=getIteratee(n,2);e=n(e);const o=e!==e;const s=e===null;const a=isSymbol(e);const c=e===void 0;while(r<i){let l;const u=Math.floor((r+i)/2);const h=n(t[u]);const d=h!==void 0;const f=h===null;const p=h===h;const g=isSymbol(h);l=o?p:c?p&&d:s?p&&d&&!f:a?p&&d&&!f&&!g:!f&&!g&&h<e;l?r=u+1:i=u}return Math.min(i,Le)};const uniq=(t,e)=>{let n=-1;let includes=(t,e)=>{const n=t==null?0:t.length;return!!n&&t.indexOf(e)>-1};e=getIteratee(e,2);let r=true;const{length:i}=t;const o=[];let s=o;if(i>=pe){const n=e?null:_e(t);if(n)return setToArray(n);r=false;includes=(t,e)=>t.has(e);s=new SetCache}else s=e?[]:o;t:while(++n<i){let i=t[n];const a=e?e(i):i;i=i!==0?i:0;if(r&&a===a){let t=s.length;while(t--)if(s[t]===a)continue t;e&&s.push(a);o.push(i)}else if(!includes(s,a)){s!==o&&s.push(a);o.push(i)}}return o};const clone$1=t=>baseClone(t);const cloneDeep=t=>baseClone(t,true);const isEmpty=t=>{if(t==null)return true;if(isArrayLike(t)&&(Array.isArray(t)||typeof t==="string"||typeof t.splice==="function"||isTypedArray(t)||isArguments(t)))return!t.length;const e=getTag(t);if(e=="[object Map]"||e=="[object Set]")return!t.size;if(isPrototype(t))return!baseKeys(t).length;for(const e in t)if(hasOwnProperty.call(t,e))return false;return true};const isEqual=(t,e)=>baseIsEqual(t,e);const isFunction=t=>typeof t==="function";const isPlainObject=t=>{if(!isObjectLike(t)||getTag(t)!="[object Object]")return false;if(Object.getPrototypeOf(t)===null)return true;let e=t;while(Object.getPrototypeOf(e)!==null)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e};const toArray$1=t=>{if(!t)return[];if(isArrayLike(t))return isString(t)?stringToArray(t):copyArray(t);if(Symbol.iterator&&Symbol.iterator in Object(t)){const e=t[Symbol.iterator]();let n;const r=[];while(!(n=e.next()).done)r.push(n.value);return r}const e=getTag(t);const n=e==it?mapToArray:e==lt?setToArray:values;return n(t)};function debounce(t,e,n){if(typeof t!=="function")throw new TypeError("Expected a function");let r;let i;let o;let s;let a;let c;let l=0;let u=false;let h=false;let d=true;const f=!e&&e!==0&&window&&typeof window.requestAnimationFrame==="function";e=+e||0;if(isObject(n)){u=!!n.leading;h="maxWait"in n;o=h?Math.max(+n.maxWait||0,e):o;d="trailing"in n?!!n.trailing:d}function invokeFunc(e){const n=r;const o=i;r=i=void 0;l=e;s=t.apply(o,n);return s}function startTimer(t,e){if(f){window.cancelAnimationFrame(a);return window.requestAnimationFrame(t)}return setTimeout(t,e)}function cancelTimer(t){if(f)return window.cancelAnimationFrame(t);clearTimeout(t)}function leadingEdge(t){l=t;a=startTimer(timerExpired,e);return u?invokeFunc(t):s}function remainingWait(t){const n=t-c;const r=t-l;const i=e-n;return h?Math.min(i,o-r):i}function shouldInvoke(t){const n=t-c;const r=t-l;return c===void 0||n>=e||n<0||h&&r>=o}function timerExpired(){const t=Date.now();if(shouldInvoke(t))return trailingEdge(t);a=startTimer(timerExpired,remainingWait(t))}function trailingEdge(t){a=void 0;if(d&&r)return invokeFunc(t);r=i=void 0;return s}function debounced(...t){const n=Date.now();const o=shouldInvoke(n);r=t;i=this;c=n;if(o){if(a===void 0)return leadingEdge(c);if(h){a=startTimer(timerExpired,e);return invokeFunc(c)}}a===void 0&&(a=startTimer(timerExpired,e));return s}debounced.cancel=()=>{a!==void 0&&cancelTimer(a);l=0;r=c=i=a=void 0};debounced.flush=()=>a===void 0?s:trailingEdge(Date.now());debounced.pending=()=>a!==void 0;return debounced}const groupBy=(t,e)=>{e=getIteratee(e,2);return reduce(t,((t,n)=>{const r=e(n);hasOwnProperty.call(t,r)?t[r].push(n):assignValue(t,r,[n]);return t}),{})};const sortBy=(t,e=[])=>{if(t==null)return[];const n=e.length;n>1&&isIterateeCall(t,e[0],e[1])?e=[]:n>2&&isIterateeCall(e[0],e[1],e[2])&&(e=[e[0]]);Array.isArray(e)||(e=[getIteratee(e,2)]);return baseOrderBy(t,e.flat(1),[])};const flattenDeep=t=>{const e=t==null?0:t.length;return e?baseFlatten(t,Infinity):[]};const without=(t,...e)=>isArrayLike(t)?diff(t,e):[];const difference=(t,...e)=>isObjectLike(t)&&isArrayLike(t)?diff(t,e.flat(1)):[];const intersection=(...t)=>{const e=t.map((t=>isObjectLike(t)&&isArrayLike(t)?t:[]));return e.length&&e[0]===t[0]?intersect(e):[]};const union=(...t)=>{const e=t.flat(1);return uniq(e)};const has=(t,e)=>{if(t==null)return false;typeof e==="string"&&(e=e.split("."));let n=-1;let r=t;while(++n<e.length){if(!r||!hasOwnProperty.call(r,e[n]))return false;r=r[e[n]]}return true};const result=(t,e,n)=>{e=castPath(e,t);let r=-1;let i=e.length;if(!i){i=1;t=void 0}while(++r<i){let o=t==null?void 0:t[toKey(e[r])];if(o===void 0){r=i;o=n}t=typeof o==="function"?o.call(t):o}return t};const omit=(t,...e)=>{let n={};if(t==null)return n;let r=false;e=e.flat(1).map((e=>{e=castPath(e,t);r||(r=e.length>1);return e}));copyObject(t,getAllKeysIn(t),n);r&&(n=baseClone(n,true,true,true,(t=>isPlainObject(t)?void 0:t)));let i=e.length;while(i--)unset(n,e[i]);return n};const pick=(t,...e)=>t==null?{}:basePick(t,e.flat(Infinity));const bindAll=(t,...e)=>{e.flat(1).forEach((e=>{e=toKey(e);assignValue(t,e,t[e].bind(t))}));return t};const forIn=(t,e=(t=>t))=>{let n=-1;const r=Object(t);const i=isArrayLike(t)?arrayLikeKeys(t,true):keysIn(t);let o=i.length;while(o--){const t=i[++n];if(e(r[t],t,r)===false)break}};const camelCase=(t="")=>words(`${t}`.replace(/['\u2019]/g,"")).reduce(((t,e,n)=>{e=e.toLowerCase();return t+(n?Me(e):e)}),"");let De=0;const uniqueId=(t="")=>{const e=++De;return`${t}`+e};const Ve=createAssigner(((t,e,n,r)=>{baseMerge(t,e,n,r)}),true);class Data{constructor(){this.map=new WeakMap}has(t,e){return e===void 0?this.map.has(t):e in this.map.get(t)}create(t){this.has(t)||this.map.set(t,Object.create(null));return this.get(t)}get(t,e){if(!this.has(t))return;const n=this.map.get(t);return e===void 0?n:n[e]}set(t,e,n){if(e===void 0)return;const r=this.create(t);typeof e==="string"?r[e]=n:Object.assign(r,e)}remove(t,e){if(this.has(t))if(e===void 0)this.map.delete(t);else{const n=this.map.get(t);delete n[e]}}}const ze=new Data;const je=new Data;const Event=function(t,e){if(!(this instanceof Event))return new Event(t,e);if(t&&t.type){this.originalEvent=t;this.type=t.type;this.isDefaultPrevented=t.defaultPrevented?returnTrue:returnFalse;this.target=t.target;this.currentTarget=t.currentTarget;this.relatedTarget=t.relatedTarget}else this.type=t;e&&Object.assign(this,e);this.timeStamp=t&&t.timeStamp||Date.now();this.envelope=true};Event.prototype={constructor:Event,isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){const t=this.originalEvent;this.isDefaultPrevented=returnTrue;t&&t.preventDefault()},stopPropagation:function(){const t=this.originalEvent;this.isPropagationStopped=returnTrue;t&&t.stopPropagation()},stopImmediatePropagation:function(){const t=this.originalEvent;this.isImmediatePropagationStopped=returnTrue;t&&t.stopImmediatePropagation();this.stopPropagation()}};["altKey","bubbles","cancelable","changedTouches","ctrlKey","detail","eventPhase","metaKey","pageX","pageY","shiftKey","view","char","code","charCode","key","keyCode","button","buttons","clientX","clientY","offsetX","offsetY","pointerId","pointerType","screenX","screenY","targetTouches","toElement","touches","which"].forEach((t=>addProp(t)));function addProp(t){Object.defineProperty(Event.prototype,t,{enumerable:true,configurable:true,get:function(){return this.originalEvent?this.originalEvent[t]:void 0},set:function(e){Object.defineProperty(this,t,{enumerable:true,configurable:true,writable:true,value:e})}})}function returnTrue(){return true}function returnFalse(){return false}const Ge=typeof window!=="undefined"?window.document:null;const Ue=Ge&&Ge.documentElement;const We=/^([^.]*)(?:\.(.+)|)/;const He=/[^\x20\t\r\n\f]+/g;const $=function(t){return new $.Dom(t)};$.fn=$.prototype={constructor:$,length:0};$.guid=1;$.data=je;$.merge=function(t,e){let n=+e.length;let r=t.length;for(let i=0;i<n;i++)t[r++]=e[i];t.length=r;return t};$.parseHTML=function(t){const e=Ge.implementation.createHTMLDocument();const n=e.createElement("base");n.href=Ge.location.href;e.head.appendChild(n);e.body.innerHTML=t;const r=e.getElementsByTagName("script");for(let t=0;t<r.length;t++)r[t].remove();return Array.from(e.body.childNodes)};typeof Symbol==="function"&&($.fn[Symbol.iterator]=Array.prototype[Symbol.iterator]);$.fn.toArray=function(){return Array.from(this)};$.fn.pushStack=function(t){const e=$.merge(this.constructor(),t);e.prevObject=this;return e};$.fn.find=function(t){const[e]=this;const n=this.pushStack([]);if(!e)return n;const{nodeType:r}=e;if(r!==1&&r!==9&&r!==11)return n;typeof t!=="string"?e!==t&&e.contains(t)&&$.merge(n,[t]):$.merge(n,e.querySelectorAll(t));return n};$.fn.add=function(t){const e=$(t).toArray();const n=this.toArray();const r=this.pushStack([]);$.merge(r,uniq(n.concat(e)));return r};$.fn.addBack=function(){return this.add(this.prevObject)};$.fn.filter=function(t){const e=[];for(let n=0;n<this.length;n++){const r=this[n];r.matches(t)&&e.push(r)}return this.pushStack(e)};const $e=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;function isObviousHtml(t){return t[0]==="<"&&t[t.length-1]===">"&&t.length>=3}const Dom=function(t){if(!t)return this;if(typeof t==="function")throw new Error("function not supported");if(arguments.length>1)throw new Error("selector with context not supported");if(t.nodeType){this[0]=t;this.length=1;return this}let e;if(isObviousHtml(t+""))e=[null,t,null];else{if(typeof t!=="string")return $.merge(this,t);e=$e.exec(t)}if(!e||!e[1])return qe.find(t);if(e[1]){$.merge(this,$.parseHTML(e[1]));return this}const n=Ge.getElementById(e[2]);if(n){this[0]=n;this.length=1}return this};$.Dom=Dom;Dom.prototype=$.fn;$.Event=Event;$.event={special:Object.create(null)};$.event.has=function(t,e){const n=ze.get(t,"events");return!!n&&(!e||Array.isArray(n[e])&&n[e].length>0)};$.event.on=function(t,e,n,r,i,o){if(typeof e==="object"){if(typeof n!=="string"){r=r||n;n=void 0}for(let i in e)$.event.on(t,i,n,r,e[i],o);return t}if(r==null&&i==null){i=n;r=n=void 0}else if(i==null)if(typeof n==="string"){i=r;r=void 0}else{i=r;r=n;n=void 0}if(!i)return t;if(o===1){const t=i;i=function(e){$().off(e);return t.apply(this,arguments)};i.guid=t.guid||(t.guid=$.guid++)}for(let o=0;o<t.length;o++)$.event.add(t[o],e,i,r,n)};$.event.add=function(t,e,n,r,i){if(typeof t!="object")return;const o=ze.create(t);let s;if(n.handler){s=n;n=s.handler;i=s.selector}i&&Ue.matches(i);n.guid||(n.guid=$.guid++);let a;(a=o.events)||(a=o.events=Object.create(null));let c;(c=o.handle)||(c=o.handle=function(e){return typeof $!=="undefined"?$.event.dispatch.apply(t,arguments):void 0});const l=(e||"").match(He)||[""];let u=l.length;while(u--){const[,e,o=""]=We.exec(l[u]);if(!e)continue;const h=o.split(".").sort();let d=$.event.special[e];const f=d&&(i?d.delegateType:d.bindType)||e;d=$.event.special[f];const p=Object.assign({type:f,origType:e,data:r,handler:n,guid:n.guid,selector:i,namespace:h.join(".")},s);let g;if(!(g=a[f])){g=a[f]=[];g.delegateCount=0;d&&d.setup&&d.setup.call(t,r,h,c)!==false||t.addEventListener&&t.addEventListener(f,c)}if(d&&d.add){d.add.call(t,p);p.handler.guid||(p.handler.guid=n.guid)}i?g.splice(g.delegateCount++,0,p):g.push(p)}};$.event.remove=function(t,e,n,r,i){const o=ze.get(t);if(!o||!o.events)return;const s=o.events;const a=(e||"").match(He)||[""];let c=a.length;while(c--){const[,e,l=""]=We.exec(a[c]);if(!e){for(const e in s)$.event.remove(t,e+a[c],n,r,true);continue}const u=$.event.special[e];const h=u&&(r?u.delegateType:u.bindType)||e;const d=s[h];if(!d||d.length===0)continue;const f=l.split(".").sort();const p=l?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;const g=d.length;let v=g;while(v--){const o=d[v];if((i||e===o.origType)&&(!n||n.guid===o.guid)&&(!p||p.test(o.namespace))&&(!r||r===o.selector||r==="**"&&o.selector)){d.splice(v,1);o.selector&&d.delegateCount--;u&&u.remove&&u.remove.call(t,o)}}if(g&&d.length===0){u&&u.teardown&&u.teardown.call(t,f,o.handle)!==false||t.removeEventListener&&t.removeEventListener(h,o.handle);delete s[h]}}if(isEmpty(s)){ze.remove(t,"handle");ze.remove(t,"events")}};$.event.dispatch=function(t){const e=this;const n=$.event.fix(t);n.delegateTarget=e;const r=Array.from(arguments);r[0]=n;const i=ze.get(e,"events");const o=i&&i[n.type]||[];const s=$.event.special[n.type];if(s&&s.preDispatch&&s.preDispatch.call(e,n)===false)return;const a=$.event.handlers.call(e,n,o);let c=0;let l;while((l=a[c++])&&!n.isPropagationStopped()){n.currentTarget=l.elem;let t=0;let e;while((e=l.handlers[t++])&&!n.isImmediatePropagationStopped()){n.handleObj=e;n.data=e.data;const t=$.event.special[e.origType];let i;i=t&&t.handle?t.handle:e.handler;const o=i.apply(l.elem,r);if(o!==void 0&&(n.result=o)===false){n.preventDefault();n.stopPropagation()}}}s&&s.postDispatch&&s.postDispatch.call(e,n);return n.result};$.event.handlers=function(t,e){const n=e.delegateCount;const r=[];if(n&&!(t.type==="click"&&t.button>=1))for(let i=t.target;i!==this;i=i.parentNode||this)if(i.nodeType===1&&!(t.type==="click"&&i.disabled===true)){const t=[];const o={};for(let r=0;r<n;r++){const n=e[r];const s=n.selector+" ";o[s]===void 0&&(o[s]=i.matches(s));o[s]&&t.push(n)}t.length&&r.push({elem:i,handlers:t})}n<e.length&&r.push({elem:this,handlers:e.slice(n)});return r};$.event.fix=function(t){return t.envelope?t:new Event(t)};const qe=$(Ge);function cleanNodesData(t){let e=t.length;while(e--)cleanNodeData(t[e])}function cleanNodeData(t){$.event.remove(t);ze.remove(t);je.remove(t)}function removeNodes(t){for(let e=0;e<t.length;e++){const n=t[e];n.parentNode&&n.parentNode.removeChild(n)}}function remove(){for(let t=0;t<this.length;t++){const e=this[t];cleanNodeData(e);cleanNodesData(e.getElementsByTagName("*"))}removeNodes(this);return this}function detach(){removeNodes(this);return this}function empty(){for(let t=0;t<this.length;t++){const e=this[t];if(e.nodeType===1){cleanNodesData(e.getElementsByTagName("*"));e.textContent=""}}return this}function clone(){const t=[];for(let e=0;e<this.length;e++)t.push(this[e].cloneNode(true));return this.pushStack(t)}function html(t){const[e]=this;if(!e)return null;if(arguments.length===0)return e.innerHTML;if(t===void 0)return this;cleanNodesData(e.getElementsByTagName("*"));if(typeof t!=="string"&&typeof t!=="number"){e.innerHTML="";return this.append(t)}e.innerHTML=t;return this}function append(...t){const[e]=this;if(!e)return this;t.forEach((t=>{t&&(typeof t==="string"?e.append(...$.parseHTML(t)):t.toString()==="[object Object]"?this.append(...Array.from(t)):Array.isArray(t)?this.append(...t):e.appendChild(t))}));return this}function prepend(...t){const[e]=this;if(!e)return this;t.forEach((t=>{t&&(typeof t==="string"?e.prepend(...$.parseHTML(t)):t.toString()==="[object Object]"?this.prepend(...Array.from(t)):Array.isArray(t)?this.prepend(...t):e.insertBefore(t,e.firstChild))}));return this}function appendTo(t){$(t).append(this);return this}function prependTo(t){$(t).prepend(this);return this}const Ye={};["width","height","top","bottom","left","right","padding","paddingTop","paddingBottom","paddingLeft","paddingRight","margin","marginTop","marginBottom","marginLeft","marginRight"].forEach((t=>{Ye[t]=true}));function setCSSProperty(t,e,n){typeof n==="number"&&Ye[camelCase(e)]&&(n+="px");t.style[e]=n}function css(t,e){let n;if(typeof t==="string"){if(e===void 0){const[e]=this;return e?e.style[t]:null}n={[t]:e}}else{if(!t)throw new Error("no styles provided");n=t}for(let t in n)if(n.hasOwnProperty(t))for(let e=0;e<this.length;e++)setCSSProperty(this[e],t,n[t]);return this}function data(t,e){if(arguments.length<2){const[e]=this;return e?t===void 0?e.dataset:e.dataset[t]:null}for(let n=0;n<this.length;n++)this[n].dataset[t]=e;return this}function setNodesClass(t,e,n){for(let r=0;r<e.length;r++){const i=e[r];J.prototype[t].apply({node:i},n)}}function removeClass(){setNodesClass("removeClass",this,arguments);return this}function addClass$1(){setNodesClass("addClass",this,arguments);return this}function toggleClass(){setNodesClass("toggleClass",this,arguments);return this}function hasClass(){const[t]=this;return!!t&&J.prototype.hasClass.apply({node:t},arguments)}function children(t){const e=[];for(let n=0;n<this.length;n++){const r=this[n];let i=Array.from(r.children);typeof t==="string"&&(i=i.filter((e=>e.matches(t))));e.push(...i)}return this.pushStack(e)}function closest(t){const e=[];for(let n=0;n<this.length;n++){const r=this[n];if(typeof t==="string"){const n=r.closest(t);n&&e.push(n)}else{const[n]=$(t);n&&n.contains(r)&&e.push(n)}}return this.pushStack(e)}function on(t,e,n,r){$.event.on(this,t,e,n,r);return this}function one(t,e,n,r){$.event.on(this,t,e,n,r,1);return this}function off(t,e,n){if(t&&t.preventDefault&&t.handleObj){const e=t.handleObj;$(t.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler);return this}if(typeof t==="object"){for(let n in t)this.off(n,e,t[n]);return this}if(e===false||typeof e==="function"){n=e;e=void 0}for(let r=0;r<this.length;r++)$.event.remove(this[r],t,n,e);return this}function width(){const[t]=this;if(t===window)return t.document.documentElement.clientWidth;if(!t)return;const e=window.getComputedStyle(t);const n=t.offsetWidth;const r=parseFloat(e.borderTopWidth);const i=parseFloat(e.borderBottomWidth);const o=parseFloat(e.paddingTop);const s=parseFloat(e.paddingBottom);return n-i-r-o-s}function height(){const[t]=this;if(t===window)return t.document.documentElement.clientHeight;if(!t)return;const e=window.getComputedStyle(t);const n=t.offsetHeight;const r=parseFloat(e.borderLeftWidth);const i=parseFloat(e.borderRightWidth);const o=parseFloat(e.paddingLeft);const s=parseFloat(e.paddingRight);return n-r-i-o-s}function position(){const[t]=this;if(!t)return;let e=$(t);let n;let r;let i;let o={top:0,left:0};if(e.css("position")==="fixed")r=t.getBoundingClientRect();else{r=e.offset();i=t.ownerDocument;n=t.offsetParent||i.documentElement;const isStaticallyPositioned=t=>{const{position:e}=t.style;return!e||e==="static"};while(n&&n!==i.documentElement&&isStaticallyPositioned(n))n=n.offsetParent||i.documentElement;if(n&&n!==t&&n.nodeType===1&&!isStaticallyPositioned(n)){const t=window.getComputedStyle(n);const e=parseFloat(t.borderTopWidth)||0;const r=parseFloat(t.borderLeftWidth)||0;o=$(n).offset();o.top+=e;o.left+=r}}const s=parseFloat(window.getComputedStyle(t).marginTop)||0;const a=parseFloat(window.getComputedStyle(t).marginLeft)||0;return{top:r.top-o.top-s,left:r.left-o.left-a}}function offset(t){const[e]=this;if(t===void 0){if(!e)return null;if(!e.getClientRects().length)return{top:0,left:0};const t=e.getBoundingClientRect();return{top:t.top+window.scrollY,left:t.left+window.scrollX}}if(!e)return this;const n=window.getComputedStyle(e);n.position==="static"&&this.css("position","relative");const r=this.offset();const i=t.top-r.top;const o=t.left-r.left;this.css({top:(parseFloat(n.top)||0)+i+"px",left:(parseFloat(n.left)||0)+o+"px"});return this}var Xe=Object.freeze(Object.defineProperty({__proto__:null,addClass:addClass$1,append:append,appendTo:appendTo,children:children,clone:clone,closest:closest,css:css,data:data,detach:detach,empty:empty,hasClass:hasClass,height:height,html:html,off:off,offset:offset,on:on,one:one,position:position,prepend:prepend,prependTo:prependTo,remove:remove,removeClass:removeClass,toggleClass:toggleClass,width:width},Symbol.toStringTag,{value:"Module"}));const Ze="animationFrameId";const Je={};Je["transition-property"]=Je["transition-duration"]=Je["transition-delay"]=Je["transition-timing-function"]=Je["animation-name"]=Je["animation-duration"]=Je["animation-delay"]=Je["animation-timing-function"]="";function animate(t,e={}){this.stop();for(let n=0;n<this.length;n++)animateNode(this[n],t,e);return this}function animateNode(t,e,n={}){let{duration:r=400,easing:i="ease-in-out",delay:o=0,complete:s}=n;const a=setTimeout((function(){const n=$(t);let a=false;let c="transitionend";r/=1e3;o/=1e3;const l={};if(typeof e==="string"){l["animation-name"]=e;l["animation-duration"]=r+"s";l["animation-delay"]=o+"s";l["animation-timing-function"]=i;c="animationend"}else{const t=[];for(var u in e)if(e.hasOwnProperty(u)){l[u]=e[u];t.push(u)}if(r>0){l["transition-property"]=t.join(", ");l["transition-duration"]=r+"s";l["transition-delay"]=o+"s";l["transition-timing-function"]=i}}const wrappedCallback=function(e){if(e){if(e.target!==e.currentTarget)return;e.target.removeEventListener(c,wrappedCallback)}else t.removeEventListener(c,wrappedCallback);a=true;n.css(Je);s&&s.call(t)};if(r>0){t.addEventListener(c,wrappedCallback);const e=setTimeout((function(){a||wrappedCallback(null)}),(r+o)*1e3+25);ze.set(t,Ze,{id:e,stop:()=>{clearTimeout(e);t.removeEventListener(c,wrappedCallback)}})}n.css(l);r<=0&&wrappedCallback(null)}));ze.set(t,Ze,{stop:()=>clearTimeout(a)})}function stop(){for(let t=0;t<this.length;t++){const e=this[t];const n=ze.get(e,Ze);if(n){n.stop();ze.remove(e,Ze)}}this.css(Je);return this}var Ke=Object.freeze(Object.defineProperty({__proto__:null,animate:animate,stop:stop},Symbol.toStringTag,{value:"Module"}));const Qe={outerWidth:"offsetWidth",outerHeight:"offsetHeight",innerWidth:"clientWidth",innerHeight:"clientHeight",scrollLeft:"scrollLeft",scrollTop:"scrollTop",val:"value",text:"textContent"};const tn={disabled:"disabled",value:"value",text:"textContent"};function prop(t,e){if(!t)throw new Error("no property provided");if(arguments.length===1){const[e]=this;return e?e[t]:null}if(e===void 0)return this;for(let n=0;n<this.length;n++)this[n][t]=e;return this}function attr(t,e){let n;if(typeof t==="string"){if(e===void 0){const[e]=this;return e?e.getAttribute(t):null}n={[t]:e}}else{if(!t)throw new Error("no attributes provided");n=t}for(let t in n)if(n.hasOwnProperty(t)){const e=n[t];if(tn[t]){this.prop(tn[t],e);continue}for(let n=0;n<this.length;n++)e===null?this[n].removeAttribute(t):this[n].setAttribute(t,e)}return this}const en={prop:prop,attr:attr};Object.keys(Qe).forEach((t=>{en[t]=function(...e){return this.prop(Qe[t],...e)}}));const nn={useCSSSelectors:false,classNamePrefix:"joint-",defaultTheme:"default",doubleTapInterval:300};const rn=Object.create(null);rn.load={noBubble:true};[["mouseenter","mouseover"],["mouseleave","mouseout"],["pointerenter","pointerover"],["pointerleave","pointerout"]].forEach((([t,e])=>{rn[t]={delegateType:e,bindType:e,handle:function(t){const n=this;const r=t.relatedTarget;const i=t.handleObj;let o;if(!r||!n.contains(r)){t.type=i.origType;o=i.handler.apply(n,arguments);t.type=e}return o}}}));const sn=nn.doubleTapInterval;const an=30;rn.dbltap={bindType:"touchend",delegateType:"touchend",handle:function(t,...e){const{handleObj:n,target:r}=t;const i=$.data.create(r);const o=(new Date).getTime();const s="lastTouch"in i?o-i.lastTouch:0;if(s<sn&&s>an){i.lastTouch=null;t.type=n.origType;n.handler.call(this,t,...e)}else i.lastTouch=o}};Object.assign($.fn,Xe);Object.assign($.fn,Ke);Object.assign($.fn,en);Object.assign($.event.special,rn);const addClassNamePrefix=function(t){return t?t.toString().split(" ").map((function(t){t.substr(0,nn.classNamePrefix.length)!==nn.classNamePrefix&&(t=nn.classNamePrefix+t);return t})).join(" "):t};const removeClassNamePrefix=function(t){return t?t.toString().split(" ").map((function(t){t.substr(0,nn.classNamePrefix.length)===nn.classNamePrefix&&(t=t.substr(nn.classNamePrefix.length));return t})).join(" "):t};const parseDOMJSON=function(t,e){const n={};const r={};const i=J.namespace.svg;const o=e||i;const s=document.createDocumentFragment();const parseNode=function(t,e,o){for(let s=0;s<t.length;s++){const a=t[s];if(typeof a==="string"){const t=document.createTextNode(a);e.appendChild(t);continue}if(!a.hasOwnProperty("tagName"))throw new Error("json-dom-parser: missing tagName");const c=a.tagName;let l;const u=a.hasOwnProperty("namespaceURI")?a.namespaceURI:o;l=document.createElementNS(u,c);const h=u===i;const d=h?J(l):$(l);const f=a.attributes;f&&d.attr(f);const p=a.style;p&&$(l).css(p);if(a.hasOwnProperty("className")){const t=a.className;h?l.className.baseVal=t:l.className=t}a.hasOwnProperty("textContent")&&(l.textContent=a.textContent);if(a.hasOwnProperty("selector")){const t=a.selector;if(n[t])throw new Error("json-dom-parser: selector must be unique");n[t]=l;d.attr("joint-selector",t)}if(a.hasOwnProperty("groupSelector")){let t=a.groupSelector;Array.isArray(t)||(t=[t]);for(let e=0;e<t.length;e++){const n=t[e];let i=r[n];i||(i=r[n]=[]);i.push(l)}}e.appendChild(l);const g=a.children;Array.isArray(g)&&parseNode(g,l,u)}};parseNode(t,s,o);return{fragment:s,selectors:n,groupSelectors:r}};const hashCode=function(t){let e=0;if(t.length===0)return e;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);e=(e<<5)-e+r;e|=0}return e};const getByPath=function(t,e,n){var r=Array.isArray(e)?e:e.split(n||"/");var i;var o=0;var s=r.length;while(o<s){i=r[o++];if(Object(t)!==t||!(i in t))return;t=t[i]}return t};const isGetSafe=function(t,e){typeof e!=="string"&&typeof e!=="number"&&(e=String(e));return(e!=="constructor"||typeof t[e]!=="function")&&e!=="__proto__"};const setByPath=function(t,e,n,r){const i=Array.isArray(e)?e:e.split(r||"/");const o=i.length-1;let s=t;let a=0;for(;a<o;a++){const e=i[a];if(!isGetSafe(s,e))return t;const n=s[e];s=n||(s[e]={})}s[i[o]]=n;return t};const unsetByPath=function(t,e,n){const r=Array.isArray(e)?e:e.split(n||"/");const i=r.length-1;let o=t;let s=0;for(;s<i;s++){const e=r[s];if(!isGetSafe(o,e))return t;const n=o[e];if(!n)return t;o=n}delete o[r[i]];return t};const flattenObject=function(t,e,n){e=e||"/";var r={};for(var i in t)if(t.hasOwnProperty(i)){var o=typeof t[i]==="object";o&&n&&n(t[i])&&(o=false);if(o){var s=flattenObject(t[i],e,n);for(var a in s)s.hasOwnProperty(a)&&(r[i+e+a]=s[a])}else r[i]=t[i]}return r};const uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=Math.random()*16|0;var n=t==="x"?e:e&3|8;return n.toString(16)}))};const guid=function(t){guid.id=guid.id||1;if(t===void 0)return"j_"+guid.id++;t.id=t.id===void 0?"j_"+guid.id++:t.id;return t.id};const toKebabCase=function(t){return t.replace(/[A-Z]/g,"-$&").toLowerCase()};const normalizeEvent=function(t){if(t.normalized)return t;const{originalEvent:e,target:n}=t;const r=e&&e.changedTouches&&e.changedTouches[0];if(r)for(let e in r)t[e]===void 0&&(t[e]=r[e]);if(n){const e=n.correspondingUseElement;e&&(t.target=e)}t.normalized=true;return t};const normalizeWheel=function(t){const e=10;const n=40;const r=800;let i=0,o=0,s=0,a=0;"detail"in t&&(o=t.detail);"wheelDelta"in t&&(o=-t.wheelDelta/120);"wheelDeltaY"in t&&(o=-t.wheelDeltaY/120);"wheelDeltaX"in t&&(i=-t.wheelDeltaX/120);if("axis"in t&&t.axis===t.HORIZONTAL_AXIS){i=o;o=0}s="deltaX"in t?t.deltaX:i*e;a="deltaY"in t?t.deltaY:o*e;if((s||a)&&t.deltaMode)if(t.deltaMode==1){s*=n;a*=n}else{s*=r;a*=r}if(t.deltaX===0&&t.deltaY!==0&&t.shiftKey){s=a;a=0;i=o;o=0}s&&!i&&(i=s<1?-1:1);a&&!o&&(o=a<1?-1:1);return{spinX:i,spinY:o,deltaX:s,deltaY:a}};const cap=function(t,e){return t>e?e:t<-e?-e:t};const cn=function(){var t;typeof window!=="undefined"&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame);if(!t){var e=0;t=function(t){var n=(new Date).getTime();var r=Math.max(0,16-(n-e));var i=setTimeout((function(){t(n+r)}),r);e=n+r;return i}}return function(e,n,...r){return t(n!==void 0?e.bind(n,...r):e)}}();const ln=function(){var t;var e=typeof window!="undefined";e&&(t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame);t=t||clearTimeout;return e?t.bind(window):t}();const isPercentage=function(t){return isString(t)&&t.slice(-1)==="%"};const parseCssNumeric=function(t,e){function getUnit(e){var n=new RegExp("(?:\\d+(?:\\.\\d+)*)("+e+")$").exec(t);return n?n[1]:null}var n=parseFloat(t);if(Number.isNaN(n))return null;var r={};r.value=n;var i;if(e==null)i="[A-Za-z]*";else if(Array.isArray(e)){if(e.length===0)return null;i=e.join("|")}else isString(e)&&(i=e);var o=getUnit(i);if(o===null)return null;r.unit=o;return r};const un=0;function splitWordWithEOL(t,e){const n=t.split(e);let r=1;for(let t=0,i=n.length-1;t<i;t++){const o=[];(t>0||n[0]!=="")&&o.push(un);o.push(e);(t<i-1||n[i]!=="")&&o.push(un);n.splice(r,0,...o);r+=o.length+1}return n.filter((t=>t!==""))}function getLineHeight(t,e){if(t===null)return e.getBBox().height;switch(t.unit){case"em":return e.getBBox().height*t.value;case"px":case"":return t.value}}const breakText=function(t,e,n={},r={}){var i=e.width;var o=e.height;var s=r.svgDocument||J("svg").node;var a=J("tspan").node;var c=J("text").attr(n).append(a).node;var l=document.createTextNode("");c.style.opacity=0;c.style.display="block";a.style.display="block";a.appendChild(l);s.appendChild(c);r.svgDocument||document.body.appendChild(s);const u=r.preserveSpaces;const h=" ";const d=r.separator||r.separator===""?r.separator:h;const f=typeof d==="string"?d:h;var p=r.eol||"\n";var g=r.hyphen?new RegExp(r.hyphen):/[^\w\d\u00C0-\u1FFF\u2800-\uFFFD]/;var v=r.maxLineCount;isNumber(v)||(v=Infinity);var m=t.split(d);var y=[];var b=[];var x,w;var A;u&&J(a).attr("xml:space","preserve");for(var P=0,T=0,E=m.length;P<E;P++){var S=m[P];if((S||u)&&typeof S==="string"){var k=false;if(p&&S.indexOf(p)>=0){if(S.length>1){const t=splitWordWithEOL(m[P],p);m.splice(P,1,...t);P--;E=m.length;continue}if(u&&typeof m[P-1]==="string"){m.splice(P,un,"",un);E+=2;P--;continue}b[++T]=u&&typeof m[P+1]!=="string"?void 0:"";k=true}if(!k){let t;t=u?b[T]!==void 0?b[T]+f+S:S:b[T]?b[T]+f+S:S;l.data=t;if(a.getComputedTextLength()<=i){b[T]=t;if(x||w){y[T++]=true;x=0;w=0}}else{if(!b[T]||x){var L=!!x;x=S.length-1;if(L||!x){if(!x){if(!b[T]){b=[];break}m.splice(P,2,S+m[P+1]);E--;y[T++]=true;P--;continue}m[P]=S.substring(0,x);const t=m[P+1];m[P+1]=S.substring(x)+(t===void 0||t===un?"":t)}else{if(w){m.splice(P,2,m[P]+m[P+1]);w=0}else{var C=S.search(g);if(C>-1&&C!==S.length-1&&C!==0){w=C+1;x=0}m.splice(P,1,S.substring(0,w||x),S.substring(w||x));E++}T&&!y[T-1]&&T--}u&&b[T]===""||P--;continue}T++;P--}}var _=null;if(b.length>v)_=v-1;else if(o!==void 0){if(A===void 0&&l.data!=="")if(n.lineHeight==="auto")A=getLineHeight({value:1.5,unit:"em"},c);else{const t=parseCssNumeric(n.lineHeight,["em","px",""]);A=getLineHeight(t,c)}A*b.length>o&&(_=Math.floor(o/A)-1)}if(_!==null){b.splice(_+1);var M=r.ellipsis;if(!M||_<0)break;typeof M!=="string"&&(M="");var N=b[_];if(!N&&!k)break;var O=N.length;var R,B;do{B=N[O];R=N.substring(0,O);B?B.match(d)&&(R+=B):R+=f;R+=M;l.data=R;if(a.getComputedTextLength()<=i){b[_]=R;break}O--}while(O>=0);break}}}r.svgDocument?s.removeChild(c):document.body.removeChild(s);return b.join(p)};const sanitizeHTML=function(t){const[e]=$.parseHTML("<div>"+t+"</div>");Array.from(e.getElementsByTagName("*")).forEach((function(t){const e=t.getAttributeNames();e.forEach((function(e){const n=t.getAttribute(e);(e.startsWith("on")||n.startsWith("javascript:"))&&t.removeAttribute(e)}))}));return e.innerHTML};const downloadBlob=function(t,e){if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(t,e);else{var n=window.URL.createObjectURL(t);var r=document.createElement("a");r.href=n;r.download=e;document.body.appendChild(r);r.click();document.body.removeChild(r);window.URL.revokeObjectURL(n)}};const downloadDataUri=function(t,e){const n=dataUriToBlob(t);downloadBlob(n,e)};const dataUriToBlob=function(t){t=t.replace(/\s/g,"");t=decodeURIComponent(t);var e=t.indexOf(",");var n=t.slice(0,e);var r=n.split(":")[1].split(";")[0];var i=t.slice(e+1);var o;o=n.indexOf("base64")>=0?atob(i):unescape(encodeURIComponent(i));var s=new Uint8Array(o.length);for(var a=0;a<o.length;a++)s[a]=o.charCodeAt(a);return new Blob([s],{type:r})};const imageToDataUri=function(t,e){if(!t||t.substr(0,5)==="data:")return setTimeout((function(){e(null,t)}),0);var modernHandler=function(e,n){if(e.status===200){var r=new FileReader;r.onload=function(t){var e=t.target.result;n(null,e)};r.onerror=function(){n(new Error("Failed to load image "+t))};r.readAsDataURL(e.response)}else n(new Error("Failed to load image "+t))};var legacyHandler=function(e,n){var Uint8ToString=function(t){var e=32768;var n=[];for(var r=0;r<t.length;r+=e)n.push(String.fromCharCode.apply(null,t.subarray(r,r+e)));return n.join("")};if(e.status===200){var r=new Uint8Array(e.response);var i=t.split(".").pop()||"png";var o={svg:"svg+xml"};var s="data:image/"+(o[i]||i)+";base64,";var a=s+btoa(Uint8ToString(r));n(null,a)}else n(new Error("Failed to load image "+t))};var n=new XMLHttpRequest;n.open("GET",t,true);n.addEventListener("error",(function(){e(new Error("Failed to load image "+t))}));n.responseType=window.FileReader?"blob":"arraybuffer";n.addEventListener("load",(function(){window.FileReader?modernHandler(n,e):legacyHandler(n,e)}));n.send()};const getElementBBox=function(t){var e=$(t);if(e.length===0)throw new Error("Element not found");var n=e[0];var r=n.ownerDocument;var i=n.getBoundingClientRect();var o=0;var s=0;if(n.ownerSVGElement){var a=J(n);var c=a.getBBox({target:a.svg()});o=i.width-c.width;s=i.height-c.height}return{x:i.left+window.pageXOffset-r.documentElement.offsetLeft+o/2,y:i.top+window.pageYOffset-r.documentElement.offsetTop+s/2,width:i.width-o,height:i.height-s}};const sortElements=function(t,e){t=$(t).toArray();var n=t.map((function(t){var e=t.parentNode;var n=e.insertBefore(document.createTextNode(""),t.nextSibling);return function(){if(e===this)throw new Error("You can't sort elements if any one is a descendant of another.");e.insertBefore(this,n);e.removeChild(n)}}));t.sort(e);for(var r=0;r<n.length;r++)n[r].call(t[r]);return t};const setAttributesBySelector=function(t,e){var n=$(t);forIn(e,(function(t,e){var r=n.find(e).addBack().filter(e);if(has(t,"class")){r.addClass(t.class);t=omit(t,"class")}r.attr(t)}))};const normalizeSides=function(t){if(Object(t)!==t){var e=0;isFinite(t)&&(e=+t);return{top:e,right:e,bottom:e,left:e}}var n,r,i,o;n=r=i=o=0;isFinite(t.vertical)&&(n=i=+t.vertical);isFinite(t.horizontal)&&(r=o=+t.horizontal);isFinite(t.top)&&(n=+t.top);isFinite(t.right)&&(r=+t.right);isFinite(t.bottom)&&(i=+t.bottom);isFinite(t.left)&&(o=+t.left);return{top:n,right:r,bottom:i,left:o}};const hn={linear:function(t){return t},quad:function(t){return t*t},cubic:function(t){return t*t*t},inout:function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t;var n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)},exponential:function(t){return Math.pow(2,10*(t-1))},bounce:function(t){for(var e=0,n=1;1;e+=n,n/=2)if(t>=(7-4*e)/11){var r=(11-6*e-11*t)/4;return-r*r+n*n}},reverse:function(t){return function(e){return 1-t(1-e)}},reflect:function(t){return function(e){return.5*(e<.5?t(2*e):2-t(2-2*e))}},clamp:function(t,e,n){e=e||0;n=n||1;return function(r){var i=t(r);return i<e?e:i>n?n:i}},back:function(t){t||(t=1.70158);return function(e){return e*e*((t+1)*e-t)}},elastic:function(t){t||(t=1.5);return function(e){return Math.pow(2,10*(e-1))*Math.cos(20*Math.PI*t/3*e)}}};const dn={number:function(t,e){var n=e-t;return function(e){return t+n*e}},object:function(t,e){var n=Object.keys(t);return function(r){var i,o;var s={};for(i=n.length-1;i!=-1;i--){o=n[i];s[o]=t[o]+(e[o]-t[o])*r}return s}},hexColor:function(t,e){var n=parseInt(t.slice(1),16);var r=parseInt(e.slice(1),16);var i=n&255;var o=(r&255)-i;var s=n&65280;var a=(r&65280)-s;var c=n&16711680;var l=(r&16711680)-c;return function(t){var e=i+o*t&255;var n=s+a*t&65280;var r=c+l*t&16711680;return"#"+(1<<24|e|n|r).toString(16).slice(1)}},unit:function(t,e){var n=/(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/;var r=n.exec(t);var i=n.exec(e);var o=i[1].indexOf(".");var s=o>0?i[1].length-o-1:0;t=+r[1];var a=+i[1]-t;var c=r[2];return function(e){return(t+a*e).toFixed(s)+c}}};const pn={outline:function(t){var e='<filter><feFlood flood-color="${color}" flood-opacity="${opacity}" result="colored"/><feMorphology in="SourceAlpha" result="morphedOuter" operator="dilate" radius="${outerRadius}" /><feMorphology in="SourceAlpha" result="morphedInner" operator="dilate" radius="${innerRadius}" /><feComposite result="morphedOuterColored" in="colored" in2="morphedOuter" operator="in"/><feComposite operator="xor" in="morphedOuterColored" in2="morphedInner" result="outline"/><feMerge><feMergeNode in="outline"/><feMergeNode in="SourceGraphic"/></feMerge></filter>';var n=Number.isFinite(t.margin)?t.margin:2;var r=Number.isFinite(t.width)?t.width:1;return template(e)({color:t.color||"blue",opacity:Number.isFinite(t.opacity)?t.opacity:1,outerRadius:n+r,innerRadius:n})},highlight:function(t){var e='<filter><feFlood flood-color="${color}" flood-opacity="${opacity}" result="colored"/><feMorphology result="morphed" in="SourceGraphic" operator="dilate" radius="${width}"/><feComposite result="composed" in="colored" in2="morphed" operator="in"/><feGaussianBlur result="blured" in="composed" stdDeviation="${blur}"/><feBlend in="SourceGraphic" in2="blured" mode="normal"/></filter>';return template(e)({color:t.color||"red",width:Number.isFinite(t.width)?t.width:1,blur:Number.isFinite(t.blur)?t.blur:0,opacity:Number.isFinite(t.opacity)?t.opacity:1})},blur:function(t){var e=Number.isFinite(t.x)?t.x:2;return template('<filter><feGaussianBlur stdDeviation="${stdDeviation}"/></filter>')({stdDeviation:Number.isFinite(t.y)?[e,t.y]:e})},dropShadow:function(t){var e="SVGFEDropShadowElement"in window?'<filter><feDropShadow stdDeviation="${blur}" dx="${dx}" dy="${dy}" flood-color="${color}" flood-opacity="${opacity}"/></filter>':'<filter><feGaussianBlur in="SourceAlpha" stdDeviation="${blur}"/><feOffset dx="${dx}" dy="${dy}" result="offsetblur"/><feFlood flood-color="${color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="${opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>';return template(e)({dx:t.dx||0,dy:t.dy||0,opacity:Number.isFinite(t.opacity)?t.opacity:1,color:t.color||"black",blur:Number.isFinite(t.blur)?t.blur:4})},grayscale:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return template('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${b} ${h} 0 0 0 0 0 1 0"/></filter>')({a:.2126+.7874*(1-e),b:.7152-.7152*(1-e),c:.0722-.0722*(1-e),d:.2126-.2126*(1-e),e:.7152+.2848*(1-e),f:.0722-.0722*(1-e),g:.2126-.2126*(1-e),h:.0722+.9278*(1-e)})},sepia:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return template('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${h} ${i} 0 0 0 0 0 1 0"/></filter>')({a:.393+.607*(1-e),b:.769-.769*(1-e),c:.189-.189*(1-e),d:.349-.349*(1-e),e:.686+.314*(1-e),f:.168-.168*(1-e),g:.272-.272*(1-e),h:.534-.534*(1-e),i:.131+.869*(1-e)})},saturate:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return template('<filter><feColorMatrix type="saturate" values="${amount}"/></filter>')({amount:1-e})},hueRotate:function(t){return template('<filter><feColorMatrix type="hueRotate" values="${angle}"/></filter>')({angle:t.angle||0})},invert:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return template('<filter><feComponentTransfer><feFuncR type="table" tableValues="${amount} ${amount2}"/><feFuncG type="table" tableValues="${amount} ${amount2}"/><feFuncB type="table" tableValues="${amount} ${amount2}"/></feComponentTransfer></filter>')({amount:e,amount2:1-e})},brightness:function(t){return template('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}"/><feFuncG type="linear" slope="${amount}"/><feFuncB type="linear" slope="${amount}"/></feComponentTransfer></filter>')({amount:Number.isFinite(t.amount)?t.amount:1})},contrast:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return template('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}" intercept="${amount2}"/><feFuncG type="linear" slope="${amount}" intercept="${amount2}"/><feFuncB type="linear" slope="${amount}" intercept="${amount2}"/></feComponentTransfer></filter>')({amount:e,amount2:.5-e/2})}};const gn={number:function(t,e,n){n=n||{currency:["$",""],decimal:".",thousands:",",grouping:[3]};var r=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i;var i=r.exec(t);var o=i[1]||" ";var s=i[2]||">";var a=i[3]||"";var c=i[4]||"";var l=i[5];var u=+i[6];var h=i[7];var d=i[8];var f=i[9];var p=1;var g="";var v="";var m=false;d&&(d=+d.substring(1));if(l||o==="0"&&s==="="){l=o="0";s="=";h&&(u-=Math.floor((u-1)/4))}switch(f){case"n":h=true;f="g";break;case"%":p=100;v="%";f="f";break;case"p":p=100;v="%";f="r";break;case"b":case"o":case"x":case"X":c==="#"&&(g="0"+f.toLowerCase());break;case"c":case"d":m=true;d=0;break;case"s":p=-1;f="r";break}if(c==="$"){g=n.currency[0];v=n.currency[1]}f!="r"||d||(f="g");d!=null&&(f=="g"?d=Math.max(1,Math.min(21,d)):f!="e"&&f!="f"||(d=Math.max(0,Math.min(20,d))));var y=l&&h;if(m&&e%1)return"";var b=e<0||e===0&&1/e<0?(e=-e,"-"):a;var x=v;if(p<0){var w=this.prefix(e,d);e=w.scale(e);x=w.symbol+v}else e*=p;e=this.convert(f,e,d);var A=e.lastIndexOf(".");var P=A<0?e:e.substring(0,A);var T=A<0?"":n.decimal+e.substring(A+1);function formatGroup(t){var e=t.length;var r=[];var i=0;var o=n.grouping[0];while(e>0&&o>0){r.push(t.substring(e-=o,e+o));o=n.grouping[i=(i+1)%n.grouping.length]}return r.reverse().join(n.thousands)}!l&&h&&n.grouping&&(P=formatGroup(P));var E=g.length+P.length+T.length+(y?0:b.length);var S=E<u?new Array(E=u-E+1).join(o):"";y&&(P=formatGroup(S+P));b+=g;e=P+T;return(s==="<"?b+e+S:s===">"?S+b+e:s==="^"?S.substring(0,E>>=1)+b+e+S.substring(E):b+(y?e:S+e))+x},string:function(t,e){var n;var r="{";var i=false;var o=[];while((n=t.indexOf(r))!==-1){var s,a,c;s=t.slice(0,n);if(i){a=s.split(":");c=a.shift().split(".");s=e;for(var l=0;l<c.length;l++)s=s[c[l]];a.length&&(s=this.number(a,s))}o.push(s);t=t.slice(n+1);i=!i;r=i?"}":"{"}o.push(t);return o.join("")},convert:function(t,e,n){switch(t){case"b":return e.toString(2);case"c":return String.fromCharCode(e);case"o":return e.toString(8);case"x":return e.toString(16);case"X":return e.toString(16).toUpperCase();case"g":return e.toPrecision(n);case"e":return e.toExponential(n);case"f":return e.toFixed(n);case"r":return(e=this.round(e,this.precision(e,n))).toFixed(Math.max(0,Math.min(20,this.precision(e*(1+1e-15),n))));default:return e+""}},round:function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)},precision:function(t,e){return e-(t?Math.ceil(Math.log(t)/Math.LN10):1)},prefix:function(t,e){var n=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"].map((function(t,e){var n=Math.pow(10,Math.abs(8-e)*3);return{scale:e>8?function(t){return t/n}:function(t){return t*n},symbol:t}}));var r=0;if(t){t<0&&(t*=-1);e&&(t=this.round(t,this.precision(t,e)));r=1+Math.floor(1e-12+Math.log(t)/Math.LN10);r=Math.max(-24,Math.min(24,Math.floor((r<=0?r+1:r-1)/3)*3))}return n[8+r/3]}};const template=function(t){var e=/<%= ([^ ]+) %>|\$\{ ?([^{} ]+) ?\}|\{\{([^{} ]+)\}\}/g;return function(n){n=n||{};return t.replace(e,(function(t){var e=Array.from(arguments);var r=e.slice(1,4).find((function(t){return!!t}));var i=r.split(".");var o=n[i.shift()];while(o!==void 0&&i.length)o=o[i.shift()];return o!==void 0?o:""}))}};
/**
 * @param {Element} el Element, which content is intent to display in full-screen mode, 'window.top.document.body' is default.
 */const toggleFullScreen=function(t){var e=window.top.document;t=t||e.body;function prefixedResult(t,e){var n=["webkit","moz","ms","o",""];for(var r=0;r<n.length;r++){var i=n[r];var o=i?i+e:e.substr(0,1).toLowerCase()+e.substr(1);if(t[o]!==void 0)return isFunction(t[o])?t[o]():t[o]}}prefixedResult(e,"FullscreenElement")||prefixedResult(e,"FullScreenElement")?prefixedResult(e,"ExitFullscreen")||prefixedResult(e,"CancelFullScreen"):prefixedResult(t,"RequestFullscreen")||prefixedResult(t,"RequestFullScreen")};function findDifference(t,e,n,r){if(n===r)return{};const i={};Object.keys(t).forEach((o=>{const s=t[o];const a=e[o];if(!Array.isArray(s)&&!Array.isArray(a)&&isObject(s)&&isObject(a)){const t=n+1;const e=findDifference(s,a,t,r);Object.keys(e).length>0?i[o]=e:n!==0&&t!==r||(i[o]={})}else isEqual(s,a)||(i[o]=s)}));return i}function objectDifference(t,e,n){const{maxDepth:r=Number.POSITIVE_INFINITY}=n||{};return findDifference(t,e,0,r)}const noop=function(){};var vn={};var mn=/\s+/;var yn;var eventsApi=function(t,e,n,r,i){var o,s=0;if(n&&typeof n==="object"){r!==void 0&&"context"in i&&i.context===void 0&&(i.context=r);for(o=Object.keys(n);s<o.length;s++)e=eventsApi(t,e,o[s],n[o[s]],i)}else if(n&&mn.test(n))for(o=n.split(mn);s<o.length;s++)e=t(e,o[s],r,i);else e=t(e,n,r,i);return e};vn.on=function(t,e,n){this._events=eventsApi(onApi,this._events||{},t,e,{context:n,ctx:this,listening:yn});if(yn){var r=this._listeners||(this._listeners={});r[yn.id]=yn;yn.interop=false}return this};vn.listenTo=function(t,e,n){if(!t)return this;var r=t._listenId||(t._listenId=uniqueId("l"));var i=this._listeningTo||(this._listeningTo={});var o=yn=i[r];if(!o){this._listenId||(this._listenId=uniqueId("l"));o=yn=i[r]=new Listening(this,t)}var s=tryCatchOn(t,e,n,this);yn=void 0;if(s)throw s;o.interop&&o.on(e,n);return this};var onApi=function(t,e,n,r){if(n){var i=t[e]||(t[e]=[]);var o=r.context,s=r.ctx,a=r.listening;a&&a.count++;i.push({callback:n,context:o,ctx:o||s,listening:a})}return t};var tryCatchOn=function(t,e,n,r){try{t.on(e,n,r)}catch(t){return t}};vn.off=function(t,e,n){if(!this._events)return this;this._events=eventsApi(offApi,this._events,t,e,{context:n,listeners:this._listeners});return this};vn.stopListening=function(t,e,n){var r=this._listeningTo;if(!r)return this;var i=t?[t._listenId]:Object.keys(r);for(var o=0;o<i.length;o++){var s=r[i[o]];if(!s)break;s.obj.off(e,n,this);s.interop&&s.off(e,n)}isEmpty(r)&&(this._listeningTo=void 0);return this};var offApi=function(t,e,n,r){if(t){var i=r.context,o=r.listeners;var s,a=0;if(e||i||n){s=e?[e]:Object.keys(t);for(;a<s.length;a++){e=s[a];var c=t[e];if(!c)break;var l=[];for(var u=0;u<c.length;u++){var h=c[u];if(n&&n!==h.callback&&n!==h.callback._callback||i&&i!==h.context)l.push(h);else{var d=h.listening;d&&d.off(e,n)}}l.length?t[e]=l:delete t[e]}return t}if(o!=null)for(s=Object.keys(o);a<s.length;a++)o[s[a]].cleanup()}};vn.once=function(t,e,n){var r=eventsApi(onceMap,{},t,e,this.off.bind(this));typeof t==="string"&&n==null&&(e=void 0);return this.on(r,e,n)};vn.listenToOnce=function(t,e,n){var r=eventsApi(onceMap,{},e,n,this.stopListening.bind(this,t));return this.listenTo(t,r)};var onceMap=function(t,e,n,r){if(n){var i=t[e]=onceInvoke((function(){r(e,i);n.apply(this,arguments)}));i._callback=n}return t};var onceInvoke=function(t){var e;if(typeof t!="function")throw new TypeError("Expected a function");var n=2;return function(){--n>0&&(e=t.apply(this,arguments));n<=1&&(t=void 0);return e}};vn.trigger=function(t){if(!this._events)return this;var e=Math.max(0,arguments.length-1);var n=Array(e);for(var r=0;r<e;r++)n[r]=arguments[r+1];eventsApi(triggerApi,this._events,t,void 0,n);return this};var triggerApi=function(t,e,n,r){if(t){var i=t[e];var o=t.all;i&&o&&(o=o.slice());i&&triggerEvents(i,r);o&&triggerEvents(o,[e].concat(r))}return t};var triggerEvents=function(t,e){var n,r=-1,i=t.length,o=e[0],s=e[1],a=e[2];switch(e.length){case 0:while(++r<i)(n=t[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=t[r]).callback.call(n.ctx,o);return;case 2:while(++r<i)(n=t[r]).callback.call(n.ctx,o,s);return;case 3:while(++r<i)(n=t[r]).callback.call(n.ctx,o,s,a);return;default:while(++r<i)(n=t[r]).callback.apply(n.ctx,e);return}};var Listening=function(t,e){this.id=t._listenId;this.listener=t;this.obj=e;this.interop=true;this.count=0;this._events=void 0};Listening.prototype.on=vn.on;Listening.prototype.off=function(t,e){var n;if(this.interop){this._events=eventsApi(offApi,this._events,t,e,{context:void 0,listeners:void 0});n=!this._events}else{this.count--;n=this.count===0}n&&this.cleanup()};Listening.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId];this.interop||delete this.obj._listeners[this.id]};vn.bind=vn.on;vn.unbind=vn.off;var extend=function(t,e){var n=this;var r;r=t&&has(t,"constructor")?t.constructor:function(){return n.apply(this,arguments)};Ne(r,n,e);r.prototype=Object.assign(Object.create(n.prototype),t);r.prototype.constructor=r;r.__super__=n.prototype;return r};var addMethod=function(t,e,n,r){switch(e){case 1:return function(){return t[n](this[r])};case 2:return function(e){return t[n](this[r],e)};case 3:return function(e,i){return t[n](this[r],cb(e,this),i)};case 4:return function(e,i,o){return t[n](this[r],cb(e,this),i,o)};default:return function(){var e=Array.prototype.slice.call(arguments);e.unshift(this[r]);return t[n].apply(t,e)}}};var addMethodsUtil=function(t,e,n,r){forIn(n,(function(n,i){e[i]&&(t.prototype[i]=addMethod(e,n,i,r))}))};var cb=function(t,e){return isFunction(t)?t:isObject(t)&&!e._isModel(t)?modelMatcher(t):isString(t)?function(e){return e.get(t)}:t};var modelMatcher=function(t){var e=matches(t);return function(t){return e(t.attributes)}};var Model=function(t,e){var n=t||{};e||(e={});this.preinitialize.apply(this,arguments);this.cid=uniqueId(this.cidPrefix);this.attributes={};e.collection&&(this.collection=e.collection);var r=result(this,"defaults");n=Be(Ne({},r,n),r);this.set(n,e);this.changed={};this.initialize.apply(this,arguments)};Ne(Model.prototype,vn,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(t){return clone$1(this.attributes)},get:function(t){return this.attributes[t]},has:function(t){return this.get(t)!=null},set:function(t,e,n){if(t==null)return this;var r;if(typeof t==="object"){r=t;n=e}else(r={})[t]=e;n||(n={});if(!this._validate(r,n))return false;var i=n.unset;var o=n.silent;var s=[];var a=this._changing;this._changing=true;if(!a){this._previousAttributes=clone$1(this.attributes);this.changed={}}var c=this.attributes;var l=this.changed;var u=this._previousAttributes;for(var h in r){e=r[h];isEqual(c[h],e)||s.push(h);isEqual(u[h],e)?delete l[h]:l[h]=e;i?delete c[h]:c[h]=e}if(this.idAttribute in r){var d=this.id;this.id=this.get(this.idAttribute);this.trigger("changeId",this,d,n)}if(!o){s.length&&(this._pending=n);for(var f=0;f<s.length;f++)this.trigger("change:"+s[f],this,c[s[f]],n)}if(a)return this;if(!o)while(this._pending){n=this._pending;this._pending=false;this.trigger("change",this,n)}this._pending=false;this._changing=false;return this},unset:function(t,e){return this.set(t,void 0,Ne({},e,{unset:true}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,Ne({},t,{unset:true}))},hasChanged:function(t){return t==null?!isEmpty(this.changed):has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&clone$1(this.changed);var e=this._changing?this._previousAttributes:this.attributes;var n={};var r;for(var i in t){var o=t[i];if(!isEqual(e[i],o)){n[i]=o;r=true}}return!!r&&n},previous:function(t){return t!=null&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return clone$1(this._previousAttributes)},clone:function(){return new this.constructor(this.attributes)},isValid:function(t){return this._validate({},Ne({},t,{validate:true}))},_validate:function(t,e){if(!e.validate||!this.validate)return true;t=Ne({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;if(!n)return true;this.trigger("invalid",this,n,Ne(e,{validationError:n}));return false}});Model.extend=extend;function cloneCells(t){t=uniq(t);const e=toArray$1(t).reduce((function(t,e){t[e.id]=e.clone();return t}),{});toArray$1(t).forEach((function(t){const n=e[t.id];if(n.isLink()){const t=n.source();const r=n.target();t.id&&e[t.id]&&n.prop("source/id",e[t.id].id);r.id&&e[r.id]&&n.prop("target/id",e[r.id].id)}const r=t.get("parent");r&&e[r]&&n.set("parent",e[r].id);const i=toArray$1(t.get("embeds")).reduce((function(t,n){e[n]&&t.push(e[n].id);return t}),[]);isEmpty(i)||n.set("embeds",i)}));return e}const bn=["checked","selected","disabled","readOnly","contentEditable","value","indeterminate"];const xn=bn.reduce(((t,e)=>{t[e]=true;return t}),{});const wn={qualify:function(t){return isPlainObject(t)},set:function(t,e,n){Object.keys(t).forEach((function(e){if(xn[e]&&e in n){const r=t[e];n.tagName==="SELECT"&&Array.isArray(r)?Array.from(n.options).forEach((function(t,e){t.selected=r.includes(t.value)})):n[e]=r}}))}};function positionWrapper(t,e,n){return function(r,i){var o=isPercentage(r);r=parseFloat(r);o&&(r/=100);var s;if(isFinite(r)){var a=i[n]();s=o||r>0&&r<1?a[t]+i[e]*r:a[t]+r}var c=Point();c[t]=s||0;return c}}function setWrapper(t,e){return function(n,r){var i=isPercentage(n);n=parseFloat(n);i&&(n/=100);var o={};if(isFinite(n)){var s=i||n>=0&&n<=1?n*r[e]:Math.max(n+r[e],0);o[t]=s}return o}}const An={"ref-x":{position:positionWrapper("x","width","origin")},"ref-y":{position:positionWrapper("y","height","origin")},"ref-dx":{position:positionWrapper("x","width","corner")},"ref-dy":{position:positionWrapper("y","height","corner")},"ref-width":{set:setWrapper("width","width")},"ref-height":{set:setWrapper("height","height")},"ref-rx":{set:setWrapper("rx","width")},"ref-ry":{set:setWrapper("ry","height")},"ref-cx":{set:setWrapper("cx","width")},"ref-cy":{set:setWrapper("cy","height")},"ref-r-inscribed":{set:function(t){var e=setWrapper(t,"width");var n=setWrapper(t,"height");return function(t,r){var i=r.height>r.width?e:n;return i(t,r)}}("r")},"ref-r-circumscribed":{set:function(t,e){var n=isPercentage(t);t=parseFloat(t);n&&(t/=100);var r=Math.sqrt(e.height*e.height+e.width*e.width);var i;isFinite(t)&&(i=n||t>=0&&t<=1?t*r:Math.max(t+r,0));return{r:i}}}};An.refX=An["ref-x"];An.refY=An["ref-y"];An["ref-x2"]=An["ref-x"];An["ref-y2"]=An["ref-y"];An["ref-width2"]=An["ref-width"];An["ref-height2"]=An["ref-height"];An["ref-r"]=An["ref-r-inscribed"];const Pn={x:"x",y:"y",width:"w",height:"h",minimum:"s",maximum:"l",diagonal:"d"};const Tn=Object.keys(Pn).map((t=>Pn[t])).join("");const En="[-+]?[0-9]*\\.?[0-9]+(?:[eE][-+]?[0-9]+)?";const Sn=/\s/g;const kn=new RegExp(`^(${En}\\*)?([${Tn}])(/${En})?([-+]{1,2}${En})?$`,"g");function throwInvalid(t){throw new Error(`Invalid calc() expression: ${t}`)}function evalCalcFormula(t,e){const n=kn.exec(t.replace(Sn,""));n||throwInvalid(t);kn.lastIndex=0;const[,r,i,o,s]=n;const{x:a,y:c,width:l,height:u}=e;let h=0;switch(i){case Pn.width:h=l;break;case Pn.height:h=u;break;case Pn.x:h=a;break;case Pn.y:h=c;break;case Pn.minimum:h=Math.min(u,l);break;case Pn.maximum:h=Math.max(u,l);break;case Pn.diagonal:h=Math.sqrt(u*u+l*l);break}r&&(h*=parseFloat(r));o&&(h/=parseFloat(o.slice(1)));s&&(h+=evalAddExpression(s));return h}function evalAddExpression(t){if(!t)return 0;const[e]=t;switch(e){case"+":return parseFloat(t.substr(1));case"-":return-parseFloat(t.substr(1))}return parseFloat(t)}function isCalcExpression(t){return typeof t==="string"&&t.includes("calc")}const Ln="calc(";const Cn=Ln.length;function evalCalcExpression(t,e){let n=t;let r=0;do{let t=n.indexOf(Ln,r);if(t===-1)return n;let i=t+Cn;let o=1;t:do{switch(n[i]){case"(":o++;break;case")":o--;if(o===0)break t;break;case void 0:throwInvalid(n)}i++}while(true);let s=n.slice(t+Cn,i);isCalcExpression(s)&&(s=evalCalcExpression(s,e));const a=String(evalCalcFormula(s,e));n=n.slice(0,t)+a+n.slice(i+1);r=t+a.length}while(true)}function isTextInUse(t,e,n){return n.text!==void 0}const _n=["font-weight","font-family","font-size","letter-spacing","text-transform"];const Mn={"line-height":{qualify:isTextInUse},"text-vertical-anchor":{qualify:isTextInUse},"text-path":{qualify:isTextInUse},annotations:{qualify:isTextInUse},eol:{qualify:isTextInUse},"display-empty":{qualify:isTextInUse},text:{qualify:function(t,e,n){const r=n["text-wrap"];return!r||!isPlainObject(r)},unset:function(t){t.textContent=""},set:function(t,e,n,r){const i="joint-text";const o=$.data.get(n,i);const s=r["line-height"];const a=r["text-vertical-anchor"];const c=r["display-empty"];const l=r["font-size"];const u=r.annotations;const h=r.eol;const d=r.x;let f=r["text-path"];const p=JSON.stringify([t,s,u,a,h,c,f,d,l]);if(o===void 0||o!==p){l&&n.setAttribute("font-size",l);if(isObject(f)){const t=f.selector;if(typeof t==="string"){const e=this.findNode(t);e instanceof SVGPathElement&&(f=Ne({"xlink:href":"#"+e.id},f))}}J(n).text(""+t,{lineHeight:s,annotations:u,textPath:f,x:d,textVerticalAnchor:a,eol:h,displayEmpty:c});$.data.set(n,i,p)}}},"text-wrap":{qualify:isPlainObject,set:function(t,e,n,r){var i={};var o=t.width||0;isPercentage(o)?i.width=e.width*parseFloat(o)/100:isCalcExpression(o)?i.width=Number(evalCalcExpression(o,e)):t.width===null?i.width=Infinity:i.width=o<=0?e.width+o:o;var s=t.height||0;isPercentage(s)?i.height=e.height*parseFloat(s)/100:isCalcExpression(s)?i.height=Number(evalCalcExpression(s,e)):t.height===null||(i.height=s<=0?e.height+s:s);var a;var c=t.text;c===void 0&&(c=r.text);if(c!==void 0){const e=t.breakText||breakText;const o=getComputedStyle(n);const s={};for(let t=0;t<_n.length;t++){const e=_n[t];e in r&&n.setAttribute(e,r[e]);s[e]=o[e]}s.lineHeight=r["line-height"];a=e(""+c,i,s,{svgDocument:this.paper.svg,ellipsis:t.ellipsis,hyphen:t.hyphen,separator:t.separator,maxLineCount:t.maxLineCount,preserveSpaces:t.preserveSpaces})}else a="";Mn.text.set.call(this,a,e,n,r)},FONT_ATTRIBUTES:_n},title:{qualify:function(t,e){return e instanceof SVGElement},unset:function(t){$.data.remove(t,"joint-title");const e=t.firstElementChild;e&&e.remove()},set:function(t,e,n){var r="joint-title";var i=$.data.get(n,r);if(i===void 0||i!==t){$.data.set(n,r,t);if(n.tagName==="title"){n.textContent=t;return}var o=n.firstElementChild;if(o&&o.tagName==="title")o.textContent=t;else{var s=document.createElementNS(n.namespaceURI,"title");s.textContent=t;n.insertBefore(s,o)}}}}};function atConnectionWrapper(t,e){var n=new Point(1,0);return function(r){var i,o;var s=this[t](r);if(s){o=e.rotate?s.vector().vectorAngle(n):0;i=s.start}else{i=this.path.start;o=0}return o===0?{transform:"translate("+i.x+","+i.y+")"}:{transform:"translate("+i.x+","+i.y+") rotate("+o+")"}}}function isLinkView(){return this.model.isLink()}const Nn={connection:{qualify:isLinkView,unset:"d",set:function({stubs:t=0}){let e;if(isFinite(t)&&t!==0){let n;n=t<0?(this.getConnectionLength()+t)/2:t;const r=this.getConnection();const i=this.getConnectionSubdivisions();const o=r.divideAtLength(n,{segmentSubdivisions:i});const s=r.divideAtLength(-n,{segmentSubdivisions:i});o&&s&&(e=`${o[0].serialize()} ${s[1].serialize()}`)}return{d:e||this.getSerializedConnection()}}},"at-connection-length-keep-gradient":{qualify:isLinkView,unset:"transform",set:atConnectionWrapper("getTangentAtLength",{rotate:true})},"at-connection-length-ignore-gradient":{qualify:isLinkView,unset:"transform",set:atConnectionWrapper("getTangentAtLength",{rotate:false})},"at-connection-ratio-keep-gradient":{qualify:isLinkView,unset:"transform",set:atConnectionWrapper("getTangentAtRatio",{rotate:true})},"at-connection-ratio-ignore-gradient":{qualify:isLinkView,unset:"transform",set:atConnectionWrapper("getTangentAtRatio",{rotate:false})}};Nn["at-connection-length"]=Nn["at-connection-length-keep-gradient"];Nn["at-connection-ratio"]=Nn["at-connection-ratio-keep-gradient"];function shapeWrapper(t,e){var n="joint-shape";var r=e&&e.resetOffset;return function(e,i,o){var s=$.data.get(o,n);if(!s||s.value!==e){var a=t(e);s={value:e,shape:a,shapeBBox:a.bbox()};$.data.set(o,n,s)}var c=s.shape.clone();var l=s.shapeBBox.clone();var u=l.origin();var h=i.origin();l.x=h.x;l.y=h.y;var d=i.maxRectScaleToFit(l,h);var f=l.width===0||i.width===0?1:d.sx;var p=l.height===0||i.height===0?1:d.sy;c.scale(f,p,u);r&&c.translate(-u.x,-u.y);return c}}function dWrapper(t){function pathConstructor(t){return new Path$1(J.normalizePathData(t))}var e=shapeWrapper(pathConstructor,t);return function(t,n,r){var i=e(t,n,r);return{d:i.serialize()}}}function pointsWrapper(t){var e=shapeWrapper(Polyline$1,t);return function(t,n,r){var i=e(t,n,r);return{points:i.serialize()}}}const On={"ref-d-reset-offset":{unset:"d",set:dWrapper({resetOffset:true})},"ref-d-keep-offset":{unset:"d",set:dWrapper({resetOffset:false})},"ref-points-reset-offset":{unset:"points",set:pointsWrapper({resetOffset:true})},"ref-points-keep-offset":{unset:"points",set:pointsWrapper({resetOffset:false})}};On["ref-d"]=On["ref-d-reset-offset"];On["ref-points"]=On["ref-points-reset-offset"];function contextMarker(t){var e={};var n=t.stroke;if(typeof n==="string"){e.stroke=n;e.fill=n}var r=t["stroke-opacity"];r===void 0&&(r=t.opacity);if(r!==void 0){e["stroke-opacity"]=r;e["fill-opacity"]=r}return e}function setPaintURL(t){const{paper:e}=this;const n=t.type==="pattern"?e.definePattern(t):e.defineGradient(t);return`url(#${n})`}const Rn={"source-marker":{qualify:isPlainObject,unset:"marker-start",set:function(t,e,n,r){t=Ne(contextMarker(r),t);return{"marker-start":"url(#"+this.paper.defineMarker(t)+")"}}},"target-marker":{qualify:isPlainObject,unset:"marker-end",set:function(t,e,n,r){t=Ne(contextMarker(r),{transform:"rotate(180)"},t);return{"marker-end":"url(#"+this.paper.defineMarker(t)+")"}}},"vertex-marker":{qualify:isPlainObject,unset:"marker-mid",set:function(t,e,n,r){t=Ne(contextMarker(r),t);return{"marker-mid":"url(#"+this.paper.defineMarker(t)+")"}}},fill:{qualify:isPlainObject,set:setPaintURL},stroke:{qualify:isPlainObject,set:setPaintURL},filter:{qualify:isPlainObject,set:function(t){return"url(#"+this.paper.defineFilter(t)+")"}}};function offsetWrapper(t,e,n){return function(r,i){var o;o=r==="middle"?i[e]/2:r===n?i[e]:isFinite(r)?r>-1&&r<1?-i[e]*r:-r:isPercentage(r)?i[e]*parseFloat(r)/100:0;var s=new Point;s[t]=-(i[t]+o);return s}}const Bn={"x-alignment":{offset:offsetWrapper("x","width","right")},"y-alignment":{offset:offsetWrapper("y","height","bottom")},"reset-offset":{offset:function(t,e){return t?{x:-e.x,y:-e.y}:{x:0,y:0}}}};function setIfChangedWrapper(t){return function setIfChanged(e,n,r){const i=J(r);i.attr(t)!==e&&i.attr(t,e)}}const In={ref:{},href:{set:setIfChangedWrapper("href")},"xlink:href":{set:setIfChangedWrapper("xlink:href")},port:{set:function(t){return t===null||t.id===void 0?t:t.id}},style:{qualify:isPlainObject,set:function(t,e,n){$(n).css(t)}},html:{unset:function(t){$(t).empty()},set:function(t,e,n){$(n).html(t+"")}},props:wn};Ne(In,An);Ne(In,Mn);Ne(In,Nn);Ne(In,On);Ne(In,Rn);Ne(In,Bn);const Fn=In;const attributesMerger=function(t,e){if(Array.isArray(t))return e};function removeEmptyAttributes(t){for(const e in t){const n=t[e];const r=isObject(n)&&!Array.isArray(n);r&&(isEmpty(n)&&delete t[e])}}const Dn=Model.extend({constructor:function(t,e){var n;var r=t||{};typeof this.preinitialize==="function"&&this.preinitialize.apply(this,arguments);this.cid=uniqueId("c");this.attributes={};e&&e.collection&&(this.collection=e.collection);e&&e.parse&&(r=this.parse(r,e)||{});if(n=result(this,"defaults")){const t=(!e||e.mergeArrays!==true)&&attributesMerger;r=Ve({},n,r,t)}this.set(r,e);this.changed={};this.initialize.apply(this,arguments)},translate:function(t,e,n){throw new Error("Must define a translate() method.")},toJSON:function(t){const{ignoreDefaults:e,ignoreEmptyAttributes:n=false}=t||{};const r=result(this.constructor.prototype,"defaults");if(e===false){const t=cloneDeep(this.attributes);if(!n)return t;removeEmptyAttributes(t);return t}let i={};let o=cloneDeep(this.attributes);if(e===true)i=r;else{const t=Array.isArray(e)?e:["attrs"];t.forEach((t=>{i[t]=r[t]||{}}))}const s=objectDifference(o,omit(i,"id","type"),{maxDepth:4});n&&removeEmptyAttributes(s);return s},initialize:function(t){const e=this.getIdAttribute();t&&t[e]!==void 0||this.set(e,this.generateId(),{silent:true});this._transitionIds={};this._scheduledTransitionIds={};this.processPorts();this.on("change:attrs",this.processPorts,this)},getIdAttribute:function(){return this.idAttribute||"id"},generateId:function(){return uuid()},
/**
     * @deprecated
     */
processPorts:function(){var t=this.ports;var e={};forIn(this.get("attrs"),(function(t,n){t&&t.port&&(t.port.id!==void 0?e[t.port.id]=t.port:e[t.port]={id:t.port})}));var n={};forIn(t,(function(t,r){e[r]||(n[r]=true)}));if(this.graph&&!isEmpty(n)){var r=this.graph.getConnectedLinks(this,{inbound:true});r.forEach((function(t){n[t.get("target").port]&&t.remove()}));var i=this.graph.getConnectedLinks(this,{outbound:true});i.forEach((function(t){n[t.get("source").port]&&t.remove()}))}this.ports=e},remove:function(t={}){const{graph:e,collection:n}=this;if(!e){n&&n.remove(this,t);return this}e.startBatch("remove");const r=this.getParentCell();r&&r.unembed(this,t);const i=this.getEmbeddedCells();for(let e=0,n=i.length;e<n;e++){const n=i[e];n&&n.remove(t)}this.trigger("remove",this,e.attributes.cells,t);e.stopBatch("remove");return this},toFront:function(t){var e=this.graph;if(e){t=Be(t||{},{foregroundEmbeds:true});let n;if(t.deep){n=this.getEmbeddedCells({deep:true,breadthFirst:t.breadthFirst!==false,sortSiblings:t.foregroundEmbeds});n.unshift(this)}else n=[this];const r=t.foregroundEmbeds?n:sortBy(n,(t=>t.z()));const i=e.maxZIndex();let o=i-n.length+1;const s=e.get("cells");let a=s.toArray().indexOf(r[0])!==s.length-n.length;a||(a=r.some((function(t,e){return t.z()!==o+e})));if(a){this.startBatch("to-front");o+=n.length;r.forEach((function(e,n){e.set("z",o+n,t)}));this.stopBatch("to-front")}}return this},toBack:function(t){var e=this.graph;if(e){t=Be(t||{},{foregroundEmbeds:true});let r;if(t.deep){r=this.getEmbeddedCells({deep:true,breadthFirst:t.breadthFirst!==false,sortSiblings:t.foregroundEmbeds});r.unshift(this)}else r=[this];const i=t.foregroundEmbeds?r:sortBy(r,(t=>t.z()));let o=e.minZIndex();var n=e.get("cells");let s=n.toArray().indexOf(i[0])!==0;s||(s=i.some((function(t,e){return t.z()!==o+e})));if(s){this.startBatch("to-back");o-=r.length;i.forEach((function(e,n){e.set("z",o+n,t)}));this.stopBatch("to-back")}}return this},parent:function(t,e){return t===void 0?this.get("parent"):this.set("parent",t,e)},embed:function(t,e={}){const n=Array.isArray(t)?t:[t];if(!this.canEmbed(n))throw new Error("Recursive embedding not allowed.");if(e.reparent){const t=uniq(n.map((t=>t.getParentCell())));t.forEach((t=>{t&&t._unembedCells(n,e)}))}else if(n.some((t=>t.isEmbedded()&&this.id!==t.parent())))throw new Error("Embedding of already embedded cells is not allowed.");this._embedCells(n,e);return this},unembed:function(t,e){const n=Array.isArray(t)?t:[t];this._unembedCells(n,e);return this},canEmbed:function(t){const e=Array.isArray(t)?t:[t];return e.every((t=>this!==t&&!this.isEmbeddedIn(t)))},_embedCells:function(t,e){const n="embed";this.startBatch(n);const r=Ne([],this.get("embeds"));t.forEach((t=>{r[t.isLink()?"unshift":"push"](t.id);t.parent(this.id,e)}));this.set("embeds",uniq(r),e);this.stopBatch(n)},_unembedCells:function(t,e){const n="unembed";this.startBatch(n);t.forEach((t=>t.unset("parent",e)));this.set("embeds",without(this.get("embeds"),...t.map((t=>t.id))),e);this.stopBatch(n)},getParentCell:function(){var t=this.parent();var e=this.graph;return t&&e&&e.getCell(t)||null},getAncestors:function(){var t=[];if(!this.graph)return t;var e=this.getParentCell();while(e){t.push(e);e=e.getParentCell()}return t},getEmbeddedCells:function(t){t=t||{};if(!this.graph)return[];if(t.deep)return t.breadthFirst?this._getEmbeddedCellsBfs(t.sortSiblings):this._getEmbeddedCellsDfs(t.sortSiblings);const e=this.get("embeds");if(isEmpty(e))return[];let n=e.map(this.graph.getCell,this.graph);t.sortSiblings&&(n=sortBy(n,(t=>t.z())));return n},_getEmbeddedCellsBfs:function(t){const e=[];const n=[];n.push(this);while(n.length>0){const r=n.shift();e.push(r);const i=r.getEmbeddedCells({sortSiblings:t});n.push(...i)}e.shift();return e},_getEmbeddedCellsDfs:function(t){const e=[];const n=[];n.push(this);while(n.length>0){const r=n.pop();e.push(r);const i=r.getEmbeddedCells({sortSiblings:t});for(let t=i.length-1;t>=0;--t)n.push(i[t])}e.shift();return e},isEmbeddedIn:function(t,e){var n=isString(t)?t:t.id;var r=this.parent();e=Ne({deep:true},e);if(this.graph&&e.deep){while(r){if(r===n)return true;r=this.graph.getCell(r).parent()}return false}return r===n},isEmbedded:function(){return!!this.parent()},clone:function(t){t=t||{};if(t.deep)return toArray$1(cloneCells([this].concat(this.getEmbeddedCells({deep:true}))));var e=Model.prototype.clone.apply(this,arguments);e.set(this.getIdAttribute(),this.generateId());e.unset("embeds");e.unset("parent");return e},prop:function(t,e,n){var r="/";var i=isString(t);if(i||Array.isArray(t)){if(arguments.length>1){var o;var s;if(i){o=t;s=o.split("/")}else{o=t.join(r);s=t.slice()}var a=s[0];var c=s.length;const m=n||{};m.propertyPath=o;m.propertyValue=e;m.propertyPathArray=s;"rewrite"in m||(m.rewrite=false);var l={};var u=l;var h=a;for(var d=1;d<c;d++){var f=s[d];var p=Number.isFinite(i?Number(f):f);u=u[h]=p?[]:{};h=f}l=setByPath(l,s,e,"/");var g=Ve({},this.attributes);m.rewrite&&unsetByPath(g,o,"/");var v=Ve(g,l);return this.set(a,v[a],m)}return getByPath(this.attributes,t,r)}const m=e||{};m.propertyPath=null;m.propertyValue=t;m.propertyPathArray=[];"rewrite"in m||(m.rewrite=false);const y={};for(const e in t){const{changedValue:n}=Ve({},{changedValue:this.attributes[e]},{changedValue:t[e]});y[e]=n}return this.set(y,m)},removeProp:function(t,e){e=e||{};var n=Array.isArray(t)?t:t.split("/");var r=n[0];r==="attrs"&&(e.dirty=true);if(n.length===1)return this.unset(t,e);var i=n.slice(1);var o=this.get(r);if(o===void 0||o===null)return this;o=cloneDeep(o);unsetByPath(o,i,"/");return this.set(r,o,e)},attr:function(t,e,n){var r=Array.from(arguments);if(r.length===0)return this.get("attrs");Array.isArray(t)?r[0]=["attrs"].concat(t):isString(t)?r[0]="attrs/"+t:r[0]={attrs:t};return this.prop.apply(this,r)},removeAttr:function(t,e){return Array.isArray(t)?this.removeProp(["attrs"].concat(t)):this.removeProp("attrs/"+t,e)},transition:function(t,e,n,r){r=r||"/";var i={duration:100,delay:10,timingFunction:hn.linear,valueFunction:dn.number};n=Ne(i,n);var o=0;var s;var a=function(e){var r,i,c;o=o||e;e-=o;i=e/n.duration;if(i<1)this._transitionIds[t]=r=cn(a);else{i=1;delete this._transitionIds[t]}c=s(n.timingFunction(i));n.transitionId=r;this.prop(t,c,n);r||this.trigger("transition:end",this,t)}.bind(this);const{_scheduledTransitionIds:c}=this;let l;var initiator=i=>{if(c[t]){c[t]=without(c[t],l);c[t].length===0&&delete c[t]}this.stopPendingTransitions(t,r);s=n.valueFunction(getByPath(this.attributes,t,r),e);this._transitionIds[t]=cn(i);this.trigger("transition:start",this,t)};l=setTimeout(initiator,n.delay,a);c[t]||(c[t]=[]);c[t].push(l);return l},getTransitions:function(){return union(Object.keys(this._transitionIds),Object.keys(this._scheduledTransitionIds))},stopScheduledTransitions:function(t,e="/"){const{_scheduledTransitionIds:n={}}=this;let r=Object.keys(n);if(t){const n=t.split(e);r=r.filter((t=>isEqual(n,t.split(e).slice(0,n.length))))}r.forEach((t=>{const e=n[t];e.forEach((t=>clearTimeout(t)));delete n[t]}));return this},stopPendingTransitions(t,e="/"){const{_transitionIds:n={}}=this;let r=Object.keys(n);if(t){const n=t.split(e);r=r.filter((t=>isEqual(n,t.split(e).slice(0,n.length))))}r.forEach((t=>{const e=n[t];ln(e);delete n[t];this.trigger("transition:end",this,t)}))},stopTransitions:function(t,e="/"){this.stopScheduledTransitions(t,e);this.stopPendingTransitions(t,e);return this},addTo:function(t,e){t.addCell(this,e);return this},findView:function(t){return t.findViewByModel(this)},isElement:function(){return false},isLink:function(){return false},startBatch:function(t,e){this.graph&&this.graph.startBatch(t,Ne({},e,{cell:this}));return this},stopBatch:function(t,e){this.graph&&this.graph.stopBatch(t,Ne({},e,{cell:this}));return this},getChangeFlag:function(t){var e=0;if(!t)return e;for(var n in t)t.hasOwnProperty(n)&&this.hasChanged(n)&&(e|=t[n]);return e},angle:function(){return 0},position:function(){return new Point(0,0)},z:function(){return this.get("z")||0},getPointFromConnectedLink:function(){return new Point},getBBox:function(){return new Rect(0,0,0,0)},getPointRotatedAroundCenter(t,e,n){const r=new Point(e,n);t&&r.rotate(this.getBBox().center(),t);return r},getAbsolutePointFromRelative(t,e){return this.getPointRotatedAroundCenter(-this.angle(),this.position().offset(t,e))},getRelativePointFromAbsolute(t,e){return this.getPointRotatedAroundCenter(this.angle(),t,e).difference(this.position())}},{getAttributeDefinition:function(t){var e=this.attributes;var n=Fn;return e&&e[t]||n[t]},define:function(t,e,n,r){n=Ne({defaults:Fe({type:t},e,this.prototype.defaults)},n);var i=this.extend(n,r);typeof joint!=="undefined"&&has(joint,"shapes")&&setByPath(joint.shapes,t,i,".");return i}});const wrapWith=function(t,e,n){if(isString(n)){if(!Vn[n])throw new Error('Unknown wrapper: "'+n+'"');n=Vn[n]}if(!isFunction(n))throw new Error("Wrapper must be a function.");toArray$1(e).forEach((function(e){t[e]=n(t[e])}))};const Vn={cells:function(t){return function(){var e=Array.from(arguments);var n=e.length;var r=n>0&&e[0]||[];var i=n>1&&e[n-1]||{};if(!Array.isArray(r))if(i instanceof Dn)r=e;else if(r instanceof Dn){e.length>1&&e.pop();r=e}i instanceof Dn&&(i={});return t.call(this,r,i)}}};function svg(t,...e){const n=[];t.forEach(((t,r)=>{n.push(t);r in e&&n.push(e[r])}));const r=parseFromSVGString(n.join(""));return r}function parseFromSVGString(t){const e=new DOMParser;const n=`<svg>${t.trim()}</svg>`;const r=e.parseFromString(n.replace(/@/g,""),"application/xml");if(r.getElementsByTagName("parsererror")[0])throw new Error("Invalid SVG markup");const i=e.parseFromString(n,"text/html");const o=i.querySelector("svg");return build(o)}function buildNode(t){const e={};const{tagName:n,attributes:r,namespaceURI:i,style:o,childNodes:s}=t;e.namespaceURI=i;e.tagName=i===J.namespace.xhtml?n.toLowerCase():n;const a={};for(var c=o.length;c--;){var l=o[c];a[l]=o.getPropertyValue(l)}e.style=a;const u=r.getNamedItem("@selector");if(u){e.selector=u.value;r.removeNamedItem("@selector")}const h=r.getNamedItem("@group-selector");if(h){const t=h.value.split(",");e.groupSelector=t.map((t=>t.trim()));r.removeNamedItem("@group-selector")}const d=r.getNamedItem("class");d&&(e.className=d.value);const f=[];s.forEach((t=>{switch(t.nodeType){case Node.TEXT_NODE:{const e=t.data.replace(/\s\s+/g," ");e.trim()&&f.push(e);break}case Node.ELEMENT_NODE:f.push(buildNode(t));break;default:break}}));f.length&&(e.children=f);const p={};Array.from(r).forEach((t=>{const{name:e,value:n}=t;p[e]=n}));Object.keys(p).length>0&&(e.attributes=p);return e}function build(t){const e=[];Array.from(t.children).forEach((t=>{e.push(buildNode(t))}));return e}const zn={TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left",TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",CENTER:"center"};function getRectPoint(t,e){const n=new Rect(t);switch(e){case void 0:throw new Error("Position required");case zn.LEFT:case"leftMiddle":return n.leftMiddle();case zn.RIGHT:case"rightMiddle":return n.rightMiddle();case zn.TOP:case"topMiddle":return n.topMiddle();case zn.BOTTOM:case"bottomMiddle":return n.bottomMiddle();case zn.TOP_LEFT:case"topLeft":case"origin":return n.topLeft();case zn.TOP_RIGHT:case"topRight":return n.topRight();case zn.BOTTOM_LEFT:case"bottomLeft":return n.bottomLeft();case zn.BOTTOM_RIGHT:case"bottomRight":case"corner":return n.bottomRight();case zn.CENTER:return n.center();default:throw new Error(`Unknown position: ${e}`)}}var jn=Object.freeze(Object.defineProperty({__proto__:null,addClassNamePrefix:addClassNamePrefix,assign:Ne,bindAll:bindAll,breakText:breakText,camelCase:camelCase,cancelFrame:ln,cap:cap,clone:clone$1,cloneCells:cloneCells,cloneDeep:cloneDeep,dataUriToBlob:dataUriToBlob,debounce:debounce,deepMixin:Re,deepSupplement:Ie,defaults:Be,defaultsDeep:Fe,difference:difference,downloadBlob:downloadBlob,downloadDataUri:downloadDataUri,evalCalcExpression:evalCalcExpression,evalCalcFormula:evalCalcFormula,filter:pn,flattenDeep:flattenDeep,flattenObject:flattenObject,forIn:forIn,format:gn,getByPath:getByPath,getElementBBox:getElementBBox,getRectPoint:getRectPoint,groupBy:groupBy,guid:guid,has:has,hashCode:hashCode,imageToDataUri:imageToDataUri,interpolate:dn,intersection:intersection,invoke:invoke,invokeProperty:invokeProperty,isBoolean:isBoolean,isCalcExpression:isCalcExpression,isEmpty:isEmpty,isEqual:isEqual,isFunction:isFunction,isNumber:isNumber,isObject:isObject,isPercentage:isPercentage,isPlainObject:isPlainObject,isString:isString,merge:Ve,mixin:Oe,nextFrame:cn,noop:noop,normalizeEvent:normalizeEvent,normalizeSides:normalizeSides,normalizeWheel:normalizeWheel,objectDifference:objectDifference,omit:omit,parseCssNumeric:parseCssNumeric,parseDOMJSON:parseDOMJSON,pick:pick,removeClassNamePrefix:removeClassNamePrefix,result:result,sanitizeHTML:sanitizeHTML,setAttributesBySelector:setAttributesBySelector,setByPath:setByPath,sortBy:sortBy,sortElements:sortElements,sortedIndex:sortedIndex,supplement:supplement,svg:svg,template:template,timing:hn,toArray:toArray$1,toKebabCase:toKebabCase,toggleFullScreen:toggleFullScreen,union:union,uniq:uniq,uniqueId:uniqueId,unsetByPath:unsetByPath,uuid:uuid,without:without,wrapWith:wrapWith,wrappers:Vn},Symbol.toStringTag,{value:"Module"}));function portTransformAttrs(t,e,n){var r=t.toJSON();r.angle=e||0;return Be({},n,r)}function lineLayout(t,e,n,r){return t.map((function(t,e,n){var i=this.pointAt((e+.5)/n.length);(t.dx||t.dy)&&i.offset(t.dx||0,t.dy||0);return portTransformAttrs(i.round(),0,argTransform(r,t))}),w(e,n))}function ellipseLayout(t,e,n,r){var i=e.center();var o=e.width/e.height;var s=e.topMiddle();var a=Ellipse$1.fromRect(e);return t.map((function(t,c,l){var u=n+r(c,l.length);var h=s.clone().rotate(i,-u).scale(o,1,i);var d=t.compensateRotation?-a.tangentTheta(h):0;(t.dx||t.dy)&&h.offset(t.dx||0,t.dy||0);t.dr&&h.move(i,t.dr);return portTransformAttrs(h.round(),d,argTransform(e,t))}))}function argTransform(t,e){let{x:n,y:r,angle:i}=e;isPercentage(n)?n=parseFloat(n)/100*t.width:isCalcExpression(n)&&(n=Number(evalCalcExpression(n,t)));isPercentage(r)?r=parseFloat(r)/100*t.height:isCalcExpression(r)&&(r=Number(evalCalcExpression(r,t)));return{x:n,y:r,angle:i}}function argPoint(t,e){const{x:n,y:r}=argTransform(t,e);return new Point(n||0,r||0)}
/**
 * @param {Array<Object>} ports
 * @param {g.Rect} elBBox
 * @param {Object=} opt opt Group options
 * @returns {Array<g.Point>}
 */const absolute=function(t,e){return t.map((t=>{const n=argPoint(e,t).round().toJSON();n.angle=t.angle||0;return n}))};
/**
 * @param {Array<Object>} ports
 * @param {g.Rect} elBBox
 * @param {Object=} opt opt Group options
 * @returns {Array<g.Point>}
 */const fn=function(t,e,n){return n.fn(t,e,n)};
/**
 * @param {Array<Object>} ports
 * @param {g.Rect} elBBox
 * @param {Object=} opt opt Group options
 * @returns {Array<g.Point>}
 */const line=function(t,e,n){var r=argPoint(e,n.start||e.origin());var i=argPoint(e,n.end||e.corner());return lineLayout(t,r,i,e)};
/**
 * @param {Array<Object>} ports
 * @param {g.Rect} elBBox
 * @param {Object=} opt opt Group options
 * @returns {Array<g.Point>}
 */const left$2=function(t,e,n){return lineLayout(t,e.origin(),e.bottomLeft(),e)};
/**
 * @param {Array<Object>} ports
 * @param {g.Rect} elBBox
 * @param {Object=} opt opt Group options
 * @returns {Array<g.Point>}
 */const right$2=function(t,e,n){return lineLayout(t,e.topRight(),e.corner(),e)};
/**
 * @param {Array<Object>} ports
 * @param {g.Rect} elBBox
 * @param {Object=} opt opt Group options
 * @returns {Array<g.Point>}
 */const top$2=function(t,e,n){return lineLayout(t,e.origin(),e.topRight(),e)};
/**
 * @param {Array<Object>} ports
 * @param {g.Rect} elBBox
 * @param {Object=} opt opt Group options
 * @returns {Array<g.Point>}
 */const bottom$2=function(t,e,n){return lineLayout(t,e.bottomLeft(),e.corner(),e)};
/**
 * @param {Array<Object>} ports
 * @param {g.Rect} elBBox
 * @param {Object=} opt Group options
 * @returns {Array<g.Point>}
 */const ellipseSpread=function(t,e,n){var r=n.startAngle||0;var i=n.step||360/t.length;return ellipseLayout(t,e,r,(function(t){return t*i}))};
/**
 * @param {Array<Object>} ports
 * @param {g.Rect} elBBox
 * @param {Object=} opt Group options
 * @returns {Array<g.Point>}
 */const ellipse=function(t,e,n){var r=n.startAngle||0;var i=n.step||20;return ellipseLayout(t,e,r,(function(t,e){return(t+.5-e/2)*i}))};var Gn=Object.freeze(Object.defineProperty({__proto__:null,absolute:absolute,bottom:bottom$2,ellipse:ellipse,ellipseSpread:ellipseSpread,fn:fn,left:left$2,line:line,right:right$2,top:top$2},Symbol.toStringTag,{value:"Module"}));function labelAttributes(t,e){return Fe({},t,e,{x:0,y:0,angle:0,attrs:{}})}function getBBoxAngles(t){var e=t.center();var n=e.theta(t.origin());var r=e.theta(t.bottomLeft());var i=e.theta(t.corner());var o=e.theta(t.topRight());return[n,o,i,r]}function outsideLayout(t,e,n,r){r=Be({},r,{offset:15});var i=e.center().theta(t);var o,s,a,c;var l=r.offset;var u=0;const[h,d,f,p]=getBBoxAngles(e);if(i<d||i>f){a=".3em";o=l;s=0;c="start"}else if(i<h){o=0;s=-l;if(n){u=-90;c="start";a=".3em"}else{c="middle";a="0"}}else if(i<p){a=".3em";o=-l;s=0;c="end"}else{o=0;s=l;if(n){u=90;c="start";a=".3em"}else{c="middle";a=".6em"}}var g=Math.round;return labelAttributes(r,{x:g(o),y:g(s),angle:u,attrs:{labelText:{y:a,textAnchor:c}}})}function insideLayout(t,e,n,r){r=Be({},r,{offset:15});var i=e.center().theta(t);var o,s,a,c;var l=r.offset;var u=0;const[h,d,f,p]=getBBoxAngles(e);if(i<d||i>f){a=".3em";o=-l;s=0;c="end"}else if(i<h){o=0;s=l;if(n){u=90;c="start";a=".3em"}else{c="middle";a=".6em"}}else if(i<p){a=".3em";o=l;s=0;c="start"}else{o=0;s=-l;if(n){u=-90;c="start";a=".3em"}else{c="middle";a="0"}}var g=Math.round;return labelAttributes(r,{x:g(o),y:g(s),angle:u,attrs:{labelText:{y:a,textAnchor:c}}})}function radialLayout(t,e,n){n=Be({},n,{offset:20});var r=y(0,0);var i=-t.theta(r);var o=i;var s=t.clone().move(r,n.offset).difference(t).round();var a=".3em";var c;if((i+90)%180===0){c=e?"end":"middle";e||i!==-270||(a="0em")}else if(i>-270&&i<-90){c="start";o=i-180}else c="end";var l=Math.round;return labelAttributes(n,{x:l(s.x),y:l(s.y),angle:e?o:0,attrs:{labelText:{y:a,textAnchor:c}}})}const manual=function(t,e,n){return labelAttributes(n)};const left$1=function(t,e,n){return labelAttributes(n,{x:-15,attrs:{labelText:{y:".3em",textAnchor:"end"}}})};const right$1=function(t,e,n){return labelAttributes(n,{x:15,attrs:{labelText:{y:".3em",textAnchor:"start"}}})};const top$1=function(t,e,n){return labelAttributes(n,{y:-15,attrs:{labelText:{y:"0",textAnchor:"middle"}}})};const bottom$1=function(t,e,n){return labelAttributes(n,{y:15,attrs:{labelText:{y:".6em",textAnchor:"middle"}}})};const outsideOriented=function(t,e,n){return outsideLayout(t,e,true,n)};const outside=function(t,e,n){return outsideLayout(t,e,false,n)};const insideOriented=function(t,e,n){return insideLayout(t,e,true,n)};const inside=function(t,e,n){return insideLayout(t,e,false,n)};const radial=function(t,e,n){return radialLayout(t.difference(e.center()),false,n)};const radialOriented=function(t,e,n){return radialLayout(t.difference(e.center()),true,n)};var Un=Object.freeze(Object.defineProperty({__proto__:null,bottom:bottom$1,inside:inside,insideOriented:insideOriented,left:left$1,manual:manual,outside:outside,outsideOriented:outsideOriented,radial:radial,radialOriented:radialOriented,right:right$1,top:top$1},Symbol.toStringTag,{value:"Module"}));var PortData=function(t){var e=cloneDeep(t)||{};this.ports=[];this.groups={};this.portLayoutNamespace=Gn;this.portLabelLayoutNamespace=Un;this._init(e)};PortData.prototype={getPorts:function(){return this.ports},getGroup:function(t){return this.groups[t]||{}},getPortsByGroup:function(t){return this.ports.filter((function(e){return e.group===t}))},getGroupPortsMetrics:function(t,e){var n=this.getGroup(t);var r=this.getPortsByGroup(t);var i=n.position||{};var o=i.name;var s=this.portLayoutNamespace;s[o]||(o="left");var a=i.args||{};var c=r.map((function(t){return t&&t.position&&t.position.args}));var l=s[o](c,e,a);var u={ports:r,result:[]};toArray$1(l).reduce(function(t,n,r){var i=t.ports[r];t.result.push({portId:i.id,portTransformation:n,labelTransformation:this._getPortLabelLayout(i,Point(n),e),portAttrs:i.attrs,portSize:i.size,labelSize:i.label.size});return t}.bind(this),u);return u.result},_getPortLabelLayout:function(t,e,n){var r=this.portLabelLayoutNamespace;var i=t.label.position.name||"left";return r[i]?r[i](e,n,t.label.position.args):null},_init:function(t){if(isObject(t.groups)){var e=Object.keys(t.groups);for(var n=0,r=e.length;n<r;n++){var i=e[n];this.groups[i]=this._evaluateGroup(t.groups[i])}}var o=toArray$1(t.items);for(var s=0,a=o.length;s<a;s++)this.ports.push(this._evaluatePort(o[s]))},_evaluateGroup:function(t){return Ve(t,{position:this._getPosition(t.position,true),label:this._getLabel(t,true)})},_evaluatePort:function(t){var e=Ne({},t);var n=this.getGroup(t.group);e.markup=e.markup||n.markup;e.attrs=Ve({},n.attrs,e.attrs);e.position=this._createPositionNode(n,e);e.label=Ve({},n.label,this._getLabel(e));e.z=this._getZIndex(n,e);e.size=Ne({},n.size,e.size);return e},_getZIndex:function(t,e){return isNumber(e.z)?e.z:isNumber(t.z)||t.z==="auto"?t.z:"auto"},_createPositionNode:function(t,e){return Ve({name:"left",args:{}},t.position,{args:e.args})},_getPosition:function(t,e){var n={};var r;if(isFunction(t)){r="fn";n.fn=t}else if(isString(t))r=t;else if(t===void 0)r=e?"left":null;else if(Array.isArray(t)){r="absolute";n.x=t[0];n.y=t[1]}else if(isObject(t)){r=t.name;Ne(n,t.args)}var i={args:n};r&&(i.name=r);return i},_getLabel:function(t,e){var n=t.label||{};var r=n;r.position=this._getPosition(n.position,e);return r}};const Wn={_initializePorts:function(){this._createPortData();this.on("change:ports",(function(){this._processRemovedPort();this._createPortData()}),this)},_processRemovedPort:function(){var t=this.get("ports")||{};var e={};toArray$1(t.items).forEach((function(t){e[t.id]=true}));var n=this.previous("ports")||{};var r={};toArray$1(n.items).forEach((function(t){e[t.id]||(r[t.id]=true)}));var i=this.graph;if(i&&!isEmpty(r)){var o=i.getConnectedLinks(this,{inbound:true});o.forEach((function(t){r[t.get("target").port]&&t.remove()}));var s=i.getConnectedLinks(this,{outbound:true});s.forEach((function(t){r[t.get("source").port]&&t.remove()}))}},
/**
     * @returns {boolean}
     */
hasPorts:function(){var t=this.prop("ports/items");return Array.isArray(t)&&t.length>0},
/**
     * @param {string} id
     * @returns {boolean}
     */
hasPort:function(t){return this.getPortIndex(t)!==-1},
/**
     * @returns {Array<object>}
     */
getPorts:function(){return cloneDeep(this.prop("ports/items"))||[]},
/**
     * @returns {Array<object>}
     */
getGroupPorts:function(t){const e=toArray$1(this.prop(["ports","items"])).filter((e=>e.group===t));return cloneDeep(e)},
/**
     * @param {string} id
     * @returns {object}
     */
getPort:function(t){return cloneDeep(toArray$1(this.prop("ports/items")).find((function(e){return e.id&&e.id===t})))},getPortGroupNames:function(){return Object.keys(this._portSettingsData.groups)},
/**
     * @param {string} groupName
     * @returns {Object<portId, {x: number, y: number, angle: number}>}
     */
getPortsPositions:function(t){var e=this._portSettingsData.getGroupPortsMetrics(t,Rect(this.size()));return e.reduce((function(t,e){var n=e.portTransformation;t[e.portId]={x:n.x,y:n.y,angle:n.angle};return t}),{})},
/**
     * @param {string|Port} port port id or port
     * @returns {number} port index
     */
getPortIndex:function(t){var e=isObject(t)?t.id:t;return this._isValidPortId(e)?toArray$1(this.prop("ports/items")).findIndex((function(t){return t.id===e})):-1},
/**
     * @param {object} port
     * @param {object} [opt]
     * @returns {joint.dia.Element}
     */
addPort:function(t,e){if(!isObject(t)||Array.isArray(t))throw new Error("Element: addPort requires an object.");var n=Ne([],this.prop("ports/items"));n.push(t);this.prop("ports/items",n,e);return this},
/**
     * @param {string|Port|number} before
     * @param {object} port
     * @param {object} [opt]
     * @returns {joint.dia.Element}
     */
insertPort:function(t,e,n){const r=typeof t==="number"?t:this.getPortIndex(t);if(!isObject(e)||Array.isArray(e))throw new Error("dia.Element: insertPort requires an object.");const i=Ne([],this.prop("ports/items"));i.splice(r,0,e);this.prop("ports/items",i,n);return this},
/**
     * @param {string} portId
     * @param {string|object=} path
     * @param {*=} value
     * @param {object=} opt
     * @returns {joint.dia.Element}
     */
portProp:function(t,e,n,r){var i=this.getPortIndex(t);if(i===-1)throw new Error("Element: unable to find port with id "+t);var o=Array.prototype.slice.call(arguments,1);if(Array.isArray(e))o[0]=["ports","items",i].concat(e);else if(isString(e))o[0]=["ports/items/",i,"/",e].join("");else{o=["ports/items/"+i];if(isPlainObject(e)){o.push(e);o.push(n)}}return this.prop.apply(this,o)},_validatePorts:function(){var t=this.get("ports")||{};var e=[];t=t||{};var n=toArray$1(t.items);n.forEach((function(t){typeof t!=="object"&&e.push("Element: invalid port ",t);this._isValidPortId(t.id)||(t.id=this.generatePortId())}),this);uniq(n,"id").length!==n.length&&e.push("Element: found id duplicities in ports.");return e},generatePortId:function(){return this.generateId()},
/**
     * @param {string} id port id
     * @returns {boolean}
     * @private
     */
_isValidPortId:function(t){return t!==null&&t!==void 0&&!isObject(t)},addPorts:function(t,e){t.length&&this.prop("ports/items",Ne([],this.prop("ports/items")).concat(t),e);return this},removePort:function(t,e){const n=e||{};const r=this.getPortIndex(t);if(r!==-1){const t=Ne([],this.prop(["ports","items"]));t.splice(r,1);n.rewrite=true;this.startBatch("port-remove");this.prop(["ports","items"],t,n);this.stopBatch("port-remove")}return this},removePorts:function(t,e){let n,r;if(Array.isArray(t)){n=e||{};if(t.length===0)return this.this;const i=Ne([],this.prop(["ports","items"]));r=i.filter((function(e){return!t.some((function(t){const n=isObject(t)?t.id:t;return e.id===n}))}))}else{n=t||{};r=[]}this.startBatch("port-remove");n.rewrite=true;this.prop(["ports","items"],r,n);this.stopBatch("port-remove");return this},_createPortData:function(){var t=this._validatePorts();if(t.length>0){this.set("ports",this.previous("ports"));throw new Error(t.join(" "))}var e;this._portSettingsData&&(e=this._portSettingsData.getPorts());this._portSettingsData=new PortData(this.get("ports"));var n=this._portSettingsData.getPorts();if(e){var r=n.filter((function(t){if(!e.find((function(e){return e.id===t.id})))return t}));var i=e.filter((function(t){if(!n.find((function(e){return e.id===t.id})))return t}));i.length>0&&this.trigger("ports:remove",this,i);r.length>0&&this.trigger("ports:add",this,r)}}};const Hn={portContainerMarkup:"g",portMarkup:[{tagName:"circle",selector:"circle",attributes:{r:10,fill:"#FFFFFF",stroke:"#000000"}}],portLabelMarkup:[{tagName:"text",selector:"text",attributes:{fill:"#000000"}}],
/** @type {Object<string, {portElement: Vectorizer, portLabelElement: Vectorizer}>} */
_portElementsCache:null,_initializePorts:function(){this._cleanPortsCache()},
/**
     * @typedef {Object} Port
     *
     * @property {string} id
     * @property {Object} position
     * @property {Object} label
     * @property {Object} attrs
     * @property {string} markup
     * @property {string} group
     */
_refreshPorts:function(){this._removePorts();this._cleanPortsCache();this._renderPorts()},_cleanPortsCache:function(){this._portElementsCache={}},_renderPorts:function(){var t=[];var e=this._getContainerElement();for(var n=0,r=e.node.childNodes.length;n<r;n++)t.push(e.node.childNodes[n]);var i=groupBy(this.model._portSettingsData.getPorts(),"z");var o="auto";toArray$1(i[o]).forEach((function(n){var r=this._getPortElement(n);e.append(r);t.push(r)}),this);var s=Object.keys(i);for(var a=0;a<s.length;a++){var c=s[a];if(c!==o){var l=parseInt(c,10);this._appendPorts(i[c],l,t)}}this._updatePorts()},
/**
     * @returns {V}
     * @private
     */
_getContainerElement:function(){return this.rotatableNode||this.vel},
/**
     * @param {Array<Port>}ports
     * @param {number} z
     * @param refs
     * @private
     */
_appendPorts:function(t,e,n){var r=this._getContainerElement();var i=toArray$1(t).map(this._getPortElement,this);n[e]||e<0?J(n[Math.max(e,0)]).before(i):r.append(i)},
/**
     * Try to get element from cache,
     * @param port
     * @returns {*}
     * @private
     */
_getPortElement:function(t){return this._portElementsCache[t.id]?this._portElementsCache[t.id].portElement:this._createPortElement(t)},findPortNodes:function(t,e){const n=this._portElementsCache[t];if(!n)return[];if(!e)return[n.portContentElement.node];const r=n.portElement.node;const i=n.portSelectors;return this.findBySelector(e,r,i)},findPortNode:function(t,e){const[n=null]=this.findPortNodes(t,e);return n},_updatePorts:function(){this._updatePortGroup(void 0);var t=Object.keys(this.model._portSettingsData.groups);t.forEach(this._updatePortGroup,this)},_removePorts:function(){invoke(this._portElementsCache,"portElement.remove")},
/**
     * @param {Port} port
     * @returns {V}
     * @private
     */
_createPortElement:function(t){let e;let n;let r;let i;var o=J(this.portContainerMarkup).addClass("joint-port");var s=this._getPortMarkup(t);if(Array.isArray(s)){var a=this.parseDOMJSON(s,o.node);var c=a.fragment;e=c.childNodes.length>1?J("g").append(c):J(c.firstChild);i=a.selectors}else{e=J(s);Array.isArray(e)&&(e=J("g").append(e))}if(!e)throw new Error("ElementView: Invalid port markup.");e.attr({port:t.id,"port-group":t.group});isNumber(t.id)&&e.attr("port-id-type","number");const l=this._getPortLabelMarkup(t.label);if(Array.isArray(l)){const{fragment:t,selectors:e}=this.parseDOMJSON(l,o.node);const i=t.childNodes.length;if(i>0){r=e;n=i===1?J(t.firstChild):J("g").append(t)}}else{n=J(l);Array.isArray(n)&&(n=J("g").append(n))}var u;if(i&&r){for(var h in r)if(i[h]&&h!==this.selector)throw new Error("ElementView: selectors within port must be unique.");u=Ne({},i,r)}else u=i||r||{};const d="portRoot";const f="labelRoot";const p="labelText";d in u||(u[d]=e.node);if(n){const t=n.node;f in u||(u[f]=t);if(!(p in u)){const e=n.tagName()==="TEXT"?t:Array.from(t.querySelectorAll("text"));u[p]=e;r||(r={});r[p]=e}}o.append(e.addClass("joint-port-body"));n&&o.append(n.addClass("joint-port-label"));this._portElementsCache[t.id]={portElement:o,portLabelElement:n,portSelectors:u,portLabelSelectors:r,portContentElement:e,portContentSelectors:i};return o},
/**
     * @param {string=} groupName
     * @private
     */
_updatePortGroup:function(t){var e=Rect(this.model.size());var n=this.model._portSettingsData.getGroupPortsMetrics(t,e);for(var r=0,i=n.length;r<i;r++){var o=n[r];var s=o.portId;var a=this._portElementsCache[s]||{};var c=o.portTransformation;var l=o.labelTransformation;if(l&&a.portLabelElement){this.updateDOMSubtreeAttributes(a.portLabelElement.node,l.attrs,{rootBBox:new Rect(o.labelSize),selectors:a.portLabelSelectors});this.applyPortTransform(a.portLabelElement,l,-c.angle||0)}this.updateDOMSubtreeAttributes(a.portElement.node,o.portAttrs,{rootBBox:new Rect(o.portSize),selectors:a.portSelectors});this.applyPortTransform(a.portElement,c)}},
/**
     * @param {Vectorizer} element
     * @param {{dx:number, dy:number, angle: number, attrs: Object, x:number: y:number}} transformData
     * @param {number=} initialAngle
     * @constructor
     */
applyPortTransform:function(t,e,n){var r=J.createSVGMatrix().rotate(n||0).translate(e.x||0,e.y||0).rotate(e.angle||0);t.transform(r,{absolute:true})},
/**
     * @param {Port} port
     * @returns {string}
     * @private
     */
_getPortMarkup:function(t){return t.markup||this.model.get("portMarkup")||this.model.portMarkup||this.portMarkup},
/**
     * @param {Object} label
     * @returns {string}
     * @private
     */
_getPortLabelMarkup:function(t){return t.markup||this.model.get("portLabelMarkup")||this.model.portLabelMarkup||this.portLabelMarkup}};const $n=Dn.extend({defaults:{position:{x:0,y:0},size:{width:1,height:1},angle:0},initialize:function(){this._initializePorts();Dn.prototype.initialize.apply(this,arguments)},_initializePorts:function(){},_refreshPorts:function(){},isElement:function(){return true},position:function(t,e,n){const r=isNumber(e);n=(r?n:t)||{};const{parentRelative:i,deep:o,restrictedArea:s}=n;let a;if(i){if(!this.graph)throw new Error("Element must be part of a graph.");const t=this.getParentCell();t&&!t.isLink()&&(a=t.get("position"))}if(r){if(a){t+=a.x;e+=a.y}if(o||s){const{x:r,y:i}=this.get("position");this.translate(t-r,e-i,n)}else this.set("position",{x:t,y:e},n);return this}{const t=Point(this.get("position"));return i?t.difference(a):t}},translate:function(t,e,n){t=t||0;e=e||0;if(t===0&&e===0)return this;n=n||{};n.translateBy=n.translateBy||this.id;var r=this.get("position")||{x:0,y:0};var i=n.restrictedArea;if(i&&n.translateBy===this.id)if(typeof i==="function"){var o=i.call(this,r.x+t,r.y+e,n);t=o.x-r.x;e=o.y-r.y}else{var s=this.getBBox({deep:true});var a=r.x-s.x;var c=r.y-s.y;var l=Math.max(i.x+a,Math.min(i.x+i.width+a-s.width,r.x+t));var u=Math.max(i.y+c,Math.min(i.y+i.height+c-s.height,r.y+e));t=l-r.x;e=u-r.y}var h={x:r.x+t,y:r.y+e};n.tx=t;n.ty=e;if(n.transition){isObject(n.transition)||(n.transition={});this.transition("position",h,Ne({},n.transition,{valueFunction:dn.object}));invoke(this.getEmbeddedCells(),"translate",t,e,n)}else{this.startBatch("translate",n);this.set("position",h,n);invoke(this.getEmbeddedCells(),"translate",t,e,n);this.stopBatch("translate",n)}return this},size:function(t,e,n){var r=this.get("size");if(t===void 0)return{width:r.width,height:r.height};if(isObject(t)){n=e;e=isNumber(t.height)?t.height:r.height;t=isNumber(t.width)?t.width:r.width}return this.resize(t,e,n)},resize:function(t,e,n){n=n||{};this.startBatch("resize",n);if(n.direction){var r=this.get("size");switch(n.direction){case"left":case"right":e=r.height;break;case"top":case"bottom":t=r.width;break}var i=normalizeAngle(this.get("angle")||0);var o=this.getBBox();var s;if(i){var a={"top-right":0,right:0,"top-left":1,top:1,"bottom-left":2,left:2,"bottom-right":3,bottom:3}[n.direction];if(n.absolute){a+=Math.floor((i+45)/90);a%=4}var c=o[["bottomLeft","corner","topRight","origin"][a]]();var l=Point(c).rotate(o.center(),-i);var u=Math.sqrt(t*t+e*e)/2;var h=a*Math.PI/2;h+=Math.atan(a%2==0?e/t:t/e);h-=toRad(i);var d=Point.fromPolar(u,h,l);s=Point(d).offset(t/-2,e/-2)}else{s=o.topLeft();switch(n.direction){case"top":case"top-right":s.offset(0,o.height-e);break;case"left":case"bottom-left":s.offset(o.width-t,0);break;case"top-left":s.offset(o.width-t,o.height-e);break}}this.set("size",{width:t,height:e},n);this.position(s.x,s.y,n)}else this.set("size",{width:t,height:e},n);this.stopBatch("resize",n);return this},scale:function(t,e,n,r){var i=this.getBBox().scale(t,e,n);this.startBatch("scale",r);this.position(i.x,i.y,r);this.resize(i.width,i.height,r);this.stopBatch("scale");return this},fitEmbeds:function(t){return this.fitToChildren(t)},fitToChildren:function(t={}){const{graph:e}=this;if(!e)throw new Error("Element must be part of a graph.");const n=this.getEmbeddedCells().filter((t=>t.isElement()));if(n.length===0)return this;this.startBatch("fit-embeds",t);t.deep&&invoke(n,"fitToChildren",t);this._fitToElements(Object.assign({elements:n},t));this.stopBatch("fit-embeds");return this},fitParent:function(t={}){const{graph:e}=this;if(!e)throw new Error("Element must be part of a graph.");if(t.deep&&t.terminator&&(t.terminator===this||t.terminator===this.id))return this;const n=this.getParentCell();if(!n||!n.isElement())return this;const r=n.getEmbeddedCells().filter((t=>t.isElement()));if(r.length===0)return this;this.startBatch("fit-parent",t);n._fitToElements(Object.assign({elements:r},t));t.deep&&n.fitParent(t);this.stopBatch("fit-parent");return this},_fitToElements:function(t={}){const e=this.graph.getCellsBBox(t.elements);if(!e)return;const{expandOnly:n,shrinkOnly:r}=t;if(n&&r)return;let{x:i,y:o,width:s,height:a}=e;const{left:c,right:l,top:u,bottom:h}=normalizeSides(t.padding);i-=c;o-=u;s+=c+l;a+=h+u;let d=new Rect(i,o,s,a);if(n)d=this.getBBox().union(d);else if(r){const t=this.getBBox().intersect(d);if(!t)return;d=t}this.set({position:{x:d.x,y:d.y},size:{width:d.width,height:d.height}},t)},rotate:function(t,e,n,r){if(n){var i=this.getBBox().center();var o=this.get("size");var s=this.get("position");i.rotate(n,this.get("angle")-t);var a=i.x-o.width/2-s.x;var c=i.y-o.height/2-s.y;this.startBatch("rotate",{angle:t,absolute:e,origin:n});this.position(s.x+a,s.y+c,r);this.rotate(t,e,null,r);this.stopBatch("rotate")}else this.set("angle",e?t:(this.get("angle")+t)%360,r);return this},angle:function(){return normalizeAngle(this.get("angle")||0)},getBBox:function(t={}){const{graph:e,attributes:n}=this;const{deep:r,rotate:i}=t;if(r&&e){const n=this.getEmbeddedCells({deep:true,breadthFirst:true});n.push(this);return e.getCellsBBox(n,t)}const{angle:o=0,position:{x:s,y:a},size:{width:c,height:l}}=n;const u=new Rect(s,a,c,l);i&&u.rotateAroundCenter(o);return u},getPointFromConnectedLink:function(t,e){var n=this.getBBox();var r=n.center();var i=t.get(e);if(!i)return r;var o=i.port;if(!o||!this.hasPort(o))return r;var s=this.portProp(o,["group"]);var a=this.getPortsPositions(s);var c=new Point(a[o]).offset(n.origin());var l=this.angle();l&&c.rotate(r,-l);return c}});Ne($n.prototype,Wn);const qn=Dn.extend({defaultLabel:void 0,labelMarkup:void 0,_builtins:{defaultLabel:{markup:[{tagName:"rect",selector:"rect"},{tagName:"text",selector:"text"}],attrs:{text:{fill:"#000000",fontSize:14,textAnchor:"middle",textVerticalAnchor:"middle",pointerEvents:"none"},rect:{ref:"text",fill:"#ffffff",rx:3,ry:3,x:"calc(x)",y:"calc(y)",width:"calc(w)",height:"calc(h)"}},position:{distance:.5}}},defaults:{source:{},target:{}},isLink:function(){return true},disconnect:function(t){return this.set({source:{x:0,y:0},target:{x:0,y:0}},t)},source:function(t,e,n){if(t===void 0)return clone$1(this.get("source"));var r;var i;var o=t instanceof Dn;if(o){r=clone$1(e)||{};r.id=t.id;i=n;return this.set("source",r,i)}var s=!isPlainObject(t);if(s){r=clone$1(e)||{};r.x=t.x;r.y=t.y;i=n;return this.set("source",r,i)}r=t;i=e;return this.set("source",r,i)},target:function(t,e,n){if(t===void 0)return clone$1(this.get("target"));var r;var i;var o=t instanceof Dn;if(o){r=clone$1(e)||{};r.id=t.id;i=n;return this.set("target",r,i)}var s=!isPlainObject(t);if(s){r=clone$1(e)||{};r.x=t.x;r.y=t.y;i=n;return this.set("target",r,i)}r=t;i=e;return this.set("target",r,i)},router:function(t,e,n){if(t===void 0){var r=this.get("router");return r?typeof r==="object"?clone$1(r):r:null}var i=typeof t==="object"||typeof t==="function";var o=i?t:{name:t,args:e};var s=i?e:n;return this.set("router",o,s)},connector:function(t,e,n){if(t===void 0){var r=this.get("connector");return r?typeof r==="object"?clone$1(r):r:null}var i=typeof t==="object"||typeof t==="function";var o=i?t:{name:t,args:e};var s=i?e:n;return this.set("connector",o,s)},label:function(t,e,n){var r=this.labels();t=isFinite(t)&&t!==null?t|0:0;t<0&&(t=r.length+t);return arguments.length<=1?this.prop(["labels",t]):this.prop(["labels",t],e,n)},labels:function(t,e){if(arguments.length===0){t=this.get("labels");return Array.isArray(t)?t.slice():[]}Array.isArray(t)||(t=[]);return this.set("labels",t,e)},hasLabels:function(){const{labels:t}=this.attributes;return Array.isArray(t)&&t.length>0},insertLabel:function(t,e,n){if(!e)throw new Error("dia.Link: no label provided");var r=this.labels();var i=r.length;t=isFinite(t)&&t!==null?t|0:i;t<0&&(t=i+t+1);r.splice(t,0,e);return this.labels(r,n)},appendLabel:function(t,e){return this.insertLabel(-1,t,e)},removeLabel:function(t,e){var n=this.labels();t=isFinite(t)&&t!==null?t|0:-1;n.splice(t,1);return this.labels(n,e)},vertex:function(t,e,n){var r=this.vertices();t=isFinite(t)&&t!==null?t|0:0;t<0&&(t=r.length+t);if(arguments.length<=1)return this.prop(["vertices",t]);var i=this._normalizeVertex(e);return this.prop(["vertices",t],i,n)},vertices:function(t,e){if(arguments.length===0){t=this.get("vertices");return Array.isArray(t)?t.slice():[]}Array.isArray(t)||(t=[]);var n=[];for(var r=0;r<t.length;r++){var i=t[r];var o=this._normalizeVertex(i);n.push(o)}return this.set("vertices",n,e)},insertVertex:function(t,e,n){if(!e)throw new Error("dia.Link: no vertex provided");var r=this.vertices();var i=r.length;t=isFinite(t)&&t!==null?t|0:i;t<0&&(t=i+t+1);var o=this._normalizeVertex(e);r.splice(t,0,o);return this.vertices(r,n)},removeVertex:function(t,e){var n=this.vertices();t=isFinite(t)&&t!==null?t|0:-1;n.splice(t,1);return this.vertices(n,e)},_normalizeVertex:function(t){var e=!isPlainObject(t);return e?{x:t.x,y:t.y}:t},translate:function(t,e,n){n=n||{};n.translateBy=n.translateBy||this.id;n.tx=t;n.ty=e;return this.applyToPoints((function(n){return{x:(n.x||0)+t,y:(n.y||0)+e}}),n)},scale:function(t,e,n,r){return this.applyToPoints((function(r){return Point(r).scale(t,e,n).toJSON()}),r)},applyToPoints:function(t,e){if(!isFunction(t))throw new TypeError("dia.Link: applyToPoints expects its first parameter to be a function.");var n={};var{source:r,target:i}=this.attributes;r.id||(n.source=t(r));i.id||(n.target=t(i));var o=this.vertices();o.length>0&&(n.vertices=o.map(t));return this.set(n,e)},getSourcePoint:function(){var t=this.getSourceCell();return t?t.getPointFromConnectedLink(this,"source"):new Point(this.source())},getTargetPoint:function(){var t=this.getTargetCell();return t?t.getPointFromConnectedLink(this,"target"):new Point(this.target())},getPointFromConnectedLink:function(){return this.getPolyline().pointAt(.5)},getPolyline:function(){const t=[this.getSourcePoint(),...this.vertices().map(Point),this.getTargetPoint()];return new Polyline$1(t)},getBBox:function(){return this.getPolyline().bbox()},reparent:function(t){var e;if(this.graph){var n=this.getSourceElement();var r=this.getTargetElement();var i=this.getParentCell();n&&r&&(e=n===r||n.isEmbeddedIn(r)?r:r.isEmbeddedIn(n)?n:this.graph.getCommonAncestor(n,r));!i||e&&e.id===i.id||i.unembed(this,t);e&&e.embed(this,t)}return e},hasLoop:function(t){t=t||{};var{source:e,target:n}=this.attributes;var r=e.id;var i=n.id;if(!r||!i)return false;var o=r===i;if(!o&&t.deep&&this.graph){var s=this.getSourceCell();var a=this.getTargetCell();o=s.isEmbeddedIn(a)||a.isEmbeddedIn(s)}return o},getSourceCell:function(){const{graph:t,attributes:e}=this;var n=e.source;return n&&n.id&&t&&t.getCell(n.id)||null},getSourceElement:function(){var t=this;var e={};do{if(e[t.id])return null;e[t.id]=true;t=t.getSourceCell()}while(t&&t.isLink());return t},getTargetCell:function(){const{graph:t,attributes:e}=this;var n=e.target;return n&&n.id&&t&&t.getCell(n.id)||null},getTargetElement:function(){var t=this;var e={};do{if(e[t.id])return null;e[t.id]=true;t=t.getTargetCell()}while(t&&t.isLink());return t},getRelationshipAncestor:function(){var t;if(this.graph){var e=[this,this.getSourceElement(),this.getTargetElement()].filter((function(t){return!!t}));t=this.graph.getCommonAncestor.apply(this.graph,e)}return t||null},isRelationshipEmbeddedIn:function(t){var e=isString(t)||isNumber(t)?t:t.id;var n=this.getRelationshipAncestor();return!!n&&(n.id===e||n.isEmbeddedIn(e))},_getDefaultLabel:function(){var t=this.get("defaultLabel")||this.defaultLabel||{};var e={};e.markup=t.markup||this.get("labelMarkup")||this.labelMarkup;e.position=t.position;e.attrs=t.attrs;e.size=t.size;return e}},{endsEqual:function(t,e){var n=t.port===e.port||!t.port&&!e.port;return t.id===e.id&&n}});const Yn={_results:{},_tests:{svgforeignobject:function(){return!!document.createElementNS&&/SVGForeignObject/.test({}.toString.call(document.createElementNS("http://www.w3.org/2000/svg","foreignObject")))},isSafari:function(){return/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)}},addTest:function(t,e){return this._tests[t]=e},test:function(t){var e=this._tests[t];if(!e)throw new Error('Test not defined ("'+t+'"). Use `joint.env.addTest(name, fn) to add a new test.`');var n=this._results[t];if(typeof n!=="undefined")return n;try{n=e()}catch(t){n=false}this._results[t]=n;return n}};const Xn=$n.define("standard.Rectangle",{attrs:{root:{cursor:"move"},body:{width:"calc(w)",height:"calc(h)",strokeWidth:2,stroke:"#000000",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"}]});const Zn=$n.define("standard.Circle",{attrs:{root:{cursor:"move"},body:{cx:"calc(s/2)",cy:"calc(s/2)",r:"calc(s/2)",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}]});const Jn=$n.define("standard.Ellipse",{attrs:{root:{cursor:"move"},body:{cx:"calc(w/2)",cy:"calc(h/2)",rx:"calc(w/2)",ry:"calc(h/2)",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"ellipse",selector:"body"},{tagName:"text",selector:"label"}]});const Kn=$n.define("standard.Path",{attrs:{root:{cursor:"move"},body:{d:"M 0 0 H calc(w) V calc(h) H 0 Z",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"path",selector:"body"},{tagName:"text",selector:"label"}]});const Qn=$n.define("standard.Polygon",{attrs:{root:{cursor:"move"},body:{points:"0 0 calc(w) 0 calc(w) calc(h) 0 calc(h)",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"polygon",selector:"body"},{tagName:"text",selector:"label"}]});const tr=$n.define("standard.Polyline",{attrs:{root:{cursor:"move"},body:{points:"0 0 calc(w) 0 calc(w) calc(h) 0 calc(h)",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"polyline",selector:"body"},{tagName:"text",selector:"label"}]});const er=$n.define("standard.Image",{attrs:{root:{cursor:"move"},image:{width:"calc(w)",height:"calc(h)"},label:{textVerticalAnchor:"top",textAnchor:"middle",x:"calc(w/2)",y:"calc(h+10)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]});const nr=$n.define("standard.BorderedImage",{attrs:{root:{cursor:"move"},border:{width:"calc(w)",height:"calc(h)",stroke:"#333333",strokeWidth:2},background:{width:"calc(w-1)",height:"calc(h-1)",x:.5,y:.5,fill:"#FFFFFF"},image:{width:"calc(w-1)",height:"calc(h-1)",x:.5,y:.5},label:{textVerticalAnchor:"top",textAnchor:"middle",x:"calc(w/2)",y:"calc(h+10)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"background",attributes:{stroke:"none"}},{tagName:"image",selector:"image"},{tagName:"rect",selector:"border",attributes:{fill:"none"}},{tagName:"text",selector:"label"}]});const rr=$n.define("standard.EmbeddedImage",{attrs:{root:{cursor:"move"},body:{width:"calc(w)",height:"calc(h)",stroke:"#333333",fill:"#FFFFFF",strokeWidth:2},image:{width:"calc(0.3*w)",height:"calc(h-20)",x:10,y:10,preserveAspectRatio:"xMidYMin"},label:{textVerticalAnchor:"top",textAnchor:"left",x:"calc(0.3*w+20)",y:10,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]});const ir=$n.define("standard.InscribedImage",{attrs:{root:{cursor:"move"},border:{rx:"calc(w/2)",ry:"calc(h/2)",cx:"calc(w/2)",cy:"calc(h/2)",stroke:"#333333",strokeWidth:2},background:{rx:"calc(w/2)",ry:"calc(h/2)",cx:"calc(w/2)",cy:"calc(h/2)",fill:"#FFFFFF"},image:{width:"calc(0.68*w)",height:"calc(0.68*h)",x:"calc(0.16*w)",y:"calc(0.16*h)",preserveAspectRatio:"xMidYMid"},label:{textVerticalAnchor:"top",textAnchor:"middle",x:"calc(w/2)",y:"calc(h+10)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"ellipse",selector:"background"},{tagName:"image",selector:"image"},{tagName:"ellipse",selector:"border",attributes:{fill:"none"}},{tagName:"text",selector:"label"}]});const or=$n.define("standard.HeaderedRectangle",{attrs:{root:{cursor:"move"},body:{width:"calc(w)",height:"calc(h)",strokeWidth:2,stroke:"#000000",fill:"#FFFFFF"},header:{width:"calc(w)",height:30,strokeWidth:2,stroke:"#000000",fill:"#FFFFFF"},headerText:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:15,fontSize:16,fill:"#333333"},bodyText:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2+15)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"rect",selector:"header"},{tagName:"text",selector:"headerText"},{tagName:"text",selector:"bodyText"}]});var sr=10;const ar=$n.define("standard.Cylinder",{attrs:{root:{cursor:"move"},body:{lateralArea:sr,fill:"#FFFFFF",stroke:"#333333",strokeWidth:2},top:{cx:"calc(w/2)",cy:sr,rx:"calc(w/2)",ry:sr,fill:"#FFFFFF",stroke:"#333333",strokeWidth:2},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h+15)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"path",selector:"body"},{tagName:"ellipse",selector:"top"},{tagName:"text",selector:"label"}],topRy:function(t,e){if(t===void 0)return this.attr("body/lateralArea");var n={lateralArea:t};var r=isPercentage(t);var i=r?`calc(${parseFloat(t)/100}*h)`:t;var o={cy:i,ry:i};return this.attr({body:n,top:o},e)}},{attributes:{"lateral-area":{set:function(t,e){var n=isPercentage(t);n&&(t=parseFloat(t)/100);var r=e.x;var i=e.y;var o=e.width;var s=e.height;var a=o/2;var c=n?s*t:t;var l=J.KAPPA;var u=l*a;var h=l*(n?s*t:t);var d=r;var f=r+o/2;var p=r+o;var g=i+c;var v=g-c;var m=i+s-c;var y=i+s;var b=["M",d,g,"L",d,m,"C",r,m+h,f-u,y,f,y,"C",f+u,y,p,m+h,p,m,"L",p,g,"C",p,g-h,f+u,v,f,v,"C",f-u,v,d,g-h,d,g,"Z"];return{d:b.join(" ")}},unset:"d"}}});var cr={tagName:"foreignObject",selector:"foreignObject",attributes:{overflow:"hidden"},children:[{tagName:"div",namespaceURI:"http://www.w3.org/1999/xhtml",selector:"label",style:{width:"100%",height:"100%",position:"static",backgroundColor:"transparent",textAlign:"center",margin:0,padding:"0px 5px",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center"}}]};var lr={tagName:"text",selector:"label",attributes:{"text-anchor":"middle"}};var ur=Yn.test("svgforeignobject")?cr:lr;const hr=$n.define("standard.TextBlock",{attrs:{root:{cursor:"move"},body:{width:"calc(w)",height:"calc(h)",stroke:"#333333",fill:"#ffffff",strokeWidth:2},foreignObject:{width:"calc(w)",height:"calc(h)"},label:{style:{fontSize:14}}}},{markup:[{tagName:"rect",selector:"body"},ur]},{attributes:{text:{set:function(t,e,n,r){if(!(n instanceof HTMLElement)){var i=r.style||{};var o={text:t,width:-5,height:"100%"};var s=Ne({"text-vertical-anchor":"middle"},i);Fn["text-wrap"].set.call(this,o,e,n,s);return{fill:i.color||null}}n.textContent=t},unset:function(t){t.textContent="";if(t instanceof SVGElement)return"fill"},position:function(t,e,n){if(n instanceof SVGElement)return e.center()}}}});const dr=qn.define("standard.Link",{attrs:{line:{connection:true,stroke:"#333333",strokeWidth:2,strokeLinejoin:"round",targetMarker:{type:"path",d:"M 10 -5 0 0 10 5 z"}},wrapper:{connection:true,strokeWidth:10,strokeLinejoin:"round"}}},{markup:[{tagName:"path",selector:"wrapper",attributes:{fill:"none",cursor:"pointer",stroke:"transparent","stroke-linecap":"round"}},{tagName:"path",selector:"line",attributes:{fill:"none","pointer-events":"none"}}]});const fr=qn.define("standard.DoubleLink",{attrs:{line:{connection:true,stroke:"#DDDDDD",strokeWidth:4,strokeLinejoin:"round",targetMarker:{type:"path",stroke:"#000000",d:"M 10 -3 10 -10 -2 0 10 10 10 3"}},outline:{connection:true,stroke:"#000000",strokeWidth:6,strokeLinejoin:"round"}}},{markup:[{tagName:"path",selector:"outline",attributes:{fill:"none",cursor:"pointer"}},{tagName:"path",selector:"line",attributes:{fill:"none","pointer-events":"none"}}]});const pr=qn.define("standard.ShadowLink",{attrs:{line:{connection:true,stroke:"#FF0000",strokeWidth:20,strokeLinejoin:"round",targetMarker:{type:"path",stroke:"none",d:"M 0 -10 -10 0 0 10 z"},sourceMarker:{type:"path",stroke:"none",d:"M -10 -10 0 0 -10 10 0 10 0 -10 z"}},shadow:{connection:true,transform:"translate(3,6)",stroke:"#000000",strokeOpacity:.2,strokeWidth:20,strokeLinejoin:"round",targetMarker:{type:"path",d:"M 0 -10 -10 0 0 10 z",stroke:"none"},sourceMarker:{type:"path",stroke:"none",d:"M -10 -10 0 0 -10 10 0 10 0 -10 z"}}}},{markup:[{tagName:"path",selector:"shadow",attributes:{fill:"none","pointer-events":"none"}},{tagName:"path",selector:"line",attributes:{fill:"none",cursor:"pointer"}}]});var gr=Object.freeze(Object.defineProperty({__proto__:null,BorderedImage:nr,Circle:Zn,Cylinder:ar,DoubleLink:fr,Ellipse:Jn,EmbeddedImage:rr,HeaderedRectangle:or,Image:er,InscribedImage:ir,Link:dr,Path:Kn,Polygon:Qn,Polyline:tr,Rectangle:Xn,ShadowLink:pr,TextBlock:hr},Symbol.toStringTag,{value:"Module"}));var vr=Object.freeze(Object.defineProperty({__proto__:null,standard:gr},Symbol.toStringTag,{value:"Module"}));const mr={POINT:"point",CUBIC:"cubic",LINE:"line",GAP:"gap"};const yr=Object.values(mr);const br=10;const xr=1;const straight=function(t,e,n=[],r={}){const{cornerType:i=mr.POINT,cornerRadius:o=br,cornerPreserveAspectRatio:s=false,precision:a=xr,raw:c=false}=r;if(yr.indexOf(i)===-1)throw new Error("Invalid `cornerType` provided to `straight` connector.");let l;if(i!==mr.POINT&&o){l=new Path$1;l.appendSegment(Path$1.createSegment("M",t));let r;const c=n.length;for(let u=0;u<c;u++){const c=new Point(n[u]);const h=n[u-1]||t;const d=n[u+1]||e;const f=r||c.distance(h)/2;r=c.distance(d)/2;let p,g;if(s)p=g=-Math.min(o,f,r);else{p=-Math.min(o,f);g=-Math.min(o,r)}const v=c.clone().move(h,p).round(a);const m=c.clone().move(d,g).round(a);l.appendSegment(Path$1.createSegment("L",v));switch(i){case mr.CUBIC:{const t=1/3;const e=2/3;const n=new Point(t*v.x+e*c.x,e*c.y+t*v.y);const r=new Point(t*m.x+e*c.x,e*c.y+t*m.y);l.appendSegment(Path$1.createSegment("C",n,r,m));break}case mr.LINE:l.appendSegment(Path$1.createSegment("L",m));break;case mr.GAP:l.appendSegment(Path$1.createSegment("M",m));break}}l.appendSegment(Path$1.createSegment("L",e))}else{const r=[t].concat(n).concat([e]);const i=new Polyline$1(r);l=new Path$1(i)}return c?l:l.serialize()};var wr=5;var Ar=["arc","gap","cubic"];var Pr=0;var Tr=1;var Er=["smooth"];var Sr=1/3;var kr=2/3;function sortPointsAscending(t,e){let{x:n,y:r}=t;let{x:i,y:o}=e;if(n>i){let t=n;n=i;i=t;t=r;r=o;o=t}if(r>o){let t=n;n=i;i=t;t=r;r=o;o=t}return[new Point(n,r),new Point(i,o)]}function overlapExists(t,e){const[{x:n,y:r},{x:i,y:o}]=sortPointsAscending(t.start,t.end);const[{x:s,y:a},{x:c,y:l}]=sortPointsAscending(e.start,e.end);const u=n<=c&&s<=i;const h=r<=l&&a<=o;return u&&h}
/**
 * Transform start/end and route into series of lines
 * @param {g.point} sourcePoint start point
 * @param {g.point} targetPoint end point
 * @param {g.point[]} route optional list of route
 * @return {g.line[]} [description]
 */function createLines(t,e,n){var r=[].concat(t,n,e);return r.reduce((function(t,e,n){var i=r[n+1];i!=null&&(t[n]=w(e,i));return t}),[])}function setupUpdating(t){var e=t.paper;var n=e._jumpOverUpdateList;if(n==null){n=e._jumpOverUpdateList=[];var r=e.model;r.on("batch:stop",(function(){this.hasActiveBatch()||updateJumpOver(e)}));r.on("reset",(function(){n=e._jumpOverUpdateList=[]}))}if(n.indexOf(t)<0){n.push(t);t.listenToOnce(t.model,"change:connector remove",(function(){n.splice(n.indexOf(t),1)}))}}
/**
 * Handler for a batch:stop event to force
 * update of all registered links with jump over connector
 * @param {object} batchEvent optional object with info about batch
 */function updateJumpOver(t){var e=t._jumpOverUpdateList;for(var n=0;n<e.length;n++){const t=e[n];const r=t.getFlag(t.constructor.Flags.CONNECTOR);t.requestUpdate(r)}}
/**
 * Utility function to collect all intersection points of a single
 * line against group of other lines.
 * @param {g.line} line where to find points
 * @param {g.line[]} crossCheckLines lines to cross
 * @return {g.point[]} list of intersection points
 */function findLineIntersections(t,e){return toArray$1(e).reduce((function(e,n){var r=t.intersection(n);r&&e.push(r);return e}),[])}
/**
 * Sorting function for list of points by their distance.
 * @param {g.point} p1 first point
 * @param {g.point} p2 second point
 * @return {number} squared distance between points
 */function sortPoints(t,e){return w(t,e).squaredLength()}
/**
 * Split input line into multiple based on intersection points.
 * @param {g.line} line input line to split
 * @param {g.point[]} intersections points where to split the line
 * @param {number} jumpSize the size of jump arc (length empty spot on a line)
 * @return {g.line[]} list of lines being split
 */function createJumps(t,e,n){return e.reduce((function(r,i,o){if(i.skip===true)return r;var s=r.pop()||t;var a=y(i).move(s.start,-n);var c=y(i).move(s.start,+n);var l=e[o+1];if(l!=null){var u=c.distance(l);if(u<=n){c=l.move(s.start,u);l.skip=true}}else{var h=a.distance(s.end);if(h<n*2+Tr){r.push(s);return r}}var d=c.distance(s.start);if(d<n*2+Tr){r.push(s);return r}var f=w(a,c);f.isJump=true;r.push(w(s.start,a),f,w(c,s.end));return r}),[])}
/**
 * Assemble `D` attribute of a SVG path by iterating given lines.
 * @param {g.line[]} lines source lines to use
 * @param {number} jumpSize the size of jump arc (length empty spot on a line)
 * @param {number} radius the radius
 * @return {string}
 */function buildPath(t,e,n,r){var i=new Path$1;var o;o=Path$1.createSegment("M",t[0].start);i.appendSegment(o);toArray$1(t).forEach((function(s,a){if(s.isJump){var c,l;var u,h;if(n==="arc"){c=-90;l=s.start.difference(s.end);var d=Number(l.x<0||l.x===0&&l.y<0);d&&(c+=180);var f=s.midpoint();var p=new Line(f,s.end).rotate(f,c);var g;g=new Line(s.start,f);u=g.pointAt(2/3).rotate(s.start,c);h=p.pointAt(1/3).rotate(p.end,-c);o=Path$1.createSegment("C",u,h,p.end);i.appendSegment(o);g=new Line(f,s.end);u=p.pointAt(1/3).rotate(p.end,c);h=g.pointAt(1/3).rotate(s.end,-c);o=Path$1.createSegment("C",u,h,s.end);i.appendSegment(o)}else if(n==="gap"){o=Path$1.createSegment("M",s.end);i.appendSegment(o)}else if(n==="cubic"){c=s.start.theta(s.end);var v=e*.6;var m=e*1.35;l=s.start.difference(s.end);d=Number(l.x<0||l.x===0&&l.y<0);d&&(m*=-1);u=Point(s.start.x+v,s.start.y+m).rotate(s.start,c);h=Point(s.end.x-v,s.end.y+m).rotate(s.end,c);o=Path$1.createSegment("C",u,h,s.end);i.appendSegment(o)}}else{var y=t[a+1];if(r==0||!y||y.isJump){o=Path$1.createSegment("L",s.end);i.appendSegment(o)}else buildRoundedSegment(r,i,s.end,s.start,y.end)}}));return i}function buildRoundedSegment(t,e,n,r,i){var o=n.distance(r)/2;var s=n.distance(i)/2;var a=-Math.min(t,o);var c=-Math.min(t,s);var l=n.clone().move(r,a).round();var u=n.clone().move(i,c).round();var h=new Point(Sr*l.x+kr*n.x,kr*n.y+Sr*l.y);var d=new Point(Sr*u.x+kr*n.x,kr*n.y+Sr*u.y);var f;f=Path$1.createSegment("L",l);e.appendSegment(f);f=Path$1.createSegment("C",h,d,u);e.appendSegment(f)}
/**
 * Actual connector function that will be run on every update.
 * @param {g.point} sourcePoint start point of this link
 * @param {g.point} targetPoint end point of this link
 * @param {g.point[]} route of this link
 * @param {object} opt options
 * @property {number} size optional size of a jump arc
 * @return {string} created `D` attribute of SVG path
 */const jumpover=function(t,e,n,r){setupUpdating(this);var i=r.raw;var o=r.size||wr;var s=r.jump&&(""+r.jump).toLowerCase();var a=r.radius||Pr;var c=r.ignoreConnectors||Er;Ar.indexOf(s)===-1&&(s=Ar[0]);var l=this.paper;var u=l.model;var h=u.getLinks();if(h.length===1)return buildPath(createLines(t,e,n),o,s,a);var d=this.model;var f=h.indexOf(d);var p=l.options.defaultConnector||{};var g=h.filter((function(t,e){var n=t.get("connector")||p;return!toArray$1(c).includes(n.name)&&(!(e>f)||n.name!=="jumpover")}));var v=g.map((function(t){return l.findViewByModel(t)}));var m=createLines(t,e,n);var y=v.map((function(t){return t==null?[]:t===this?m:createLines(t.sourcePoint,t.targetPoint,t.route)}),this);var b=m.reduce((function(t,e){var n=g.reduce((function(t,n,r){if(n!==d){const n=y[r].slice();const i=n.findIndex((t=>overlapExists(e,t)));i>-1&&e.containsPoint(n[i].end)&&n.splice(i+1,1);const o=findLineIntersections(e,n);t.push.apply(t,o)}return t}),[]).sort((function(t,n){return sortPoints(e.start,t)-sortPoints(e.start,n)}));n.length>0?t.push.apply(t,createJumps(e,n,o)):t.push(e);return t}),[]);var x=buildPath(b,o,s,a);return i?x:x.serialize()};const normal$1=function(t,e,n=[],r={}){const{raw:i}=r;const o={cornerType:"point",raw:i};return straight(t,e,n,o)};const Lr=10;const Cr=0;const rounded=function(t,e,n=[],r={}){const{radius:i=Lr,raw:o}=r;const s={cornerType:"cubic",cornerRadius:i,precision:Cr,raw:o};return straight(t,e,n,s)};const smooth=function(t,e,n,r){var i=r&&r.raw;var o;if(n&&n.length!==0){var s=[t].concat(n).concat([e]);var a=Curve.throughPoints(s);o=new Path$1(a)}else{o=new Path$1;var c;c=Path$1.createSegment("M",t);o.appendSegment(c);if(Math.abs(t.x-e.x)>=Math.abs(t.y-e.y)){var l=(t.x+e.x)/2;c=Path$1.createSegment("C",l,t.y,l,e.y,e.x,e.y);o.appendSegment(c)}else{var u=(t.y+e.y)/2;c=Path$1.createSegment("C",t.x,u,e.x,u,e.x,e.y);o.appendSegment(c)}}return i?o:o.serialize()};const _r={AUTO:"auto",HORIZONTAL:"horizontal",VERTICAL:"vertical",CLOSEST_POINT:"closest-point",OUTWARDS:"outwards"};const Mr={UP:"up",DOWN:"down",LEFT:"left",RIGHT:"right",AUTO:"auto",CLOSEST_POINT:"closest-point",OUTWARDS:"outwards"};const curve=function(t,e,n=[],r={},i){const o=Boolean(r.raw);const{direction:s=_r.AUTO,precision:a=3}=r;const c={coeff:r.distanceCoefficient||.6,angleTangentCoefficient:r.angleTangentCoefficient||80,tau:r.tension||.5,sourceTangent:r.sourceTangent?new Point(r.sourceTangent):null,targetTangent:r.targetTangent?new Point(r.targetTangent):null,rotate:Boolean(r.rotate)};typeof r.sourceDirection==="string"?c.sourceDirection=r.sourceDirection:typeof r.sourceDirection==="number"?c.sourceDirection=new Point(1,0).rotate(null,r.sourceDirection):c.sourceDirection=r.sourceDirection?new Point(r.sourceDirection).normalize():null;typeof r.targetDirection==="string"?c.targetDirection=r.targetDirection:typeof r.targetDirection==="number"?c.targetDirection=new Point(1,0).rotate(null,r.targetDirection):c.targetDirection=r.targetDirection?new Point(r.targetDirection).normalize():null;const l=[t,...n,e].map((t=>new Point(t)));let u;if(c.sourceTangent)u=c.sourceTangent;else{const t=getSourceTangentDirection(i,l,s,c);const e=l[0].distance(l[1])*c.coeff;const n=l[1].difference(l[0]).normalize();const r=angleBetweenVectors(t,n);if(r>Math.PI/4){const n=e+(r-Math.PI/4)*c.angleTangentCoefficient;u=t.clone().scale(n,n)}else u=t.clone().scale(e,e)}let h;if(c.targetTangent)h=c.targetTangent;else{const t=getTargetTangentDirection(i,l,s,c);const e=l.length-1;const n=l[e-1].distance(l[e])*c.coeff;const r=l[e-1].difference(l[e]).normalize();const o=angleBetweenVectors(t,r);if(o>Math.PI/4){const e=n+(o-Math.PI/4)*c.angleTangentCoefficient;h=t.clone().scale(e,e)}else h=t.clone().scale(n,n)}const d=createCatmullRomCurves(l,u,h,c);const f=d.map((t=>catmullRomToBezier(t,c)));const p=new Path$1(f).round(a);return o?p:p.serialize()};curve.Directions=_r;curve.TangentDirections=Mr;function getHorizontalSourceDirection(t,e,n){const{sourceBBox:r}=t;let i;let o;if(t.sourceView){o=t.sourceView.model.angle();if(n.rotate&&o){const n=t.sourceView.getNodeUnrotatedBBox(t.sourceView.el);const s=e[0].clone();s.rotate(r.center(),o);i=n.sideNearestToPoint(s)}else i=r.sideNearestToPoint(e[0])}else i=r.x>e[1].x?"right":"left";let s;switch(i){case"left":s=new Point(-1,0);break;case"right":default:s=new Point(1,0);break}n.rotate&&o&&s.rotate(null,-o);return s}function getHorizontalTargetDirection(t,e,n){const{targetBBox:r}=t;let i;let o;if(t.targetView){o=t.targetView.model.angle();if(n.rotate&&o){const n=t.targetView.getNodeUnrotatedBBox(t.targetView.el);const s=e[e.length-1].clone();s.rotate(r.center(),o);i=n.sideNearestToPoint(s)}else i=r.sideNearestToPoint(e[e.length-1])}else i=r.x>e[e.length-2].x?"left":"right";let s;switch(i){case"left":s=new Point(-1,0);break;case"right":default:s=new Point(1,0);break}n.rotate&&o&&s.rotate(null,-o);return s}function getVerticalSourceDirection(t,e,n){const{sourceBBox:r}=t;let i;let o;if(t.sourceView){o=t.sourceView.model.angle();if(n.rotate&&o){const n=t.sourceView.getNodeUnrotatedBBox(t.sourceView.el);const s=e[0].clone();s.rotate(r.center(),o);i=n.sideNearestToPoint(s)}else i=r.sideNearestToPoint(e[0])}else i=r.y>e[1].y?"bottom":"top";let s;switch(i){case"top":s=new Point(0,-1);break;case"bottom":default:s=new Point(0,1);break}n.rotate&&o&&s.rotate(null,-o);return s}function getVerticalTargetDirection(t,e,n){const{targetBBox:r}=t;let i;let o;if(t.targetView){o=t.targetView.model.angle();if(n.rotate&&o){const n=t.targetView.getNodeUnrotatedBBox(t.targetView.el);const s=e[e.length-1].clone();s.rotate(r.center(),o);i=n.sideNearestToPoint(s)}else i=r.sideNearestToPoint(e[e.length-1])}else i=r.y>e[e.length-2].y?"top":"bottom";let s;switch(i){case"top":s=new Point(0,-1);break;case"bottom":default:s=new Point(0,1);break}n.rotate&&o&&s.rotate(null,-o);return s}function getAutoSourceDirection(t,e,n){const{sourceBBox:r}=t;let i;let o;if(t.sourceView){o=t.sourceView.model.angle();if(n.rotate&&o){const n=t.sourceView.getNodeUnrotatedBBox(t.sourceView.el);const s=e[0].clone();s.rotate(r.center(),o);i=n.sideNearestToPoint(s)}else i=r.sideNearestToPoint(e[0])}else i=r.sideNearestToPoint(e[1]);let s;switch(i){case"top":s=new Point(0,-1);break;case"bottom":s=new Point(0,1);break;case"right":s=new Point(1,0);break;case"left":s=new Point(-1,0);break}n.rotate&&o&&s.rotate(null,-o);return s}function getAutoTargetDirection(t,e,n){const{targetBBox:r}=t;let i;let o;if(t.targetView){o=t.targetView.model.angle();if(n.rotate&&o){const n=t.targetView.getNodeUnrotatedBBox(t.targetView.el);const s=e[e.length-1].clone();s.rotate(r.center(),o);i=n.sideNearestToPoint(s)}else i=r.sideNearestToPoint(e[e.length-1])}else i=r.sideNearestToPoint(e[e.length-2]);let s;switch(i){case"top":s=new Point(0,-1);break;case"bottom":s=new Point(0,1);break;case"right":s=new Point(1,0);break;case"left":s=new Point(-1,0);break}n.rotate&&o&&s.rotate(null,-o);return s}function getClosestPointSourceDirection(t,e,n){return e[1].difference(e[0]).normalize()}function getClosestPointTargetDirection(t,e,n){const r=e.length-1;return e[r-1].difference(e[r]).normalize()}function getOutwardsSourceDirection(t,e,n){const{sourceBBox:r}=t;const i=r.center();return e[0].difference(i).normalize()}function getOutwardsTargetDirection(t,e,n){const{targetBBox:r}=t;const i=r.center();return e[e.length-1].difference(i).normalize()}function getSourceTangentDirection(t,e,n,r){if(r.sourceDirection)switch(r.sourceDirection){case Mr.UP:return new Point(0,-1);case Mr.DOWN:return new Point(0,1);case Mr.LEFT:return new Point(-1,0);case Mr.RIGHT:return new Point(1,0);case Mr.AUTO:return getAutoSourceDirection(t,e,r);case Mr.CLOSEST_POINT:return getClosestPointSourceDirection(t,e,r);case Mr.OUTWARDS:return getOutwardsSourceDirection(t,e,r);default:return r.sourceDirection}switch(n){case _r.HORIZONTAL:return getHorizontalSourceDirection(t,e,r);case _r.VERTICAL:return getVerticalSourceDirection(t,e,r);case _r.CLOSEST_POINT:return getClosestPointSourceDirection(t,e,r);case _r.OUTWARDS:return getOutwardsSourceDirection(t,e,r);case _r.AUTO:default:return getAutoSourceDirection(t,e,r)}}function getTargetTangentDirection(t,e,n,r){if(r.targetDirection)switch(r.targetDirection){case Mr.UP:return new Point(0,-1);case Mr.DOWN:return new Point(0,1);case Mr.LEFT:return new Point(-1,0);case Mr.RIGHT:return new Point(1,0);case Mr.AUTO:return getAutoTargetDirection(t,e,r);case Mr.CLOSEST_POINT:return getClosestPointTargetDirection(t,e,r);case Mr.OUTWARDS:return getOutwardsTargetDirection(t,e,r);default:return r.targetDirection}switch(n){case _r.HORIZONTAL:return getHorizontalTargetDirection(t,e,r);case _r.VERTICAL:return getVerticalTargetDirection(t,e,r);case _r.CLOSEST_POINT:return getClosestPointTargetDirection(t,e,r);case _r.OUTWARDS:return getOutwardsTargetDirection(t,e,r);case _r.AUTO:default:return getAutoTargetDirection(t,e,r)}}function rotateVector(t,e){const n=Math.cos(e);const r=Math.sin(e);const i=n*t.x-r*t.y;const o=r*t.x+n*t.y;t.x=i;t.y=o}function angleBetweenVectors(t,e){let n=t.dot(e)/(t.magnitude()*e.magnitude());n<-1&&(n=-1);n>1&&(n=1);return Math.acos(n)}function determinant(t,e){return t.x*e.y-t.y*e.x}function createCatmullRomCurves(t,e,n,r){const{tau:i,coeff:o}=r;const s=[];const a=[];const c=[];const l=t.length-1;for(let e=0;e<l;e++)s[e]=t[e].distance(t[e+1]);a[0]=e;a[l]=n;for(let e=1;e<l;e++){let n;let r;n=e===1?t[e-1].clone().offset(a[e-1].x,a[e-1].y):t[e-1].clone();r=e===l-1?t[e+1].clone().offset(a[e+1].x,a[e+1].y):t[e+1].clone();const i=n.difference(t[e]).normalize();const c=r.difference(t[e]).normalize();const u=angleBetweenVectors(i,c);let h=(Math.PI-u)/2;let d;const f=determinant(i,c);let p;p=determinant(t[e].difference(t[e+1]),t[e].difference(t[e-1]));f<0&&(h=-h);u<Math.PI/2&&(h<0&&p<0||h>0&&p>0)&&(h-=Math.PI);d=c.clone();rotateVector(d,h);const g=d.clone();const v=d.clone();const m=s[e-1]*o;const y=s[e]*o;g.scale(m,m);v.scale(y,y);a[e]=[g,v]}for(let e=0;e<l;e++){let n;let r;n=e===0?t[e+1].difference(a[e].x/i,a[e].y/i):t[e+1].difference(a[e][1].x/i,a[e][1].y/i);r=e===l-1?t[e].clone().offset(a[e+1].x/i,a[e+1].y/i):t[e].difference(a[e+1][0].x/i,a[e+1][0].y/i);c[e]=[n,t[e],t[e+1],r]}return c}function catmullRomToBezier(t,e){const{tau:n}=e;const r=new Point;r.x=t[1].x+(t[2].x-t[0].x)/(6*n);r.y=t[1].y+(t[2].y-t[0].y)/(6*n);const i=new Point;i.x=t[2].x+(t[3].x-t[1].x)/(6*n);i.y=t[2].y+(t[3].y-t[1].y)/(6*n);return new Curve(t[1],r,i,t[2])}var Nr=Object.freeze(Object.defineProperty({__proto__:null,curve:curve,jumpover:jumpover,normal:normal$1,rounded:rounded,smooth:smooth,straight:straight},Symbol.toStringTag,{value:"Module"}));var ViewBase=function(t){this.cid=uniqueId("view");this.preinitialize.apply(this,arguments);Ne(this,pick(t,Rr));this._ensureElement();this.initialize.apply(this,arguments)};var Or=/^(\S+)\s*(.*)$/;var Rr=["model","collection","el","id","attributes","className","tagName","events","style"];Ne(ViewBase.prototype,vn,{tagName:"div",$:function(t){return this.$el.find(t)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){this._removeElement();this.stopListening();return this},_removeElement:function(){this.$el.remove()},setElement:function(t){this.undelegateEvents();this._setElement(t);this.delegateEvents();return this},_setElement:function(t){this.$el=t instanceof $?t:$(t);this.el=this.$el[0]},delegateEvents:function(t){t||(t=result(this,"events"));if(!t)return this;this.undelegateEvents();for(var e in t){var n=t[e];isFunction(n)||(n=this[n]);if(n){var r=e.match(Or);this.delegate(r[1],r[2],n.bind(this))}}return this},delegate:function(t,e,n){this.$el.on(t+".delegateEvents"+this.cid,e,n);return this},undelegateEvents:function(){this.$el&&this.$el.off(".delegateEvents"+this.cid);return this},undelegate:function(t,e,n){this.$el.off(t+".delegateEvents"+this.cid,e,n);return this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(this.el)this.setElement(result(this,"el"));else{var t=Ne({},result(this,"attributes"));this.id&&(t.id=result(this,"id"));this.className&&(t.class=result(this,"className"));this.setElement(this._createElement(result(this,"tagName")));this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)}});ViewBase.extend=extend;const Br={};const Ir=ViewBase.extend({options:{},theme:null,themeClassNamePrefix:addClassNamePrefix("theme-"),requireSetThemeOverride:false,defaultTheme:nn.defaultTheme,children:null,childNodes:null,DETACHABLE:true,UPDATE_PRIORITY:2,FLAG_INSERT:1<<30,FLAG_REMOVE:1<<29,FLAG_INIT:1<<28,constructor:function(t){this.requireSetThemeOverride=t&&!!t.theme;this.options=Ne({},this.options,t);ViewBase.call(this,t)},initialize:function(){Br[this.cid]=this;this.setTheme(this.options.theme||this.defaultTheme);this.init()},unmount:function(){this.svgElement?this.vel.remove():this.$el.remove()},isMounted:function(){return this.el.parentNode!==null},renderChildren:function(t){t||(t=result(this,"children"));if(t){var e=this.svgElement;var n=J.namespace[e?"svg":"xhtml"];var r=parseDOMJSON(t,n);(e?this.vel:this.$el).empty().append(r.fragment);this.childNodes=r.selectors}return this},findAttributeNode:function(t,e){let n=e;while(n&&n.nodeType===1){if(n.getAttribute(t))return n;if(n===this.el)return null;n=n.parentNode}return null},findAttribute:function(t,e){const n=this.findAttributeNode(t,e);return n&&n.getAttribute(t)},_ensureElement:function(){if(this.el)this.setElement(result(this,"el"));else{var t=result(this,"tagName");var e=Ne({},result(this,"attributes"));var n=Ne({},result(this,"style"));this.id&&(e.id=result(this,"id"));this.setElement(this._createElement(t));this._setAttributes(e);this._setStyle(n)}this._ensureElClassName()},_setAttributes:function(t){this.svgElement?this.vel.attr(t):this.$el.attr(t)},_setStyle:function(t){this.$el.css(t)},_createElement:function(t){return this.svgElement?document.createElementNS(J.namespace.svg,t):document.createElement(t)},_setElement:function(t){this.$el=t instanceof $?t:$(t);this.el=this.$el[0];this.svgElement&&(this.vel=J(this.el))},_ensureElClassName:function(){var t=result(this,"className");if(t){var e=addClassNamePrefix(t);this.svgElement?this.vel.removeClass(t).addClass(e):this.$el.removeClass(t).addClass(e)}},init:function(){},onRender:function(){},confirmUpdate:function(){return 0},setTheme:function(t,e){e=e||{};if(this.theme&&this.requireSetThemeOverride&&!e.override)return this;this.removeThemeClassName();this.addThemeClassName(t);this.onSetTheme(this.theme,t);this.theme=t;return this},addThemeClassName:function(t){t=t||this.theme;if(!t)return this;var e=this.themeClassNamePrefix+t;this.svgElement?this.vel.addClass(e):this.$el.addClass(e);return this},removeThemeClassName:function(t){t=t||this.theme;var e=this.themeClassNamePrefix+t;this.svgElement?this.vel.removeClass(e):this.$el.removeClass(e);return this},onSetTheme:function(t,e){},remove:function(){this.onRemove();this.undelegateDocumentEvents();Br[this.cid]=null;ViewBase.prototype.remove.apply(this,arguments);return this},onRemove:function(){},getEventNamespace:function(){return".joint-event-ns-"+this.cid},delegateElementEvents:function(t,e,n){if(!e)return this;n||(n={});var r=this.getEventNamespace();for(var i in e){var o=e[i];typeof o!=="function"&&(o=this[o]);o&&$(t).on(i+r,n,o.bind(this))}return this},undelegateElementEvents:function(t){$(t).off(this.getEventNamespace());return this},delegateDocumentEvents:function(t,e){t||(t=result(this,"documentEvents"));return this.delegateElementEvents(document,t,e)},undelegateDocumentEvents:function(){return this.undelegateElementEvents(document)},eventData:function(t,e){if(!t)throw new Error("eventData(): event object required.");var n=t.data;var r="__"+this.cid+"__";if(e===void 0)return n&&n[r]||{};n||(n=t.data={});n[r]||(n[r]={});Ne(n[r],e);return this},stopPropagation:function(t){this.eventData(t,{propagationStopped:true});return this},isPropagationStopped:function(t){return!!this.eventData(t).propagationStopped}},{extend:function(){var t=Array.from(arguments);var e=t[0]&&Ne({},t[0])||{};var n=t[1]&&Ne({},t[1])||{};var r=e.render||this.prototype&&this.prototype.render||null;e.render=function(){typeof r==="function"&&r.apply(this,arguments);this.render.__render__===r&&this.onRender();return this};e.render.__render__=r;return ViewBase.extend.call(this,e,n)}});class Listener{constructor(...t){this.callbackArguments=t}listenTo(t,e,...n){const{callbackArguments:r}=this;if(e&&typeof e==="object"){const[i=null]=n;Object.entries(e).forEach((([e,n])=>{if(typeof n==="function"){(i||r.length>0)&&(n=n.bind(i,...r));vn.listenTo.call(this,t,e,n)}}))}else if(typeof e==="string"&&typeof n[0]==="function"){let[i,o=null]=n;(o||r.length>0)&&(i=i.bind(o,...r));vn.listenTo.call(this,t,e,i)}}stopListening(){vn.stopListening.call(this)}}var Collection=function(t,e){e||(e={});this.preinitialize.apply(this,arguments);e.model&&(this.model=e.model);e.comparator!==void 0&&(this.comparator=e.comparator);this._reset();this.initialize.apply(this,arguments);t&&this.reset(t,Ne({silent:true},e))};var Fr={add:true,remove:true,merge:true};var Dr={add:true,remove:false};var splice=function(t,e,n){n=Math.min(Math.max(n,0),t.length);var r=Array(t.length-n);var i=e.length;var o;for(o=0;o<r.length;o++)r[o]=t[o+n];for(o=0;o<i;o++)t[o+n]=e[o];for(o=0;o<r.length;o++)t[o+i+n]=r[o]};Ne(Collection.prototype,vn,{model:Model,preinitialize:function(){},initialize:function(){},toJSON:function(t){return this.map((function(e){return e.toJSON(t)}))},add:function(t,e){return this.set(t,Ne({merge:false},e,Dr))},remove:function(t,e){e=Ne({},e);var n=!Array.isArray(t);t=n?[t]:t.slice();var r=this._removeModels(t,e);if(!e.silent&&r.length){e.changes={added:[],merged:[],removed:r};this.trigger("update",this,e)}return n?r[0]:r},set:function(t,e){if(t!=null){e=Ne({},Fr,e);var n=!Array.isArray(t);t=n?[t]:t.slice();var r=e.at;r!=null&&(r=+r);r>this.length&&(r=this.length);r<0&&(r+=this.length+1);var i=[];var o=[];var s=[];var a=[];var c={};var l=e.add;var u=e.merge;var h=e.remove;var d=false;var f=this.comparator&&r==null&&e.sort!==false;var p=isString(this.comparator)?this.comparator:null;var g,v;for(v=0;v<t.length;v++){g=t[v];var m=this.get(g);if(m){if(u&&g!==m){var y=this._isModel(g)?g.attributes:g;m.set(y,e);s.push(m);f&&!d&&(d=m.hasChanged(p))}if(!c[m.cid]){c[m.cid]=true;i.push(m)}t[v]=m}else if(l){g=t[v]=this._prepareModel(g,e);if(g){o.push(g);this._addReference(g,e);c[g.cid]=true;i.push(g)}}}if(h){for(v=0;v<this.length;v++){g=this.models[v];c[g.cid]||a.push(g)}a.length&&this._removeModels(a,e)}var b=false;var x=!f&&l&&h;if(i.length&&x){b=this.length!==i.length||this.models.some((function(t,e){return t!==i[e]}));this.models.length=0;splice(this.models,i,0);this.length=this.models.length}else if(o.length){f&&(d=true);splice(this.models,o,r==null?this.length:r);this.length=this.models.length}d&&this.sort({silent:true});if(!e.silent){for(v=0;v<o.length;v++){r!=null&&(e.index=r+v);g=o[v];g.trigger("add",g,this,e)}(d||b)&&this.trigger("sort",this,e);if(o.length||a.length||s.length){e.changes={added:o,removed:a,merged:s};this.trigger("update",this,e)}}return n?t[0]:t}},reset:function(t,e){e=e?clone$1(e):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],e);e.previousModels=this.models;this._reset();t=this.add(t,Ne({silent:true},e));e.silent||this.trigger("reset",this,e);return t},push:function(t,e){return this.add(t,Ne({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,Ne({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return Array.prototype.slice.apply(this.models,arguments)},get:function(t){if(t!=null)return this._byId[t]||this._byId[this.modelId(this._isModel(t)?t.attributes:t,t.idAttribute)]||t.cid&&this._byId[t.cid]},has:function(t){return this.get(t)!=null},at:function(t){t<0&&(t+=this.length);return this.models[t]},sort:function(t){var e=this.comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t||(t={});var n=e.length;isFunction(e)&&(e=e.bind(this));n===1||isString(e)?this.models=this.sortBy(e):this.models.sort(e);t.silent||this.trigger("sort",this,t);return this},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t,e){return t[e||this.model.prototype.idAttribute||"id"]},values:function(){return new CollectionIterator(this,zr)},keys:function(){return new CollectionIterator(this,jr)},entries:function(){return new CollectionIterator(this,Gr)},each:function(t,e){this.models.forEach(t,e)},filter:function(t,e){return this.models.filter(t,e)},find:function(t,e){return this.models.find(t,e)},findIndex:function(t,e){return this.models.findIndex(t,e)},first:function(){return this.models[0]},includes:function(t){return this.models.includes(t)},last:function(){return this.models[this.models.length-1]},isEmpty:function(){return!this.models.length},map:function(t,e){return this.models.map(t,e)},reduce:function(t,e=this.first()){return this.models.reduce(t,e)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(t,e){if(this._isModel(t)){t.collection||(t.collection=this);return t}e=e?clone$1(e):{};e.collection=this;var n;n=this.model.prototype?new this.model(t,e):this.model(t,e);if(!n.validationError)return n;this.trigger("invalid",this,n.validationError,e);return false},_removeModels:function(t,e){var n=[];for(var r=0;r<t.length;r++){var i=this.get(t[r]);if(i){var o=this.models.indexOf(i);this.models.splice(o,1);this.length--;delete this._byId[i.cid];var s=this.modelId(i.attributes,i.idAttribute);s!=null&&delete this._byId[s];if(!e.silent){e.index=o;i.trigger("remove",i,this,e)}n.push(i);this._removeReference(i,e)}}t.length>0&&!e.silent&&delete e.index;return n},_isModel:function(t){return t instanceof Model},_addReference:function(t,e){this._byId[t.cid]=t;var n=this.modelId(t.attributes,t.idAttribute);n!=null&&(this._byId[n]=t);t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var n=this.modelId(t.attributes,t.idAttribute);n!=null&&delete this._byId[n];this===t.collection&&delete t.collection;t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,r){if(e){if((t==="add"||t==="remove")&&n!==this)return;if(t==="changeId"){var i=this.modelId(e.previousAttributes(),e.idAttribute);var o=this.modelId(e.attributes,e.idAttribute);i!=null&&delete this._byId[i];o!=null&&(this._byId[o]=e)}}this.trigger.apply(this,arguments)}});var Vr=typeof Symbol==="function"&&Symbol.iterator;Vr&&(Collection.prototype[Vr]=Collection.prototype.values);var CollectionIterator=function(t,e){this._collection=t;this._kind=e;this._index=0};var zr=1;var jr=2;var Gr=3;Vr&&(CollectionIterator.prototype[Vr]=function(){return this});CollectionIterator.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var t=this._collection.at(this._index);this._index++;var e;if(this._kind===zr)e=t;else{var n=this._collection.modelId(t.attributes,t.idAttribute);e=this._kind===jr?n:[n,t]}return{value:e,done:false}}this._collection=void 0}return{value:void 0,done:true}};var Ur={toArray:1,sortBy:3};var Wr=[Collection,Ur,"models"];function addMethods(t){var e=t[0],n=t[1],r=t[2];const i={sortBy:sortBy,toArray:toArray$1};addMethodsUtil(e,i,n,r)}addMethods(Wr);Collection.extend=extend;var Hr=Object.freeze(Object.defineProperty({__proto__:null,$:$,Collection:Collection,Data:Data,Event:Event,Events:vn,Listener:Listener,Model:Model,View:Ir,ViewBase:ViewBase,views:Br},Symbol.toStringTag,{value:"Module"}));function toArray(t){return t?Array.isArray(t)?t:[t]:[]}const $r=Ir.extend({tagName:"g",svgElement:true,className:"highlight",HIGHLIGHT_FLAG:1,UPDATE_PRIORITY:3,DETACHABLE:false,UPDATABLE:true,MOUNTABLE:true,cellView:null,nodeSelector:null,node:null,updateRequested:false,postponedUpdate:false,transformGroup:null,detachedTransformGroup:null,requestUpdate(t,e){const{paper:n}=t;this.cellView=t;this.nodeSelector=e;if(n){this.updateRequested=true;n.requestViewUpdate(this,this.HIGHLIGHT_FLAG,this.UPDATE_PRIORITY)}},confirmUpdate(){this.updateRequested=false;const{cellView:t,nodeSelector:e}=this;if(t.isMounted()){this.update(t,e);this.mount();this.transform()}else this.postponedUpdate=true;return 0},findNode(t,e=null){let n;if(typeof e==="string")n=t.findNode(e);else if(isPlainObject(e)){const r=t.model.isLink();const{label:i=null,port:o,selector:s}=e;n=r&&i!==null?t.findLabelNode(i,s):!r&&o?t.findPortNode(o,s):t.findNode(s)}else if(e){n=J.toNode(e);n instanceof SVGElement||(n=null)}return n||null},getNodeMatrix(t,e){const{options:n}=this;const{layer:r}=n;const{rotatableNode:i}=t;const o=t.getNodeMatrix(e);return i?r?i.contains(e)?o:t.getRootRotateMatrix().inverse().multiply(o):t.getNodeRotateMatrix(e).multiply(o):o},mount(){const{MOUNTABLE:t,cellView:e,el:n,options:r,transformGroup:i,detachedTransformGroup:o,postponedUpdate:s,nodeSelector:a}=this;if(!t||i)return;if(s){this.update(e,a);this.transform();return}const{vel:c,paper:l}=e;const{layer:u}=r;if(u){let t;if(o){t=o;this.detachedTransformGroup=null}else t=J("g").addClass("highlight-transform").append(n);this.transformGroup=t;l.getLayerView(u).insertSortedNode(t.node,r.z)}else n.parentNode&&!n.nextSibling||c.append(n)},unmount(){const{MOUNTABLE:t,transformGroup:e,vel:n}=this;if(t)if(e){this.transformGroup=null;this.detachedTransformGroup=e;e.remove()}else n.remove()},transform(){const{transformGroup:t,cellView:e,updateRequested:n}=this;if(!t||e.model.isLink()||n)return;const r=e.getRootTranslateMatrix();const i=e.getRootRotateMatrix();const o=r.multiply(i);t.attr("transform",J.matrixToTransformString(o))},update(){const{node:t,cellView:e,nodeSelector:n,updateRequested:r,id:i}=this;if(r)return;this.postponedUpdate=false;const o=this.node=this.findNode(e,n);t&&this.unhighlight(e,t);if(o){this.highlight(e,o);this.mount()}else{this.unmount();e.notify("cell:highlight:invalid",i,this)}},onRemove(){const{node:t,cellView:e,id:n,constructor:r}=this;t&&this.unhighlight(e,t);this.unmount();r._removeRef(e,n)},highlight(t,e){},unhighlight(t,e){},listenToUpdateAttributes(t){const e=result(this,"UPDATE_ATTRIBUTES");Array.isArray(e)&&e.length!==0&&this.listenTo(t.model,"change",this.onCellAttributeChange)},onCellAttributeChange(){const{cellView:t}=this;if(!t)return;const{model:e,paper:n}=t;const r=result(this,"UPDATE_ATTRIBUTES");r.some((t=>e.hasChanged(t)))&&n.requestViewUpdate(this,this.HIGHLIGHT_FLAG,this.UPDATE_PRIORITY)}},{_views:{},highlight:function(t,e,n){const r=this.uniqueId(e,n);this.add(t,e,r,n)},unhighlight:function(t,e,n){const r=this.uniqueId(e,n);this.remove(t,r)},get(t,e=null){const{cid:n}=t;const{_views:r}=this;const i=r[n];if(e===null){const t=[];if(!i)return t;for(let e in i){const n=i[e];n instanceof this&&t.push(n)}return t}if(!i)return null;if(e in i){const t=i[e];if(t instanceof this)return t}return null},add(t,e,n,r={}){if(!n)throw new Error("dia.HighlighterView: An ID required.");const i=$r.get(t,n);i&&i.remove();const o=new this(r);o.id=n;this._addRef(t,n,o);o.requestUpdate(t,e);o.listenToUpdateAttributes(t);return o},_addRef(t,e,n){const{cid:r}=t;const{_views:i}=this;let o=i[r];o||(o=i[r]={});o[e]=n},_removeRef(t,e){const{cid:n}=t;const{_views:r}=this;const i=r[n];if(i){e&&delete i[e];for(let t in i)return;delete r[n]}},remove(t,e=null){toArray(this.get(t,e)).forEach((t=>{t.remove()}))},getAll(t,e=null){const n=[];const{_views:r}=this;for(let i in r)for(let o in r[i]){const s=r[i][o];s.cellView.paper===t&&s instanceof this&&(e===null||o===e)&&n.push(s)}return n},removeAll(t,e=null){this.getAll(t,e).forEach((t=>t.remove()))},update(t,e=null,n=false){toArray(this.get(t,e)).forEach((t=>{(n||t.UPDATABLE)&&t.update()}))},transform(t,e=null){toArray(this.get(t,e)).forEach((t=>{t.UPDATABLE&&t.transform()}))},unmount(t,e=null){toArray(this.get(t,e)).forEach((t=>t.unmount()))},mount(t,e=null){toArray(this.get(t,e)).forEach((t=>t.mount()))},uniqueId(t,e=""){return J.ensureId(t)+JSON.stringify(e)}});const qr=$r.extend({tagName:"path",className:"highlight-stroke",attributes:{"pointer-events":"none",fill:"none"},options:{padding:3,rx:0,ry:0,useFirstSubpath:false,attrs:{"stroke-width":3,stroke:"#FEB663"}},getPathData(t,e){const{options:n}=this;const{useFirstSubpath:r}=n;let i;try{const t=J(e);i=t.convertToPathData().trim();if(t.tagName()==="PATH"&&r){const t=i.search(/.M/i)+1;t>0&&(i=i.substr(0,t))}}catch(r){const o=t.getNodeBoundingRect(e);i=J.rectToPath(Ne({},n,o.toJSON()))}return i},highlightConnection(t){this.vel.attr("d",t.getSerializedConnection())},highlightNode(t,e){const{vel:n,options:r}=this;const{padding:i,layer:o}=r;let s=this.getNodeMatrix(t,e);if(i){o||e!==t.el||n.remove();let r=t.getNodeBoundingRect(e);const a=r.x+r.width/2;const c=r.y+r.height/2;r=J.transformRect(r,s);const l=Math.max(r.width,1);const u=Math.max(r.height,1);const h=(l+i)/l;const d=(u+i)/u;const f=J.createSVGMatrix({a:h,b:0,c:0,d:d,e:a-h*a,f:c-d*c});s=s.multiply(f)}n.attr({d:this.getPathData(t,e),transform:J.matrixToTransformString(s)})},highlight(t,e){const{vel:n,options:r}=this;n.attr(r.attrs);r.nonScalingStroke&&n.attr("vector-effect","non-scaling-stroke");t.isNodeConnection(e)?this.highlightConnection(t):this.highlightNode(t,e)}});const Yr=20;function forEachDescendant(t,e){const n=t.children();while(n.length>0){const t=n.shift();e(t)&&n.push(...t.children())}}const Xr=$r.extend({tagName:"rect",className:"highlight-mask",attributes:{"pointer-events":"none"},options:{padding:3,maskClip:Yr,deep:false,attrs:{stroke:"#FEB663","stroke-width":3,"stroke-linecap":"butt","stroke-linejoin":"miter"}},VISIBLE:"white",INVISIBLE:"black",MASK_ROOT_ATTRIBUTE_BLACKLIST:["marker-start","marker-end","marker-mid","transform","stroke-dasharray","class"],MASK_CHILD_ATTRIBUTE_BLACKLIST:["stroke","fill","stroke-width","stroke-opacity","stroke-dasharray","fill-opacity","marker-start","marker-end","marker-mid","class"],MASK_REPLACE_TAGS:["FOREIGNOBJECT","IMAGE","USE","TEXT","TSPAN","TEXTPATH"],MASK_REMOVE_TAGS:["TEXT","TSPAN","TEXTPATH"],transformMaskChild(t,e){const{MASK_CHILD_ATTRIBUTE_BLACKLIST:n,MASK_REPLACE_TAGS:r,MASK_REMOVE_TAGS:i}=this;const o=e.tagName();if(!J.isSVGGraphicsElement(e)||i.includes(o)){e.remove();return false}if(r.includes(o)){const n=t.vel.findOne(`#${e.id}`);if(n){const{node:r}=n;let i=t.getNodeBoundingRect(r);t.model.isElement()&&(i=J.transformRect(i,t.getNodeMatrix(r)));const o=J("rect",i.toJSON());const{x:s,y:a}=i.center();const{angle:c,cx:l=s,cy:u=a}=n.rotate();c&&o.rotate(c,l,u);e.parent().append(o)}e.remove();return false}n.forEach((t=>{t==="fill"&&e.attr("fill")==="none"||e.removeAttr(t)}));return true},transformMaskRoot(t,e){const{MASK_ROOT_ATTRIBUTE_BLACKLIST:n}=this;n.forEach((t=>{e.removeAttr(t)}))},getMaskShape(t,e){const{options:n,MASK_REPLACE_TAGS:r}=this;const{deep:i}=n;const o=e.tagName();let s;if(o==="G"){if(!i)return null;s=e.clone();forEachDescendant(s,(e=>this.transformMaskChild(t,e)))}else{if(r.includes(o))return null;s=e.clone()}this.transformMaskRoot(t,s);return s},getMaskId(){return`highlight-mask-${this.cid}`},getMask(t,e){const{VISIBLE:n,INVISIBLE:r,options:i}=this;const{padding:o,attrs:s}=i;const a=parseFloat(J("g").attr(s).attr("stroke-width"));const c=e.attr("fill")!=="none";let l=parseFloat(e.attr("stroke-width"));isNaN(l)&&(l=1);const u=l+o*2;const h=u+a*2;let d=this.getMaskShape(t,e);if(!d){const n=t.getNodeBoundingRect(e.node);n.inflate(n.width?0:.5,n.height?0:.5);d=J("rect",n.toJSON())}d.attr(s);return J("mask",{id:this.getMaskId()}).append([d.clone().attr({fill:c?n:"none",stroke:n,"stroke-width":h}),d.clone().attr({fill:c?r:"none",stroke:r,"stroke-width":u})])},removeMask(t){const e=t.svg.getElementById(this.getMaskId());e&&t.defs.removeChild(e)},addMask(t,e){t.defs.appendChild(e.node)},highlight(t,e){const{options:n,vel:r}=this;const{padding:i,attrs:o,maskClip:s=Yr,layer:a}=n;const c="stroke"in o?o.stroke:"#000000";a||e!==t.el||r.remove();const l=t.getNodeBoundingRect(e).inflate(i+s);const u=this.getNodeMatrix(t,e);const h=this.getMask(t,J(e));this.addMask(t.paper,h);r.attr(l.toJSON());r.attr({transform:J.matrixToTransformString(u),mask:`url(#${h.id})`,fill:c})},unhighlight(t){this.removeMask(t.paper)}});const Zr=$r.extend({UPDATABLE:false,MOUNTABLE:false,highlight:function(t,e){const{alphaValue:n=.3}=this.options;e.style.opacity=n},unhighlight:function(t,e){e.style.opacity=""}});const Jr=addClassNamePrefix("highlighted");const Kr=$r.extend({UPDATABLE:false,MOUNTABLE:false,options:{className:Jr},highlight:function(t,e){J(e).addClass(this.options.className)},unhighlight:function(t,e){J(e).removeClass(this.options.className)}},{className:Jr});const Qr={ROW:"row",COLUMN:"column"};const ti=$r.extend({tagName:"g",MOUNTABLE:true,UPDATE_ATTRIBUTES:function(){return[this.options.attribute]},_prevItems:null,highlight(t,e){const n=t.model;const{attribute:r,size:i=20,gap:o=5,direction:s=Qr.ROW}=this.options;if(!r)throw new Error("List: attribute is required");const a=typeof i==="number"?{width:i,height:i}:i;const c=s===Qr.ROW;const l=c?a.width:a.height;let u=n.get(r);Array.isArray(u)||(u=[]);const h=this._prevItems||[];const d=u.map(((t,e)=>isEqual(h[e],u[e])));if(h.length!==u.length||d.some((t=>!t))){const t=this.vel.children();const e=u.map(((e,n)=>{const i=n in t?t[n].node:null;if(d[n])return i;const s=this.createListItem(e,a,i);if(!s)return null;if(!(s instanceof SVGElement))throw new Error("List: item must be an SVGElement");s.dataset.index=n;s.dataset.attribute=r;const u=n*(l+o);s.setAttribute("transform",c?`translate(${u}, 0)`:`translate(0, ${u})`);return s}));this.vel.empty().append(e);this._prevItems=u}const f=u.length;const p=f===0?0:f*l+(f-1)*o;const g=c?{width:p,height:a.height}:{width:a.width,height:p};this.position(n,g)},position(t,e){const{vel:n,options:r}=this;const{margin:i=5,position:o="top-left"}=r;const{width:s,height:a}=t.size();const{left:c,right:l,top:u,bottom:h}=normalizeSides(i);const d=new Rect(c,u,s-(c+l),a-(u+h));let{x:f,y:p}=getRectPoint(d,o);switch(o){case zn.CENTER:case zn.TOP:case zn.BOTTOM:f-=e.width/2;break;case zn.RIGHT:case zn.BOTTOM_RIGHT:case zn.TOP_RIGHT:f-=e.width;break}switch(o){case zn.CENTER:case zn.RIGHT:case zn.LEFT:p-=e.height/2;break;case zn.BOTTOM:case zn.BOTTOM_RIGHT:case zn.BOTTOM_LEFT:p-=e.height;break}n.attr("transform",`translate(${f}, ${p})`)}},{Directions:Qr,Positions:zn});var ei=Object.freeze(Object.defineProperty({__proto__:null,addClass:Kr,list:ti,mask:Xr,opacity:Zr,stroke:qr},Symbol.toStringTag,{value:"Module"}));function offsetPoint(t,e,n){if(isPlainObject(n)){const{x:r,y:i}=n;if(isFinite(i)){const n=new Line(e,t);const{start:r,end:o}=n.parallel(i);e=r;t=o}n=r}if(!isFinite(n))return t;var r=t.distance(e);return n===0&&r>0?t:t.move(e,-Math.min(n,r-1))}function stroke(t){var e=t.getAttribute("stroke-width");return e===null?0:parseFloat(e)||0}function alignLine(t,e,n=0){let r,i,o,s;const{start:a,end:c}=t;switch(e){case"left":r="x";i=c;o=a;s=-1;break;case"right":r="x";i=a;o=c;s=1;break;case"top":r="y";i=c;o=a;s=-1;break;case"bottom":r="y";i=a;o=c;s=1;break;default:return}a[r]<c[r]?i[r]=o[r]:o[r]=i[r];if(isFinite(n)){i[r]+=s*n;o[r]+=s*n}}function anchorConnectionPoint(t,e,n,r){let{offset:i,alignOffset:o,align:s}=r;s&&alignLine(t,s,o);return offsetPoint(t.end,t.start,i)}function bboxIntersection(t,e,n,r){var i=e.getNodeBBox(n);r.stroke&&i.inflate(stroke(n)/2);var o=t.intersect(i);var s=o?t.start.chooseClosest(o):t.end;return offsetPoint(s,t.start,r.offset)}function rectangleIntersection(t,e,n,r){var i=e.model.angle();if(i===0)return bboxIntersection(t,e,n,r);var o=e.getNodeUnrotatedBBox(n);r.stroke&&o.inflate(stroke(n)/2);var s=o.center();var a=t.clone().rotate(s,i);var c=a.setLength(1e6).intersect(o);var l=c?a.start.chooseClosest(c).rotate(s,-i):t.end;return offsetPoint(l,t.start,r.offset)}function findShapeNode(t){if(!t)return null;var e=t;do{var n=e.tagName;if(typeof n!=="string")return null;n=n.toUpperCase();if(n==="G")e=e.firstElementChild;else{if(n!=="TITLE")break;e=e.nextElementSibling}}while(e);return e}var ni="segmentSubdivisons";var ri="shapeBBox";function boundaryIntersection(t,e,n,r){var i,o;var s=r.selector;var a=t.end;i=typeof s==="string"?e.findNode(s):s===false?n:Array.isArray(s)?getByPath(n,s):findShapeNode(n);if(!J.isSVGGraphicsElement(i)){if(i===n||!J.isSVGGraphicsElement(n))return a;i=n}var c=e.getNodeShape(i);var l=e.getNodeMatrix(i);var u=e.getRootTranslateMatrix();var h=e.getRootRotateMatrix();var d=u.multiply(h).multiply(l);var f=d.inverse();var p=J.transformLine(t,f);var g=p.start.clone();var v=e.getNodeData(i);if(r.insideout===false){v[ri]||(v[ri]=c.bbox());var m=v[ri];if(m.containsPoint(g))return a}var y;if(c instanceof Path$1){var b=r.precision||2;v[ni]||(v[ni]=c.getSegmentSubdivisions({precision:b}));y={precision:b,segmentSubdivisions:v[ni]}}r.extrapolate===true&&p.setLength(1e6);o=p.intersect(c,y);o?J.isArray(o)&&(o=g.chooseClosest(o)):r.sticky===true&&(o=c instanceof Rect?c.pointNearestToPoint(g):c instanceof Ellipse$1?c.intersectionWithLineFromCenterToPoint(g):c.closestPoint(g,y));var x=o?J.transformPoint(o,d):a;var w=r.offset||0;r.stroke&&(w+=stroke(i)/2);return offsetPoint(x,t.start,w)}const ii=anchorConnectionPoint;const oi=bboxIntersection;const si=rectangleIntersection;const ai=boundaryIntersection;var ci=Object.freeze(Object.defineProperty({__proto__:null,anchor:ii,bbox:oi,boundary:ai,rectangle:si},Symbol.toStringTag,{value:"Module"}));function abs2rel(t,e){if(e===0)return"0%";const n=1e3;const r=Math.round(t/e*100*n)/n;return`${r}%`}function pin(t){return function(e,n,r,i){var o=n.isNodeConnection(r)?pinnedLinkEnd:pinnedElementEnd;return o(t,e,n,r,i)}}function pinnedElementEnd(t,e,n,r,i){var o=n.model.angle();var s=n.getNodeUnrotatedBBox(r);var a=n.model.getBBox().center();i.rotate(a,o);var c=i.x-s.x;var l=i.y-s.y;if(t){c=abs2rel(c,s.width);l=abs2rel(l,s.height)}e.anchor={name:"topLeft",args:{dx:c,dy:l,rotate:true}};return e}function pinnedLinkEnd(t,e,n,r,i){var o=n.getConnection();if(!o)return e;var s=o.closestPointLength(i);if(t){var a=o.length();e.anchor={name:"connectionRatio",args:{ratio:s/a}}}else e.anchor={name:"connectionLength",args:{length:s}};return e}const li=noop;const ui=pin(false);const hi=pin(true);var di=Object.freeze(Object.defineProperty({__proto__:null,pinAbsolute:ui,pinRelative:hi,useDefaults:li},Symbol.toStringTag,{value:"Module"}));const normal=function(t,e,n){return t};const oneSide=function(t,e,n){var r=e.side||"bottom";var i=normalizeSides(e.padding||40);var o=n.sourceBBox;var s=n.targetBBox;var a=o.center();var c=s.center();var l,u,h;switch(r){case"bottom":h=1;l="y";u="height";break;case"top":h=-1;l="y";u="height";break;case"left":h=-1;l="x";u="width";break;case"right":h=1;l="x";u="width";break;default:throw new Error("Router: invalid side")}a[l]+=h*(o[u]/2+i[r]);c[l]+=h*(s[u]/2+i[r]);h*(a[l]-c[l])>0?c[l]=a[l]:a[l]=c[l];return[a].concat(t,c)};var fi={N:"S",S:"N",E:"W",W:"E"};var pi={N:-Math.PI/2*3,S:-Math.PI/2,E:0,W:Math.PI};function freeJoin(t,e,n){var r=new Point(t.x,e.y);n.containsPoint(r)&&(r=new Point(e.x,t.y));return r}function getBBoxSize(t,e){return t[e==="W"||e==="E"?"width":"height"]}function getBearing(t,e){return t.x===e.x?t.y>e.y?"N":"S":t.y===e.y?t.x>e.x?"W":"E":null}function getPointBox(t){return new Rect(t.x,t.y,0,0)}function getPaddingBox(t){var e=normalizeSides(t.padding||t.elementPadding||20);return{x:-e.left,y:-e.top,width:e.left+e.right,height:e.top+e.bottom}}function getSourceBBox$1(t,e){return t.sourceBBox.clone().moveAndExpand(getPaddingBox(e))}function getTargetBBox$1(t,e){return t.targetBBox.clone().moveAndExpand(getPaddingBox(e))}function getSourceAnchor$1(t,e){if(t.sourceAnchor)return t.sourceAnchor;var n=getSourceBBox$1(t,e);return n.center()}function getTargetAnchor$1(t,e){if(t.targetAnchor)return t.targetAnchor;var n=getTargetBBox$1(t,e);return n.center()}function vertexVertex(t,e,n){var r=new Point(t.x,e.y);var i=new Point(e.x,t.y);var o=getBearing(t,r);var s=getBearing(t,i);var a=fi[n];var c=o===n||o!==a&&(s===a||s!==n)?r:i;return{points:[c],direction:getBearing(c,e)}}function elementVertex(t,e,n){var r=freeJoin(t,e,n);return{points:[r],direction:getBearing(r,e)}}function vertexElement(t,e,n,r){var i={};var o=[new Point(t.x,e.y),new Point(e.x,t.y)];var s=o.filter((function(t){return!n.containsPoint(t)}));var a=s.filter((function(e){return getBearing(e,t)!==r}));var c;if(a.length>0){c=a.filter((function(e){return getBearing(t,e)===r})).pop();c=c||a[0];i.points=[c];i.direction=getBearing(c,e)}else{c=difference(o,s)[0];var l=new Point(e).move(c,-getBBoxSize(n,r)/2);var u=freeJoin(l,t,n);i.points=[u,l];i.direction=getBearing(l,e)}return i}function elementElement(t,e,n,r){var i=elementVertex(e,t,r);var o=i.points[0];if(n.containsPoint(o)){i=elementVertex(t,e,n);var s=i.points[0];if(r.containsPoint(s)){var a=new Point(t).move(s,-getBBoxSize(n,getBearing(t,s))/2);var c=new Point(e).move(o,-getBBoxSize(r,getBearing(e,o))/2);var l=new Line(a,c).midpoint();var u=elementVertex(t,l,n);var h=vertexVertex(l,e,u.direction);i.points=[u.points[0],h.points[0]];i.direction=h.direction}}return i}function insideElement(t,e,n,r,i){var o={};var s=n.union(r).inflate(1);var a=s.center().distance(e)>s.center().distance(t);var c=a?e:t;var l=a?t:e;var u,h,d;if(i){u=Point.fromPolar(s.width+s.height,pi[i],c);u=s.pointNearestToPoint(u).move(u,-1)}else u=s.pointNearestToPoint(c).move(c,1);h=freeJoin(u,l,s);if(u.round().equals(h.round())){h=Point.fromPolar(s.width+s.height,toRad(u.theta(c))+Math.PI/2,l);h=s.pointNearestToPoint(h).move(l,1).round();d=freeJoin(u,h,s);o.points=a?[h,d,u]:[u,d,h]}else o.points=a?[h,u]:[u,h];o.direction=getBearing(a?u:h,e);return o}function orthogonal(t,e,n){var r=getSourceBBox$1(n,e);var i=getTargetBBox$1(n,e);var o=getSourceAnchor$1(n,e);var s=getTargetAnchor$1(n,e);r=r.union(getPointBox(o));i=i.union(getPointBox(s));t=toArray$1(t).map(Point);t.unshift(o);t.push(s);var a;var c=[];for(var l=0,u=t.length-1;l<u;l++){var h=null;var d=t[l];var f=t[l+1];var p=!!getBearing(d,f);if(l===0)l+1===u?r.intersect(i.clone().inflate(1))?h=insideElement(d,f,r,i):p||(h=elementElement(d,f,r,i)):r.containsPoint(f)?h=insideElement(d,f,r,getPointBox(f).moveAndExpand(getPaddingBox(e))):p||(h=elementVertex(d,f,r));else if(l+1===u){var g=p&&getBearing(f,d)===a;i.containsPoint(d)||g?h=insideElement(d,f,getPointBox(d).moveAndExpand(getPaddingBox(e)),i,a):p||(h=vertexElement(d,f,i,a))}else p||(h=vertexVertex(d,f,a));if(h){Array.prototype.push.apply(c,h.points);a=h.direction}else a=getBearing(d,f);l+1<u&&c.push(f)}return c}var gi={step:10,maximumLoops:2e3,precision:1,maxAllowedDirectionChange:90,perpendicular:true,excludeEnds:[],excludeTypes:[],startDirections:["top","right","bottom","left"],endDirections:["top","right","bottom","left"],directionMap:{top:{x:0,y:-1},right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0}},cost:function(){return this.step},directions:function(){var t=this.step;var e=this.cost();return[{offsetX:t,offsetY:0,cost:e},{offsetX:-t,offsetY:0,cost:e},{offsetX:0,offsetY:t,cost:e},{offsetX:0,offsetY:-t,cost:e}]},penalties:function(){return{0:0,45:this.step/2,90:this.step/2}},paddingBox:function(){var t=this.step;return{x:-t,y:-t,width:2*t,height:2*t}},isPointObstacle:null,fallbackRouter:function(t,e,n){if(!isFunction(orthogonal))throw new Error("Manhattan requires the orthogonal router as default fallback.");return orthogonal(t,Ne({},gi,e),n)},fallbackRoute:function(t,e,n){return null},draggingRoute:null};function ObstacleMap(t){this.map={};this.options=t;this.mapGridSize=100}ObstacleMap.prototype.build=function(t,e){var n=this.options;var r=toArray$1(n.excludeEnds).reduce((function(n,r){var i=e.get(r);if(i){var o=t.getCell(i.id);o&&n.push(o)}return n}),[]);var i=[];var o=t.getCell(e.get("source").id);o&&(i=union(i,o.getAncestors().map((function(t){return t.id}))));var s=t.getCell(e.get("target").id);s&&(i=union(i,s.getAncestors().map((function(t){return t.id}))));var a=this.mapGridSize;t.getElements().reduce((function(t,e){var o=toArray$1(n.excludeTypes).includes(e.get("type"));var s=r.find((function(t){return t.id===e.id}));var c=i.includes(e.id);var l=o||s||c;if(!l){var u=e.getBBox().moveAndExpand(n.paddingBox);var h=u.origin().snapToGrid(a);var d=u.corner().snapToGrid(a);for(var f=h.x;f<=d.x;f+=a)for(var p=h.y;p<=d.y;p+=a){var g=f+"@"+p;t[g]=t[g]||[];t[g].push(u)}}return t}),this.map);return this};ObstacleMap.prototype.isPointAccessible=function(t){var e=t.clone().snapToGrid(this.mapGridSize).toString();return toArray$1(this.map[e]).every((function(e){return!e.containsPoint(t)}))};function SortedSet(){this.items=[];this.hash={};this.values={};this.OPEN=1;this.CLOSE=2}SortedSet.prototype.add=function(t,e){this.hash[t]?this.items.splice(this.items.indexOf(t),1):this.hash[t]=this.OPEN;this.values[t]=e;var n=sortedIndex(this.items,t,function(t){return this.values[t]}.bind(this));this.items.splice(n,0,t)};SortedSet.prototype.remove=function(t){this.hash[t]=this.CLOSE};SortedSet.prototype.isOpen=function(t){return this.hash[t]===this.OPEN};SortedSet.prototype.isClose=function(t){return this.hash[t]===this.CLOSE};SortedSet.prototype.isEmpty=function(){return this.items.length===0};SortedSet.prototype.pop=function(){var t=this.items.shift();this.remove(t);return t};function getSourceBBox(t,e){return e&&e.paddingBox?t.sourceBBox.clone().moveAndExpand(e.paddingBox):t.sourceBBox.clone()}function getTargetBBox(t,e){return e&&e.paddingBox?t.targetBBox.clone().moveAndExpand(e.paddingBox):t.targetBBox.clone()}function getSourceAnchor(t,e){if(t.sourceAnchor)return t.sourceAnchor;var n=getSourceBBox(t,e);return n.center()}function getTargetAnchor(t,e){if(t.targetAnchor)return t.targetAnchor;var n=getTargetBBox(t,e);return n.center()}function getDirectionAngle(t,e,n,r,i){var o=360/n;var s=t.theta(fixAngleEnd(t,e,r,i));var a=normalizeAngle(s+o/2);return o*Math.floor(a/o)}function fixAngleEnd(t,e,n,r){var i=r.step;var o=e.x-t.x;var s=e.y-t.y;var a=o/n.x;var c=s/n.y;var l=a*i;var u=c*i;return new Point(t.x+l,t.y+u)}function getDirectionChange(t,e){var n=Math.abs(t-e);return n>180?360-n:n}function getGridOffsets(t,e,n){var r=n.step;toArray$1(n.directions).forEach((function(t){t.gridOffsetX=t.offsetX/r*e.x;t.gridOffsetY=t.offsetY/r*e.y}))}function getGrid(t,e,n){return{source:e.clone(),x:getGridDimension(n.x-e.x,t),y:getGridDimension(n.y-e.y,t)}}function getGridDimension(t,e){if(!t)return e;var n=Math.abs(t);var r=Math.round(n/e);if(!r)return n;var i=r*e;var o=n-i;var s=o/r;return e+s}function snapToGrid(t,e){var n=e.source;var r=snapToGrid$1(t.x-n.x,e.x)+n.x;var i=snapToGrid$1(t.y-n.y,e.y)+n.y;return new Point(r,i)}function round(t,e){return t.round(e)}function align(t,e,n){return round(snapToGrid(t.clone(),e),n)}function getKey(t){return t.clone().toString()}function normalizePoint(t){return new Point(t.x===0?0:Math.abs(t.x)/t.x,t.y===0?0:Math.abs(t.y)/t.y)}function reconstructRoute(t,e,n,r,i,o,s){var a=[];var c=normalizePoint(i.difference(n));var l=getKey(n);var u=t[l];var h;while(u){h=e[l];var d=normalizePoint(h.difference(u));if(!d.equals(c)){a.unshift(h);c=d}l=getKey(u);u=t[l]}var f=e[l];var p=normalizePoint(f.difference(r));p.equals(c)||a.unshift(f);return a}function estimateCost(t,e){var n=Infinity;for(var r=0,i=e.length;r<i;r++){var o=t.manhattanDistance(e[r]);o<n&&(n=o)}return n}function getRectPoints(t,e,n,r,i){var o=i.precision;var s=i.directionMap;var a=t.difference(e.center());var c=isObject(s)?Object.keys(s):[];var l=toArray$1(n);var u=c.reduce((function(n,i){if(l.includes(i)){var c=s[i];var u=new Point(t.x+c.x*(Math.abs(a.x)+e.width),t.y+c.y*(Math.abs(a.y)+e.height));var h=new Line(t,u);var d=h.intersect(e)||[];var f=d.length;var p;var g=null;for(var v=0;v<f;v++){var m=d[v];var y=t.squaredDistance(m);if(p===void 0||y>p){p=y;g=m}}if(g){var b=align(g,r,o);e.containsPoint(b)&&(b=align(b.offset(c.x*r.x,c.y*r.y),r,o));n.push(b)}}return n}),[]);e.containsPoint(t)||u.push(align(t,r,o));return u}function findRoute(t,e,n,r){var i=r.precision;var o,s;o=round(t instanceof Rect?getSourceAnchor(this,r).clone():t.clone(),i);s=round(e instanceof Rect?getTargetAnchor(this,r).clone():e.clone(),i);var a=getGrid(r.step,o,s);var c,l;var u,h;if(t instanceof Rect){c=o;u=getRectPoints(c,t,r.startDirections,a,r)}else{c=o;u=[c]}if(e instanceof Rect){l=s;h=getRectPoints(s,e,r.endDirections,a,r)}else{l=s;h=[l]}u=u.filter((t=>!n(t)));h=h.filter((t=>!n(t)));if(u.length>0&&h.length>0){var d=new SortedSet;var f={};var p={};var g={};for(var v=0,m=u.length;v<m;v++){var y=u[v];var b=getKey(y);d.add(b,estimateCost(y,h));f[b]=y;g[b]=0}var x=r.previousDirectionAngle;var w=x===void 0;var A,P;var T=r.directions;getGridOffsets(T,a,r);var E=T.length;var S=toArray$1(h).reduce((function(t,e){var n=getKey(e);t.push(n);return t}),[]);var k=r.maximumLoops;while(!d.isEmpty()&&k>0){var L=d.pop();var C=f[L];var _=p[L];var M=g[L];var N=_===void 0;var O=C.equals(c);var R;R=N?w?O?null:getDirectionAngle(c,C,E,a,r):x:getDirectionAngle(_,C,E,a,r);var B=u.length===h.length;if(B)for(var I=0;I<u.length;I++)if(!u[I].equals(h[I])){B=false;break}var F=N&&B;if(!F&&S.indexOf(L)>=0){r.previousDirectionAngle=R;return reconstructRoute(p,f,C,c,l,a,r)}for(v=0;v<E;v++){A=T[v];var D=A.angle;P=getDirectionChange(R,D);if(w&&O||!(P>r.maxAllowedDirectionChange)){var z=align(C.clone().offset(A.gridOffsetX,A.gridOffsetY),a,i);var j=getKey(z);if(!d.isClose(j)&&!n(z)){if(S.indexOf(j)>=0){var G=z.equals(l);if(!G){var U=getDirectionAngle(z,l,E,a,r);var W=getDirectionChange(D,U);if(W>r.maxAllowedDirectionChange)continue}}var H=A.cost;var q=O?0:r.penalties[P];var Y=M+H+q;if(!d.isOpen(j)||Y<g[j]){f[j]=z;p[j]=C;g[j]=Y;d.add(j,Y+estimateCost(z,h))}}}}k--}}return r.fallbackRoute.call(this,c,l,r)}function resolveOptions(t){t.directions=result(t,"directions");t.penalties=result(t,"penalties");t.paddingBox=result(t,"paddingBox");t.padding=result(t,"padding");if(t.padding){var e=normalizeSides(t.padding);t.paddingBox={x:-e.left,y:-e.top,width:e.left+e.right,height:e.top+e.bottom}}toArray$1(t.directions).forEach((function(t){var e=new Point(0,0);var n=new Point(t.offsetX,t.offsetY);t.angle=normalizeAngle(e.theta(n))}))}function router(t,e,n){resolveOptions(e);n.options.perpendicular=!!e.perpendicular;var r=getSourceBBox(n,e);var i=getTargetBBox(n,e);var o=getSourceAnchor(n,e);let s;if(typeof e.isPointObstacle==="function")s=e.isPointObstacle;else{const t=new ObstacleMap(e);t.build(n.paper.model,n.model);s=e=>!t.isPointAccessible(e)}var a=toArray$1(t).map(Point);var c=[];var l=o;var u,h;for(var d=0,f=a.length;d<=f;d++){var p=null;h=u||r;u=a[d];if(!u){u=i;var g=!n.model.get("source").id||!n.model.get("target").id;if(g&&isFunction(e.draggingRoute)){var v=h===r?o:h;var m=u.origin();p=e.draggingRoute.call(n,v,m,e)}}p=p||findRoute.call(n,h,u,s,e);if(p===null)return e.fallbackRouter(t,e,n);var y=p[0];y&&y.equals(l)&&p.shift();l=p[p.length-1]||l;Array.prototype.push.apply(c,p)}return c}const manhattan=function(t,e,n){return router(t,Ne({},gi,e),n)};var vi={maxAllowedDirectionChange:45,diagonalCost:function(){var t=this.step;return Math.ceil(Math.sqrt(t*t<<1))},directions:function(){var t=this.step;var e=this.cost();var n=this.diagonalCost();return[{offsetX:t,offsetY:0,cost:e},{offsetX:t,offsetY:t,cost:n},{offsetX:0,offsetY:t,cost:e},{offsetX:-t,offsetY:t,cost:n},{offsetX:-t,offsetY:0,cost:e},{offsetX:-t,offsetY:-t,cost:n},{offsetX:0,offsetY:-t,cost:e},{offsetX:t,offsetY:-t,cost:n}]},fallbackRoute:function(t,e,n){var r=t.theta(e);var i=[];var o={x:e.x,y:t.y};var s={x:t.x,y:e.y};if(r%180>90){var a=o;o=s;s=a}var c=r%90<45?o:s;var l=new Line(t,c);var u=90*Math.ceil(r/90);var h=Point.fromPolar(l.squaredLength(),toRad(u+135),c);var d=new Line(e,h);var f=l.intersection(d);var p=f||e;var g=f?p:t;var v=360/n.directions.length;var m=g.theta(e);var y=normalizeAngle(m+v/2);var b=v*Math.floor(y/v);n.previousDirectionAngle=b;p&&i.push(p.round());i.push(e);return i}};const metro=function(t,e,n){if(!isFunction(manhattan))throw new Error("Metro requires the manhattan router.");return manhattan(t,Ne({},vi,e),n)};const mi={AUTO:"auto",LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom",ANCHOR_SIDE:"anchor-side",MAGNET_SIDE:"magnet-side"};const yi=[mi.LEFT,mi.RIGHT,mi.TOP,mi.BOTTOM];const bi={[mi.LEFT]:mi.RIGHT,[mi.RIGHT]:mi.LEFT,[mi.TOP]:mi.BOTTOM,[mi.BOTTOM]:mi.TOP};const xi=[mi.TOP,mi.BOTTOM];const wi={0:mi.RIGHT,180:mi.LEFT,270:mi.TOP,90:mi.BOTTOM};function getSegmentAngle(t){return t.angle()}function simplifyPoints(t){return new Polyline$1(t).simplify({threshold:1}).points}function resolveSides(t,e){const{point:n,x0:r,y0:i,view:o,bbox:s,direction:a}=t;const{point:c,x0:l,y0:u,view:h,bbox:d,direction:f}=e;let p;if(o)p=o.model.isLink()?getDirectionForLinkConnection(c,n,o):a===mi.ANCHOR_SIDE?s.sideNearestToPoint(n):a===mi.MAGNET_SIDE?o.model.getBBox().sideNearestToPoint(n):a;else{const t=new Rect(r,i,0,0);p=yi.includes(a)?a:t.sideNearestToPoint(c)}let g;if(h)g=h.model.isLink()?getDirectionForLinkConnection(n,c,h):f===mi.ANCHOR_SIDE?d.sideNearestToPoint(c):f===mi.MAGNET_SIDE?h.model.getBBox().sideNearestToPoint(c):f;else{const t=new Rect(l,u,0,0);g=yi.includes(f)?f:t.sideNearestToPoint(n)}return[p,g]}function resolveForTopSourceSide(t,e,n){const{x0:r,y0:i,width:o,height:s,point:a,margin:c}=t;const l=r+o;const u=i+s;const h=r-c;const d=l+c;const f=i-c;const{x:p}=a;const{x0:g,y0:v}=e;return g===p&&v<i?mi.BOTTOM:g<p&&v<f?n.point.x===p?mi.BOTTOM:mi.RIGHT:g>p&&v<f?n.point.x===p?mi.BOTTOM:mi.LEFT:g<h&&v>f||g>d&&v>f?mi.TOP:g>=h&&g<=p&&v>u||g<=d&&g>=p&&v>u?n.point.x<g?mi.RIGHT:mi.LEFT:mi.BOTTOM}function resolveForBottomSourceSide(t,e,n){const{x0:r,y0:i,width:o,height:s,point:a,margin:c}=t;const l=r+o;const u=i+s;const h=r-c;const d=l+c;const f=u+c;const{x:p}=a;const{x0:g,y0:v}=e;return g===p&&v>u?mi.TOP:g<p&&v>f?n.point.x===p?mi.TOP:mi.RIGHT:g>p&&v>f?n.point.x===p?mi.TOP:mi.LEFT:g<h&&v<f||g>d&&v<f?mi.BOTTOM:g>=h&&g<=p&&v<i||g<=d&&g>=p&&v<i?n.point.x<g?mi.RIGHT:mi.LEFT:mi.TOP}function resolveForLeftSourceSide(t,e,n){const{y0:r,x0:i,width:o,height:s,point:a,margin:c}=t;const l=i+o;const u=r+s;const h=i-c;const d=r-c;const f=u+c;const{x:p,y:g}=a;const{x0:v,y0:m}=e;return v<p&&m===g?mi.RIGHT:v<=h&&m<g?mi.BOTTOM:v<=h&&m>g?mi.TOP:v>=h&&m<d||v>=h&&m>f?mi.LEFT:v>l&&m>=d&&m<=g||v>l&&m<=f&&m>=g?n.point.y<m?mi.BOTTOM:mi.TOP:mi.RIGHT}function resolveForRightSourceSide(t,e,n){const{y0:r,x0:i,width:o,height:s,point:a,margin:c}=t;const l=i+o;const u=r+s;const h=l+c;const d=r-c;const f=u+c;const{x:p,y:g}=a;const{x0:v,y0:m}=e;return v>p&&m===g?mi.LEFT:v>=h&&m<g?mi.BOTTOM:v>=h&&m>g?mi.TOP:v<=h&&m<d||v<=h&&m>f?mi.RIGHT:v<i&&m>=d&&m<=g||v<i&&m<=f&&m>=g?n.point.y<m?mi.BOTTOM:mi.TOP:mi.LEFT}function resolveInitialDirection(t,e,n){const[r]=resolveSides(t,e);switch(r){case mi.TOP:return resolveForTopSourceSide(t,e,n);case mi.RIGHT:return resolveForRightSourceSide(t,e,n);case mi.BOTTOM:return resolveForBottomSourceSide(t,e,n);case mi.LEFT:return resolveForLeftSourceSide(t,e,n)}}function getDirectionForLinkConnection(t,e,n){const r=n.getTangentAtLength(n.getClosestPointLength(e));const i=Math.round(getSegmentAngle(r)/90)*90;if(i%180===0&&t.y===e.y)return t.x<e.x?mi.LEFT:mi.RIGHT;if(t.x===e.x)return t.y<e.y?mi.TOP:mi.BOTTOM;switch(i){case 0:case 180:case 360:return t.y<e.y?mi.TOP:mi.BOTTOM;case 90:case 270:return t.x<e.x?mi.LEFT:mi.RIGHT}}function pointDataFromAnchor(t,e,n,r,i,o,s){r===mi.AUTO&&(r=i?mi.MAGNET_SIDE:mi.ANCHOR_SIDE);const a=t&&t.model.isElement();const{x:c,y:l,width:u=0,height:h=0}=a?Rect.fromRectUnion(n,t.model.getBBox()):o;return{point:e,x0:c,y0:l,view:t,bbox:n,width:u,height:h,direction:r,margin:a?s:0}}function pointDataFromVertex({x:t,y:e}){const n=new Point(t,e);return{point:n,x0:n.x,y0:n.y,view:null,bbox:new Rect(t,e,0,0),width:0,height:0,direction:null,margin:0}}function getOutsidePoint(t,e,n){const r=e.point.clone();const{x0:i,y0:o,width:s,height:a}=e;switch(t){case"left":r.x=i-n;break;case"right":r.x=i+s+n;break;case"top":r.y=o-n;break;case"bottom":r.y=o+a+n;break}return r}function createLoop(t,e,{dx:n=0,dy:r=0}){const i={x:t.point.x+n,y:t.point.y+r};const o={x:e.point.x+n,y:e.point.y+r};return[t.point,i,o,e.point]}function loopSegment(t,e,n,r){const i=normalizeAngle(n-90);let o=0;let s=0;i===90?s=-r:i===180?o=-r:i===270?s=r:i===0&&(o=r);const a=createLoop(t,e,{dx:o,dy:s});const c=a[2];const l=new Line(e.point,c);const u=wi[getSegmentAngle(l)];return{loopRoute:a,continueDirection:u}}function getHorizontalDistance(t,e){const{x0:n,x1:r,outsidePoint:i}=t;const{x0:o,x1:s,outsidePoint:a}=e;let c=Math.min(n,o);let l=Math.max(r,s);if(t.direction===e.direction){const n=t.y0<e.y0?t:e;const r=n===t?e:t;const i=t.direction===mi.TOP?n:r;c=i.x0;l=i.x1}const{x:u}=i;const{x:h}=a;const d=Math.abs(u-c);const f=Math.abs(h-c);const p=d+f;const g=Math.abs(u-l);const v=Math.abs(h-l);const m=g+v;return[p,m]}function getVerticalDistance(t,e){const{y0:n,y1:r,outsidePoint:i}=t;const{y0:o,y1:s,outsidePoint:a}=e;let c=Math.min(n,o);let l=Math.max(r,s);if(t.direction===e.direction){const n=t.x0<e.x0?t:e;const r=n===t?e:t;const i=t.direction===mi.LEFT?n:r;c=i.y0;l=i.y1}const{y:u}=i;const{y:h}=a;const d=Math.abs(u-c);const f=Math.abs(h-c);const p=d+f;const g=Math.abs(u-l);const v=Math.abs(h-l);const m=g+v;return[p,m]}function moveAndExpandBBox(t,e,n){switch(e){case mi.LEFT:t.inflate(0,n).moveAndExpand({x:-n,width:n});break;case mi.RIGHT:t.inflate(0,n).moveAndExpand({width:n});break;case mi.TOP:t.inflate(n,0).moveAndExpand({y:-n,height:n});break;case mi.BOTTOM:t.inflate(n,0).moveAndExpand({height:n});break}return t}function routeBetweenPoints(t,e,n={}){const{point:r,x0:i,y0:o,width:s,height:a,margin:c}=t;const{point:l,x0:u,y0:h,width:d,height:f,margin:p}=e;const{targetInSourceBBox:g=false}=n;const v=u+d;const m=h+f;const y=i+s;const b=o+a;const x=i-c;const w=y+c;const A=o-c;const P=b+c;const T=u-p;const E=v+p;const S=h-p;const k=m+p;const[L,C]=resolveSides(t,e);const _=getOutsidePoint(L,{point:r,x0:i,y0:o,width:s,height:a},c);const M=getOutsidePoint(C,{point:l,x0:u,y0:h,width:d,height:f},p);const{x:N,y:O}=_;const{x:R,y:B}=M;const I=(u+v)/2;const F=(h+m)/2;const D=(i+y)/2;const z=(o+b)/2;const j=(D<I?y+u:v+i)/2;const G=(z<F?b+h:m+o)/2;const U=new Rect(i,o,s,a);const W=new Rect(u,h,d,f);const H=U.clone().inflate(c);const q=W.clone().inflate(p);const Y=Object.assign({},t,{x1:y,y1:b,outsidePoint:_,direction:L});const Z=Object.assign({},e,{x1:v,y1:m,outsidePoint:M,direction:C});const[J,K]=getHorizontalDistance(Y,Z);const[Q,tt]=getVerticalDistance(Y,Z);if(L==="left"&&C==="right"){const t=H.containsPoint(M);const e=q.containsPoint(_);if(t||e){const t=(O+B)/2;return[{x:N,y:O},{x:N,y:t},{x:R,y:t},{x:R,y:B}]}if(x<R){let t=G;let e=N;let n=R;const r=Q<tt;if(t>=A&&t<=P||t>=S&&t<=k){P>=S&&r?t=Math.min(S,A):A<=k&&!r&&(t=Math.max(k,P));e=Math.min(N,T);n=Math.max(R,w);r&&O<h||!r&&O>m?e=N:(r&&B<o||!r&&B>b)&&(n=R)}return[{x:e,y:O},{x:e,y:t},{x:n,y:t},{x:n,y:B}]}const n=(N+R)/2;return[{x:n,y:O},{x:n,y:B}]}if(L==="right"&&C==="left"){const t=H.containsPoint(M);const e=q.containsPoint(_);if(t||e){const t=(O+B)/2;return[{x:N,y:O},{x:N,y:t},{x:R,y:t},{x:R,y:B}]}if(w>R){let t=G;let e=N;let n=R;const r=Q<tt;if(t>=A&&t<=P||t>=S&&t<=k){P>=S&&r?t=Math.min(S,A):A<=k&&!r&&(t=Math.max(k,P));e=Math.max(N,E);n=Math.min(R,x);r&&O<h||!r&&O>m?e=N:(r&&B<o||!r&&B>b)&&(n=R)}return[{x:e,y:O},{x:e,y:t},{x:n,y:t},{x:n,y:B}]}const n=(N+R)/2;return[{x:n,y:O},{x:n,y:B}]}if(L==="top"&&C==="bottom"){const t=H.containsPoint(M);const e=q.containsPoint(_);if(t||e){const t=(N+R)/2;return[{x:N,y:O},{x:t,y:O},{x:t,y:B},{x:R,y:B}]}if(A<B){let t=j;let e=O;let n=B;const r=J<K;if(t>=x&&t<=w||t>=T&&t<=E){w>=T&&r?t=Math.min(T,x):x<=E&&!r&&(t=Math.max(E,w));e=Math.min(O,S);n=Math.max(B,P);r&&N<u||!r&&N>v?e=O:(r&&R<i||!r&&R>y)&&(n=B)}return[{x:N,y:e},{x:t,y:e},{x:t,y:n},{x:R,y:n}]}const n=(O+B)/2;return[{x:N,y:n},{x:R,y:n}]}if(L==="bottom"&&C==="top"){const t=H.containsPoint(M);const e=q.containsPoint(_);if(t||e){const t=(N+R)/2;return[{x:N,y:O},{x:t,y:O},{x:t,y:B},{x:R,y:B}]}if(P>B){let t=j;let e=O;let n=B;const r=J<K;if(t>=x&&t<=w||t>=T&&t<=E){w>=T&&r?t=Math.min(T,x):x<=E&&!r&&(t=Math.max(E,w));e=Math.max(O,k);n=Math.min(B,A);r&&N<u||!r&&N>v?e=O:(r&&R<i||!r&&R>y)&&(n=B)}return[{x:N,y:e},{x:t,y:e},{x:t,y:n},{x:R,y:n}]}const n=(O+B)/2;return[{x:N,y:n},{x:R,y:n}]}if(L==="top"&&C==="top"){const t=g||X.rectWithRect(H,W)||O<=h&&(H.bottomRight().x<=R||H.bottomLeft().x>=R)||O>=h&&(q.bottomRight().x<=N||q.bottomLeft().x>=N);if(t&&N!==R)return[{x:N,y:Math.min(O,B)},{x:R,y:Math.min(O,B)}];let e;let n=Math.min((b+h)/2,B);let r=Math.min((o+m)/2,O);e=B<O?K>J?Math.min(N,T):Math.max(N,E):K>J?Math.min(R,x):Math.max(R,w);return[{x:N,y:r},{x:e,y:r},{x:e,y:n},{x:R,y:n}]}if(L==="bottom"&&C==="bottom"){const t=g||X.rectWithRect(H,W)||O>=B&&(H.topRight().x<=R||H.topLeft().x>=R)||O<=B&&(q.topRight().x<=N||q.topLeft().x>=N);if(t&&N!==R)return[{x:N,y:Math.max(O,B)},{x:R,y:Math.max(O,B)}];let e;let n=Math.max((o+m)/2,B);let r=Math.max((b+h)/2,O);e=B>O?K>J?Math.min(N,T):Math.max(N,E):K>J?Math.min(R,x):Math.max(R,w);return[{x:N,y:r},{x:e,y:r},{x:e,y:n},{x:R,y:n}]}if(L==="left"&&C==="left"){const t=g||X.rectWithRect(H,W)||N<=R&&(H.bottomRight().y<=B||H.topRight().y>=B)||N>=R&&(q.bottomRight().y<=O||q.topRight().y>=O);if(t&&O!==B)return[{x:Math.min(N,R),y:O},{x:Math.min(N,R),y:B}];let e;let n=Math.min((y+u)/2,R);let r=Math.min((i+v)/2,N);e=R>N?Q<=tt?Math.min(A,B):Math.max(P,B):Q<=tt?Math.min(S,O):Math.max(k,O);return[{x:r,y:O},{x:r,y:e},{x:n,y:e},{x:n,y:B}]}if(L==="right"&&C==="right"){const t=g||X.rectWithRect(H,W)||N>=R&&(H.bottomLeft().y<=B||H.topLeft().y>=B)||N<=R&&(q.bottomLeft().y<=O||q.topLeft().y>=O);if(t&&O!==B)return[{x:Math.max(N,R),y:O},{x:Math.max(N,R),y:B}];let e;let n=Math.max((i+v)/2,R);let r=Math.max((y+u)/2,N);e=R<=N?Q<=tt?Math.min(A,B):Math.max(P,B):Q<=tt?Math.min(S,O):Math.max(k,O);return[{x:r,y:O},{x:r,y:e},{x:n,y:e},{x:n,y:B}]}if(L==="top"&&C==="right"){const t=H.containsPoint(l);if(t){if(N<=E){const t=Math.max(N+c,R);const e=Math.min(A,S);return[{x:N,y:e},{x:t,y:e},{x:t,y:B}]}const t=(N-c+R)/2;return[{x:N,y:O},{x:t,y:O},{x:t,y:B}]}if(A>B){if(N<R){let t=S;k<=A&&E>=N&&(t=G);return[{x:N,y:t},{x:R,y:t},{x:R,y:B}]}return[{x:N,y:B}]}const e=Math.max(j,E);if(N>R&&b>=B)return[{x:N,y:O},{x:e,y:O},{x:e,y:B}];if(e>x&&O<m){const t=Math.min(A,S);const e=Math.max(w,E);return[{x:N,y:t},{x:e,y:t},{x:e,y:B}]}return[{x:N,y:O},{x:e,y:O},{x:e,y:B}]}if(L==="top"&&C==="left"){const t=H.containsPoint(l);if(t){if(N>=T){const t=Math.min(N-c,R);const e=Math.min(A,S);return[{x:N,y:e},{x:t,y:e},{x:t,y:B}]}const t=(N+c+R)/2;return[{x:N,y:O},{x:t,y:O},{x:t,y:B}]}if(A>B){if(N>R){let t=S;k<=A&&T<=N&&(t=G);return[{x:N,y:t},{x:R,y:t},{x:R,y:B}]}return[{x:N,y:B}]}const e=Math.min(T,j);if(N<R&&b>=B)return[{x:N,y:O},{x:e,y:O},{x:e,y:B}];if(e<w&&O<m){const t=Math.min(A,S);const e=Math.min(x,T);return[{x:N,y:t},{x:e,y:t},{x:e,y:B}]}return[{x:N,y:O},{x:e,y:O},{x:e,y:B}]}if(L==="bottom"&&C==="right"){const t=H.containsPoint(l);if(t){if(N<=E){const t=Math.max(N+c,R);const e=Math.max(P,k);return[{x:N,y:e},{x:t,y:e},{x:t,y:B}]}const t=(N-c+R)/2;return[{x:N,y:O},{x:t,y:O},{x:t,y:B}]}if(P<B){if(N<R){let t=k;S>=P&&E>=N&&(t=G);return[{x:N,y:t},{x:R,y:t},{x:R,y:B}]}return[{x:N,y:B}]}const e=Math.max(j,E);if(N>R&&o<=B)return[{x:N,y:O},{x:e,y:O},{x:e,y:B}];if(e>x&&O>h){const t=Math.max(P,k);const e=Math.max(w,E);return[{x:N,y:t},{x:e,y:t},{x:e,y:B}]}return[{x:N,y:O},{x:e,y:O},{x:e,y:B}]}if(L==="bottom"&&C==="left"){const t=H.containsPoint(l);if(t){if(N>=T){const t=Math.min(N-c,R);const e=Math.max(P,k);return[{x:N,y:e},{x:t,y:e},{x:t,y:B}]}const t=(N+c+R)/2;return[{x:N,y:O},{x:t,y:O},{x:t,y:B}]}if(P<B){if(N>R){let t=k;S>=P&&T<=N&&(t=G);return[{x:N,y:t},{x:R,y:t},{x:R,y:B}]}return[{x:N,y:B}]}const e=Math.min(T,j);if(N<R&&o<=B)return[{x:N,y:O},{x:e,y:O},{x:e,y:B}];if(e<w&&O>h){const t=Math.max(P,k);const e=Math.min(x,T);return[{x:N,y:t},{x:e,y:t},{x:e,y:B}]}return[{x:N,y:O},{x:e,y:O},{x:e,y:B}]}if(L==="left"&&C==="bottom"){const t=H.containsPoint(l);if(t){if(O<=k){const t=Math.min(x,T);const e=Math.max(O+c,B);return[{x:t,y:O},{x:t,y:e},{x:R,y:e}]}const t=(O-c+B)/2;return[{x:N,y:O},{x:N,y:t},{x:R,y:t}]}if(x>R){if(O<B){let t=T;E<=x&&k>=O&&(t=j);return[{x:t,y:O},{x:t,y:B},{x:R,y:B}]}return[{x:R,y:O}]}const e=Math.max(k,G);if(O>B&&y>=R)return[{x:N,y:O},{x:N,y:e},{x:R,y:e}];if(e>A&&N<v){const t=Math.min(x,T);const e=Math.max(P,k);return[{x:t,y:O},{x:t,y:e},{x:R,y:e}]}return[{x:N,y:O},{x:N,y:e},{x:R,y:e}]}if(L==="left"&&C==="top"){const t=H.containsPoint(l);if(t){if(O>=S){const t=Math.min(O-c,B);const e=Math.min(x,T);return[{x:e,y:O},{x:e,y:t},{x:R,y:t}]}const t=(O+c+B)/2;return[{x:N,y:O},{x:N,y:t},{x:R,y:t}]}if(x>R){if(O>B){let t=T;E<=x&&S<=O&&(t=j);return[{x:t,y:O},{x:t,y:B},{x:R,y:B}]}return[{x:R,y:O}]}const e=Math.min(S,G);if(O<B&&y>=R)return[{x:N,y:O},{x:N,y:e},{x:R,y:e}];if(e<P&&N<v){const t=Math.min(x,T);const e=Math.min(A,S);return[{x:t,y:O},{x:t,y:e},{x:R,y:e}]}return[{x:N,y:O},{x:N,y:e},{x:R,y:e}]}if(L==="right"&&C==="top"){const t=H.containsPoint(l);if(t){if(O>=S){const t=Math.max(w,E);const e=Math.min(O-c,B);return[{x:t,y:O},{x:t,y:e},{x:R,y:e}]}const t=(O+c+B)/2;return[{x:N,y:O},{x:N,y:t},{x:R,y:t}]}if(w<R){if(O>B){let t=E;T>=w&&S<=O&&(t=j);return[{x:t,y:O},{x:t,y:B},{x:R,y:B}]}return[{x:R,y:O}]}const e=Math.min(S,G);if(O<B&&i<=R)return[{x:N,y:O},{x:N,y:e},{x:R,y:e}];if(e<P&&N>u){const t=Math.max(w,E);const e=Math.min(A,S);return[{x:t,y:O},{x:t,y:e},{x:R,y:e}]}return[{x:N,y:O},{x:N,y:e},{x:R,y:e}]}if(L==="right"&&C==="bottom"){const t=H.containsPoint(l);if(t){if(O<=k){const t=Math.max(w,E);const e=Math.max(O+c,B);return[{x:t,y:O},{x:t,y:e},{x:R,y:e}]}const t=(O-c+B)/2;return[{x:N,y:O},{x:N,y:t},{x:R,y:t}]}if(w<R){if(O<B){let t=E;T>=w&&k>=O&&(t=j);return[{x:t,y:O},{x:t,y:B},{x:R,y:B}]}return[{x:R,y:O}]}const e=Math.max(k,G);if(O>B&&i<=R)return[{x:N,y:O},{x:N,y:e},{x:R,y:e}];if(e>A&&N>u){const t=Math.max(w,E);const e=Math.max(P,k);return[{x:t,y:O},{x:t,y:e},{x:R,y:e}]}return[{x:N,y:O},{x:N,y:e},{x:R,y:e}]}}function getLoopCoordinates(t,e,n){const r=t===mi.LEFT||t===mi.RIGHT;let i=0;let o=0;switch(normalizeAngle(Math.round(e))){case 0:case 90:i=r?0:n;o=r?n:0;break;case 180:case 270:i=r?0:-n;o=r?-n:0;break}return{dx:i,dy:o}}function rightAngleRouter(t,e,n){const{sourceDirection:r=mi.AUTO,targetDirection:i=mi.AUTO}=e;const o=e.margin||20;const s=e.useVertices||false;const a=!!n.model.source().port;const c=pointDataFromAnchor(n.sourceView,n.sourceAnchor,n.sourceBBox,r,a,n.sourceAnchor,o);const l=!!n.model.target().port;const u=pointDataFromAnchor(n.targetView,n.targetAnchor,n.targetBBox,i,l,n.targetAnchor,o);let h=[];if(!s||t.length===0)return simplifyPoints(routeBetweenPoints(c,u));const d=t.map((t=>pointDataFromVertex(t)));const[f]=d;const[p]=resolveSides(c,f);const g=c.view&&c.view.model.isElement();const v=g?moveAndExpandBBox(c.view.model.getBBox(),p,o):null;const m=!!g&&v.containsPoint(f.point);if(m){const t=getOutsidePoint(p,c,o);const e=t.equals(f.point);const n=c.point.x===f.point.x;const r=c.point.y===f.point.y;const i=n&&(p===mi.TOP||p===mi.BOTTOM);const s=r&&(p===mi.LEFT||p===mi.RIGHT);const a=new Line(c.point,t);const l=a.containsPoint(f.point);const u=m&&(s||i);if(e){h.push(c.point,f.point);f.direction=bi[p]}else if(l||u){const e=getSegmentAngle(l?a:new Line(c.point,f.point));const{dx:n,dy:r}=getLoopCoordinates(p,e,o);const i=createLoop({point:t},f,{dx:n,dy:r});const s=i[2];const u=new Line(f.point,s);const d=wi[getSegmentAngle(u)];f.direction=d;h.push(...i)}else{f.direction=p;f.margin=o;h.push(...routeBetweenPoints(c,f,{targetInSourceBBox:true}),f.point)}}else{const t=d[1]||u;const e=resolveInitialDirection(c,f,t);f.direction=e;h.push(...routeBetweenPoints(c,f),f.point)}for(let t=0;t<d.length-1;t++){const e=d[t];const n=d[t+1];const r=new Line(e.point,n.point);const i=getSegmentAngle(r);if(i%90===0){const t=wi[i];const r=simplifyPoints([...h,e.point]);const s=new Line(r[r.length-2],r[r.length-1]);const a=wi[Math.round(getSegmentAngle(s))];if(t!==bi[a]){h.push(e.point,n.point);const[,t]=resolveSides(e,n);n.direction=t}else{const{loopRoute:t,continueDirection:r}=loopSegment(e,n,i,o);n.direction=r;h.push(...t)}continue}const[s,a]=resolveDirection(e,n);e.direction=s;n.direction=a;h.push(...routeBetweenPoints(e,n),n.point)}const y=d[d.length-1];if(u.view&&u.view.model.isElement()){const[,t]=resolveSides(y,u);const e=getOutsidePoint(t,u,o);const n=simplifyPoints([...h,y.point]);const r=new Line(n[n.length-2],n[n.length-1]);const i=Math.round(getSegmentAngle(r));const s=wi[i];const a=e.equals(y.point);if(!a||a&&s===t){y.direction=s;let n=routeBetweenPoints(y,u);const[r,c]=simplifyPoints([...n,u.point]);const l=new Line(r,c);const d=Math.round(getSegmentAngle(l));const f=wi[d];const p=moveAndExpandBBox(u.view.model.getBBox(),t,o);const g=y.point.x===u.point.x;const v=y.point.y===u.point.y;const m=p.containsPoint(y.point);const b=g&&(t===mi.TOP||t===mi.BOTTOM);const x=v&&(t===mi.LEFT||t===mi.RIGHT);if(!a&&m&&(x||b)){const{dx:r,dy:s}=getLoopCoordinates(t,i,o);n=createLoop(y,{point:e},{dx:r,dy:s})}else if(m&&t!==bi[s]){y.margin=o;y.direction=t;n=routeBetweenPoints(y,u)}else if(f!==s&&s===bi[f]){y.margin=o;n=routeBetweenPoints(y,u)}h.push(...n)}}else{const t=y;const e=u;const n=new Line(t.point,e.point);const r=getSegmentAngle(n);if(r%90===0){const n=wi[r];const i=simplifyPoints(h);const s=new Line(i[i.length-2],t.point);const a=wi[Math.round(getSegmentAngle(s))];if(n!==bi[a])h.push(t.point);else{const{loopRoute:n}=loopSegment(t,e,r,o);n.pop();h.push(...n)}}else{const[n,r]=resolveDirection(t,e);t.direction=n;e.direction=r;h.push(...routeBetweenPoints(t,e))}}return simplifyPoints(h)}function resolveDirection(t,e){const n=t.direction;const r=xi.includes(n);let i=t.direction;let o=e.direction;if(r){const r=t.point.y>e.point.y;const s=e.point.x-t.point.x;if(n===mi.BOTTOM){i=r?bi[n]:s>=0?mi.RIGHT:mi.LEFT;s>0?o=r?mi.LEFT:mi.TOP:s<0&&(o=r?mi.RIGHT:mi.TOP)}else{i=r?s>=0?mi.RIGHT:mi.LEFT:bi[n];s>0?o=r?mi.BOTTOM:mi.LEFT:s<0&&(o=r?mi.BOTTOM:mi.RIGHT)}}else{const r=t.point.x>e.point.x;const s=e.point.y-t.point.y;if(n===mi.RIGHT){i=r?bi[n]:s>=0?mi.BOTTOM:mi.TOP;s>0?o=r?mi.TOP:mi.LEFT:s<0&&(o=r?mi.BOTTOM:mi.LEFT)}else{i=r?s>=0?mi.BOTTOM:mi.TOP:bi[n];s>0?o=r?mi.RIGHT:mi.TOP:s<0&&(o=r?mi.RIGHT:mi.BOTTOM)}}return[i,o]}rightAngleRouter.Directions=mi;const Ai=rightAngleRouter;var Pi=Object.freeze(Object.defineProperty({__proto__:null,manhattan:manhattan,metro:metro,normal:normal,oneSide:oneSide,orthogonal:orthogonal,rightAngle:Ai},Symbol.toStringTag,{value:"Module"}));function connectionRatio(t,e,n,r){var i="ratio"in r?r.ratio:.5;return t.getPointAtRatio(i)}function connectionLength(t,e,n,r){var i="length"in r?r.length:20;return t.getPointAtLength(i)}function _connectionPerpendicular(t,e,n,r){var i=1e6;var o=t.getConnection();var s=t.getConnectionSubdivisions();var a=new Line(n.clone().offset(0,i),n.clone().offset(0,-i));var c=new Line(n.clone().offset(i,0),n.clone().offset(-i,0));var l=a.intersect(o,{segmentSubdivisions:s});var u=c.intersect(o,{segmentSubdivisions:s});var h=[];l&&Array.prototype.push.apply(h,l);u&&Array.prototype.push.apply(h,u);return h.length>0?n.chooseClosest(h):"fallbackAt"in r?getPointAtLink(t,r.fallbackAt):Ei(t,e,n,r)}function _connectionClosest(t,e,n,r){var i=t.getClosestPoint(n);return i||new Point}function resolveRef(t){return function(e,n,r,i){if(r instanceof Element){var o=this.paper.findView(r);var s;if(o)if(o.isNodeConnection(r)){var a="fixedAt"in i?i.fixedAt:"50%";s=getPointAtLink(o,a)}else s=o.getNodeBBox(r).center();else s=new Point;return t.call(this,e,n,s,i)}return t.apply(this,arguments)}}function getPointAtLink(t,e){var n=parseFloat(e);return isPercentage(e)?t.getPointAtRatio(n/100):t.getPointAtLength(n)}const Ti=resolveRef(_connectionPerpendicular);const Ei=resolveRef(_connectionClosest);var Si=Object.freeze(Object.defineProperty({__proto__:null,connectionClosest:Ei,connectionLength:connectionLength,connectionPerpendicular:Ti,connectionRatio:connectionRatio,resolveRef:resolveRef},Symbol.toStringTag,{value:"Module"}));function bboxWrapper(t){return function(e,n,r,i){var o=!!i.rotate;var s=o?e.getNodeUnrotatedBBox(n):e.getNodeBBox(n);var a=s[t]();var c=i.dx;if(c){var l=isPercentage(c);c=parseFloat(c);if(isFinite(c)){if(l){c/=100;c*=s.width}a.x+=c}}var u=i.dy;if(u){var h=isPercentage(u);u=parseFloat(u);if(isFinite(u)){if(h){u/=100;u*=s.height}a.y+=u}}return o?a.rotate(e.model.getBBox().center(),-e.model.angle()):a}}function _perpendicular(t,e,n,r){var i=t.model.angle();var o=t.getNodeBBox(e);var s=o.center();var a=o.origin();var c=o.corner();var l=r.padding;isFinite(l)||(l=0);if(a.y+l<=n.y&&n.y<=c.y-l){var u=n.y-s.y;s.x+=i===0||i===180?0:u*1/Math.tan(toRad(i));s.y+=u}else if(a.x+l<=n.x&&n.x<=c.x-l){var h=n.x-s.x;s.y+=i===90||i===270?0:h*Math.tan(toRad(i));s.x+=h}return s}function _midSide(t,e,n,r){var i=!!r.rotate;var o,s,a;if(i){o=t.getNodeUnrotatedBBox(e);a=t.model.getBBox().center();s=t.model.angle()}else o=t.getNodeBBox(e);var c=r.padding;isFinite(c)&&o.inflate(c);i&&n.rotate(a,s);var l=o.sideNearestToPoint(n);var u;switch(l){case"left":u=o.leftMiddle();break;case"right":u=o.rightMiddle();break;case"top":u=o.topMiddle();break;case"bottom":u=o.bottomMiddle();break}return i?u.rotate(a,-s):u}function _modelCenter(t,e,n,r,i){return t.model.getPointFromConnectedLink(this.model,i).offset(r.dx,r.dy)}const ki=bboxWrapper("center");const Li=bboxWrapper("topMiddle");const Ci=bboxWrapper("bottomMiddle");const _i=bboxWrapper("leftMiddle");const Mi=bboxWrapper("rightMiddle");const Ni=bboxWrapper("origin");const Oi=bboxWrapper("topRight");const Ri=bboxWrapper("bottomLeft");const Bi=bboxWrapper("corner");const Ii=resolveRef(_perpendicular);const Fi=resolveRef(_midSide);const Di=_modelCenter;var Vi=Object.freeze(Object.defineProperty({__proto__:null,bottom:Ci,bottomLeft:Ri,bottomRight:Bi,center:ki,left:_i,midSide:Fi,modelCenter:Di,perpendicular:Ii,right:Mi,top:Li,topLeft:Ni,topRight:Oi},Symbol.toStringTag,{value:"Module"}));const zi=Collection.extend({initialize:function(t,e){e.cellNamespace?this.cellNamespace=e.cellNamespace:this.cellNamespace=typeof joint!=="undefined"&&has(joint,"shapes")?joint.shapes:null;this.graph=e.graph},model:function(t,e){const n=e.collection;const r=n.cellNamespace;const{type:i}=t;const o=getByPath(r,i,".");if(!o)throw new Error(`dia.Graph: Could not find cell constructor for type: '${i}'. Make sure to add the constructor to 'cellNamespace'.`);return new o(t,e)},_addReference:function(t,e){Collection.prototype._addReference.apply(this,arguments);e.dry||t.graph||(t.graph=this.graph)},_removeReference:function(t,e){Collection.prototype._removeReference.apply(this,arguments);e.dry||t.graph!==this.graph||(t.graph=null)},comparator:function(t){return t.get("z")||0}});const ji=Model.extend({initialize:function(t,e){e=e||{};var n=new zi([],{model:e.cellModel,cellNamespace:e.cellNamespace,graph:this});Model.prototype.set.call(this,"cells",n);n.on("all",this.trigger,this);this.on("change:z",this._sortOnChangeZ,this);this._out={};this._in={};this._nodes={};this._edges={};this._batches={};n.on("add",this._restructureOnAdd,this);n.on("remove",this._restructureOnRemove,this);n.on("reset",this._restructureOnReset,this);n.on("change:source",this._restructureOnChangeSource,this);n.on("change:target",this._restructureOnChangeTarget,this);n.on("remove",this._removeCell,this)},_sortOnChangeZ:function(){this.get("cells").sort()},_restructureOnAdd:function(t){if(t.isLink()){this._edges[t.id]=true;var{source:e,target:n}=t.attributes;e.id&&((this._out[e.id]||(this._out[e.id]={}))[t.id]=true);n.id&&((this._in[n.id]||(this._in[n.id]={}))[t.id]=true)}else this._nodes[t.id]=true},_restructureOnRemove:function(t){if(t.isLink()){delete this._edges[t.id];var{source:e,target:n}=t.attributes;e.id&&this._out[e.id]&&this._out[e.id][t.id]&&delete this._out[e.id][t.id];n.id&&this._in[n.id]&&this._in[n.id][t.id]&&delete this._in[n.id][t.id]}else delete this._nodes[t.id]},_restructureOnReset:function(t){t=t.models;this._out={};this._in={};this._nodes={};this._edges={};t.forEach(this._restructureOnAdd,this)},_restructureOnChangeSource:function(t){var e=t.previous("source");e.id&&this._out[e.id]&&delete this._out[e.id][t.id];var n=t.attributes.source;n.id&&((this._out[n.id]||(this._out[n.id]={}))[t.id]=true)},_restructureOnChangeTarget:function(t){var e=t.previous("target");e.id&&this._in[e.id]&&delete this._in[e.id][t.id];var n=t.get("target");n.id&&((this._in[n.id]||(this._in[n.id]={}))[t.id]=true)},getOutboundEdges:function(t){return this._out&&this._out[t]||{}},getInboundEdges:function(t){return this._in&&this._in[t]||{}},toJSON:function(t={}){var e=Model.prototype.toJSON.apply(this,arguments);e.cells=this.get("cells").toJSON(t.cellAttributes);return e},fromJSON:function(t,e){if(!t.cells)throw new Error("Graph JSON must contain cells array.");return this.set(t,e)},set:function(t,e,n){var r;if(typeof t==="object"){r=t;n=e}else(r={})[t]=e;if(r.hasOwnProperty("cells")){this.resetCells(r.cells,n);r=omit(r,"cells")}return Model.prototype.set.call(this,r,n)},clear:function(t){t=Ne({},t,{clear:true});var e=this.get("cells");if(e.length===0)return this;this.startBatch("clear",t);var n=e.sortBy((function(t){return t.isLink()?1:2}));do{n.shift().remove(t)}while(n.length>0);this.stopBatch("clear");return this},_prepareCell:function(t){let e;e=t instanceof Model?t.attributes:t;if(!isString(e.type))throw new TypeError("dia.Graph: cell type must be a string.");return t},minZIndex:function(){var t=this.get("cells").first();return t&&t.get("z")||0},maxZIndex:function(){var t=this.get("cells").last();return t&&t.get("z")||0},addCell:function(t,e){if(Array.isArray(t))return this.addCells(t,e);t instanceof Model?t.has("z")||t.set("z",this.maxZIndex()+1):t.z===void 0&&(t.z=this.maxZIndex()+1);this.get("cells").add(this._prepareCell(t,e),e||{});return this},addCells:function(t,e){if(t.length===0)return this;t=flattenDeep(t);e.maxPosition=e.position=t.length-1;this.startBatch("add",e);t.forEach((function(t){this.addCell(t,e);e.position--}),this);this.stopBatch("add",e);return this},resetCells:function(t,e){var n=toArray$1(t).map((function(t){return this._prepareCell(t,e)}),this);this.get("cells").reset(n,e);return this},removeCells:function(t,e){if(t.length){this.startBatch("remove");invoke(t,"remove",e);this.stopBatch("remove")}return this},_removeCell:function(t,e,n){n=n||{};n.clear||(n.disconnectLinks?this.disconnectLinks(t,n):this.removeLinks(t,n));this.get("cells").remove(t,{silent:true})},transferCellEmbeds:function(t,e,n={}){const r="transfer-embeds";this.startBatch(r);const i=t.getEmbeddedCells();e.embed(i,{...n,reparent:true});this.stopBatch(r)},transferCellConnectedLinks:function(t,e,n={}){const r="transfer-connected-links";this.startBatch(r);const i=this.getConnectedLinks(t,n);i.forEach((r=>{r.getSourceCell()===t&&r.prop(["source","id"],e.id,n);r.getTargetCell()===t&&r.prop(["target","id"],e.id,n)}));this.stopBatch(r)},getCell:function(t){return this.get("cells").get(t)},getCells:function(){return this.get("cells").toArray()},getElements:function(){return this.get("cells").toArray().filter((t=>t.isElement()))},getLinks:function(){return this.get("cells").toArray().filter((t=>t.isLink()))},getFirstCell:function(){return this.get("cells").first()},getLastCell:function(){return this.get("cells").last()},getConnectedLinks:function(t,e){e=e||{};var n=e.indirect;var r=e.inbound;var i=e.outbound;r===void 0&&i===void 0&&(r=i=true);var o=[];var s={};i&&addOutbounds(this,t);r&&addInbounds(this,t);function addOutbounds(t,e){forIn(t.getOutboundEdges(e.id),function(e,a){if(!s[a]){var c=t.getCell(a);o.push(c);s[a]=true;if(n){r&&addInbounds(t,c);i&&addOutbounds(t,c)}}}.bind(t));if(n&&e.isLink()){var a=e.getTargetCell();if(a&&a.isLink()&&!s[a.id]){o.push(a);addOutbounds(t,a)}}}function addInbounds(t,e){forIn(t.getInboundEdges(e.id),function(e,a){if(!s[a]){var c=t.getCell(a);o.push(c);s[a]=true;if(n){r&&addInbounds(t,c);i&&addOutbounds(t,c)}}}.bind(t));if(n&&e.isLink()){var a=e.getSourceCell();if(a&&a.isLink()&&!s[a.id]){o.push(a);addInbounds(t,a)}}}if(e.deep){var a=t.getEmbeddedCells({deep:true});var c={};a.forEach((function(t){t.isElement()&&(c[t.id]=true)}));a.forEach((function(t){if(!t.isLink()){i&&forIn(this.getOutboundEdges(t.id),function(t,n){if(!s[n]){var r=this.getCell(n);var{source:i,target:a}=r.attributes;var l=i.id;var u=a.id;if(!e.includeEnclosed&&l&&c[l]&&u&&c[u])return;o.push(this.getCell(n));s[n]=true}}.bind(this));r&&forIn(this.getInboundEdges(t.id),function(t,n){if(!s[n]){var r=this.getCell(n);var{source:i,target:a}=r.attributes;var l=i.id;var u=a.id;if(!e.includeEnclosed&&l&&c[l]&&u&&c[u])return;o.push(this.getCell(n));s[n]=true}}.bind(this))}}),this)}return o},getNeighbors:function(t,e){e||(e={});var n=e.inbound;var r=e.outbound;n===void 0&&r===void 0&&(n=r=true);var i=this.getConnectedLinks(t,e).reduce(function(i,o){var{source:s,target:a}=o.attributes;var c=o.hasLoop(e);if(n&&has(s,"id")&&!i[s.id]){var l=this.getCell(s.id);l.isElement()&&(!c&&(!l||l===t||e.deep&&l.isEmbeddedIn(t))||(i[s.id]=l))}if(r&&has(a,"id")&&!i[a.id]){var u=this.getCell(a.id);u.isElement()&&(!c&&(!u||u===t||e.deep&&u.isEmbeddedIn(t))||(i[a.id]=u))}return i}.bind(this),{});if(t.isLink()){if(n){var o=t.getSourceCell();o&&o.isElement()&&!i[o.id]&&(i[o.id]=o)}if(r){var s=t.getTargetCell();s&&s.isElement()&&!i[s.id]&&(i[s.id]=s)}}return toArray$1(i)},getCommonAncestor:function(){var t=Array.from(arguments).map((function(t){var e=[];var n=t.get("parent");while(n){e.push(n);n=this.getCell(n).get("parent")}return e}),this);t=t.sort((function(t,e){return t.length-e.length}));var e=toArray$1(t.shift()).find((function(e){return t.every((function(t){return t.includes(e)}))}));return this.getCell(e)},getSuccessors:function(t,e){e=e||{};var n=[];this.search(t,(function(e){e!==t&&n.push(e)}),Ne({},e,{outbound:true}));return n},cloneCells:cloneCells,cloneSubgraph:function(t,e){var n=this.getSubgraph(t,e);return this.cloneCells(n)},getSubgraph:function(t,e){e=e||{};var n=[];var r={};var i=[];var o=[];toArray$1(t).forEach((function(t){if(!r[t.id]){n.push(t);r[t.id]=t;t.isLink()?o.push(t):i.push(t)}if(e.deep){var s=t.getEmbeddedCells({deep:true});s.forEach((function(t){if(!r[t.id]){n.push(t);r[t.id]=t;t.isLink()?o.push(t):i.push(t)}}))}}));o.forEach((function(t){var{source:e,target:o}=t.attributes;if(e.id&&!r[e.id]){var s=this.getCell(e.id);n.push(s);r[s.id]=s;i.push(s)}if(o.id&&!r[o.id]){var a=this.getCell(o.id);n.push(this.getCell(o.id));r[a.id]=a;i.push(a)}}),this);i.forEach((function(t){var i=this.getConnectedLinks(t,e);i.forEach((function(t){var{source:e,target:i}=t.attributes;if(!r[t.id]&&e.id&&r[e.id]&&i.id&&r[i.id]){n.push(t);r[t.id]=t}}))}),this);return n},getPredecessors:function(t,e){e=e||{};var n=[];this.search(t,(function(e){e!==t&&n.push(e)}),Ne({},e,{inbound:true}));return n},search:function(t,e,n){n=n||{};n.breadthFirst?this.bfs(t,e,n):this.dfs(t,e,n)},bfs:function(t,e,n={}){const r={};const i={};const o=[];o.push(t);i[t.id]=0;while(o.length>0){var s=o.shift();if(r[s.id])continue;r[s.id]=true;if(e.call(this,s,i[s.id])===false)continue;const t=this.getNeighbors(s,n);for(let e=0,n=t.length;e<n;e++){const n=t[e];i[n.id]=i[s.id]+1;o.push(n)}}},dfs:function(t,e,n={}){const r={};const i={};const o=[];o.push(t);i[t.id]=0;while(o.length>0){const t=o.pop();if(r[t.id])continue;r[t.id]=true;if(e.call(this,t,i[t.id])===false)continue;const s=this.getNeighbors(t,n);const a=o.length;for(let e=0,n=s.length;e<n;e++){const n=s[e];i[n.id]=i[t.id]+1;o.splice(a,0,n)}}},getSources:function(){var t=[];forIn(this._nodes,function(e,n){this._in[n]&&!isEmpty(this._in[n])||t.push(this.getCell(n))}.bind(this));return t},getSinks:function(){var t=[];forIn(this._nodes,function(e,n){this._out[n]&&!isEmpty(this._out[n])||t.push(this.getCell(n))}.bind(this));return t},isSource:function(t){return!this._in[t.id]||isEmpty(this._in[t.id])},isSink:function(t){return!this._out[t.id]||isEmpty(this._out[t.id])},isSuccessor:function(t,e){var n=false;this.search(t,(function(r){if(r===e&&r!==t){n=true;return false}}),{outbound:true});return n},isPredecessor:function(t,e){var n=false;this.search(t,(function(r){if(r===e&&r!==t){n=true;return false}}),{inbound:true});return n},isNeighbor:function(t,e,n){n=n||{};var r=n.inbound;var i=n.outbound;r===void 0&&i===void 0&&(r=i=true);var o=false;this.getConnectedLinks(t,n).forEach((function(t){var{source:n,target:s}=t.attributes;if(r&&has(n,"id")&&n.id===e.id){o=true;return false}if(i&&has(s,"id")&&s.id===e.id){o=true;return false}}));return o},disconnectLinks:function(t,e){this.getConnectedLinks(t).forEach((function(n){n.set(n.attributes.source.id===t.id?"source":"target",{x:0,y:0},e)}))},removeLinks:function(t,e){invoke(this.getConnectedLinks(t),"remove",e)},findElementsAtPoint:function(t,e){return this._filterAtPoint(this.getElements(),t,e)},findLinksAtPoint:function(t,e){return this._filterAtPoint(this.getLinks(),t,e)},findCellsAtPoint:function(t,e){return this._filterAtPoint(this.getCells(),t,e)},_filterAtPoint:function(t,e,n={}){return t.filter((t=>t.getBBox({rotate:true}).containsPoint(e,n)))},findElementsInArea:function(t,e={}){return this._filterInArea(this.getElements(),t,e)},findLinksInArea:function(t,e={}){return this._filterInArea(this.getLinks(),t,e)},findCellsInArea:function(t,e={}){return this._filterInArea(this.getCells(),t,e)},_filterInArea:function(t,e,n={}){const r=new Rect(e);const{strict:i=false}=n;const o=i?"containsRect":"intersect";return t.filter((t=>r[o](t.getBBox({rotate:true}))))},findElementsUnderElement:function(t,e){return this._filterCellsUnderElement(this.getElements(),t,e)},findLinksUnderElement:function(t,e){return this._filterCellsUnderElement(this.getLinks(),t,e)},findCellsUnderElement:function(t,e){return this._filterCellsUnderElement(this.getCells(),t,e)},_isValidElementUnderElement:function(t,e){return t.id!==e.id&&!t.isEmbeddedIn(e)},_isValidLinkUnderElement:function(t,e){return t.source().id!==e.id&&t.target().id!==e.id&&!t.isEmbeddedIn(e)},_validateCellsUnderElement:function(t,e){return t.filter((t=>t.isLink()?this._isValidLinkUnderElement(t,e):this._isValidElementUnderElement(t,e)))},_getFindUnderElementGeometry:function(t,e="bbox"){const n=t.getBBox({rotate:true});return e!=="bbox"?getRectPoint(n,e):n},_filterCellsUnderElement:function(t,e,n={}){const r=this._getFindUnderElementGeometry(e,n.searchBy);const i=r.type===a.Point?this._filterAtPoint(t,r):this._filterInArea(t,r,n);return this._validateCellsUnderElement(i,e)},findModelsInArea:function(t,e){return this.findElementsInArea(t,e)},findModelsFromPoint:function(t){return this.findElementsAtPoint(t)},findModelsUnderElement:function(t,e){return this.findElementsUnderElement(t,e)},getBBox:function(){return this.getCellsBBox(this.getCells())},getCellsBBox:function(t,e={}){const{rotate:n=true}=e;return toArray$1(t).reduce((function(t,e){const r=e.getBBox({rotate:n});return r?t?t.union(r):r:t}),null)},translate:function(t,e,n){var r=this.getCells().filter((function(t){return!t.isEmbedded()}));invoke(r,"translate",t,e,n);return this},resize:function(t,e,n){return this.resizeCells(t,e,this.getCells(),n)},resizeCells:function(t,e,n,r){var i=this.getCellsBBox(n);if(i){var o=Math.max(t/i.width,0);var s=Math.max(e/i.height,0);invoke(n,"scale",o,s,i.origin(),r)}return this},startBatch:function(t,e){e=e||{};this._batches[t]=(this._batches[t]||0)+1;return this.trigger("batch:start",Ne({},e,{batchName:t}))},stopBatch:function(t,e){e=e||{};this._batches[t]=(this._batches[t]||0)-1;return this.trigger("batch:stop",Ne({},e,{batchName:t}))},hasActiveBatch:function(t){const e=this._batches;let n;n=arguments.length===0?Object.keys(e):Array.isArray(t)?t:[t];return n.some((t=>e[t]>0))}},{validations:{multiLinks:function(t,e){var{source:n,target:r}=e.attributes;if(n.id&&r.id){var i=e.getSourceCell();if(i){var o=t.getConnectedLinks(i,{outbound:true});var s=o.filter((function(t){var{source:e,target:i}=t.attributes;return e&&e.id===n.id&&(!e.port||e.port===n.port)&&i&&i.id===r.id&&(!i.port||i.port===r.port)}));if(s.length>1)return false}}return true},linkPinning:function(t,e){var{source:n,target:r}=e.attributes;return n.id&&r.id}}});wrapWith(ji.prototype,["resetCells","addCells","removeCells"],Vn.cells);const Gi={GRID:"grid",CELLS:"cells",BACK:"back",FRONT:"front",TOOLS:"tools",LABELS:"labels"};const Ui=Ir.extend({tagName:"g",svgElement:true,pivotNodes:null,defaultTheme:null,options:{name:""},className:function(){return addClassNamePrefix(`${this.options.name}-layer`)},init:function(){this.pivotNodes={}},insertSortedNode:function(t,e){this.el.insertBefore(t,this.insertPivot(e))},insertNode:function(t){const{el:e}=this;t.parentNode!==e&&e.appendChild(t)},insertPivot:function(t){const{el:e,pivotNodes:n}=this;t=+t;t||(t=0);let r=n[t];if(r)return r;r=n[t]=document.createComment("z-index:"+(t+1));let i=-Infinity;for(let e in n){e=+e;if(e<t&&e>i){i=e;if(i===t-1)continue}}if(i!==-Infinity){const t=n[i];e.insertBefore(r,t.nextSibling)}else e.insertBefore(r,e.firstChild);return r},removePivots:function(){const{el:t,pivotNodes:e}=this;for(let n in e)t.removeChild(e[n]);this.pivotNodes={}}});const Wi=["transform","x","y","cx","cy","dx","dy","x1","y1","x2","y2","points","d","r","rx","ry","width","height","stroke-width","font-size"];const Hi=["r","rx","ry","width","height","stroke-width","font-size"];const $i=Wi.reduce(((t,e)=>{t[e]=true;return t}),{});const qi=Hi.reduce(((t,e)=>{t[e]=true;return t}),{});function evalAttributes(t,e){const n={};for(let r in t)t.hasOwnProperty(r)&&(n[r]=evalAttribute(r,t[r],e));return n}function evalAttribute(t,e,n){if(t in $i&&isCalcExpression(e)){let r=evalCalcExpression(e,n);t in qi&&(r=Math.max(0,r));return r}return e}const Yi={DEFAULT:"default",EMBEDDING:"embedding",CONNECTING:"connecting",MAGNET_AVAILABILITY:"magnetAvailability",ELEMENT_AVAILABILITY:"elementAvailability"};const Xi={TOOLS:"TOOLS"};const Zi=Ir.extend({tagName:"g",svgElement:true,selector:"root",metrics:null,className:function(){var t=["cell"];var e=this.model.get("type");e&&e.toLowerCase().split(".").forEach((function(e,n,r){t.push("type-"+r.slice(0,n+1).join("-"))}));return t.join(" ")},_presentationAttributes:null,_flags:null,setFlags:function(){var t={};var e={};var n=0;var r,i,o;var s=result(this,"presentationAttributes");for(var a in s)if(s.hasOwnProperty(a)){var c=s[a];Array.isArray(c)||(c=[c]);for(r=0,i=c.length;r<i;r++){o=c[r];var l=t[o];l||(l=t[o]=1<<n++);e[a]|=l}}var u=result(this,"initFlag");Array.isArray(u)||(u=[u]);for(r=0,i=u.length;r<i;r++){o=u[r];t[o]||(t[o]=1<<n++)}if(n>25)throw new Error("dia.CellView: Maximum number of flags exceeded.");this._flags=t;this._presentationAttributes=e},hasFlag:function(t,e){return t&this.getFlag(e)},removeFlag:function(t,e){return t^t&this.getFlag(e)},getFlag:function(t){var e=this._flags;if(!e)return 0;var n=0;if(Array.isArray(t))for(var r=0,i=t.length;r<i;r++)n|=e[t[r]];else n|=e[t];return n},attributes:function(){var t=this.model;return{"model-id":t.id,"data-type":t.attributes.type}},constructor:function(t){t.id=t.id||guid(this);Ir.call(this,t)},initialize:function(){this.setFlags();Ir.prototype.initialize.apply(this,arguments);this.cleanNodesCache();this.startListening()},startListening:function(){this.listenTo(this.model,"change",this.onAttributesChange)},onAttributesChange:function(t,e){var n=t.getChangeFlag(this._presentationAttributes);if(!e.updateHandled&&n){e.dirty&&this.hasFlag(n,"UPDATE")&&(n|=this.getFlag("RENDER"));e.tool&&(e.async=false);this.requestUpdate(n,e)}},requestUpdate:function(t,e){const{paper:n}=this;n&&t>0&&n.requestViewUpdate(this,t,this.UPDATE_PRIORITY,e)},parseDOMJSON:function(t,e){var n=parseDOMJSON(t);var r=n.selectors;var i=n.groupSelectors;for(var o in i){if(r[o])throw new Error("dia.CellView: ambiguous group selector");r[o]=i[o]}if(e){var s=this.selector;if(r[s])throw new Error("dia.CellView: ambiguous root selector.");r[s]=e}return{fragment:n.fragment,selectors:r}},can:function(t){var e=isFunction(this.options.interactive)?this.options.interactive(this):this.options.interactive;return isObject(e)&&e[t]!==false||isBoolean(e)&&e!==false},findBySelector:function(t,e,n){if(!t||t===".")return[e];if(n){var r=n[t];if(r)return Array.isArray(r)?r:[r]}return this.useCSSSelectors?$(e).find(t).toArray():[]},findNodes:function(t){return this.findBySelector(t,this.el,this.selectors)},findNode:function(t){const[e=null]=this.findNodes(t);return e},notify:function(t){if(this.paper){var e=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[t].concat(e));this.paper.trigger.apply(this.paper,[t,this].concat(e))}},getBBox:function(t){var e;if(t&&t.useModelGeometry){var n=this.model;e=n.getBBox().bbox(n.angle())}else e=this.getNodeBBox(this.el);return this.paper.localToPaperRect(e)},getNodeBBox:function(t){const e=this.getNodeBoundingRect(t);const n=this.getRootTranslateMatrix().multiply(this.getNodeRotateMatrix(t));const r=this.getNodeMatrix(t);return J.transformRect(e,n.multiply(r))},getNodeRotateMatrix(t){return!this.rotatableNode||this.rotatableNode.contains(t)?this.getRootRotateMatrix():J.createSVGMatrix()},getNodeUnrotatedBBox:function(t){var e=this.getNodeBoundingRect(t);var n=this.getNodeMatrix(t);var r=this.getRootTranslateMatrix();return J.transformRect(e,r.multiply(n))},getRootTranslateMatrix:function(){var t=this.model;var e=t.position();var n=J.createSVGMatrix().translate(e.x,e.y);return n},getRootRotateMatrix:function(){var t=J.createSVGMatrix();var e=this.model;var n=e.angle();if(n){var r=e.getBBox();var i=r.width/2;var o=r.height/2;t=t.translate(i,o).rotate(n).translate(-i,-o)}return t},_notifyHighlight:function(t,e,n={}){const{el:r}=this;let i;typeof e==="string"?i=this.findNode(e)||r:[i=r]=this.$(e);n.partial=i!==r;if(n.type===void 0){let t;switch(true){case n.embedding:t=Yi.EMBEDDING;break;case n.connecting:t=Yi.CONNECTING;break;case n.magnetAvailability:t=Yi.MAGNET_AVAILABILITY;break;case n.elementAvailability:t=Yi.ELEMENT_AVAILABILITY;break;default:t=Yi.DEFAULT;break}n.type=t}this.notify(t,i,n);return this},highlight:function(t,e){return this._notifyHighlight("cell:highlight",t,e)},unhighlight:function(t,e={}){return this._notifyHighlight("cell:unhighlight",t,e)},findMagnet:function(t){const e=this.el;let n=this.$(t)[0];n||(n=e);do{const t=n.getAttribute("magnet");const r=n===e;if((t||r)&&t!=="false")return n;if(r)return;n=n.parentNode}while(n)},findProxyNode:function(t,e){t||(t=this.el);const n=t.getAttribute(`${e}-selector`);if(n){const t=this.findNode(n);if(t)return t}return t},getSelector:function(t,e){var n;if(t===this.el){typeof e==="string"&&(n=":scope > "+e);return n}if(t){var r=J(t).index()+1;n=t.tagName+":nth-child("+r+")";e&&(n+=" > "+e);n=this.getSelector(t.parentNode,n)}return n},addLinkFromMagnet:function(t,e,n){var r=this.paper;var i=r.model;var o=r.getDefaultLink(this,t);o.set({source:this.getLinkEnd(t,e,n,o,"source"),target:{x:e,y:n}}).addTo(i,{async:false,ui:true});return o.findView(r)},getLinkEnd:function(t,...e){const n=this.model;const r=n.id;const i=this.findAttributeNode("port",t);const o=t.getAttribute("joint-selector");const s={id:r};o!=null&&(s.magnet=o);if(i!=null){let e=i.getAttribute("port");i.getAttribute("port-id-type")==="number"&&(e=parseInt(e,10));s.port=e;n.hasPort(e)||o||(s.selector=this.getSelector(t))}else o==null&&this.el!==t&&(s.selector=this.getSelector(t));return this.customizeLinkEnd(s,t,...e)},customizeLinkEnd:function(t,e,n,r,i,o){const{paper:s}=this;const{connectionStrategy:a}=s.options;if(typeof a==="function"){var c=a.call(s,t,this,e,new Point(n,r),i,o,s);if(c)return c}return t},getMagnetFromLinkEnd:function(t){var e=t.port;var n=t.magnet;var r=this.model;var i;if(e!=null&&r.isElement()&&r.hasPort(e))i=this.findPortNode(e,n)||this.el;else{n||(n=t.selector);n||e==null||(n='[port="'+e+'"]');i=this.findNode(n)}return this.findProxyNode(i,"magnet")},dragLinkStart:function(t,e,n,r){this.model.startBatch("add-link");const i=this.addLinkFromMagnet(e,n,r);i.notifyPointerdown(t,n,r);i.eventData(t,i.startArrowheadMove("target",{whenNotAllowed:"remove"}));this.eventData(t,{linkView:i})},dragLink:function(t,e,n){var r=this.eventData(t);var i=r.linkView;if(i)i.pointermove(t,e,n);else{var o=this.paper;var s=o.options.magnetThreshold;var a=this.getEventTarget(t);var c=r.targetMagnet;if(s==="onleave"){if(c===a||J(c).contains(a))return}else if(o.eventData(t).mousemoved<=s)return;this.dragLinkStart(t,c,e,n)}},dragLinkEnd:function(t,e,n){var r=this.eventData(t);var i=r.linkView;if(i){i.pointerup(t,e,n);this.model.stopBatch("add-link")}},getAttributeDefinition:function(t){return this.model.constructor.getAttributeDefinition(t)},setNodeAttributes:function(t,e){isEmpty(e)||(t instanceof SVGElement?J(t).attr(e):$(t).attr(e))},processNodeAttributes:function(t,e){var n,r,i,o,s;var a,c,l,u;var h=[];const d={};for(n in e)e.hasOwnProperty(n)&&(d[J.attributeNames[n]]=e[n]);for(n in d)if(d.hasOwnProperty(n)){r=d[n];i=this.getAttributeDefinition(n);if(i)if(r===null){let e;e=isFunction(i.unset)?i.unset.call(this,t,d,this):i.unset;!e&&isString(i.set)&&(e=i.set);e||(e=n);if(isString(e)&&e){a||(a={});if(e in a)continue;a[e]=r}else if(Array.isArray(e)&&e.length>0){a||(a={});for(o=0,s=e.length;o<s;o++){const t=e[o];t in a||(a[t]=r)}}}else if(!isFunction(i.qualify)||i.qualify.call(this,r,t,d,this)){if(isString(i.set)){a||(a={});a[i.set]=r}h.push(n,i)}else{a||(a={});a[n]=r}else{a||(a={});a[n]=r}}for(o=0,s=h.length;o<s;o+=2){n=h[o];i=h[o+1];r=e[n];if(isFunction(i.set)){c||(c={});c[n]=r}if(isFunction(i.position)){l||(l={});l[n]=r}if(isFunction(i.offset)){u||(u={});u[n]=r}}return{raw:d,normal:a,set:c,position:l,offset:u}},updateRelativeAttributes:function(t,e,n,r){r||(r={});var i,o,s;var a=evalAttributes(e.raw||{},n);var c=e.normal||{};for(const t in c)c[t]=a[t];var l=e.set;var u=e.position;var h=e.offset;for(i in l){o=a[i];s=this.getAttributeDefinition(i);var d=s.set.call(this,o,n.clone(),t,a,this);isObject(d)?Ne(c,d):d!==void 0&&(c[i]=d)}if(t instanceof HTMLElement)this.setNodeAttributes(t,c);else{var f=c.transform;var p=J.transformStringToMatrix(f);var g=Point(p.e,p.f);if(f){c=omit(c,"transform");p.e=p.f=0}var v,m,y;if(u||h){var b=this.getNodeScale(t,r.scalableNode);v=b.sx;m=b.sy}var x=false;for(i in u){o=a[i];s=this.getAttributeDefinition(i);y=s.position.call(this,o,n.clone(),t,a,this);if(y){g.offset(Point(y).scale(v,m));x||(x=true)}}this.setNodeAttributes(t,c);var w=false;if(h){var A=this.getNodeBoundingRect(t);if(A.width>0&&A.height>0){var P=J.transformRect(A,p).scale(1/v,1/m);for(i in h){o=a[i];s=this.getAttributeDefinition(i);y=s.offset.call(this,o,P,t,a,this);if(y){g.offset(Point(y).scale(v,m));w||(w=true)}}}}if(f!==void 0||x||w){g.round(1);p.e=g.x;p.f=g.y;t.setAttribute("transform",J.matrixToTransformString(p))}}},getNodeScale:function(t,e){var n,r;if(e&&e.contains(t)){var i=e.scale();n=1/i.sx;r=1/i.sy}else{n=1;r=1}return{sx:n,sy:r}},cleanNodesCache:function(){this.metrics={}},cleanNodeCache:function(t){const e=t.id;e&&delete this.metrics[e]},nodeCache:function(t){var e=this.metrics;if(!e)return{};var n=J.ensureId(t);var r=e[n];r||(r=e[n]={});return r},getNodeData:function(t){var e=this.nodeCache(t);e.data||(e.data={});return e.data},getNodeBoundingRect:function(t){var e=this.nodeCache(t);e.boundingRect===void 0&&(e.boundingRect=J(t).getBBox());return new Rect(e.boundingRect)},getNodeMatrix:function(t){const e=this.nodeCache(t);if(e.magnetMatrix===void 0){const{rotatableNode:n,el:r}=this;let i;i=n&&n.contains(t)?n:r;e.magnetMatrix=J(t).getTransformToElement(i)}return J.createSVGMatrix(e.magnetMatrix)},getNodeShape:function(t){var e=this.nodeCache(t);e.geometryShape===void 0&&(e.geometryShape=J(t).toGeometryShape());return e.geometryShape.clone()},isNodeConnection:function(t){return this.model.isLink()&&(!t||t===this.el)},findNodesAttributes:function(t,e,n,r){var i,o,s,a;var c={};var l=[];for(var u in t)if(t.hasOwnProperty(u)){s=t[u];if(isPlainObject(s)){var h=n[u]=this.findBySelector(u,e,r);for(i=0,o=h.length;i<o;i++){var d=h[i];a=J.ensureId(d);var f=r&&r[u]===d;var p=c[a];if(p){if(!p.array){l.push(a);p.array=true;p.attributes=[p.attributes];p.selectedLength=[p.selectedLength]}var g=p.attributes;var v=p.selectedLength;if(f){g.unshift(s);v.unshift(-1)}else{var m=sortedIndex(v,o);g.splice(m,0,s);v.splice(m,0,o)}}else c[a]={attributes:s,selectedLength:f?-1:o,node:d,array:false}}}}for(i=0,o=l.length;i<o;i++){a=l[i];s=c[a];s.attributes=Ve({},...s.attributes.reverse())}return c},getEventTarget:function(t,e={}){const{target:n,type:r,clientX:i=0,clientY:o=0}=t;return e.fromPoint||r==="touchmove"||r==="touchend"||"pointerId"in t&&n.hasPointerCapture(t.pointerId)?document.elementFromPoint(i,o):n},updateDOMSubtreeAttributes:function(t,e,n){n||(n={});n.rootBBox||(n.rootBBox=Rect());n.selectors||(n.selectors=this.selectors);var r={};var i={};var o=[];var s=[];var a,c,l,u,h;var d=n.roAttributes;var f=this.findNodesAttributes(d||e,t,r,n.selectors);var p=d?this.findNodesAttributes(e,t,r,n.selectors):f;for(var g in f){u=f[g];l=u.attributes;c=u.node;h=this.processNodeAttributes(c,l);if(h.set||h.position||h.offset||h.raw.ref){var v=p[g]&&p[g].attributes;var m=v&&l.ref===void 0?v.ref:l.ref;var y;if(m){y=(r[m]||this.findBySelector(m,t,n.selectors))[0];if(!y)throw new Error('dia.CellView: "'+m+'" reference does not exist.')}else y=null;a={node:c,refNode:y,processedAttributes:h,allAttributes:v};if(y){var b=s.findIndex((function(t){return t.refNode===c}));b>-1?s.splice(b,0,a):s.push(a)}else o.push(a)}else this.setNodeAttributes(c,evalAttributes(h.normal,n.rootBBox))}o.push(...s);for(let t=0,e=o.length;t<e;t++){a=o[t];c=a.node;y=a.refNode;const e=y?J.ensureId(y):"";let r=i[e];r||(r=i[e]=y?J(y).getBBox({target:getCommonAncestorNode(c,y)}):n.rootBBox);if(d){h=this.processNodeAttributes(c,a.allAttributes);this.mergeProcessedAttributes(h,a.processedAttributes)}else h=a.processedAttributes;this.updateRelativeAttributes(c,h,r,n)}},mergeProcessedAttributes:function(t,e){t.set||(t.set={});t.position||(t.position={});t.offset||(t.offset={});Ne(t.set,e.set);Ne(t.position,e.position);Ne(t.offset,e.offset);var n=t.normal&&t.normal.transform;n!==void 0&&e.normal&&(e.normal.transform=n);t.normal=e.normal},onMount(t){if(!t){this.mountTools();$r.mount(this)}},onDetach(){this.unmountTools();$r.unmount(this)},onRemove:function(){this.removeTools();this.removeHighlighters()},_toolsView:null,hasTools:function(t){var e=this._toolsView;return!!e&&(!t||e.getName()===t)},addTools:function(t){this.removeTools();if(t){this._toolsView=t;t.configure({relatedView:this});t.listenTo(this.paper,"tools:event",this.onToolEvent.bind(this))}return this},unmountTools(){const t=this._toolsView;t&&t.unmount();return this},mountTools(){const t=this._toolsView;t&&!t.isMounted()&&t.mount();return this},updateTools:function(t){var e=this._toolsView;e&&e.update(t);return this},removeTools:function(){var t=this._toolsView;if(t){t.remove();this._toolsView=null}return this},hideTools:function(){var t=this._toolsView;t&&t.hide();return this},showTools:function(){var t=this._toolsView;t&&t.show();return this},onToolEvent:function(t){switch(t){case"remove":this.removeTools();break;case"hide":this.hideTools();break;case"show":this.showTools();break}},removeHighlighters:function(){$r.remove(this)},updateHighlighters:function(t=false){$r.update(this,null,t)},transformHighlighters:function(){$r.transform(this)},preventDefaultInteraction(t){this.eventData(t,{defaultInteractionPrevented:true})},isDefaultInteractionPrevented(t){const{defaultInteractionPrevented:e=false}=this.eventData(t);return e},pointerdblclick:function(t,e,n){this.notify("cell:pointerdblclick",t,e,n)},pointerclick:function(t,e,n){this.notify("cell:pointerclick",t,e,n)},contextmenu:function(t,e,n){this.notify("cell:contextmenu",t,e,n)},pointerdown:function(t,e,n){const{model:r}=this;const{graph:i}=r;if(i){r.startBatch("pointer");this.eventData(t,{graph:i})}this.notify("cell:pointerdown",t,e,n)},pointermove:function(t,e,n){this.notify("cell:pointermove",t,e,n)},pointerup:function(t,e,n){const{graph:r}=this.eventData(t);this.notify("cell:pointerup",t,e,n);r&&r.stopBatch("pointer",{cell:this.model})},mouseover:function(t){this.notify("cell:mouseover",t)},mouseout:function(t){this.notify("cell:mouseout",t)},mouseenter:function(t){this.notify("cell:mouseenter",t)},mouseleave:function(t){this.notify("cell:mouseleave",t)},mousewheel:function(t,e,n,r){this.notify("cell:mousewheel",t,e,n,r)},onevent:function(t,e,n,r){this.notify(e,t,n,r)},onmagnet:function(){},magnetpointerdblclick:function(){},magnetcontextmenu:function(){},checkMouseleave(t){const{paper:e,model:n}=this;if(e.isAsync()){if(n.isLink()){const t=n.getSourceElement();if(t){const n=e.findViewByModel(t);if(n){e.dumpView(n);e.checkViewVisibility(n)}}const r=n.getTargetElement();if(r){const t=e.findViewByModel(r);if(t){e.dumpView(t);e.checkViewVisibility(t)}}}e.dumpView(this);e.checkViewVisibility(this)}const r=this.getEventTarget(t,{fromPoint:true});const i=e.findView(r);if(i!==this){this.mouseleave(t);i&&i.mouseenter(t)}},setInteractivity:function(t){this.options.interactive=t},isIntersecting:function(t,e){return X.exists(t,this.getNodeBBox(this.el),e)},isEnclosedIn:function(t){return t.containsRect(this.getNodeBBox(this.el))},isInArea:function(t,e={}){return e.strict?this.isEnclosedIn(t):this.isIntersecting(t)},isAtPoint:function(t,e){return this.getNodeBBox(this.el).containsPoint(t,e)}},{Flags:Xi,Highlighting:Yi,addPresentationAttributes:function(t){return Ve({},result(this.prototype,"presentationAttributes"),t,(function(t,e){if(t&&e){typeof t==="string"&&(t=[t]);typeof e==="string"&&(e=[e]);return Array.isArray(t)&&Array.isArray(e)?uniq(t.concat(e)):void 0}}))},evalAttribute:evalAttribute});Object.defineProperty(Zi.prototype,"useCSSSelectors",{get(){const t=this.model.useCSSSelectors;return t!==void 0?t:nn.useCSSSelectors}});function getCommonAncestorNode(t,e){let n=t;do{if(n.contains(e))return n;n=n.parentNode}while(n);return null}const Ji={TOOLS:Zi.Flags.TOOLS,UPDATE:"UPDATE",TRANSLATE:"TRANSLATE",RESIZE:"RESIZE",PORTS:"PORTS",ROTATE:"ROTATE",RENDER:"RENDER"};const Ki={MOVE:"move",MAGNET:"magnet"};const Qi=Zi.extend({_removePorts:function(){},_renderPorts:function(){},className:function(){var t=Zi.prototype.className.apply(this).split(" ");t.push("element");return t.join(" ")},initialize:function(){Zi.prototype.initialize.apply(this,arguments);this._initializePorts()},presentationAttributes:{attrs:[Ji.UPDATE],position:[Ji.TRANSLATE,Ji.TOOLS],size:[Ji.RESIZE,Ji.PORTS,Ji.TOOLS],angle:[Ji.ROTATE,Ji.TOOLS],markup:[Ji.RENDER],ports:[Ji.PORTS]},initFlag:[Ji.RENDER],UPDATE_PRIORITY:0,confirmUpdate:function(t,e){const{useCSSSelectors:n}=this;if(this.hasFlag(t,Ji.PORTS)){this._removePorts();this._cleanPortsCache()}let r=false;if(this.hasFlag(t,Ji.RENDER)){this.render();this.updateTools(e);this.updateHighlighters(true);r=true;t=this.removeFlag(t,[Ji.RENDER,Ji.UPDATE,Ji.RESIZE,Ji.TRANSLATE,Ji.ROTATE,Ji.PORTS,Ji.TOOLS])}else{let i=false;if(this.hasFlag(t,Ji.RESIZE)){this.resize(e);i=true;t=this.removeFlag(t,[Ji.RESIZE,Ji.UPDATE]);n&&(t=this.removeFlag(t,Ji.PORTS))}if(this.hasFlag(t,Ji.UPDATE)){this.update(this.model,null,e);t=this.removeFlag(t,Ji.UPDATE);i=true;n&&(t=this.removeFlag(t,Ji.PORTS))}if(this.hasFlag(t,Ji.TRANSLATE)){this.translate();t=this.removeFlag(t,Ji.TRANSLATE);r=true}if(this.hasFlag(t,Ji.ROTATE)){this.rotate();t=this.removeFlag(t,Ji.ROTATE);r=true}if(this.hasFlag(t,Ji.PORTS)){this._renderPorts();i=true;t=this.removeFlag(t,Ji.PORTS)}i&&this.updateHighlighters(false)}r&&this.transformHighlighters();if(this.hasFlag(t,Ji.TOOLS)){this.updateTools(e);t=this.removeFlag(t,Ji.TOOLS)}return t},_initializePorts:function(){},update:function(t,e){this.cleanNodesCache();const{useCSSSelectors:n}=this;n&&this._removePorts();var r=this.model;var i=r.attr();this.updateDOMSubtreeAttributes(this.el,i,{rootBBox:new Rect(r.size()),selectors:this.selectors,scalableNode:this.scalableNode,rotatableNode:this.rotatableNode,roAttributes:e===i?null:e});n&&this._renderPorts()},rotatableSelector:"rotatable",scalableSelector:"scalable",scalableNode:null,rotatableNode:null,renderMarkup:function(){var t=this.model;var e=t.get("markup")||t.markup;if(!e)throw new Error("dia.ElementView: markup required");if(Array.isArray(e))return this.renderJSONMarkup(e);if(typeof e==="string")return this.renderStringMarkup(e);throw new Error("dia.ElementView: invalid markup")},renderJSONMarkup:function(t){var e=this.parseDOMJSON(t,this.el);var n=this.selectors=e.selectors;this.rotatableNode=J(n[this.rotatableSelector])||null;this.scalableNode=J(n[this.scalableSelector])||null;this.vel.append(e.fragment)},renderStringMarkup:function(t){var e=this.vel;e.append(J(t));this.rotatableNode=e.findOne(".rotatable");this.scalableNode=e.findOne(".scalable");var n=this.selectors={};n[this.selector]=this.el},render:function(){this.vel.empty();this.renderMarkup();this.scalableNode&&this.update();this.resize();if(this.rotatableNode){this.rotate();this.translate()}else this.updateTransformation();this.useCSSSelectors||this._renderPorts();return this},resize:function(t){if(this.scalableNode)return this.sgResize(t);this.model.attributes.angle&&this.rotate();this.update()},translate:function(){if(this.rotatableNode)return this.rgTranslate();this.updateTransformation()},rotate:function(){if(this.rotatableNode){this.rgRotate();this.update()}else this.updateTransformation()},updateTransformation:function(){var t=this.getTranslateString();var e=this.getRotateString();e&&(t+=" "+e);this.vel.attr("transform",t)},getTranslateString:function(){const{x:t,y:e}=this.model.position();return`translate(${t},${e})`},getRotateString:function(){const t=this.model.angle();if(!t)return null;const{width:e,height:n}=this.model.size();return`rotate(${t},${e/2},${n/2})`},rgRotate:function(){this.rotatableNode.attr("transform",this.getRotateString())},rgTranslate:function(){this.vel.attr("transform",this.getTranslateString())},sgResize:function(t){var e=this.model;var n=e.angle();var r=e.size();var i=this.scalableNode;var o=false;i.node.getElementsByTagName("path").length>0&&(o=true);var s=i.getBBox({recursive:o});var a=r.width/(s.width||1);var c=r.height/(s.height||1);i.attr("transform","scale("+a+","+c+")");var l=this.rotatableNode;var u=l&&l.attr("transform");if(u){l.attr("transform",u+" rotate("+-n+","+r.width/2+","+r.height/2+")");var h=i.getBBox({target:this.paper.cells});e.set("position",{x:h.x,y:h.y},Ne({updateHandled:true},t));this.translate();this.rotate()}this.update()},prepareEmbedding:function(t={}){const e=t.model||this.model;const n=t.paper||this.paper;const r=n.model;const i=t.initialZIndices={};const o=e.getEmbeddedCells({deep:true});const s=r.getConnectedLinks(e,{deep:true,includeEnclosed:true});[e,...o,...s].forEach((t=>i[t.id]=t.attributes.z));e.startBatch("to-front");e.toFront({deep:true,ui:true});const a=r.getElements().reduce(((t,e)=>Math.max(t,e.attributes.z||0)),0);s.forEach((t=>{t.attributes.z<=a&&t.set("z",a+1,{ui:true})}));e.stopBatch("to-front");const c=e.parent();if(c){const n=r.getCell(c);n.unembed(e,{ui:true});t.initialParentId=c}else t.initialParentId=null},processEmbedding:function(t={},e,n,r){const i=t.model||this.model;const o=t.paper||this.paper;const s=o.model;const{findParentBy:a,frontParentOnly:c,validateEmbedding:l}=o.options;let u;u=isFunction(a)?toArray$1(a.call(s,this,e,n,r)):a==="pointer"?s.findElementsAtPoint({x:n,y:r}):s.findElementsUnderElement(i,{searchBy:a});u=u.filter((t=>t instanceof Dn&&i.id!==t.id&&!t.isEmbeddedIn(i)));c&&(u=u.slice(-1));let h=null;const d=t.candidateEmbedView;for(let t=u.length-1;t>=0;t--){const e=u[t];if(d&&d.model.id==e.id){h=d;break}{const t=e.findView(o);if(!isFunction(l)||l.call(o,this,t)){h=t;break}}}if(h&&h!=d){this.clearEmbedding(t);t.candidateEmbedView=h.highlight(h.findProxyNode(null,"container"),{embedding:true})}!h&&d&&this.clearEmbedding(t)},clearEmbedding:function(t){t||(t={});var e=t.candidateEmbedView;if(e){e.unhighlight(e.findProxyNode(null,"container"),{embedding:true});t.candidateEmbedView=null}},finalizeEmbedding:function(t={}){const e=t.candidateEmbedView;const n=t.model||this.model;const r=t.paper||this.paper;if(e){e.model.embed(n,{ui:true});e.unhighlight(e.findProxyNode(null,"container"),{embedding:true});t.candidateEmbedView=null}else{const{validateUnembedding:e}=r.options;const{initialParentId:n}=t;if(n&&typeof e==="function"&&!e.call(r,this)){this._disallowUnembed(t);return}}r.model.getConnectedLinks(n,{deep:true}).forEach((t=>{t.reparent({ui:true})}))},_disallowUnembed:function(t){const{model:e,whenNotAllowed:n="revert"}=t;const r=e||this.model;const i=t.paper||this.paper;const o=i.model;switch(n){case"remove":r.remove({ui:true});break;case"revert":{const{initialParentId:e,initialPosition:n,initialZIndices:i}=t;if(n){const{x:t,y:e}=n;r.position(t,e,{deep:true,ui:true})}i&&Object.keys(i).forEach((t=>{const e=o.getCell(t);e&&e.set("z",i[t],{ui:true})}));const s=o.getCell(e);s&&s.embed(r,{ui:true});break}}},getTargetParentView:function(t){const{candidateEmbedView:e=null}=this.eventData(t);return e},getDelegatedView:function(){var t=this;var e=t.model;var n=t.paper;while(t){if(e.isLink())break;if(!e.isEmbedded()||t.can("stopDelegation"))return t;e=e.getParentCell();t=n.findViewByModel(e)}return null},findProxyNode:function(t,e){t||(t=this.el);const n=t.getAttribute(`${e}-selector`);if(n){const e=this.findAttribute("port",t);if(e){const t=this.findPortNode(e,n);if(t)return t}else{const t=this.findNode(n);if(t)return t}}return t},notifyPointerdown(t,e,n){Zi.prototype.pointerdown.call(this,t,e,n);this.notify("element:pointerdown",t,e,n)},notifyPointermove(t,e,n){Zi.prototype.pointermove.call(this,t,e,n);this.notify("element:pointermove",t,e,n)},notifyPointerup(t,e,n){this.notify("element:pointerup",t,e,n);Zi.prototype.pointerup.call(this,t,e,n)},pointerdblclick:function(t,e,n){Zi.prototype.pointerdblclick.apply(this,arguments);this.notify("element:pointerdblclick",t,e,n)},pointerclick:function(t,e,n){Zi.prototype.pointerclick.apply(this,arguments);this.notify("element:pointerclick",t,e,n)},contextmenu:function(t,e,n){Zi.prototype.contextmenu.apply(this,arguments);this.notify("element:contextmenu",t,e,n)},pointerdown:function(t,e,n){this.notifyPointerdown(t,e,n);this.dragStart(t,e,n)},pointermove:function(t,e,n){const r=this.eventData(t);const{targetMagnet:i,action:o,delegatedView:s}=r;i&&this.magnetpointermove(t,i,e,n);switch(o){case Ki.MAGNET:this.dragMagnet(t,e,n);break;case Ki.MOVE:(s||this).drag(t,e,n);default:if(r.preventPointerEvents)break;this.notifyPointermove(t,e,n);break}this.eventData(t,r)},pointerup:function(t,e,n){const r=this.eventData(t);const{targetMagnet:i,action:o,delegatedView:s}=r;i&&this.magnetpointerup(t,i,e,n);switch(o){case Ki.MAGNET:this.dragMagnetEnd(t,e,n);break;case Ki.MOVE:(s||this).dragEnd(t,e,n);default:if(r.preventPointerEvents)break;this.notifyPointerup(t,e,n)}i&&this.magnetpointerclick(t,i,e,n);this.checkMouseleave(t)},mouseover:function(t){Zi.prototype.mouseover.apply(this,arguments);this.notify("element:mouseover",t)},mouseout:function(t){Zi.prototype.mouseout.apply(this,arguments);this.notify("element:mouseout",t)},mouseenter:function(t){Zi.prototype.mouseenter.apply(this,arguments);this.notify("element:mouseenter",t)},mouseleave:function(t){Zi.prototype.mouseleave.apply(this,arguments);this.notify("element:mouseleave",t)},mousewheel:function(t,e,n,r){Zi.prototype.mousewheel.apply(this,arguments);this.notify("element:mousewheel",t,e,n,r)},onmagnet:function(t,e,n){const{currentTarget:r}=t;this.magnetpointerdown(t,r,e,n);this.eventData(t,{targetMagnet:r});this.dragMagnetStart(t,e,n)},magnetpointerdown:function(t,e,n,r){this.notify("element:magnet:pointerdown",t,e,n,r)},magnetpointermove:function(t,e,n,r){this.notify("element:magnet:pointermove",t,e,n,r)},magnetpointerup:function(t,e,n,r){this.notify("element:magnet:pointerup",t,e,n,r)},magnetpointerdblclick:function(t,e,n,r){this.notify("element:magnet:pointerdblclick",t,e,n,r)},magnetcontextmenu:function(t,e,n,r){this.notify("element:magnet:contextmenu",t,e,n,r)},dragStart:function(t,e,n){if(this.isDefaultInteractionPrevented(t))return;var r=this.getDelegatedView();if(!r||!r.can("elementMove"))return;this.eventData(t,{action:Ki.MOVE,delegatedView:r});const i=r.model.position();r.eventData(t,{initialPosition:i,pointerOffset:i.difference(e,n),restrictedArea:this.paper.getRestrictedArea(r,e,n)})},dragMagnetStart:function(t,e,n){const{paper:r}=this;const i=t.isPropagationStopped();i&&this.eventData(t,{preventPointerEvents:true});if(this.isDefaultInteractionPrevented(t)||!this.can("addLinkFromMagnet"))return;const{targetMagnet:o=t.currentTarget}=this.eventData(t);t.stopPropagation();if(r.options.validateMagnet.call(r,this,o,t)){r.options.magnetThreshold<=0&&this.dragLinkStart(t,o,e,n);this.eventData(t,{action:Ki.MAGNET})}else i?this.dragStart(t,e,n):this.pointerdown(t,e,n)},drag:function(t,e,n){var r=this.paper;var i=r.options.gridSize;var o=this.model;var s=this.eventData(t);var{pointerOffset:a,restrictedArea:c,embedding:l}=s;var u=snapToGrid$1(e+a.x,i);var h=snapToGrid$1(n+a.y,i);o.position(u,h,{restrictedArea:c,deep:true,ui:true});if(r.options.embeddingMode){if(!l){this.prepareEmbedding(s);l=true}this.processEmbedding(s,t,e,n)}this.eventData(t,{embedding:l})},dragMagnet:function(t,e,n){this.dragLink(t,e,n)},dragEnd:function(t,e,n){var r=this.eventData(t);r.embedding&&this.finalizeEmbedding(r)},dragMagnetEnd:function(t,e,n){this.dragLinkEnd(t,e,n)},magnetpointerclick:function(t,e,n,r){var i=this.paper;i.eventData(t).mousemoved>i.options.clickThreshold||this.notify("element:magnet:pointerclick",t,e,n,r)}},{Flags:Ji});Ne(Qi.prototype,Hn);const to={TOOLS:Zi.Flags.TOOLS,RENDER:"RENDER",UPDATE:"UPDATE",LABELS:"LABELS",SOURCE:"SOURCE",TARGET:"TARGET",CONNECTOR:"CONNECTOR"};const eo=Zi.extend({className:function(){var t=Zi.prototype.className.apply(this).split(" ");t.push("link");return t.join(" ")},_labelCache:null,_labelSelectors:null,_V:null,_dragData:null,metrics:null,decimalsRounding:2,initialize:function(){Zi.prototype.initialize.apply(this,arguments);this._labelCache={};this._labelSelectors={};this._V={};this.cleanNodesCache()},presentationAttributes:{markup:[to.RENDER],attrs:[to.UPDATE],router:[to.UPDATE],connector:[to.CONNECTOR],labels:[to.LABELS,to.TOOLS],labelMarkup:[to.LABELS],vertices:[to.UPDATE],source:[to.SOURCE,to.UPDATE],target:[to.TARGET,to.UPDATE]},initFlag:[to.RENDER,to.SOURCE,to.TARGET,to.TOOLS],UPDATE_PRIORITY:1,EPSILON:1e-6,confirmUpdate:function(t,e){e||(e={});if(this.hasFlag(t,to.SOURCE)){if(!this.updateEndProperties("source"))return t;t=this.removeFlag(t,to.SOURCE)}if(this.hasFlag(t,to.TARGET)){if(!this.updateEndProperties("target"))return t;t=this.removeFlag(t,to.TARGET)}const{paper:n,sourceView:r,targetView:i}=this;if(n&&(r&&!n.isViewMounted(r)||i&&!n.isViewMounted(i)))return t;if(this.hasFlag(t,to.RENDER)){this.render();this.updateHighlighters(true);this.updateTools(e);t=this.removeFlag(t,[to.RENDER,to.UPDATE,to.LABELS,to.TOOLS,to.CONNECTOR]);Yn.test("isSafari")&&this.__fixSafariBug268376();return t}let o=false;const{model:s}=this;const{attributes:a}=s;let c=this.hasFlag(t,to.LABELS);if(c){this.onLabelsChange(s,a.labels,e);t=this.removeFlag(t,to.LABELS);o=true}const l=this.hasFlag(t,to.UPDATE);const u=this.hasFlag(t,to.CONNECTOR);if(l||u){if(l)e.translateBy&&s.isRelationshipEmbeddedIn(e.translateBy)?this.translate(e.tx,e.ty):this.update();else{this.updatePath();this.updateDOM()}this.updateTools(e);t=this.removeFlag(t,[to.UPDATE,to.TOOLS,to.CONNECTOR]);c=false;o=true}c&&this.updateLabelPositions();o&&this.updateHighlighters();if(this.hasFlag(t,to.TOOLS)){this.updateTools(e);t=this.removeFlag(t,to.TOOLS)}return t},__fixSafariBug268376:function(){const{el:t}=this;const e=Array.from(t.childNodes);const n=document.createDocumentFragment();for(let r=0,i=e.length;r<i;r++){t.removeChild(e[r]);n.appendChild(e[r])}t.appendChild(n)},requestConnectionUpdate:function(t){this.requestUpdate(this.getFlag(to.UPDATE),t)},isLabelsRenderRequired:function(t={}){const e=this.model.previous("labels");if(!e)return true;if("propertyPathArray"in t&&"propertyValue"in t){var n=t.propertyPathArray||[];var r=n.length;if(r>1){var i=!!e[n[1]];if(i){if(r===2)return"markup"in Object(t.propertyValue);if(n[2]!=="markup")return false}}}return true},onLabelsChange:function(t,e,n){this.isLabelsRenderRequired(n)?this.renderLabels():this.updateLabels()},render:function(){this.vel.empty();this.unmountLabels();this._V={};this.renderMarkup();this.renderLabels();this.update();return this},renderMarkup:function(){var t=this.model;var e=t.get("markup")||t.markup;if(!e)throw new Error("dia.LinkView: markup required");if(Array.isArray(e))return this.renderJSONMarkup(e);if(typeof e==="string")return this.renderStringMarkup(e);throw new Error("dia.LinkView: invalid markup")},renderJSONMarkup:function(t){var e=this.parseDOMJSON(t,this.el);this.selectors=e.selectors;this.vel.append(e.fragment)},renderStringMarkup:function(t){var e=J(t);Array.isArray(e)||(e=[e]);this.vel.append(e)},_getLabelMarkup:function(t){if(t){if(Array.isArray(t))return this.parseDOMJSON(t,null);if(typeof t==="string")return this._getLabelStringMarkup(t);throw new Error("dia.linkView: invalid label markup")}},_getLabelStringMarkup:function(t){var e=J(t);var n=document.createDocumentFragment();if(Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var o=e[r].node;n.appendChild(o)}else n.appendChild(e.node);return{fragment:n,selectors:{}}},_normalizeLabelMarkup:function(t){if(t){var e=t.fragment;if(!(t.fragment instanceof DocumentFragment)||!t.fragment.hasChildNodes())throw new Error("dia.LinkView: invalid label markup.");var n;var r=e.childNodes;n=r.length>1||r[0].nodeName.toUpperCase()!=="G"?J("g").append(e):J(r[0]);n.addClass("label");return{node:n.node,selectors:t.selectors}}},renderLabels:function(){var t=this._V;var e=t.labels;var n=this._labelCache={};var r=this._labelSelectors={};var i=this.model;var o=i.attributes.labels||[];var s=o.length;if(s===0){e&&e.remove();return this}if(e)e.empty();else{e=t.labels=J("g").addClass("labels");if(this.options.labelsLayer){e.addClass(addClassNamePrefix(result(this,"className")));e.attr("model-id",i.id)}}for(var a=0;a<s;a++){var c=o[a];var l=this._normalizeLabelMarkup(this._getLabelMarkup(c.markup));var u;var h;if(l){u=l.node;h=l.selectors}else{var d=i._builtins.defaultLabel;var f=this._normalizeLabelMarkup(this._getLabelMarkup(d.markup));var p=i._getDefaultLabel();var g=this._normalizeLabelMarkup(this._getLabelMarkup(p.markup));var v=g||f;u=v.node;h=v.selectors}u.setAttribute("label-idx",a);e.append(u);n[a]=u;var m=this.selector;if(h[m])throw new Error("dia.LinkView: ambiguous label root selector.");h[m]=u;r[a]=h}e.parent()||this.mountLabels();this.updateLabels();return this},mountLabels:function(){const{el:t,paper:e,model:n,_V:r,options:i}=this;const{labels:o}=r;if(!o||!n.hasLabels())return;const{node:s}=o;i.labelsLayer?e.getLayerView(i.labelsLayer).insertSortedNode(s,n.get("z")):s.parentNode!==t&&t.appendChild(s)},unmountLabels:function(){const{options:t,_V:e}=this;if(!e)return;const{labels:n}=e;n&&t.labelsLayer&&n.remove()},findLabelNodes:function(t,e){const n=this._labelCache[t];if(!n)return[];const r=this._labelSelectors[t];return this.findBySelector(e,n,r)},findLabelNode:function(t,e){const[n=null]=this.findLabelNodes(t,e);return n},_mergeLabelAttrs:function(t,e,n,r){if(e===null)return null;if(e===void 0){if(n===null)return null;if(n===void 0){if(t)return;return r}return t?n:Ve({},r,n)}return t?Ve({},n,e):Ve({},r,n,e)},_mergeLabelSize:function(t,e){if(t===null)return null;if(t===void 0){if(e===null)return null;if(e===void 0)return;return e}return Ve({},e,t)},updateLabels:function(){if(!this._V.labels)return this;this.paper.options.labelLayer||this.cleanNodeCache(this.el);var t=this.model;var e=t.get("labels")||[];var n=this.can("labelMove");var r=t._builtins.defaultLabel;var i=r.attrs;var o=t._getDefaultLabel();var s=o.markup;var a=o.attrs;var c=o.size;for(var l=0,u=e.length;l<u;l++){var h=this._labelCache[l];h.setAttribute("cursor",n?"move":"default");var d=this._labelSelectors[l];var f=e[l];var p=f.markup;var g=f.attrs;var v=f.size;var m=this._mergeLabelAttrs(p||s,g,a,i);var y=this._mergeLabelSize(v,c);this.updateDOMSubtreeAttributes(h,m,{rootBBox:new Rect(y),selectors:d})}return this},removeRedundantLinearVertices:function(t){const e=.001;const n=this.model;const r=n.vertices();const i=[this.sourceAnchor,...r,this.targetAnchor];const o=i.length;const s=new Polyline$1(i);s.simplify({threshold:e});const a=s.points.map((t=>t.toJSON()));const c=a.length;if(o===c)return 0;n.vertices(a.slice(1,c-1),t);return o-c},getEndView:function(t){switch(t){case"source":return this.sourceView||null;case"target":return this.targetView||null;default:throw new Error("dia.LinkView: type parameter required.")}},getEndAnchor:function(t){switch(t){case"source":return new Point(this.sourceAnchor);case"target":return new Point(this.targetAnchor);default:throw new Error("dia.LinkView: type parameter required.")}},getEndConnectionPoint:function(t){switch(t){case"source":return new Point(this.sourcePoint);case"target":return new Point(this.targetPoint);default:throw new Error("dia.LinkView: type parameter required.")}},getEndMagnet:function(t){switch(t){case"source":var e=this.sourceView;if(!e)break;return this.sourceMagnet||e.el;case"target":var n=this.targetView;if(!n)break;return this.targetMagnet||n.el;default:throw new Error("dia.LinkView: type parameter required.")}return null},update:function(){this.updateRoute();this.updatePath();this.updateDOM();return this},translate:function(t=0,e=0){const{route:n,path:r}=this;if(!n||!r)return;const i=new Polyline$1(n);i.translate(t,e);this.route=i.points;this.sourcePoint.offset(t,e);this.targetPoint.offset(t,e);this.sourceAnchor.offset(t,e);this.targetAnchor.offset(t,e);r.translate(t,e);this.updateDOM()},updateDOM(){const{el:t,model:e,selectors:n}=this;this.cleanNodesCache();this.updateDOMSubtreeAttributes(t,e.attr(),{selectors:n});this.updateLabelPositions();this.options.perpendicular=null},updateRoute:function(){const{model:t}=this;const e=t.vertices();const n=this.findAnchors(e);const r=this.sourceAnchor=n.source;const i=this.targetAnchor=n.target;const o=this.findRoute(e);this.route=o;var s=this.findConnectionPoints(o,r,i);this.sourcePoint=s.source;this.targetPoint=s.target},updatePath:function(){const{route:t,sourcePoint:e,targetPoint:n}=this;const r=this.findPath(t,e.clone(),n.clone());this.path=r},findAnchorsOrdered:function(t,e,n,r){var i,o;var s,a;var c=this.model;var l=c.get(t);var u=c.get(n);var h=this.getEndView(t);var d=this.getEndView(n);var f=this.getEndMagnet(t);var p=this.getEndMagnet(n);if(h){s=e?new Point(e):d?p:new Point(u);i=this.getAnchor(l.anchor,h,f,s,t)}else i=new Point(l);if(d){a=new Point(r||i);o=this.getAnchor(u.anchor,d,p,a,n)}else o=new Point(u);var g={};g[t]=i;g[n]=o;return g},findAnchors:function(t){var e=this.model;var n=t[0];var r=t[t.length-1];return e.target().priority&&!e.source().priority?this.findAnchorsOrdered("target",r,"source",n):this.findAnchorsOrdered("source",n,"target",r)},findConnectionPoints:function(t,e,n){var r=t[0];var i=t[t.length-1];var o=this.model;var s=o.get("source");var a=o.get("target");var c=this.sourceView;var l=this.targetView;var u=this.paper.options;var h,d;var f;if(c&&!c.isNodeConnection(this.sourceMagnet)){h=this.sourceMagnet||c.el;var p=s.connectionPoint||u.defaultConnectionPoint;var g=r||n;var v=new Line(g,e);f=this.getConnectionPoint(p,c,h,v,"source")}else f=e;var m;if(l&&!l.isNodeConnection(this.targetMagnet)){d=this.targetMagnet||l.el;var y=a.connectionPoint||u.defaultConnectionPoint;var b=i||e;var x=new Line(b,n);m=this.getConnectionPoint(y,l,d,x,"target")}else m=n;return{source:f,target:m}},getAnchor:function(t,e,n,r,i){var o=e.isNodeConnection(n);var s=this.paper.options;t||(t=o?s.defaultLinkAnchor:this.options.perpendicular?{name:"perpendicular"}:s.defaultAnchor);if(!t)throw new Error("Anchor required.");var a;if(typeof t==="function")a=t;else{var c=t.name;var l=o?"linkAnchorNamespace":"anchorNamespace";a=s[l][c];if(typeof a!=="function")throw new Error("Unknown anchor: "+c)}var u=a.call(this,e,n,r,t.args||{},i,this);return u?u.round(this.decimalsRounding):new Point},getConnectionPoint:function(t,e,n,r,i){var o;var s=r.end;var a=this.paper.options;if(!t)return s;var c;if(typeof t==="function")c=t;else{var l=t.name;c=a.connectionPointNamespace[l];if(typeof c!=="function")throw new Error("Unknown connection point: "+l)}o=c.call(this,r,e,n,t.args||{},i,this);return o?o.round(this.decimalsRounding):s},isIntersecting:function(t,e){const n=this.getConnection();return!!n&&X.exists(t,n,e,{segmentSubdivisions:this.getConnectionSubdivisions()})},isEnclosedIn:function(t){const e=this.getConnection();if(!e)return false;const n=e.bbox();return!!n&&t.containsRect(n)},isAtPoint:function(t){const e=new Rect(t);e.inflate(this.EPSILON);return this.isIntersecting(e)},_getDefaultLabelPositionProperty:function(){var t=this.model;var e=t._builtins.defaultLabel;var n=e.position;var r=t._getDefaultLabel();var i=this._normalizeLabelPosition(r.position);return Ve({},n,i)},_normalizeLabelPosition:function(t){return typeof t==="number"?{distance:t,offset:null,angle:0,args:null}:t},_mergeLabelPositionProperty:function(t,e){return t===null?null:t===void 0?e===null?null:e:Ve({},e,t)},updateLabelPositions:function(){if(!this._V.labels)return this;var t=this.path;if(!t)return this;var e=this.model;var n=e.get("labels")||[];if(!n.length)return this;var r=this._getDefaultLabelPositionProperty();for(var i=0,o=n.length;i<o;i++){var s=this._labelCache[i];if(s){var a=n[i];var c=this._normalizeLabelPosition(a.position);var l=this._mergeLabelPositionProperty(c,r);var u=this._getLabelTransformationMatrix(l);s.setAttribute("transform",J.matrixToTransformString(u));this._cleanLabelMatrices(i)}}return this},_cleanLabelMatrices:function(t){const{metrics:e,_labelSelectors:n}=this;const r=n[t];if(r)for(let t in r){const{id:n}=r[t];n&&n in e&&delete e[n].magnetMatrix}},updateEndProperties:function(t){const{model:e,paper:n}=this;const r=`${t}View`;const i=e.get(t);const o=i&&i.id;if(!o){this[r]=null;this.updateEndMagnet(t);return true}const s=n.getModelById(o);if(!s)throw new Error("LinkView: invalid "+t+" cell.");const a=s.findView(n);if(!a)return false;this[r]=a;this.updateEndMagnet(t);return true},updateEndMagnet:function(t){const e=`${t}Magnet`;const n=this.getEndView(t);if(n){let r=n.getMagnetFromLinkEnd(this.model.get(t));r===n.el&&(r=null);this[e]=r}else this[e]=null},_getLabelPositionProperty:function(t){return this.model.label(t).position||{}},_getLabelPositionAngle:function(t){var e=this._getLabelPositionProperty(t);return e.angle||0},_getLabelPositionArgs:function(t){var e=this._getLabelPositionProperty(t);return e.args},_getDefaultLabelPositionArgs:function(){var t=this.model._getDefaultLabel();var e=t.position||{};return e.args},_mergeLabelPositionArgs:function(t,e){return t===null?null:t===void 0?e===null?null:e:Ve({},e,t)},addLabel:function(t,e,n,r){var i;var o;var s=0;var a;if(typeof t!=="number"){i=t.x;o=t.y;if(typeof e==="number"){s=e;a=n}else a=e}else{i=t;o=e;if(typeof n==="number"){s=n;a=r}else a=n}var c=this._getDefaultLabelPositionArgs();var l=a;var u=this._mergeLabelPositionArgs(l,c);var h={position:this.getLabelPosition(i,o,s,u)};var d=-1;this.model.insertLabel(d,h,a);return d},addVertex:function(t,e,n){var r=typeof t!=="number";var i=r?t.x:t;var o=r?t.y:e;var s=r?e:n;var a={x:i,y:o};var c=this.getVertexIndex(i,o);this.model.insertVertex(c,a,s);return c},sendToken:function(t,e,n){function onAnimationEnd(t,e){return function(){t.remove();typeof e==="function"&&e()}}var r,i,o;if(isObject(e)){r=e.duration;i=e.direction==="reverse";o=e.connection}else{r=e;i=false;o=null}r=r||1e3;var s={dur:r+"ms",repeatCount:1,calcMode:"linear",fill:"freeze"};if(i){s.keyPoints="1;0";s.keyTimes="0;1"}var a=J(t);var c;if(typeof o==="string")c=this.findNode(o);else{var l=this._V;c=l.connection?l.connection.node:this.el.querySelector("path")}if(!(c instanceof SVGPathElement))throw new Error("dia.LinkView: token animation requires a valid connection path.");a.appendTo(this.paper.cells).animateAlongPath(s,c);setTimeout(onAnimationEnd(a,n),r)},findRoute:function(t){t||(t=[]);var e=this.paper.options.routerNamespace||Pi;var n=this.model.router();var r=this.paper.options.defaultRouter;if(!n){if(!r)return t.map(Point);n=r}var i=isFunction(n)?n:e[n.name];if(!isFunction(i))throw new Error('dia.LinkView: unknown router: "'+n.name+'".');var o=n.args||{};var s=i.call(this,t,o,this);return s||t.map(Point)},findPath:function(t,e,n){var r=this.paper.options.connectorNamespace||Nr;var i=this.model.connector();var o=this.paper.options.defaultConnector;i||(i=o||{});var s=isFunction(i)?i:r[i.name];if(!isFunction(s))throw new Error('dia.LinkView: unknown connector: "'+i.name+'".');var a=clone$1(i.args||{});a.raw=true;var c=s.call(this,e,n,t,a,this);typeof c==="string"&&(c=new Path$1(J.normalizePathData(c)));return c},getConnection:function(){var t=this.path;return t?t.clone():null},getSerializedConnection:function(){var t=this.path;if(!t)return null;var e=this.metrics;if(e.hasOwnProperty("data"))return e.data;var n=t.serialize();e.data=n;return n},getConnectionSubdivisions:function(){var t=this.path;if(!t)return null;var e=this.metrics;if(e.hasOwnProperty("segmentSubdivisions"))return e.segmentSubdivisions;var n=t.getSegmentSubdivisions();e.segmentSubdivisions=n;return n},getConnectionLength:function(){var t=this.path;if(!t)return 0;var e=this.metrics;if(e.hasOwnProperty("length"))return e.length;var n=t.length({segmentSubdivisions:this.getConnectionSubdivisions()});e.length=n;return n},getPointAtLength:function(t){var e=this.path;return e?e.pointAtLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getPointAtRatio:function(t){var e=this.path;if(!e)return null;isPercentage(t)&&(t=parseFloat(t)/100);return e.pointAt(t,{segmentSubdivisions:this.getConnectionSubdivisions()})},getTangentAtLength:function(t){var e=this.path;return e?e.tangentAtLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getTangentAtRatio:function(t){var e=this.path;return e?e.tangentAt(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getClosestPoint:function(t){var e=this.path;return e?e.closestPoint(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getClosestPointLength:function(t){var e=this.path;return e?e.closestPointLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getClosestPointRatio:function(t){var e=this.path;return e?e.closestPointNormalizedLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getLabelPosition:function(t,e,n,r){var i={};var o=0;var s;if(typeof n==="number"){o=n;s=r}else s=n;s&&(i.args=s);var a=!(s&&s.absoluteDistance);var c=s&&s.absoluteDistance&&s.reverseDistance;var l=s&&s.absoluteOffset;var u=this.path;var h={segmentSubdivisions:this.getConnectionSubdivisions()};var d=new Point(t,e);var f=u.closestPointT(d,h);var p=u.lengthAtT(f,h);a&&(p=p/this.getConnectionLength()||0);c&&(p=-1*(this.getConnectionLength()-p)||1);i.distance=p;var g;l||(g=u.tangentAtT(f));var v;if(g)v=g.pointOffset(d);else{var m=u.pointAtT(f);var y=d.difference(m);v={x:y.x,y:y.y}}i.offset=v;i.angle=o;return i},_getLabelTransformationMatrix:function(t){var e;var n=0;var r={};if(typeof t==="number")e=t;else{if(typeof t.distance!=="number")throw new Error("dia.LinkView: invalid label position distance.");r=t.args||{};e=t.distance;n=t.angle||0}var i=e>0&&e<=1;var o=0;var s={x:0,y:0};if(t.offset){var a=t.offset;typeof a==="number"&&(o=a);a.x&&(s.x=a.x);a.y&&(s.y=a.y)}var c=s.x!==0||s.y!==0||o===0;var l=r.keepGradient;var u=r.ensureLegibility;var h=this.path;var d={segmentSubdivisions:this.getConnectionSubdivisions()};var f=i?e*this.getConnectionLength():e;var p=h.tangentAtLength(f,d);var g;var v=n;if(p){if(c){g=p.start.clone();g.offset(s)}else{var m=p.clone();m.rotate(p.start,-90);m.setLength(o);g=m.end}if(l){v=p.angle()+n;u&&(v=normalizeAngle((v+90)%180-90))}}else{g=h.start.clone();c&&g.offset(s)}return J.createSVGMatrix().translate(g.x,g.y).rotate(v)},getLabelCoordinates:function(t){var e=this._getLabelTransformationMatrix(t);return new Point(e.e,e.f)},getVertexIndex:function(t,e){var n=this.model;var r=n.vertices();var i=this.getClosestPointLength(new Point(t,e));var o=0;for(var s=r.length;o<s;o++){var a=r[o];var c=this.getClosestPointLength(a);if(i<c)break}return o},notifyPointerdown(t,e,n){Zi.prototype.pointerdown.call(this,t,e,n);this.notify("link:pointerdown",t,e,n)},notifyPointermove(t,e,n){Zi.prototype.pointermove.call(this,t,e,n);this.notify("link:pointermove",t,e,n)},notifyPointerup(t,e,n){this.notify("link:pointerup",t,e,n);Zi.prototype.pointerup.call(this,t,e,n)},pointerdblclick:function(t,e,n){Zi.prototype.pointerdblclick.apply(this,arguments);this.notify("link:pointerdblclick",t,e,n)},pointerclick:function(t,e,n){Zi.prototype.pointerclick.apply(this,arguments);this.notify("link:pointerclick",t,e,n)},contextmenu:function(t,e,n){Zi.prototype.contextmenu.apply(this,arguments);this.notify("link:contextmenu",t,e,n)},pointerdown:function(t,e,n){this.notifyPointerdown(t,e,n);this.dragStart(t,e,n)},pointermove:function(t,e,n){var r=this._dragData;r&&this.eventData(t,r);var i=this.eventData(t);switch(i.action){case"label-move":this.dragLabel(t,e,n);break;case"arrowhead-move":this.dragArrowhead(t,e,n);break;case"move":this.drag(t,e,n);break}r&&Ne(r,this.eventData(t));this.notifyPointermove(t,e,n)},pointerup:function(t,e,n){var r=this._dragData;if(r){this.eventData(t,r);this._dragData=null}var i=this.eventData(t);switch(i.action){case"label-move":this.dragLabelEnd(t,e,n);break;case"arrowhead-move":this.dragArrowheadEnd(t,e,n);break;case"move":this.dragEnd(t,e,n)}this.notifyPointerup(t,e,n);this.checkMouseleave(t)},mouseover:function(t){Zi.prototype.mouseover.apply(this,arguments);this.notify("link:mouseover",t)},mouseout:function(t){Zi.prototype.mouseout.apply(this,arguments);this.notify("link:mouseout",t)},mouseenter:function(t){Zi.prototype.mouseenter.apply(this,arguments);this.notify("link:mouseenter",t)},mouseleave:function(t){Zi.prototype.mouseleave.apply(this,arguments);this.notify("link:mouseleave",t)},mousewheel:function(t,e,n,r){Zi.prototype.mousewheel.apply(this,arguments);this.notify("link:mousewheel",t,e,n,r)},onlabel:function(t,e,n){this.notifyPointerdown(t,e,n);this.dragLabelStart(t,e,n);var r=this.eventData(t).stopPropagation;r&&t.stopPropagation()},dragLabelStart:function(t,e,n){if(this.can("labelMove")){if(this.isDefaultInteractionPrevented(t))return;var r=t.currentTarget;var i=parseInt(r.getAttribute("label-idx"),10);var o=this._getDefaultLabelPositionProperty();var s=this._normalizeLabelPosition(this._getLabelPositionProperty(i));var a=this._mergeLabelPositionProperty(s,o);var c=this.getLabelCoordinates(a);var l=c.x-e;var u=c.y-n;var h=this._getLabelPositionAngle(i);var d=this._getLabelPositionArgs(i);var f=this._getDefaultLabelPositionArgs();var p=this._mergeLabelPositionArgs(d,f);this.eventData(t,{action:"label-move",labelIdx:i,dx:l,dy:u,positionAngle:h,positionArgs:p,stopPropagation:true})}else this.eventData(t,{stopPropagation:true});this.paper.delegateDragEvents(this,t.data)},dragArrowheadStart:function(t,e,n){if(this.can("arrowheadMove")){var r=t.target;var i=r.getAttribute("end");var o=this.startArrowheadMove(i,{ignoreBackwardsCompatibility:true});this.eventData(t,o)}},dragStart:function(t,e,n){this.isDefaultInteractionPrevented(t)||this.can("linkMove")&&this.eventData(t,{action:"move",dx:e,dy:n})},dragLabel:function(t,e,n){var r=this.eventData(t);var i={position:this.getLabelPosition(e+r.dx,n+r.dy,r.positionAngle,r.positionArgs)};this.paper.options.snapLabels&&delete i.position.offset;const o={ui:true};this.paper.isAsync()&&t.type==="touchmove"&&(o.async=false);this.model.label(r.labelIdx,i,o)},dragArrowhead:function(t,e,n){if(this.paper.options.snapLinks){const r=this._snapArrowhead(t,e,n);!r&&this.paper.options.snapLinksSelf&&this._snapArrowheadSelf(t,e,n)}else this.paper.options.snapLinksSelf?this._snapArrowheadSelf(t,e,n):this._connectArrowhead(this.getEventTarget(t),e,n,this.eventData(t))},drag:function(t,e,n){var r=this.eventData(t);this.model.translate(e-r.dx,n-r.dy,{ui:true});this.eventData(t,{dx:e,dy:n})},dragLabelEnd:function(){},dragArrowheadEnd:function(t,e,n){var r=this.eventData(t);var i=this.paper;i.options.snapLinks?this._snapArrowheadEnd(r):this._connectArrowheadEnd(r,e,n);if(i.linkAllowed(this)){this._finishEmbedding(r);this._notifyConnectEvent(r,t)}else this._disallow(r);this._afterArrowheadMove(r)},dragEnd:function(){},_disallow:function(t){switch(t.whenNotAllowed){case"remove":this.model.remove({ui:true});break;case"revert":default:this.model.set(t.arrowhead,t.initialEnd,{ui:true});break}},_finishEmbedding:function(t){this.paper.options.embeddingMode&&this.model.reparent()&&(t.z=null)},_notifyConnectEvent:function(t,e){var n=t.arrowhead;var r=t.initialEnd;var i=this.model.prop(n);var o=i&&!qn.endsEqual(r,i);if(o){var s=this.paper;r.id&&this.notify("link:disconnect",e,s.findViewByModel(r.id),t.initialMagnet,n);i.id&&this.notify("link:connect",e,s.findViewByModel(i.id),t.magnetUnderPointer,n)}},_snapToPoints:function(t,e,n){let r=null;let i=Infinity;let o=null;let s=Infinity;let a=t.x;let c=t.y;for(let n=0;n<e.length;n++){const a=Math.abs(e[n].x-t.x);if(a<i){i=a;r=e[n]}const c=Math.abs(e[n].y-t.y);if(c<s){s=c;o=e[n]}}i<n&&(a=r.x);s<n&&(c=o.y);return{x:a,y:c}},_snapArrowheadSelf:function(t,e,n){const{paper:r,model:i}=this;const{snapLinksSelf:o}=r.options;const s=this.eventData(t);const a=o.radius||20;const c=this.getEndAnchor(s.arrowhead==="source"?"target":"source");const l=i.vertices();const u=[c,...l];const h=this._snapToPoints({x:e,y:n},u,a);const d=r.localToClientPoint(h);this._connectArrowhead(document.elementFromPoint(d.x,d.y),h.x,h.y,this.eventData(t))},_snapArrowhead:function(t,e,n){const{paper:r}=this;const{snapLinks:i,connectionStrategy:o}=r.options;const s=this.eventData(t);let a=false;var c=i.radius||50;var l=r.findElementViewsInArea({x:e-c,y:n-c,width:2*c,height:2*c},i.findInAreaOptions);var u=s.closestView||null;var h=s.closestMagnet||null;var d=s.magnetProxy||null;s.closestView=s.closestMagnet=s.magnetProxy=null;var f=Number.MAX_VALUE;var p=new Point(e,n);l.forEach((function(t){const e=[];t.el.getAttribute("magnet")!=="false"&&e.push({bbox:t.model.getBBox(),magnet:t.el});t.$("[magnet]").toArray().forEach((n=>{e.push({bbox:t.getNodeBBox(n),magnet:n})}));e.forEach((e=>{const{magnet:n,bbox:i}=e;const o=i.center().squaredDistance(p);if(o<f){const e=h===n;if(e||r.options.validateConnection.apply(r,s.validateConnectionArgs(t,t.el===n?null:n))){f=o;s.closestView=t;s.closestMagnet=n}}}))}),this);var g;var v=null;var m=s.closestView;var y=s.closestMagnet;y&&(v=s.magnetProxy=m.findProxyNode(y,"highlighter"));var b=s.arrowhead;var x=h!==y;u&&x&&u.unhighlight(d,{connecting:true,snapping:true});if(m){const{prevEnd:t,prevX:r,prevY:i}=s;s.prevX=e;s.prevY=n;a=true;if(!x&&(typeof o!=="function"||r===e&&i===n))return a;g=m.getLinkEnd(y,e,n,this.model,b);if(!x&&isEqual(t,g))return a;s.prevEnd=g;x&&m.highlight(v,{connecting:true,snapping:true})}else g={x:e,y:n};this.model.set(b,g||{x:e,y:n},{ui:true});u&&this.notify("link:snap:disconnect",t,u,h,b);m&&this.notify("link:snap:connect",t,m,y,b);return a},_snapArrowheadEnd:function(t){var e=t.closestView;var n=t.closestMagnet;if(e&&n){e.unhighlight(t.magnetProxy,{connecting:true,snapping:true});t.magnetUnderPointer=e.findMagnet(n)}t.closestView=t.closestMagnet=null},_connectArrowhead:function(t,e,n,r){const{paper:i,model:o}=this;if(r.eventTarget!==t){r.magnetProxy&&r.viewUnderPointer.unhighlight(r.magnetProxy,{connecting:true});const e=r.viewUnderPointer=i.findView(t);if(e){const n=r.magnetUnderPointer=e.findMagnet(t);const o=r.magnetProxy=e.findProxyNode(n,"highlighter");if(n&&this.paper.options.validateConnection.apply(i,r.validateConnectionArgs(e,n)))o&&e.highlight(o,{connecting:true});else{r.magnetUnderPointer=null;r.magnetProxy=null}}else{r.magnetUnderPointer=null;r.magnetProxy=null}}r.eventTarget=t;o.set(r.arrowhead,{x:e,y:n},{ui:true})},_connectArrowheadEnd:function(t={},e,n){const{model:r}=this;const{viewUnderPointer:i,magnetUnderPointer:o,magnetProxy:s,arrowhead:a}=t;if(!o||!s||!i)return;i.unhighlight(s,{connecting:true});const c=i.getLinkEnd(o,e,n,r,a);r.set(a,c,{ui:true})},_beforeArrowheadMove:function(t){t.z=this.model.get("z");this.model.toFront();var e=this.el.style;t.pointerEvents=e.pointerEvents;e.pointerEvents="none";this.paper.options.markAvailable&&this._markAvailableMagnets(t)},_afterArrowheadMove:function(t){if(t.z!==null){this.model.set("z",t.z,{ui:true});t.z=null}this.el.style.pointerEvents=t.pointerEvents;this.paper.options.markAvailable&&this._unmarkAvailableMagnets(t)},_createValidateConnectionArgs:function(t){var e=[];e[4]=t;e[5]=this;var n;var r=0;var i=0;if(t==="source"){r=2;n="target"}else{i=2;n="source"}var o=this.model.get(n);if(o.id){var s=e[r]=this.paper.findViewByModel(o.id);var a=s.getMagnetFromLinkEnd(o);a===s.el&&(a=void 0);e[r+1]=a}function validateConnectionArgs(t,n){e[i]=t;e[i+1]=t.el===n?void 0:n;return e}return validateConnectionArgs},_markAvailableMagnets:function(t){function isMagnetAvailable(t,e){var n=t.paper;var r=n.options.validateConnection;return r.apply(n,this.validateConnectionArgs(t,e))}var e=this.paper;var n=e.model.getCells();t.marked={};for(var r=0,i=n.length;r<i;r++){var o=n[r].findView(e);if(o){var s=Array.prototype.slice.call(o.el.querySelectorAll("[magnet]"));o.el.getAttribute("magnet")!=="false"&&s.push(o.el);var a=s.filter(isMagnetAvailable.bind(t,o));if(a.length>0){for(var c=0,l=a.length;c<l;c++)o.highlight(a[c],{magnetAvailability:true});o.highlight(null,{elementAvailability:true});t.marked[o.model.id]=a}}}},_unmarkAvailableMagnets:function(t){var e=Object.keys(t.marked);var n;var r;for(var i=0,o=e.length;i<o;i++){n=e[i];r=t.marked[n];var s=this.paper.findViewByModel(n);if(s){for(var a=0,c=r.length;a<c;a++)s.unhighlight(r[a],{magnetAvailability:true});s.unhighlight(null,{elementAvailability:true})}}t.marked=null},startArrowheadMove:function(t,e){e||(e={});var n={action:"arrowhead-move",arrowhead:t,whenNotAllowed:e.whenNotAllowed||"revert",initialMagnet:this[t+"Magnet"]||(this[t+"View"]?this[t+"View"].el:null),initialEnd:clone$1(this.model.get(t)),validateConnectionArgs:this._createValidateConnectionArgs(t)};this._beforeArrowheadMove(n);e.ignoreBackwardsCompatibility!==true&&(this._dragData=n);return n},onMount:function(){Zi.prototype.onMount.apply(this,arguments);this.mountLabels()},onDetach:function(){Zi.prototype.onDetach.apply(this,arguments);this.unmountLabels()},onRemove:function(){Zi.prototype.onRemove.apply(this,arguments);this.unmountLabels()}},{Flags:to});Object.defineProperty(eo.prototype,"sourceBBox",{enumerable:true,get:function(){var t=this.sourceView;if(!t){var e=this.model.source();return new Rect(e.x,e.y)}var n=this.sourceMagnet;return t.isNodeConnection(n)?new Rect(this.sourceAnchor):t.getNodeBBox(n||t.el)}});Object.defineProperty(eo.prototype,"targetBBox",{enumerable:true,get:function(){var t=this.targetView;if(!t){var e=this.model.target();return new Rect(e.x,e.y)}var n=this.targetMagnet;return t.isNodeConnection(n)?new Rect(this.targetAnchor):t.getNodeBBox(n||t.el)}});const no=Ui.extend({style:{"pointer-events":"none"},_gridCache:null,_gridSettings:null,init(){Ui.prototype.init.apply(this,arguments);const{options:{paper:t}}=this;this._gridCache=null;this._gridSettings=[];this.listenTo(t,"transform resize",this.updateGrid)},setGrid(t){this._gridSettings=this.getGridSettings(t);this.renderGrid()},getGridSettings(t){const e=[];if(t){const n=Array.isArray(t)?t:[t||{}];n.forEach((t=>{e.push(...this._resolveDrawGridOption(t))}))}return e},removeGrid(){const{_gridCache:t}=this;if(t){t.root.remove();this._gridCache=null}},renderGrid(){const{options:{paper:t}}=this;const{_gridSettings:e}=this;this.removeGrid();if(e.length===0)return;const n=t.options.drawGridSize||t.options.gridSize;if(n<=1)return;const r=this._getGridRefs();e.forEach(((e,i)=>{const o=this._getPatternId(i);const s=Ve({},e);const{scaleFactor:a=1}=s;s.width=n*a||1;s.height=n*a||1;let c;if(r.exist(o))c=r.get(o);else{c=J("pattern",{id:o,patternUnits:"userSpaceOnUse"},J(s.markup));r.add(o,c)}isFunction(s.render)&&s.render(c.node.firstChild,s,t);c.attr({width:s.width,height:s.height})}));r.root.appendTo(this.el);this.updateGrid()},updateGrid(){const{_gridCache:t,_gridSettings:e,options:{paper:n}}=this;if(!t)return;const{root:r,patterns:i}=t;const{x:o,y:s,width:a,height:c}=n.getArea();r.attr({x:o,y:s,width:a,height:c});for(const t in i){const e=i[t];e.attr({x:-o,y:-s})}e.forEach(((t,e)=>{if(isFunction(t.update)){const r=i[this._getPatternId(e)];t.update(r.node.firstChild,t,n)}}))},_getPatternId(t){return`pattern_${this.options.paper.cid}_${t}`},_getGridRefs(){let{_gridCache:t}=this;if(t)return t;const e=J("defs");const n=J("svg",{width:"100%",height:"100%"},[e]);t=this._gridCache={root:n,patterns:{},add:function(t,r){const i=J("rect",{width:"100%",height:"100%",fill:`url(#${t})`});e.append(r);n.append(i);this.patterns[t]=r},get:function(t){return this.patterns[t]},exist:function(t){return this.patterns[t]!==void 0}};return t},_resolveDrawGridOption(t){var e=this.options.patterns;if(isString(t)&&Array.isArray(e[t]))return e[t].map((function(t){return Ne({},t)}));var n=t||{args:[{}]};var r=Array.isArray(n);var i=n.name;r||i||n.markup||(i="dot");if(i&&Array.isArray(e[i])){var o=e[i].map((function(t){return Ne({},t)}));var s=Array.isArray(n.args)?n.args:[n.args||{}];Be(s[0],omit(t,"args"));for(var a=0;a<s.length;a++)o[a]&&Ne(o[a],s[a]);return o}return r?n:[n]}});const ro={NONE:"sorting-none",APPROX:"sorting-approximate",EXACT:"sorting-exact"};const io=50;const oo=20;const so=1e3;const ao=Infinity;const co=9007199254740991;const lo=Zi.Highlighting;const uo={[lo.DEFAULT]:{name:"stroke",options:{padding:3}},[lo.MAGNET_AVAILABILITY]:{name:"addClass",options:{className:"available-magnet"}},[lo.ELEMENT_AVAILABILITY]:{name:"addClass",options:{className:"available-cell"}}};const ho=[{name:Gi.GRID},{name:Gi.BACK},{name:Gi.CELLS},{name:Gi.LABELS},{name:Gi.FRONT},{name:Gi.TOOLS}];const fo=Ir.extend({className:"paper",options:{width:800,height:600,gridSize:1,drawGrid:false,drawGridSize:null,background:false,elementView:Qi,linkView:eo,snapLabels:false,snapLinks:false,snapLinksSelf:false,labelsLayer:false,multiLinks:true,guard:function(t,e){return false},highlighting:uo,preventContextMenu:true,preventDefaultBlankAction:true,preventDefaultViewAction:true,restrictTranslate:false,markAvailable:false,defaultLink:function(){const{cellNamespace:t}=this.model.get("cells");const e=getByPath(t,["standard","Link"]);if(!e)throw new Error("dia.Paper: no default link model found. Use `options.defaultLink` to specify a default link model.");return new e},defaultConnector:{name:"normal"},defaultRouter:{name:"normal"},defaultAnchor:{name:"center"},defaultLinkAnchor:{name:"connectionRatio"},defaultConnectionPoint:{name:"boundary"},connectionStrategy:null,validateMagnet:function(t,e,n){return e.getAttribute("magnet")!=="passive"},validateConnection:function(t,e,n,r,i,o){return(i==="target"?n:t)instanceof Qi},embeddingMode:false,validateEmbedding:function(t,e){return true},validateUnembedding:function(t){return true},findParentBy:"bbox",frontParentOnly:true,interactive:{labelMove:false},linkPinning:true,allowLink:null,clickThreshold:0,moveThreshold:0,magnetThreshold:0,sorting:ro.APPROX,frozen:false,autoFreeze:false,onViewUpdate:function(t,e,n,r,i){e&(t.FLAG_INSERT|t.FLAG_REMOVE)||r.mounting||r.isolate||i.requestConnectedLinksUpdate(t,n,r)},onViewPostponed:function(t,e,n){return n.forcePostponedViewUpdate(t,e)},beforeRender:null,afterRender:null,viewport:null,cellViewNamespace:null,routerNamespace:null,connectorNamespace:null,highlighterNamespace:ei,anchorNamespace:Vi,linkAnchorNamespace:Si,connectionPointNamespace:ci,overflow:false},events:{dblclick:"pointerdblclick",dbltap:"pointerdblclick",contextmenu:"contextmenu",mousedown:"pointerdown",touchstart:"pointerdown",mouseover:"mouseover",mouseout:"mouseout",mouseenter:"mouseenter",mouseleave:"mouseleave",wheel:"mousewheel","mouseenter .joint-cell":"mouseenter","mouseleave .joint-cell":"mouseleave","mouseenter .joint-tools":"mouseenter","mouseleave .joint-tools":"mouseleave","dblclick .joint-cell [magnet]":"magnetpointerdblclick","contextmenu .joint-cell [magnet]":"magnetcontextmenu","mousedown .joint-link .label":"onlabel","touchstart .joint-link .label":"onlabel","dragstart .joint-cell image":"onImageDragStart"},documentEvents:{mousemove:"pointermove",touchmove:"pointermove",mouseup:"pointerup",touchend:"pointerup",touchcancel:"pointerup"},stylesheet:"\n        .joint-element .scalable * {\n            vector-effect: non-scaling-stroke;\n        }\n    ",svg:null,viewport:null,defs:null,tools:null,layers:null,_viewportMatrix:null,_viewportTransformString:null,_updates:null,_layers:null,SORT_DELAYING_BATCHES:["add","to-front","to-back"],UPDATE_DELAYING_BATCHES:["translate"],FORM_CONTROL_TAG_NAMES:["TEXTAREA","INPUT","BUTTON","SELECT","OPTION"],GUARDED_TAG_NAMES:["SELECT"],MIN_SCALE:1e-6,DEFAULT_FIND_BUFFER:200,init:function(){const{options:t}=this;t.cellViewNamespace||(t.cellViewNamespace=typeof joint!=="undefined"&&has(joint,"shapes")?joint.shapes:null);const e=this.model=t.model||new ji;this._layers={};this.cloneOptions();this.render();this._setDimensions();this.startListening();this._views={};this._mw_evt_buffer={event:null,deltas:[]};this.resetViews(e.attributes.cells.models);!this.isFrozen()&&this.isAsync()&&this.updateViewsAsync()},_resetUpdates:function(){this._updates&&this._updates.id&&ln(this._updates.id);return this._updates={id:null,priorities:[{},{},{}],unmountedCids:[],mountedCids:[],unmounted:{},mounted:{},count:0,keyFrozen:false,freezeKey:null,sort:false,disabled:false,idle:false}},startListening:function(){var t=this.model;this.listenTo(t,"add",this.onCellAdded).listenTo(t,"remove",this.onCellRemoved).listenTo(t,"change",this.onCellChange).listenTo(t,"reset",this.onGraphReset).listenTo(t,"sort",this.onGraphSort).listenTo(t,"batch:stop",this.onGraphBatchStop);this.on("cell:highlight",this.onCellHighlight).on("cell:unhighlight",this.onCellUnhighlight).on("transform",this.update)},onCellAdded:function(t,e,n){var r=n.position;if(this.isAsync()||!isNumber(r))this.renderView(t,n);else{n.maxPosition===r&&this.freeze({key:"addCells"});this.renderView(t,n);r===0&&this.unfreeze({key:"addCells"})}},onCellRemoved:function(t,e,n){const r=this.findViewByModel(t);r&&this.requestViewUpdate(r,r.FLAG_REMOVE,r.UPDATE_PRIORITY,n)},onCellChange:function(t,e){if(t!==this.model.attributes.cells&&t.hasChanged("z")&&this.options.sorting===ro.APPROX){const n=this.findViewByModel(t);n&&this.requestViewUpdate(n,n.FLAG_INSERT,n.UPDATE_PRIORITY,e)}},onGraphReset:function(t,e){this.resetLayers();this.resetViews(t.models,e)},onGraphSort:function(){this.model.hasActiveBatch(this.SORT_DELAYING_BATCHES)||this.sortViews()},onGraphBatchStop:function(t){if(!this.isFrozen()){var e=t&&t.batchName;var n=this.model;if(!this.isAsync()){var r=this.UPDATE_DELAYING_BATCHES;r.includes(e)&&!n.hasActiveBatch(r)&&this.updateViews(t)}var i=this.SORT_DELAYING_BATCHES;i.includes(e)&&!n.hasActiveBatch(i)&&this.sortViews()}},cloneOptions:function(){const{options:t}=this;const{defaultConnector:e,defaultRouter:n,defaultConnectionPoint:r,defaultAnchor:i,defaultLinkAnchor:o,highlighting:s,cellViewNamespace:a,interactive:c}=t;!a&&typeof joint!=="undefined"&&has(joint,"shapes")&&(t.cellViewNamespace=joint.shapes);isFunction(e)||(t.defaultConnector=cloneDeep(e));isFunction(n)||(t.defaultRouter=cloneDeep(n));isFunction(r)||(t.defaultConnectionPoint=cloneDeep(r));isFunction(i)||(t.defaultAnchor=cloneDeep(i));isFunction(o)||(t.defaultLinkAnchor=cloneDeep(o));isPlainObject(c)&&(t.interactive=Ne({},c));isPlainObject(s)&&(t.highlighting=Fe({},s,uo))},children:function(){var t=J.namespace;return[{namespaceURI:t.xhtml,tagName:"div",className:addClassNamePrefix("paper-background"),selector:"background",style:{position:"absolute",inset:0}},{namespaceURI:t.svg,tagName:"svg",attributes:{width:"100%",height:"100%","xmlns:xlink":t.xlink},selector:"svg",style:{position:"absolute",inset:0},children:[{tagName:"defs",selector:"defs"},{tagName:"g",className:addClassNamePrefix("layers"),selector:"layers"}]}]},hasLayerView(t){return t in this._layers},getLayerView(t){const{_layers:e}=this;if(t in e)return e[t];throw new Error(`dia.Paper: Unknown layer "${t}"`)},getLayerNode(t){return this.getLayerView(t).el},render:function(){this.renderChildren();const{el:t,childNodes:e,options:n,stylesheet:r}=this;const{svg:i,defs:o,layers:s}=e;t.style.position="relative";i.style.overflow=n.overflow?"visible":"hidden";this.svg=i;this.defs=o;this.layers=s;this.renderLayers();J.ensureId(i);this.addStylesheet(r);n.background&&this.drawBackground(n.background);n.drawGrid&&this.setGrid(n.drawGrid);return this},addStylesheet:function(t){t&&J(this.svg).prepend(J.createSVGStyle(t))},createLayer(t){switch(t){case Gi.GRID:return new no({name:t,paper:this,patterns:this.constructor.gridPatterns});default:return new Ui({name:t})}},renderLayers:function(t=ho){this.removeLayers();t.forEach((({name:t,sorted:e})=>{const n=this.createLayer(t);this.layers.appendChild(n.el);this._layers[t]=n}));const e=this.getLayerView(Gi.CELLS);const n=this.getLayerView(Gi.TOOLS);const r=this.getLayerView(Gi.LABELS);this.tools=n.el;this.cells=this.viewport=e.el;e.vel.addClass(addClassNamePrefix("viewport"));r.vel.addClass(addClassNamePrefix("viewport"));e.el.style.webkitUserSelect="none";e.el.style.userSelect="none";r.el.style.webkitUserSelect="none";r.el.style.userSelect="none"},removeLayers:function(){const{_layers:t}=this;Object.keys(t).forEach((e=>{t[e].remove();delete t[e]}))},resetLayers:function(){const{_layers:t}=this;Object.keys(t).forEach((e=>{t[e].removePivots()}))},update:function(){this._background&&this.updateBackgroundImage(this._background);return this},scale:function(t,e,n){const r=this.matrix();if(t===void 0)return J.matrixToScale(r);e===void 0&&(e=t);t=Math.max(t||0,this.MIN_SCALE);e=Math.max(e||0,this.MIN_SCALE);r.a=t;r.d=e;this.matrix(r,n);return this},scaleUniformAtPoint:function(t,e,n){const{a:r,d:i,e:o,f:s}=this.matrix();t=Math.max(t||0,this.MIN_SCALE);if(t===r&&t===i)return this;const a=J.createSVGMatrix().translate(o-e.x*(t-r),s-e.y*(t-i)).scale(t,t);this.matrix(a,n);return this},translate:function(t,e,n){const r=this.matrix();if(t===void 0)return J.matrixToTranslate(r);t||(t=0);e||(e=0);if(r.e===t&&r.f===e)return this;r.e=t;r.f=e;this.matrix(r,n);return this},matrix:function(t,e={}){var n=this.layers;if(t===void 0){var r=n.getAttribute("transform");if((this._viewportTransformString||null)===r)t=this._viewportMatrix;else{t=n.getCTM();this._viewportMatrix=t;this._viewportTransformString=r}return J.createSVGMatrix(t)}const i=this.matrix();const o=J.createSVGMatrix(t);const s=this._viewportTransformString;const a=J.matrixToTransformString(o);if(a===s)return this;if(!s&&J.matrixToTransformString()===a)return this;const{a:c,d:l,e:u,f:h}=o;n.setAttribute("transform",a);this._viewportMatrix=o;this._viewportTransformString=n.getAttribute("transform");c===i.a&&l===i.d||this.trigger("scale",c,l,e);u===i.e&&h===i.f||this.trigger("translate",u,h,e);this.trigger("transform",o,e);return this},clientMatrix:function(){return J.createSVGMatrix(this.cells.getScreenCTM())},requestConnectedLinksUpdate:function(t,e,n){if(t instanceof Zi){var r=t.model;var i=this.model.getConnectedLinks(r);for(var o=0,s=i.length;o<s;o++){var a=i[o];var c=this.findViewByModel(a);if(c){var l=["UPDATE"];a.getTargetCell()===r&&l.push("TARGET");a.getSourceCell()===r&&l.push("SOURCE");var u=Math.max(e+1,c.UPDATE_PRIORITY);this.scheduleViewUpdate(c,c.getFlag(l),u,n)}}}},forcePostponedViewUpdate:function(t,e){if(!t||!(t instanceof Zi))return false;var n=t.model;if(n.isElement())return false;if((e&t.getFlag(["SOURCE","TARGET"]))===0){var r={silent:true};var i=0;var o=this.findViewByModel(n.getSourceCell());if(o&&!this.isViewMounted(o)){i=this.dumpView(o,r);t.updateEndMagnet("source")}var s=0;var a=this.findViewByModel(n.getTargetCell());if(a&&!this.isViewMounted(a)){s=this.dumpView(a,r);t.updateEndMagnet("target")}if(i===0&&s===0)return!this.dumpView(t,r)}return false},requestViewUpdate:function(t,e,n,r){r||(r={});this.scheduleViewUpdate(t,e,n,r);var i=this.isAsync();if(!(this.isFrozen()||i&&r.async!==false)&&!this.model.hasActiveBatch(this.UPDATE_DELAYING_BATCHES)){var o=this.updateViews(r);i&&this.notifyAfterRender(o,r)}},scheduleViewUpdate:function(t,e,n,r){const{_updates:i,options:o}=this;if(i.idle&&o.autoFreeze){i.idle=false;this.unfreeze()}const{FLAG_REMOVE:s,FLAG_INSERT:a,UPDATE_PRIORITY:c,cid:l}=t;let u=i.priorities[n];u||(u=i.priorities[n]={});if(n>c)for(let t=n-1;t>=c;t--){const e=i.priorities[t];if(e&&l in e){u[l]|=e[l];delete e[l]}}let h=u[l]||0;if((h&e)===e)return;h||i.count++;e&s&&h&a?u[l]^=a:e&a&&h&s&&(u[l]^=s);u[l]|=e;const d=o.onViewUpdate;typeof d==="function"&&d.call(this,t,e,n,r||{},this)},dumpViewUpdate:function(t){if(!t)return 0;var e=this._updates;var n=t.cid;var r=e.priorities[t.UPDATE_PRIORITY];var i=this.registerMountedView(t)|r[n];delete r[n];return i},dumpView:function(t,e={}){const n=this.dumpViewUpdate(t);if(!n)return 0;const r=!e.silent;r&&this.notifyBeforeRender(e);const i=this.updateView(t,n,e);if(r){const n={updated:1,priority:t.UPDATE_PRIORITY};this.notifyAfterRender(n,e)}return i},updateView:function(t,e,n){if(!t)return 0;const{FLAG_REMOVE:r,FLAG_INSERT:i,FLAG_INIT:o,model:s}=t;if(t instanceof Zi){if(e&r){this.removeView(s);return 0}if(e&i){const n=!!(e&o);n&&(e^=o);this.insertView(t,n);e^=i}}return e?t.confirmUpdate(e,n||{}):0},requireView:function(t,e){var n=this.findViewByModel(t);if(!n)return null;this.dumpView(n,e);return n},registerUnmountedView:function(t){var e=t.cid;var n=this._updates;if(e in n.unmounted)return 0;var r=n.unmounted[e]|=t.FLAG_INSERT;n.unmountedCids.push(e);delete n.mounted[e];return r},registerMountedView:function(t){var e=t.cid;var n=this._updates;if(e in n.mounted)return 0;n.mounted[e]=true;n.mountedCids.push(e);var r=n.unmounted[e]||0;delete n.unmounted[e];return r},isViewMounted:function(t){if(!t)return false;var e=t.cid;var n=this._updates;return e in n.mounted},dumpViews:function(t){var e=Be({},t,{viewport:null});this.checkViewport(e);this.updateViews(e)},updateViews:function(t){this.notifyBeforeRender(t);let e;let n=0;let r=0;let i=co;do{r++;e=this.updateViewsBatch(t);n+=e.updated;i=Math.min(e.priority,i)}while(!e.empty);const o={updated:n,batches:r,priority:i};this.notifyAfterRender(o,t);return o},hasScheduledUpdates:function(){const t=this._updates.priorities;const e=Object.keys(t);let n=e.length;while(n>0&&n--)for(let r in t[e[n]])return true;return false},updateViewsAsync:function(t,e){t||(t={});e||(e={processed:0,priority:co});const{_updates:n,options:r}=this;const i=n.id;if(i){ln(i);e.processed===0&&this.hasScheduledUpdates()&&this.notifyBeforeRender(t);const o=this.updateViewsBatch(t);const s=Be({},t,{mountBatchSize:so-o.mounted,unmountBatchSize:so-o.unmounted});const a=this.checkViewport(s);const c=a.unmounted;const l=a.mounted;let u=e.processed;const h=n.count;if(o.updated>0){u+=o.updated+o.unmounted;o.processed=u;e.priority=Math.min(o.priority,e.priority);if(o.empty&&l===0){o.unmounted+=c;o.mounted+=l;o.priority=e.priority;this.notifyAfterRender(o,t);e.processed=0;e.priority=co;n.count=0}else e.processed=u}else if(!n.idle&&r.autoFreeze){this.freeze();n.idle=true;this.trigger("render:idle",t)}const d=t.progress;h&&typeof d==="function"&&d.call(this,o.empty,u,h,o,this);if(n.id!==i)return}if(n.disabled)throw new Error("dia.Paper: can not unfreeze the paper after it was removed");n.id=cn(this.updateViewsAsync,this,t,e)},notifyBeforeRender:function(t={}){let e=t.beforeRender;if(typeof e!=="function"){e=this.options.beforeRender;if(typeof e!=="function")return}e.call(this,t,this)},notifyAfterRender:function(t,e={}){let n=e.afterRender;typeof n!=="function"&&(n=this.options.afterRender);typeof n==="function"&&n.call(this,t,e,this);this.trigger("render:done",t,e)},updateViewsBatch:function(t){t||(t={});var e=t.batchSize||ao;var n=this._updates;var r=0;var i=0;var o=0;var s=0;var a=co;var c=true;var l=this.options;var u=n.priorities;var h="viewport"in t?t.viewport:l.viewport;typeof h!=="function"&&(h=null);var d=l.onViewPostponed;typeof d!=="function"&&(d=null);var f=Object.keys(u);t:for(var p=0,g=f.length;p<g;p++){var v=+f[p];var m=u[v];for(var y in m){if(r>=e){c=false;break t}var b=Br[y];if(b){var x=m[y];if((x&b.FLAG_REMOVE)===0){var w=y in n.unmounted;if(b.DETACHABLE&&h&&!h.call(this,b,!w,this)){if(!w){this.registerUnmountedView(b);this.detachView(b)}n.unmounted[y]|=x;delete m[y];o++;continue}if(w){x|=b.FLAG_INSERT;s++}x|=this.registerMountedView(b)}var A=this.updateView(b,x,t);if(A>0){m[y]=A;if(!d||!d.call(this,b,A,this)||m[y]){i++;c=false;continue}}a>v&&(a=v);r++;delete m[y]}else delete m[y]}}return{priority:a,updated:r,postponed:i,unmounted:o,mounted:s,empty:c}},getUnmountedViews:function(){const t=this._updates;const e=Object.keys(t.unmounted);const n=e.length;const r=new Array(n);for(var i=0;i<n;i++)r[i]=Br[e[i]];return r},getMountedViews:function(){const t=this._updates;const e=Object.keys(t.mounted);const n=e.length;const r=new Array(n);for(var i=0;i<n;i++)r[i]=Br[e[i]];return r},checkUnmountedViews:function(t,e){e||(e={});var n=0;typeof t!=="function"&&(t=null);var r="mountBatchSize"in e?e.mountBatchSize:Infinity;var i=this._updates;var o=i.unmountedCids;var s=i.unmounted;for(var a=0,c=Math.min(o.length,r);a<c;a++){var l=o[a];if(l in s){var u=Br[l];if(u)if(u.DETACHABLE&&t&&!t.call(this,u,false,this))o.push(l);else{n++;var h=this.registerMountedView(u);h&&this.scheduleViewUpdate(u,h,u.UPDATE_PRIORITY,{mounting:true})}}}o.splice(0,a);return n},checkMountedViews:function(t,e){e||(e={});var n=0;if(typeof t!=="function")return n;var r="unmountBatchSize"in e?e.unmountBatchSize:Infinity;var i=this._updates;var o=i.mountedCids;var s=i.mounted;for(var a=0,c=Math.min(o.length,r);a<c;a++){var l=o[a];if(l in s){var u=Br[l];if(u)if(u.DETACHABLE&&!t.call(this,u,true,this)){n++;var h=this.registerUnmountedView(u);h&&this.detachView(u)}else o.push(l)}}o.splice(0,a);return n},checkViewVisibility:function(t,e={}){let n="viewport"in e?e.viewport:this.options.viewport;typeof n!=="function"&&(n=null);const r=this._updates;const{mounted:i,unmounted:o}=r;const s=!t.DETACHABLE||!n||n.call(this,t,false,this);let a=false;let c=false;if(t.cid in i&&!s){const e=this.registerUnmountedView(t);e&&this.detachView(t);const n=r.mountedCids.indexOf(t.cid);r.mountedCids.splice(n,1);a=true}if(!a&&t.cid in o&&s){const e=r.unmountedCids.indexOf(t.cid);r.unmountedCids.splice(e,1);var l=this.registerMountedView(t);l&&this.scheduleViewUpdate(t,l,t.UPDATE_PRIORITY,{mounting:true});c=true}return{mounted:c?1:0,unmounted:a?1:0}},checkViewport:function(t){var e=Be({},t,{mountBatchSize:Infinity,unmountBatchSize:Infinity});var n="viewport"in e?e.viewport:this.options.viewport;var r=this.checkMountedViews(n,e);if(r>0){var i=this._updates.unmountedCids;e.mountBatchSize=Math.min(i.length-r,e.mountBatchSize)}var o=this.checkUnmountedViews(n,e);return{mounted:o,unmounted:r}},freeze:function(t){t||(t={});var e=this._updates;var n=t.key;var r=this.options.frozen;var i=e.freezeKey;if(n&&n!==i){if(r&&i)return;e.freezeKey=n;e.keyFrozen=r}this.options.frozen=true;var o=e.id;e.id=null;this.isAsync()&&o&&ln(o)},unfreeze:function(t){t||(t={});var e=this._updates;var n=t.key;var r=e.freezeKey;if(!n||!r||n===r){e.freezeKey=null;if(!n||n!==r||!e.keyFrozen){if(this.isAsync()){this.freeze();this.updateViewsAsync(t)}else this.updateViews(t);this.options.frozen=e.keyFrozen=false;if(e.sort){this.sortViews();e.sort=false}}}},isAsync:function(){return!!this.options.async},isFrozen:function(){return!!this.options.frozen},isExactSorting:function(){return this.options.sorting===ro.EXACT},onRemove:function(){this.freeze();this._updates.disabled=true;this.removeLayers();this.removeViews()},getComputedSize:function(){var t=this.options;var e=t.width;var n=t.height;isNumber(e)||(e=this.el.clientWidth);isNumber(n)||(n=this.el.clientHeight);return{width:e,height:n}},setDimensions:function(t,e,n={}){const{options:r}=this;const{width:i,height:o}=r;let s=t===void 0?i:t;let a=e===void 0?o:e;if(i===s&&o===a)return;r.width=s;r.height=a;this._setDimensions();const c=this.getComputedSize();this.trigger("resize",c.width,c.height,n)},_setDimensions:function(){const{options:t}=this;let e=t.width;let n=t.height;isNumber(e)&&(e=`${Math.round(e)}px`);isNumber(n)&&(n=`${Math.round(n)}px`);this.$el.css({width:e===null?"":e,height:n===null?"":n})},fitToContent:function(t,e,n,r){r=isObject(t)?t:Ne({gridWidth:t,gridHeight:e,padding:n},r);const{x:i,y:o,width:s,height:a}=this.getFitToContentArea(r);const{sx:c,sy:l}=this.scale();this.translate(-i*c,-o*l,r);this.setDimensions(s*c,a*l,r);return new Rect(i,o,s,a)},getFitToContentArea:function(t={}){const e=t.gridWidth||1;const n=t.gridHeight||1;const r=normalizeSides(t.padding||0);const i=Math.max(t.minWidth||0,e);const o=Math.max(t.minHeight||0,n);const s=t.maxWidth||Number.MAX_VALUE;const a=t.maxHeight||Number.MAX_VALUE;const c=t.allowNewOrigin;const l="contentArea"in t?new Rect(t.contentArea):this.getContentArea(t);const{sx:u,sy:h}=this.scale();l.x*=u;l.y*=h;l.width*=u;l.height*=h;let d=Math.ceil((l.width+l.x)/e);let f=Math.ceil((l.height+l.y)/n);if(!t.allowNegativeBottomRight){d=Math.max(d,1);f=Math.max(f,1)}d*=e;f*=n;let p=0;if(c==="negative"&&l.x<0||c==="positive"&&l.x>=0||c==="any"){p=Math.ceil(-l.x/e)*e;p+=r.left;d+=p}let g=0;if(c==="negative"&&l.y<0||c==="positive"&&l.y>=0||c==="any"){g=Math.ceil(-l.y/n)*n;g+=r.top;f+=g}d+=r.right;f+=r.bottom;d=Math.max(d,i);f=Math.max(f,o);d=Math.min(d,s);f=Math.min(f,a);return new Rect(-p/u,-g/h,d/u,f/h)},transformToFitContent:function(t){t||(t={});let e,n;if("contentArea"in t){const r=t.contentArea;e=this.localToPaperRect(r);n=new Point(r)}else{e=this.getContentBBox(t);n=this.paperToLocalPoint(e)}if(!e.width||!e.height)return;Be(t,{padding:0,preserveAspectRatio:true,scaleGrid:null,minScale:0,maxScale:Number.MAX_VALUE,verticalAlign:"top",horizontalAlign:"left"});const r=normalizeSides(t.padding);const i=t.minScaleX||t.minScale;const o=t.maxScaleX||t.maxScale;const s=t.minScaleY||t.minScale;const a=t.maxScaleY||t.maxScale;let c;if(t.fittingBBox)c=t.fittingBBox;else{const t=this.translate();const e=this.getComputedSize();c={x:t.tx,y:t.ty,width:e.width,height:e.height}}c=new Rect(c).moveAndExpand({x:r.left,y:r.top,width:-r.left-r.right,height:-r.top-r.bottom});const l=this.matrix();const{a:u,d:h,e:d,f:f}=l;let p=c.width/e.width*u;let g=c.height/e.height*h;t.preserveAspectRatio&&(p=g=Math.min(p,g));if(t.scaleGrid){const e=t.scaleGrid;p=e*Math.floor(p/e);g=e*Math.floor(g/e)}p=Math.min(o,Math.max(i,p));g=Math.min(a,Math.max(s,g));const v={x:p/u,y:g/h};let m=c.x-n.x*p-d;let y=c.y-n.y*g-f;switch(t.verticalAlign){case"middle":y+=(c.height-e.height*v.y)/2;break;case"bottom":y+=c.height-e.height*v.y;break;case"top":default:break}switch(t.horizontalAlign){case"middle":m+=(c.width-e.width*v.x)/2;break;case"right":m+=c.width-e.width*v.x;break;case"left":default:break}l.a=p;l.d=g;l.e=m;l.f=y;this.matrix(l,t)},scaleContentToFit:function(t){this.transformToFitContent(t)},getContentArea:function(t){return t&&t.useModelGeometry?this.model.getBBox()||new Rect:J(this.cells).getBBox()},getContentBBox:function(t){return this.localToPaperRect(this.getContentArea(t))},getArea:function(){return this.paperToLocalRect(this.getComputedSize())},getRestrictedArea:function(...t){const{restrictTranslate:e}=this.options;let n;n=isFunction(e)?e.apply(this,t):e===true?this.getArea():e?new Rect(e):null;return n},createViewForModel:function(t){const{options:e}=this;var n;var r;var i=e.cellViewNamespace;var o=t.get("type")+"View";var s=getByPath(i,o,".");if(t.isLink()){n=e.linkView;r=eo}else{n=e.elementView;r=Qi}var a=n.prototype instanceof ViewBase?s||n:n.call(this,t)||s||r;return new a({model:t,interactive:e.interactive,labelsLayer:e.labelsLayer===true?Gi.LABELS:e.labelsLayer})},removeView:function(t){const{id:e}=t;const{_views:n,_updates:r}=this;const i=n[e];if(i){var{cid:o}=i;const{mounted:t,unmounted:s}=r;i.remove();delete n[e];delete t[o];delete s[o]}return i},renderView:function(t,e){const{id:n}=t;const r=this._views;let i,o;let s=true;if(n in r){i=r[n];if(i.model===t){o=i.FLAG_INSERT;s=false}else this.removeView(t)}if(s){i=r[n]=this.createViewForModel(t);i.paper=this;o=this.registerUnmountedView(i)|this.FLAG_INIT|i.getFlag(result(i,"initFlag"))}this.requestViewUpdate(i,o,i.UPDATE_PRIORITY,e);return i},onImageDragStart:function(){return false},resetViews:function(t,e){e||(e={});t||(t=[]);this._resetUpdates();this.removeViews();const n=this.options.autoFreeze?null:"reset";this.freeze({key:n});for(var r=0,i=t.length;r<i;r++)this.renderView(t[r],e);this.unfreeze({key:n});this.sortViews()},removeViews:function(){invoke(this._views,"remove");this._views={}},sortViews:function(){this.isExactSorting()&&(this.isFrozen()?this._updates.sort=true:this.sortViewsExact())},sortViewsExact:function(){var t=Array.from(this.cells.childNodes).filter((t=>t.getAttribute("model-id")));var e=this.model.get("cells");sortElements(t,(function(t,n){var r=e.get(t.getAttribute("model-id"));var i=e.get(n.getAttribute("model-id"));var o=r.attributes.z||0;var s=i.attributes.z||0;return o===s?0:o<s?-1:1}))},insertView:function(t,e){const n=this.getLayerView(Gi.CELLS);const{el:r,model:i}=t;switch(this.options.sorting){case ro.APPROX:n.insertSortedNode(r,i.get("z"));break;case ro.EXACT:default:n.insertNode(r);break}t.onMount(e)},detachView(t){t.unmount();t.onDetach()},findView:function(t){var e=isString(t)?this.cells.querySelector(t):t instanceof $?t[0]:t;var n=this.findAttribute("model-id",e);if(n)return this._views[n]},findViewByModel:function(t){var e=isString(t)||isNumber(t)?t:t&&t.id;return this._views[e]},findViewsFromPoint:function(t){t=new Point(t);var e=this.model.getElements().map(this.findViewByModel,this);return e.filter((function(e){return e&&e.vel.getBBox({target:this.cells}).containsPoint(t)}),this)},findViewsInArea:function(t,e){e=Be(e||{},{strict:false});t=new Rect(t);var n=this.model.getElements().map(this.findViewByModel,this);var r=e.strict?"containsRect":"intersect";return n.filter((function(e){return e&&t[r](e.vel.getBBox({target:this.cells}))}),this)},findElementViewsInArea(t,e){return this._filterViewsInArea(t,((t,e)=>this.model.findElementsInArea(t,e)),e)},findLinkViewsInArea:function(t,e){return this._filterViewsInArea(t,((t,e)=>this.model.findLinksInArea(t,e)),e)},findCellViewsInArea:function(t,e){return this._filterViewsInArea(t,((t,e)=>this.model.findCellsInArea(t,e)),e)},findElementViewsAtPoint:function(t,e){return this._filterViewsAtPoint(t,(t=>this.model.findElementsInArea(t)),e)},findLinkViewsAtPoint:function(t,e){return this._filterViewsAtPoint(t,(t=>this.model.findLinksInArea(t)),e)},findCellViewsAtPoint:function(t,e){return this._filterViewsAtPoint(t,(t=>this.model.findCellsInArea(t)),e)},_findInExtendedArea:function(t,e,n={}){const{buffer:r=this.DEFAULT_FIND_BUFFER}=n;const i=new Rect(t).inflate(r);const o=e(i,n);return o.map((t=>this.findViewByModel(t)))},_filterViewsInArea:function(t,e,n={}){const r=new Rect(t);const i=this._findInExtendedArea(r,e,n);const o=i.filter((t=>!!t&&t.isInArea(r,n)));return o},_filterViewsAtPoint:function(t,e,n={}){const r=new Rect(t);const i=this._findInExtendedArea(r,e,n);const o=i.filter((e=>!!e&&e.isAtPoint(t,n)));return o},removeTools:function(){this.dispatchToolsEvent("remove");return this},hideTools:function(){this.dispatchToolsEvent("hide");return this},showTools:function(){this.dispatchToolsEvent("show");return this},dispatchToolsEvent:function(t,...e){typeof t==="string"&&this.trigger("tools:event",t,...e)},getModelById:function(t){return this.model.getCell(t)},snapToGrid:function(t,e){return this.clientToLocalPoint(t,e).snapToGrid(this.options.gridSize)},localToPaperPoint:function(t,e){var n=new Point(t,e);var r=J.transformPoint(n,this.matrix());return r},localToPaperRect:function(t,e,n,r){var i=new Rect(t,e,n,r);var o=J.transformRect(i,this.matrix());return o},paperToLocalPoint:function(t,e){var n=new Point(t,e);var r=J.transformPoint(n,this.matrix().inverse());return r},paperToLocalRect:function(t,e,n,r){var i=new Rect(t,e,n,r);var o=J.transformRect(i,this.matrix().inverse());return o},localToClientPoint:function(t,e){var n=new Point(t,e);var r=J.transformPoint(n,this.clientMatrix());return r},localToClientRect:function(t,e,n,r){var i=new Rect(t,e,n,r);var o=J.transformRect(i,this.clientMatrix());return o},clientToLocalPoint:function(t,e){var n=new Point(t,e);var r=J.transformPoint(n,this.clientMatrix().inverse());return r},clientToLocalRect:function(t,e,n,r){var i=new Rect(t,e,n,r);var o=J.transformRect(i,this.clientMatrix().inverse());return o},localToPagePoint:function(t,e){return this.localToPaperPoint(t,e).offset(this.pageOffset())},localToPageRect:function(t,e,n,r){return this.localToPaperRect(t,e,n,r).offset(this.pageOffset())},pageToLocalPoint:function(t,e){var n=new Point(t,e);var r=n.difference(this.pageOffset());return this.paperToLocalPoint(r)},pageToLocalRect:function(t,e,n,r){var i=this.pageOffset();var o=new Rect(t,e,n,r);o.x-=i.x;o.y-=i.y;return this.paperToLocalRect(o)},clientOffset:function(){var t=this.svg.getBoundingClientRect();return new Point(t.left,t.top)},pageOffset:function(){return this.clientOffset().offset(window.scrollX,window.scrollY)},linkAllowed:function(t){if(!(t instanceof eo))throw new Error("Must provide a linkView.");var e=t.model;var n=this.options;var r=this.model;var i=r.constructor.validations;return!(!n.multiLinks&&!i.multiLinks.call(this,r,e))&&(!(!n.linkPinning&&!i.linkPinning.call(this,r,e))&&!(typeof n.allowLink==="function"&&!n.allowLink.call(this,t,this)))},getDefaultLink:function(t,e){return isFunction(this.options.defaultLink)?this.options.defaultLink.call(this,t,e):this.options.defaultLink.clone()},resolveHighlighter:function(t={}){let{highlighter:e,type:n}=t;const{highlighting:r,highlighterNamespace:i}=this.options;if(e===void 0){if(!r)return false;if(n){e=r[n];if(e===false)return false}e||(e=r.default)}if(!e)return false;isString(e)&&(e={name:e});const o=e.name;const s=i[o];if(!s)throw new Error('Unknown highlighter ("'+o+'")');if(typeof s.highlight!=="function")throw new Error('Highlighter ("'+o+'") is missing required highlight() method');if(typeof s.unhighlight!=="function")throw new Error('Highlighter ("'+o+'") is missing required unhighlight() method');return{highlighter:s,options:e.options||{},name:o}},onCellHighlight:function(t,e,n){const r=this.resolveHighlighter(n);if(!r)return;const{highlighter:i,options:o}=r;i.highlight(t,e,o)},onCellUnhighlight:function(t,e,n){const r=this.resolveHighlighter(n);if(!r)return;const{highlighter:i,options:o}=r;i.unhighlight(t,e,o)},pointerdblclick:function(t){t.preventDefault();t=normalizeEvent(t);var e=this.findView(t.target);if(!this.guard(t,e)){var n=this.snapToGrid(t.clientX,t.clientY);e?e.pointerdblclick(t,n.x,n.y):this.trigger("blank:pointerdblclick",t,n.x,n.y)}},pointerclick:function(t){var e=this.eventData(t);if(e.mousemoved<=this.options.clickThreshold){t=normalizeEvent(t);var n=this.findView(t.target);if(this.guard(t,n))return;var r=this.snapToGrid(t.clientX,t.clientY);n?n.pointerclick(t,r.x,r.y):this.trigger("blank:pointerclick",t,r.x,r.y)}},contextmenu:function(t){this.options.preventContextMenu&&t.preventDefault();if(this.contextMenuFired)this.contextMenuFired=false;else{t=normalizeEvent(t);this.contextMenuTrigger(t)}},contextMenuTrigger:function(t){var e=this.findView(t.target);if(!this.guard(t,e)){var n=this.snapToGrid(t.clientX,t.clientY);e?e.contextmenu(t,n.x,n.y):this.trigger("blank:contextmenu",t,n.x,n.y)}},pointerdown:function(t){t=normalizeEvent(t);const{target:e,button:n}=t;const r=this.findView(e);const i=n===2;if(r){if(!i&&this.guard(t,r))return;const n=this.FORM_CONTROL_TAG_NAMES.includes(e.tagName);this.options.preventDefaultViewAction&&!n&&t.preventDefault();n&&r.preventDefaultInteraction(t);const o=this.customEventTrigger(t,r);if(o){if(o.isPropagationStopped())return;t.data=o.data}const s=e.closest("[magnet]");if(s&&r.el!==s&&r.el.contains(s)){const e=normalizeEvent(new $.Event(t.originalEvent,{data:t.data,currentTarget:s}));this.onmagnet(e);e.isDefaultPrevented()&&t.preventDefault();if(e.isPropagationStopped()){if(i)return;this.delegateDragEvents(r,e.data);return}t.data=e.data}}if(i){this.contextMenuFired=true;const e=new $.Event(t.originalEvent,{type:"contextmenu",data:t.data});this.contextMenuTrigger(e)}else{const e=this.snapToGrid(t.clientX,t.clientY);if(r)r.pointerdown(t,e.x,e.y);else{this.options.preventDefaultBlankAction&&t.preventDefault();this.trigger("blank:pointerdown",t,e.x,e.y)}this.delegateDragEvents(r,t.data)}},pointermove:function(t){var e=this.eventData(t);if(!e.mousemoved){e.mousemoved=0;this.undelegateEvents()}var n=++e.mousemoved;if(!(n<=this.options.moveThreshold)){t=normalizeEvent(t);var r=this.snapToGrid(t.clientX,t.clientY);var i=e.sourceView;i?i.pointermove(t,r.x,r.y):this.trigger("blank:pointermove",t,r.x,r.y);this.eventData(t,e)}},pointerup:function(t){this.undelegateDocumentEvents();var e=normalizeEvent(t);var n=this.snapToGrid(e.clientX,e.clientY);var r=this.eventData(t).sourceView;r?r.pointerup(e,n.x,n.y):this.trigger("blank:pointerup",e,n.x,n.y);e.isPropagationStopped()||this.pointerclick(new $.Event(t.originalEvent,{type:"click",data:t.data}));this.delegateEvents()},mouseover:function(t){t=normalizeEvent(t);var e=this.findView(t.target);if(!this.guard(t,e))if(e)e.mouseover(t);else{if(this.el===t.target)return;this.trigger("blank:mouseover",t)}},mouseout:function(t){t=normalizeEvent(t);var e=this.findView(t.target);if(!this.guard(t,e))if(e)e.mouseout(t);else{if(this.el===t.target)return;this.trigger("blank:mouseout",t)}},mouseenter:function(t){t=normalizeEvent(t);const{target:e,relatedTarget:n,currentTarget:r}=t;const i=this.findView(e);if(this.guard(t,i))return;const o=this.findView(n);if(i){if(o===i)return;i.mouseenter(t);if(this.el.contains(n))return}o||r===this.el&&this.trigger("paper:mouseenter",t)},mouseleave:function(t){t=normalizeEvent(t);const{target:e,relatedTarget:n,currentTarget:r}=t;const i=this.findView(e);if(this.guard(t,i))return;const o=this.findView(n);if(i){if(o===i)return;i.mouseleave(t);if(this.el.contains(n))return}o||r===this.el&&this.trigger("paper:mouseleave",t)},_processMouseWheelEvtBuf:debounce((function(){const{event:t,deltas:e}=this._mw_evt_buffer;const n=e.reduce(((t,e)=>t+cap(e,io)),0);const r=Math.pow(.995,n);const{x:i,y:o}=this.clientToLocalPoint(t.clientX,t.clientY);this.trigger("paper:pinch",t,i,o,r);this._mw_evt_buffer={event:null,deltas:[]}}),oo,{maxWait:oo}),mousewheel:function(t){t=normalizeEvent(t);const e=this.findView(t.target);if(this.guard(t,e))return;const n=t.originalEvent;const r=this.snapToGrid(n.clientX,n.clientY);const{deltaX:i,deltaY:o}=normalizeWheel(n);const s=this._events["paper:pinch"];if(t.ctrlKey&&s&&s.length>0){n.preventDefault();this._mw_evt_buffer.event=t;this._mw_evt_buffer.deltas.push(o);this._processMouseWheelEvtBuf()}else{const s=Math.max(-1,Math.min(1,n.wheelDelta));e?e.mousewheel(t,r.x,r.y,s):this.trigger("blank:mousewheel",t,r.x,r.y,s);this.trigger("paper:pan",t,i,o)}},onevent:function(t){var e=t.currentTarget;var n=e.getAttribute("event");if(n){var r=this.findView(e);if(r){t=normalizeEvent(t);if(this.guard(t,r))return;var i=this.snapToGrid(t.clientX,t.clientY);r.onevent(t,n,i.x,i.y)}}},magnetEvent:function(t,e){var n=t.currentTarget;var r=n.getAttribute("magnet");if(r){var i=this.findView(n);if(i){t=normalizeEvent(t);if(this.guard(t,i))return;var o=this.snapToGrid(t.clientX,t.clientY);e.call(this,i,t,n,o.x,o.y)}}},onmagnet:function(t){if(t.button===2){this.contextMenuFired=true;this.magnetContextMenuFired=true;const e=new $.Event(t.originalEvent,{type:"contextmenu",data:t.data,currentTarget:t.currentTarget});this.magnetContextMenuTrigger(e);e.isPropagationStopped()&&t.stopPropagation()}else this.magnetEvent(t,(function(t,e,n,r,i){t.onmagnet(e,r,i)}))},magnetpointerdblclick:function(t){this.magnetEvent(t,(function(t,e,n,r,i){t.magnetpointerdblclick(e,n,r,i)}))},magnetcontextmenu:function(t){this.options.preventContextMenu&&t.preventDefault();this.magnetContextMenuFired?this.magnetContextMenuFired=false:this.magnetContextMenuTrigger(t)},magnetContextMenuTrigger:function(t){this.magnetEvent(t,(function(t,e,n,r,i){t.magnetcontextmenu(e,n,r,i)}))},onlabel:function(t){var e=t.currentTarget;var n=this.findView(e);if(!n)return;t=normalizeEvent(t);if(this.guard(t,n))return;const r=this.customEventTrigger(t,n,e);if(r){if(r.isPropagationStopped())return;t.data=r.data}var i=this.snapToGrid(t.clientX,t.clientY);n.onlabel(t,i.x,i.y)},getPointerArgs(t){const e=normalizeEvent(t);const{x:n,y:r}=this.snapToGrid(e.clientX,e.clientY);return[e,n,r]},delegateDragEvents:function(t,e){e||(e={});this.eventData({data:e},{sourceView:t||null,mousemoved:0});this.delegateDocumentEvents(null,e)},guard:function(t,e){if(t.type==="mousedown"&&t.button===2)return true;if(this.options.guard&&this.options.guard(t,e))return true;if(t.data&&t.data.guarded!==void 0)return t.data.guarded;const{target:n}=t;return!!this.GUARDED_TAG_NAMES.includes(n.tagName)||!(e&&e.model&&e.model instanceof Dn)&&(this.el!==n&&!this.svg.contains(n))},setGridSize:function(t){const{options:e}=this;e.gridSize=t;e.drawGrid&&!e.drawGridSize&&this.getLayerView(Gi.GRID).renderGrid();return this},setGrid:function(t){this.getLayerView(Gi.GRID).setGrid(t);return this},updateBackgroundImage:function(t){t=t||{};var e=t.position||"center";var n=t.size||"auto auto";var r=this.scale();var i=this.translate();if(isObject(e)){var o=i.tx+r.sx*(e.x||0);var s=i.ty+r.sy*(e.y||0);e=o+"px "+s+"px"}if(isObject(n)){n=new Rect(n).scale(r.sx,r.sy);n=n.width+"px "+n.height+"px"}const{background:a}=this.childNodes;a.style.backgroundSize=n;a.style.backgroundPosition=e},drawBackgroundImage:function(t,e){if(t instanceof HTMLImageElement){if(this._background&&this._background.id===e.id){e=e||{};var n;var r=e.size;var i=e.repeat||"no-repeat";var o=e.opacity||1;var s=Math.abs(e.quality)||1;var a=this.constructor.backgroundPatterns[camelCase(i)];if(isFunction(a)){t.width*=s;t.height*=s;var c=a(t,e);if(!(c instanceof HTMLCanvasElement))throw new Error("dia.Paper: background pattern must return an HTML Canvas instance");n=c.toDataURL("image/png");i="repeat";if(isObject(r)){r.width*=c.width/t.width;r.height*=c.height/t.height}else r===void 0&&(e.size={width:c.width/s,height:c.height/s})}else{n=t.src;r===void 0&&(e.size={width:t.width,height:t.height})}this.childNodes.background.style.opacity=o;this.childNodes.background.style.backgroundRepeat=i;this.childNodes.background.style.backgroundImage=`url(${n})`;this.updateBackgroundImage(e)}}else this.childNodes.background.style.backgroundImage=""},updateBackgroundColor:function(t){this.$el.css("backgroundColor",t||"")},drawBackground:function(t){t=t||{};this.updateBackgroundColor(t.color);if(t.image){t=this._background=cloneDeep(t);guid(t);var e=document.createElement("img");e.onload=this.drawBackgroundImage.bind(this,e,t);e.src=t.image}else{this.drawBackgroundImage(null);this._background=null}return this},setInteractivity:function(t){this.options.interactive=t;invoke(this._views,"setInteractivity",t)},isDefined:function(t){return!!this.svg.getElementById(t)},defineFilter:function(t){if(!isObject(t))throw new TypeError("dia.Paper: defineFilter() requires 1. argument to be an object.");var e=t.id;var n=t.name;e||(e=n+this.svg.id+hashCode(JSON.stringify(t)));if(!this.isDefined(e)){var r=pn;var i=r[n]&&r[n](t.args||{});if(!i)throw new Error("Non-existing filter "+n);var o=Ne({filterUnits:"userSpaceOnUse"},t.attrs,{id:e});J(i,o).appendTo(this.defs)}return e},defineGradient:function(t){if(!isObject(t))throw new TypeError("dia.Paper: defineGradient() requires 1. argument to be an object.");const{svg:e,defs:n}=this;const{type:r,id:i=r+e.id+hashCode(JSON.stringify(t)),stops:o,attrs:s={}}=t;if(this.isDefined(i))return i;const a=toArray$1(o).map((({offset:t,color:e,opacity:n})=>J("stop").attr({offset:t,"stop-color":e,"stop-opacity":Number.isFinite(n)?n:1})));const c=J(r,s,a);c.id=i;c.appendTo(n);return i},definePattern:function(t){if(!isObject(t))throw new TypeError("dia.Paper: definePattern() requires 1. argument to be an object.");const{svg:e,defs:n}=this;const{id:r=e.id+hashCode(JSON.stringify(t)),markup:i,attrs:o={}}=t;if(!i)throw new TypeError("dia.Paper: definePattern() requires markup.");if(this.isDefined(r))return r;const s=J("pattern",{patternUnits:"userSpaceOnUse"});s.id=r;s.attr(o);if(typeof i==="string")s.append(J(i));else{const{fragment:t}=parseDOMJSON(i);s.append(t)}s.appendTo(n);return r},defineMarker:function(t){if(!isObject(t))throw new TypeError("dia.Paper: defineMarker() requires the first argument to be an object.");const{svg:e,defs:n}=this;const{id:r=e.id+hashCode(JSON.stringify(t)),markup:i,attrs:o={},markerUnits:s="userSpaceOnUse"}=t;if(this.isDefined(r))return r;const a=J("marker",{orient:"auto",overflow:"visible",markerUnits:s});a.id=r;a.attr(o);let c;if(i){let t;if(typeof i==="string"){t=J(i);t=Array.isArray(t)?t:[t]}else{const{fragment:e}=parseDOMJSON(i);t=J(e).children()}c=t.length>1?J("g").append(t):t[0]}else{const{type:e="path"}=t;c=J(e)}const l=omit(t,"type","id","markup","attrs","markerUnits");const u=Object.keys(l);u.forEach((t=>{const e=l[t];const n=c.attr(t);if(n==null)c.attr(t,e);else switch(t){case"transform":c.attr(t,e+" "+n);break}}));c.appendTo(a);a.appendTo(n);return r},customEventTrigger:function(t,e,n=e.el){const r=t.target.closest("[event]");if(r&&n!==r&&e.el.contains(r)){const e=normalizeEvent(new $.Event(t.originalEvent,{data:t.data,currentTarget:r}));this.onevent(e);e.isDefaultPrevented()&&t.preventDefault();return e}return null}},{sorting:ro,Layers:Gi,backgroundPatterns:{flipXy:function(t){var e=document.createElement("canvas");var n=t.width;var r=t.height;e.width=2*n;e.height=2*r;var i=e.getContext("2d");i.drawImage(t,0,0,n,r);i.setTransform(-1,0,0,-1,e.width,e.height);i.drawImage(t,0,0,n,r);i.setTransform(-1,0,0,1,e.width,0);i.drawImage(t,0,0,n,r);i.setTransform(1,0,0,-1,0,e.height);i.drawImage(t,0,0,n,r);return e},flipX:function(t){var e=document.createElement("canvas");var n=t.width;var r=t.height;e.width=n*2;e.height=r;var i=e.getContext("2d");i.drawImage(t,0,0,n,r);i.translate(2*n,0);i.scale(-1,1);i.drawImage(t,0,0,n,r);return e},flipY:function(t){var e=document.createElement("canvas");var n=t.width;var r=t.height;e.width=n;e.height=r*2;var i=e.getContext("2d");i.drawImage(t,0,0,n,r);i.translate(0,2*r);i.scale(1,-1);i.drawImage(t,0,0,n,r);return e},watermark:function(t,e){e=e||{};var n=t.width;var r=t.height;var i=document.createElement("canvas");i.width=n*3;i.height=r*3;var o=i.getContext("2d");var s=isNumber(e.watermarkAngle)?-e.watermarkAngle:-20;var a=toRad(s);var c=i.width/4;var l=i.height/4;for(var u=0;u<4;u++)for(var h=0;h<4;h++)if((u+h)%2>0){o.setTransform(1,0,0,1,(2*u-1)*c,(2*h-1)*l);o.rotate(a);o.drawImage(t,-n/2,-r/2,n,r)}return i}},gridPatterns:{dot:[{color:"#AAAAAA",thickness:1,markup:"rect",render:function(t,e){J(t).attr({width:e.thickness,height:e.thickness,fill:e.color})}}],fixedDot:[{color:"#AAAAAA",thickness:1,markup:"rect",render:function(t,e){J(t).attr({fill:e.color})},update:function(t,e,n){const{sx:r,sy:i}=n.scale();const o=r<=1?e.thickness:e.thickness/r;const s=i<=1?e.thickness:e.thickness/i;J(t).attr({width:o,height:s})}}],mesh:[{color:"#AAAAAA",thickness:1,markup:"path",render:function(t,e){var n;var r=e.width;var i=e.height;var o=e.thickness;n=r-o>=0&&i-o>=0?["M",r,0,"H0 M0 0 V0",i].join(" "):"M 0 0 0 0";J(t).attr({d:n,stroke:e.color,"stroke-width":e.thickness})}}],doubleMesh:[{color:"#AAAAAA",thickness:1,markup:"path",render:function(t,e){var n;var r=e.width;var i=e.height;var o=e.thickness;n=r-o>=0&&i-o>=0?["M",r,0,"H0 M0 0 V0",i].join(" "):"M 0 0 0 0";J(t).attr({d:n,stroke:e.color,"stroke-width":e.thickness})}},{color:"#000000",thickness:3,scaleFactor:4,markup:"path",render:function(t,e){var n;var r=e.width;var i=e.height;var o=e.thickness;n=r-o>=0&&i-o>=0?["M",r,0,"H0 M0 0 V0",i].join(" "):"M 0 0 0 0";J(t).attr({d:n,stroke:e.color,"stroke-width":e.thickness})}}]}});const po=Ir.extend({name:null,tagName:"g",className:"tool",svgElement:true,_visible:true,_visibleExplicit:true,init:function(){var t=this.name;t&&this.vel.attr("data-tool-name",t)},configure:function(t,e){this.relatedView=t;this.paper=t.paper;this.parentView=e;this.simulateRelatedView(this.el);this.delegateEvents();return this},simulateRelatedView:function(t){t&&t.setAttribute("model-id",this.relatedView.model.id)},getName:function(){return this.name},updateVisibility:function(){const t=this.computeVisibility();this.el.style.display=t?"":"none";this._visible=t},computeVisibility(){if(!this.isExplicitlyVisible())return false;const{visibility:t}=this.options;return typeof t!=="function"||!!t.call(this,this.relatedView,this)},show:function(){this._visibleExplicit=true;this.updateVisibility()},hide:function(){this._visibleExplicit=false;this.updateVisibility()},isExplicitlyVisible:function(){return!!this._visibleExplicit},isVisible:function(){return!!this._visible},focus:function(){var t=this.options.focusOpacity;isFinite(t)&&(this.el.style.opacity=t);this.parentView.focusTool(this)},blur:function(){this.el.style.opacity="";this.parentView.blurTool(this)},update:function(){},guard:function(t){const{paper:e,relatedView:n}=this;return!e||!n||e.guard(t,n)}});const go=Ir.extend({tagName:"g",className:"tools",svgElement:true,tools:null,isRendered:false,options:{tools:null,relatedView:null,name:null},configure:function(t){t=Ne(this.options,t);var e=t.tools;if(!Array.isArray(e))return this;var n=t.relatedView;if(!(n instanceof Zi))return this;var r=this.tools=[];for(var i=0,o=e.length;i<o;i++){var s=e[i];if(s instanceof po){s.configure(n,this);this.vel.append(s.el);r.push(s)}}this.isRendered=false;n.requestUpdate(n.getFlag("TOOLS"));return this},getName:function(){return this.options.name},update:function(t){t||(t={});const e=this.tools;if(!e)return this;const n=e.length;const r=this.isRendered;for(let r=0;r<n;r++){const n=e[r];n.updateVisibility();n.isVisible()&&(this.ensureToolRendered(e,r)&&t.tool!==n.cid&&n.update())}if(!this.isRendered&&n>0)return this;this.isMounted()||this.mount();r||this.blurTool();return this},ensureToolRendered(t,e){this.isRendered||(this.isRendered=Array(t.length).fill(false));if(!this.isRendered[e]){t[e].render();this.isRendered[e]=true;return false}return true},focusTool:function(t){var e=this.tools;if(!e)return this;for(var n=0,r=e.length;n<r;n++){var i=e[n];t===i?i.show():i.hide()}return this},blurTool:function(t){var e=this.tools;if(!e)return this;for(var n=0,r=e.length;n<r;n++){var i=e[n];if(i!==t&&!i.isExplicitlyVisible()){i.show();i.isVisible()&&this.ensureToolRendered(e,n)&&i.update()}}return this},hide:function(){return this.focusTool(null)},show:function(){this.blurTool(null);this.isMounted()||this.mount();return this},onRemove:function(){var t=this.tools;if(!t)return this;for(var e=0,n=t.length;e<n;e++)t[e].remove();this.tools=null},mount:function(){const{options:t,el:e}=this;const{relatedView:n,layer:r=Gi.TOOLS,z:i}=t;n&&(r?n.paper.getLayerView(r).insertSortedNode(e,i):n.el.appendChild(e));return this}});var vo=Object.freeze(Object.defineProperty({__proto__:null,Cell:Dn,CellView:Zi,Element:$n,ElementView:Qi,Graph:ji,HighlighterView:$r,LayersNames:Gi,Link:qn,LinkView:eo,Paper:fo,PaperLayer:Ui,ToolView:po,ToolsView:go,attributes:Fn},Symbol.toStringTag,{value:"Module"}));var mo=Ir.extend({tagName:"circle",svgElement:true,className:"marker-vertex",events:{mousedown:"onPointerDown",touchstart:"onPointerDown",dblclick:"onDoubleClick",dbltap:"onDoubleClick"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},attributes:{r:6,fill:"#33334F",stroke:"#FFFFFF","stroke-width":2,cursor:"move"},position:function(t,e){const{vel:n,options:r}=this;const{scale:i}=r;let o=J.createSVGMatrix().translate(t,e);i&&(o=o.scale(i));n.transform(o,{absolute:true})},onPointerDown:function(t){if(!this.options.guard(t)){t.stopPropagation();t.preventDefault();this.options.paper.undelegateEvents();this.delegateDocumentEvents(null,t.data);this.trigger("will-change",this,t)}},onPointerMove:function(t){this.trigger("changing",this,t)},onDoubleClick:function(t){this.trigger("remove",this,t)},onPointerUp:function(t){this.trigger("changed",this,t);this.undelegateDocumentEvents();this.options.paper.delegateEvents()}});const yo=po.extend({name:"vertices",options:{handleClass:mo,snapRadius:20,redundancyRemoval:true,vertexAdding:true,stopPropagation:true,scale:null},children:[{tagName:"path",selector:"connection",className:"joint-vertices-path",attributes:{fill:"none",stroke:"transparent","stroke-width":10,cursor:"cell"}}],handles:null,interactiveLinkNode:null,events:{"mousedown .joint-vertices-path":"onPathPointerDown","touchstart .joint-vertices-path":"onPathPointerDown"},linkEvents:{mousedown:"onLinkPointerDown",touchstart:"onLinkPointerDown"},onRender:function(){const{vertexAdding:t}=this.options;if(t){const{interactiveLinkNode:e=null}=t;if(e)this.delegateLinkEvents(e);else{this.renderChildren();this.updatePath()}}this.resetHandles();this.renderHandles();return this},delegateLinkEvents:function(t){this.undelegateLinkEvents();const e=this.relatedView.findNode(t);if(e){e.classList.add("joint-vertices-path");this.interactiveLinkNode=e;this.delegateElementEvents(e,this.linkEvents)}else console.warn(`Interactive link node "${t}" not found.`)},undelegateLinkEvents:function(){const t=this.interactiveLinkNode;if(t){this.undelegateElementEvents(t);t.classList.remove("joint-vertices-path");this.interactiveLinkNode=null}},update:function(){var t=this.relatedView;var e=t.model.vertices();if(e.length===this.handles.length)this.updateHandles();else{this.resetHandles();this.renderHandles()}this.options.vertexAdding&&this.updatePath();return this},resetHandles:function(){var t=this.handles;this.handles=[];this.stopListening();if(Array.isArray(t))for(var e=0,n=t.length;e<n;e++)t[e].remove()},renderHandles:function(){var t=this.relatedView;var e=t.model.vertices();for(var n=0,r=e.length;n<r;n++){var i=e[n];var o=new this.options.handleClass({index:n,paper:this.paper,scale:this.options.scale,guard:t=>this.guard(t)});o.render();o.position(i.x,i.y);this.simulateRelatedView(o.el);o.vel.appendTo(this.el);this.handles.push(o);this.startHandleListening(o)}},updateHandles:function(){var t=this.relatedView;var e=t.model.vertices();for(var n=0,r=e.length;n<r;n++){var i=e[n];var o=this.handles[n];if(!o)return;o.position(i.x,i.y)}},updatePath:function(){if(this.interactiveLinkNode)return;const t=this.childNodes.connection;t&&t.setAttribute("d",this.relatedView.getSerializedConnection())},startHandleListening:function(t){const{vertexRemoving:e=true,vertexMoving:n=true}=this.options;if(n){this.listenTo(t,"will-change",this.onHandleWillChange);this.listenTo(t,"changing",this.onHandleChanging);this.listenTo(t,"changed",this.onHandleChanged)}e&&this.listenTo(t,"remove",this.onHandleRemove)},getNeighborPoints:function(t){var e=this.relatedView;var n=e.model.vertices();var r=t>0?n[t-1]:e.sourceAnchor;var i=t<n.length-1?n[t+1]:e.targetAnchor;return{prev:new Point(r),next:new Point(i)}},onHandleWillChange:function(t,e){this.focus();const{relatedView:n,options:r}=this;n.model.startBatch("vertex-move",{ui:true,tool:this.cid});r.stopPropagation||n.notifyPointerdown(...n.paper.getPointerArgs(e))},onHandleChanging:function(t,e){const{options:n,relatedView:r}=this;var i=t.options.index;var[o,s,a]=r.paper.getPointerArgs(e);var c={x:s,y:a};this.snapVertex(c,i);r.model.vertex(i,c,{ui:true,tool:this.cid});t.position(c.x,c.y);n.stopPropagation||r.notifyPointermove(o,s,a)},onHandleChanged:function(t,e){const{options:n,relatedView:r}=this;n.vertexAdding&&this.updatePath();if(n.redundancyRemoval){var i=r.removeRedundantLinearVertices({ui:true,tool:this.cid});i&&this.render();this.blur();r.model.stopBatch("vertex-move",{ui:true,tool:this.cid});this.eventData(e).vertexAdded&&r.model.stopBatch("vertex-add",{ui:true,tool:this.cid});var[o,s,a]=r.paper.getPointerArgs(e);n.stopPropagation||r.notifyPointerup(o,s,a);r.checkMouseleave(o)}else r.checkMouseleave(normalizeEvent(e))},snapVertex:function(t,e){var n=this.options.snapRadius;if(n>0){var r=this.getNeighborPoints(e);var i=r.prev;var o=r.next;Math.abs(t.x-i.x)<n?t.x=i.x:Math.abs(t.x-o.x)<n&&(t.x=o.x);Math.abs(t.y-i.y)<n?t.y=r.prev.y:Math.abs(t.y-o.y)<n&&(t.y=o.y)}},onHandleRemove:function(t,e){var n=t.options.index;var r=this.relatedView;r.model.removeVertex(n,{ui:true});this.options.vertexAdding&&this.updatePath();r.checkMouseleave(normalizeEvent(e))},onPathPointerDown:function(t){if(!this.guard(t)){t.stopPropagation();t.preventDefault();var e=normalizeEvent(t);var n=this.paper.snapToGrid(e.clientX,e.clientY).toJSON();var r=this.relatedView;r.model.startBatch("vertex-add",{ui:true,tool:this.cid});var i=r.getVertexIndex(n.x,n.y);this.snapVertex(n,i);r.model.insertVertex(i,n,{ui:true,tool:this.cid});this.update();var o=this.handles[i];this.eventData(e,{vertexAdded:true});o.onPointerDown(e)}},onLinkPointerDown:function(t){this.relatedView.preventDefaultInteraction(t);this.onPathPointerDown(t)},onRemove:function(){this.resetHandles();this.undelegateLinkEvents()}},{VertexHandle:mo});function getViewBBox(t,e){const{model:n}=t;return e?n.getBBox():n.isLink()?t.getConnection().bbox():t.getNodeUnrotatedBBox(t.el)}function getAnchor(t,e,n){var r=hi.call(this.paper,{},e,n,t,this.model);return r.anchor}function snapAnchor(t,e,n,r,i,o){var s=o.options.snapRadius;var a=r==="source";var c=a?0:-1;var l=this.model.vertex(c)||this.getEndAnchor(a?"target":"source");if(l){Math.abs(l.x-t.x)<s&&(t.x=l.x);Math.abs(l.y-t.y)<s&&(t.y=l.y)}return t}var bo=Ir.extend({tagName:"g",svgElement:true,className:"marker-segment",events:{mousedown:"onPointerDown",touchstart:"onPointerDown"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},children:[{tagName:"line",selector:"line",attributes:{stroke:"#33334F","stroke-width":2,fill:"none","pointer-events":"none"}},{tagName:"rect",selector:"handle",attributes:{width:20,height:8,x:-10,y:-4,rx:4,ry:4,fill:"#33334F",stroke:"#FFFFFF","stroke-width":2}}],onRender:function(){this.renderChildren()},position:function(t,e,n,r){const{scale:i}=this.options;let o=J.createSVGMatrix().translate(t,e).rotate(n);i&&(o=o.scale(i));var s=this.childNodes.handle;s.setAttribute("transform",J.matrixToTransformString(o));s.setAttribute("cursor",n%180===0?"row-resize":"col-resize");var a=r.getClosestPoint(new Point(t,e));var c=this.childNodes.line;c.setAttribute("x1",t);c.setAttribute("y1",e);c.setAttribute("x2",a.x);c.setAttribute("y2",a.y)},onPointerDown:function(t){if(!this.options.guard(t)){this.trigger("change:start",this,t);t.stopPropagation();t.preventDefault();this.options.paper.undelegateEvents();this.delegateDocumentEvents(null,t.data)}},onPointerMove:function(t){this.trigger("changing",this,t)},onPointerUp:function(t){this.undelegateDocumentEvents();this.options.paper.delegateEvents();this.trigger("change:end",this,t)},show:function(){this.el.style.display=""},hide:function(){this.el.style.display="none"}});const xo=po.extend({name:"segments",precision:.5,options:{handleClass:bo,segmentLengthThreshold:40,redundancyRemoval:true,anchor:getAnchor,snapRadius:10,snapHandle:true,stopPropagation:true},handles:null,onRender:function(){this.resetHandles();var t=this.relatedView;var e=t.model.vertices();e.unshift(t.sourcePoint);e.push(t.targetPoint);for(var n=0,r=e.length;n<r-1;n++){var i=e[n];var o=e[n+1];var s=this.renderHandle(i,o);this.simulateRelatedView(s.el);this.handles.push(s);s.options.index=n}return this},renderHandle:function(t,e){var n=new this.options.handleClass({paper:this.paper,scale:this.options.scale,guard:t=>this.guard(t)});n.render();this.updateHandle(n,t,e);n.vel.appendTo(this.el);this.startHandleListening(n);return n},update:function(){this.render();return this},startHandleListening:function(t){this.listenTo(t,"change:start",this.onHandleChangeStart);this.listenTo(t,"changing",this.onHandleChanging);this.listenTo(t,"change:end",this.onHandleChangeEnd)},resetHandles:function(){var t=this.handles;this.handles=[];this.stopListening();if(Array.isArray(t))for(var e=0,n=t.length;e<n;e++)t[e].remove()},shiftHandleIndexes:function(t){var e=this.handles;for(var n=0,r=e.length;n<r;n++)e[n].options.index+=t},resetAnchor:function(t,e){var n=this.relatedView.model;e?n.prop([t,"anchor"],e,{rewrite:true,ui:true,tool:this.cid}):n.removeProp([t,"anchor"],{ui:true,tool:this.cid})},snapHandle:function(t,e,n){var r=t.options.index;var i=this.relatedView;var o=i.model;var s=o.vertices();var a=t.options.axis;var c=s[r-2]||n.sourceAnchor;var l=s[r+1]||n.targetAnchor;var u=this.options.snapRadius;Math.abs(e[a]-c[a])<u?e[a]=c[a]:Math.abs(e[a]-l[a])<u&&(e[a]=l[a]);return e},onHandleChanging:function(t,e){const{options:n}=this;var r=this.eventData(e);var i=this.relatedView;var o=i.paper;var s=t.options.index-1;var a=normalizeEvent(e);var c=o.snapToGrid(a.clientX,a.clientY);var l=this.snapHandle(t,c.clone(),r);var u=t.options.axis;var h=this.options.snapHandle?0:c[u]-l[u];var d=i.model;var f=cloneDeep(d.vertices());var p=this.options.anchor;typeof p!=="function"&&(p=null);const g=t.options.index;const v=[i.sourcePoint.clone(),...f,i.targetPoint.clone()];let m=0;if(g-1>=0){const t=v[g-1];const e=v[g];const n=new Line(t,e).vector().theta();if(n%90!==0){f.splice(g-1,0,r.originalVertices[g-1]);m++;this.shiftHandleIndexes(1)}}var y=f[s+m];var b=f[s+1+m];if(g+2<v.length){const t=v[g+1];const e=v[g+2];const n=new Line(t,e).vector().theta();if(n%90!==0){const t=r.originalVertices.length===1;const e=t?0:g;const n=r.firstHandleShifted&&!t?1:0;let i=1+m;f.splice(g+i,0,r.originalVertices[e-n])}}var x=i.sourceView;var w=i.sourceBBox;var A=false;var P=false;if(y)if(s===0)if(w.containsPoint(y)){f.shift();this.shiftHandleIndexes(-1);A=true}else{y[u]=l[u];P=true}else y[u]=l[u];else{y=i.sourceAnchor.toJSON();y[u]=l[u];if(w.containsPoint(y)){y[u]=l[u];A=true}else{f.unshift(y);this.shiftHandleIndexes(1);r.firstHandleShifted=true;P=true}}if(p&&x){if(A){var T=r.sourceAnchor.clone();T[u]=l[u];var E=p.call(i,T,x,i.sourceMagnet||x.el,"source",i);this.resetAnchor("source",E)}P&&this.resetAnchor("source",r.sourceAnchorDef)}var S=i.targetView;var k=i.targetBBox;var L=false;var C=false;if(b)if(s===f.length-2)if(k.containsPoint(b)){f.pop();L=true}else{b[u]=l[u];C=true}else b[u]=l[u];else{b=i.targetAnchor.toJSON();b[u]=l[u];if(k.containsPoint(b))L=true;else{f.push(b);C=true}}if(p&&S){if(L){var _=r.targetAnchor.clone();_[u]=l[u];var M=p.call(i,_,S,i.targetMagnet||S.el,"target",i);this.resetAnchor("target",M)}C&&this.resetAnchor("target",r.targetAnchorDef)}if(f.some((t=>!t)))throw new Error("Segments: incompatible router in use");d.vertices(f,{ui:true,tool:this.cid});this.updateHandle(t,y,b,h);n.stopPropagation||i.notifyPointermove(a,c.x,c.y)},onHandleChangeStart:function(t,e){const{options:n,handles:r,relatedView:i}=this;const{model:o,paper:s}=i;var a=t.options.index;if(Array.isArray(r)){for(var c=0,l=r.length;c<l;c++)c!==a&&r[c].hide();this.focus();this.eventData(e,{sourceAnchor:i.sourceAnchor.clone(),targetAnchor:i.targetAnchor.clone(),sourceAnchorDef:clone$1(o.prop(["source","anchor"])),targetAnchorDef:clone$1(o.prop(["target","anchor"])),originalVertices:cloneDeep(o.vertices()),firstHandleShifted:false});o.startBatch("segment-move",{ui:true,tool:this.cid});n.stopPropagation||i.notifyPointerdown(...s.getPointerArgs(e))}},onHandleChangeEnd:function(t,e){const{options:n,relatedView:r}=this;const{paper:i,model:o}=r;n.redundancyRemoval&&r.removeRedundantLinearVertices({ui:true,tool:this.cid});const s=normalizeEvent(e);const a=i.snapToGrid(s.clientX,s.clientY);this.render();this.blur();o.stopBatch("segment-move",{ui:true,tool:this.cid});n.stopPropagation||r.notifyPointerup(s,a.x,a.y);r.checkMouseleave(s)},updateHandle:function(t,e,n,r){var i=Math.abs(e.x-n.x)<this.precision;var o=Math.abs(e.y-n.y)<this.precision;if(i||o){var s=new Line(e,n);var a=s.length();if(a<this.options.segmentLengthThreshold)t.hide();else{var c=s.midpoint();var l=i?"x":"y";c[l]+=r||0;var u=s.vector().vectorAngle(new Point(1,0));t.position(c.x,c.y,u,this.relatedView);t.show();t.options.axis=l}}else t.hide()},onRemove:function(){this.resetHandles()}},{SegmentHandle:bo});const wo=po.extend({tagName:"path",xAxisVector:new Point(1,0),events:{mousedown:"onPointerDown",touchstart:"onPointerDown"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},options:{scale:null},onRender:function(){this.update()},update:function(){var t=this.ratio;var e=this.relatedView;var n=e.getTangentAtRatio(t);var r,i;if(n){r=n.start;i=n.vector().vectorAngle(this.xAxisVector)||0}else{r=e.getPointAtRatio(t);i=0}if(!r)return this;var o=J.createSVGMatrix().translate(r.x,r.y).rotate(i);const{scale:s}=this.options;s&&(o=o.scale(s));this.vel.transform(o,{absolute:true});return this},onPointerDown:function(t){if(this.guard(t))return;t.stopPropagation();t.preventDefault();var e=this.relatedView;var n=e.paper;e.model.startBatch("arrowhead-move",{ui:true,tool:this.cid});e.startArrowheadMove(this.arrowheadType);const r=t.data||(t.data={});this.delegateDocumentEvents(null,r);n.undelegateEvents();this.focus();this.el.style.pointerEvents="none";e.notifyPointerdown(...n.getPointerArgs(t))},onPointerMove:function(t){var e=normalizeEvent(t);var n=this.paper.snapToGrid(e.clientX,e.clientY);this.relatedView.pointermove(e,n.x,n.y)},onPointerUp:function(t){this.undelegateDocumentEvents();var e=this.relatedView;var n=e.paper;var r=normalizeEvent(t);var i=n.snapToGrid(r.clientX,r.clientY);e.pointerup(r,i.x,i.y);n.delegateEvents();this.blur();this.el.style.pointerEvents="";e.model.stopBatch("arrowhead-move",{ui:true,tool:this.cid})}});const Ao=wo.extend({name:"target-arrowhead",ratio:1,arrowheadType:"target",attributes:{d:"M -10 -8 10 0 -10 8 Z",fill:"#33334F",stroke:"#FFFFFF","stroke-width":2,cursor:"move",class:"target-arrowhead"}});const Po=wo.extend({name:"source-arrowhead",ratio:0,arrowheadType:"source",attributes:{d:"M 10 -8 -10 0 10 8 Z",fill:"#33334F",stroke:"#FFFFFF","stroke-width":2,cursor:"move",class:"source-arrowhead"}});const To=po.extend({tagName:"g",type:null,children:[{tagName:"circle",selector:"anchor",attributes:{cursor:"pointer"}},{tagName:"rect",selector:"area",attributes:{"pointer-events":"none",fill:"none",stroke:"#33334F","stroke-dasharray":"2,4",rx:5,ry:5}}],events:{mousedown:"onPointerDown",touchstart:"onPointerDown",dblclick:"onPointerDblClick",dbltap:"onPointerDblClick"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},options:{snap:snapAnchor,anchor:getAnchor,scale:null,resetAnchor:true,customAnchorAttributes:{"stroke-width":4,stroke:"#33334F",fill:"#FFFFFF",r:5},defaultAnchorAttributes:{"stroke-width":2,stroke:"#FFFFFF",fill:"#33334F",r:6},areaPadding:6,snapRadius:10,restrictArea:true,redundancyRemoval:true},onRender:function(){this.renderChildren();this.toggleArea(false);this.update()},update:function(){var t=this.type;var e=this.relatedView;var n=e.getEndView(t);if(n){this.updateAnchor();this.updateArea();this.el.style.display=""}else this.el.style.display="none";return this},updateAnchor:function(){var t=this.childNodes;if(!t)return;var e=t.anchor;if(!e)return;var n=this.relatedView;var r=this.type;var i=n.getEndAnchor(r);var o=this.options;var s=n.model.prop([r,"anchor"]);let a=`translate(${i.x},${i.y})`;o.scale&&(a+=` scale(${o.scale})`);e.setAttribute("transform",a);var c=s?o.customAnchorAttributes:o.defaultAnchorAttributes;for(var l in c)e.setAttribute(l,c[l])},updateArea:function(){var t=this.childNodes;if(t){var e=t.area;if(e){var n=this.relatedView;var r=this.type;var i=n.getEndView(r);var o=i.model;var s=n.getEndMagnet(r);var a=this.options.areaPadding;isFinite(a)||(a=0);var c,l,u;if(i.isNodeConnection(s)){c=i.getNodeBBox(s);l=0;u=c.center()}else{c=i.getNodeUnrotatedBBox(s);l=o.angle();u=c.center();l&&u.rotate(o.getBBox().center(),-l)}c.inflate(a);e.setAttribute("x",-c.width/2);e.setAttribute("y",-c.height/2);e.setAttribute("width",c.width);e.setAttribute("height",c.height);e.setAttribute("transform","translate("+u.x+","+u.y+") rotate("+l+")")}}},toggleArea:function(t){var e=this.childNodes;if(e){var n=e.area;n&&(n.style.display=t?"":"none")}},onPointerDown:function(t){if(!this.guard(t)){t.stopPropagation();t.preventDefault();this.paper.undelegateEvents();this.delegateDocumentEvents();this.focus();this.toggleArea(this.options.restrictArea);this.relatedView.model.startBatch("anchor-move",{ui:true,tool:this.cid})}},resetAnchor:function(t){var e=this.type;var n=this.relatedView.model;t?n.prop([e,"anchor"],t,{rewrite:true,ui:true,tool:this.cid}):n.removeProp([e,"anchor"],{ui:true,tool:this.cid})},onPointerMove:function(t){var e=this.relatedView;var n=this.type;var r=e.getEndView(n);var i=r.model;var o=e.getEndMagnet(n);var s=normalizeEvent(t);var a=this.paper.clientToLocalPoint(s.clientX,s.clientY);var c=this.options.snap;if(typeof c==="function"){a=c.call(e,a,r,o,n,e,this);a=new Point(a)}if(this.options.restrictArea)if(r.isNodeConnection(o)){var l=r.getClosestPoint(a);l&&(a=l)}else{var u=r.getNodeUnrotatedBBox(o);var h=i.angle();var d=i.getBBox().center();var f=a.clone().rotate(d,h);u.containsPoint(f)||(a=u.pointNearestToPoint(f).rotate(d,-h))}var p;var g=this.options.anchor;typeof g==="function"&&(p=g.call(e,a,r,o,n,e));this.resetAnchor(p);this.update()},onPointerUp:function(t){const e=normalizeEvent(t);this.paper.delegateEvents();this.undelegateDocumentEvents();this.blur();this.toggleArea(false);var n=this.relatedView;this.options.redundancyRemoval&&n.removeRedundantLinearVertices({ui:true,tool:this.cid});n.checkMouseleave(e);n.model.stopBatch("anchor-move",{ui:true,tool:this.cid})},onPointerDblClick:function(){var t=this.options.resetAnchor;if(t!==false){t===true&&(t=null);this.resetAnchor(cloneDeep(t));this.update()}}});const Eo=To.extend({name:"source-anchor",type:"source"});const So=To.extend({name:"target-anchor",type:"target"});const ko=po.extend({tagName:"g",children:[{tagName:"circle",selector:"handle",attributes:{cursor:"pointer","stroke-width":2,stroke:"#FFFFFF",fill:"#33334F",r:6}},{tagName:"rect",selector:"extras",attributes:{"pointer-events":"none",fill:"none",stroke:"#33334F","stroke-dasharray":"2,4",rx:5,ry:5}}],events:{mousedown:"onPointerDown",touchstart:"onPointerDown",dblclick:"onPointerDblClick",dbltap:"onPointerDblClick"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},options:{handleAttributes:null,selector:"root",padding:6,scale:null},getPosition:function(){},setPosition:function(){},resetPosition:function(){},onRender:function(){this.renderChildren();this.toggleExtras(false);this.update()},update:function(){const{handle:t,extras:e}=this.childNodes;if(!t)throw new Error("Control: markup selector `handle` is required");this.updateHandle(t);e&&this.updateExtras(e);return this},updateHandle:function(t){const{relatedView:e,options:n}=this;const{model:r}=e;const i=this.getPosition(e,this);const o=r.getAbsolutePointFromRelative(i);const{handleAttributes:s,scale:a}=n;let c=`translate(${o.x},${o.y})`;a&&(c+=` scale(${a})`);t.setAttribute("transform",c);if(s)for(let e in s)t.setAttribute(e,s[e])},updateExtras:function(t){const{relatedView:e,options:n}=this;const{selector:r}=this.options;if(!r){this.toggleExtras(false);return}const i=e.findNode(r);if(!i)throw new Error("Control: invalid selector.");let o=n.padding;isFinite(o)||(o=0);const s=e.getNodeUnrotatedBBox(i);const a=e.model;const c=a.angle();const l=s.center();c&&l.rotate(a.getBBox().center(),-c);s.inflate(o);t.setAttribute("x",-s.width/2);t.setAttribute("y",-s.height/2);t.setAttribute("width",s.width);t.setAttribute("height",s.height);t.setAttribute("transform",`translate(${l.x},${l.y}) rotate(${c})`)},toggleExtras:function(t){const{extras:e}=this.childNodes;e&&(e.style.display=t?"":"none")},onPointerDown:function(t){const{relatedView:e,paper:n}=this;if(!this.guard(t)){t.stopPropagation();t.preventDefault();n.undelegateEvents();this.delegateDocumentEvents();this.focus();this.toggleExtras(true);e.model.startBatch("control-move",{ui:true,tool:this.cid})}},onPointerMove:function(t){const{relatedView:e,paper:n}=this;const{model:r}=e;const{clientX:i,clientY:o}=normalizeEvent(t);const s=n.clientToLocalPoint(i,o);const a=r.getRelativePointFromAbsolute(s);this.setPosition(e,a,t);this.update()},onPointerUp:function(t){const{relatedView:e,paper:n}=this;n.delegateEvents();this.undelegateDocumentEvents();this.blur();this.toggleExtras(false);e.model.stopBatch("control-move",{ui:true,tool:this.cid})},onPointerDblClick:function(t){const{relatedView:e}=this;this.resetPosition(e,t);this.update()}});const Lo=ko.extend({xAxisVector:new Point(1,0),children(){const{buttonColor:t="#333",iconColor:e="#fff",outlineColor:n="#fff"}=this.options;return[{selector:"handle",tagName:"g",attributes:{cursor:"grab"},children:[{tagName:"circle",attributes:{r:10,fill:t,stroke:n}},{tagName:"path",attributes:{d:"M -5 0 A 5 5 0 1 1 0 5",fill:"transparent",stroke:e,strokeWidth:2,strokeLinecap:"round"}},{tagName:"path",attributes:{d:"M -3 5 L 0 2.5 0 7.5 Z",fill:e,stroke:e,strokeWidth:1,transform:"rotate(-5, -3, 5)"}}]}]},getPosition(t){const{offset:e=0}=this.options;const{x:n=0,y:r=0}=typeof e==="number"?{x:0,y:e}:e;const i=this.getLabel();const o=this.getLabelPosition(i);const s=t.getLabelCoordinates(o);let{angle:a=0,args:c={}}=o;const l=c.keepGradient;if(l){const e=t.getTangentAtRatio(t.getClosestPointRatio(s));e&&(a+=e.vector().vectorAngle(this.xAxisVector)||0)}const u=(new DOMMatrix).translate(s.x,s.y).rotate(a).translate(n,r);return new Point(u.e,u.f)},computeVisibility(){const t=ko.prototype.computeVisibility.apply(this,arguments);return t&&!!this.getLabel()},setPosition(t,e){const n=t.model;const r=this.getLabel();if(!r)return;const i=this.getLabelPosition(r);const o=t.getLabelCoordinates(i);const s=90-o.theta(e);const a=this.getLabelIndex();n.prop(["labels",a,"position","angle"],s)},resetPosition(t){const e=t.model;const n=this.getLabelIndex();e.prop(["labels",n,"position","angle"],0)},getLabelIndex(){return this.options.labelIndex||0},getLabel(){return this.relatedView.model.label(this.getLabelIndex())||null},getLabelPosition(t){const e=this.relatedView;const n=e._normalizeLabelPosition(t.position);return e._mergeLabelPositionProperty(n,e._getDefaultLabelPositionProperty())}});const Co=po.extend({name:"button",events:{mousedown:"onPointerDown",touchstart:"onPointerDown"},options:{distance:0,offset:0,scale:null,rotate:false},onRender:function(){this.renderChildren(this.options.markup);this.update()},update:function(){this.position();return this},position:function(){const{vel:t}=this;t.transform(this.getCellMatrix(),{absolute:true})},getCellMatrix(){return this.relatedView.model.isLink()?this.getLinkMatrix():this.getElementMatrix()},getElementMatrix(){const{relatedView:t,options:e}=this;let{x:n=0,y:r=0,offset:i={},useModelGeometry:o,rotate:s,scale:a}=e;let c=getViewBBox(t,o);const l=t.model.angle();s||(c=c.bbox(l));const{x:u=0,y:h=0}=i;isPercentage(n)?n=parseFloat(n)/100*c.width:isCalcExpression(n)&&(n=Number(evalCalcExpression(n,c)));isPercentage(r)?r=parseFloat(r)/100*c.height:isCalcExpression(r)&&(r=Number(evalCalcExpression(r,c)));let d=J.createSVGMatrix().translate(c.x+c.width/2,c.y+c.height/2);s&&(d=d.rotate(l));d=d.translate(n+u-c.width/2,r+h-c.height/2);a&&(d=d.scale(a));return d},getLinkMatrix(){const{relatedView:t,options:e}=this;const{offset:n=0,distance:r=0,rotate:i,scale:o}=e;const s=typeof r==="function"?r.call(this,t,this):r;let a,c,l;a=isPercentage(s)?t.getTangentAtRatio(parseFloat(s)/100):t.getTangentAtLength(s);if(a){c=a.start;l=a.vector().vectorAngle(new Point(1,0))||0}else{c=t.getConnection().start;l=0}let u=J.createSVGMatrix().translate(c.x,c.y).rotate(l).translate(0,n);i||(u=u.rotate(-l));o&&(u=u.scale(o));return u},onPointerDown:function(t){if(!this.guard(t)){t.stopPropagation();t.preventDefault();var e=this.options.action;typeof e==="function"&&e.call(this.relatedView,t,this.relatedView,this)}}});const _o=Co.extend({name:"remove",children:[{tagName:"circle",selector:"button",attributes:{r:7,fill:"#FF1D00",cursor:"pointer"}},{tagName:"path",selector:"icon",attributes:{d:"M -3 -3 3 3 M -3 3 3 -3",fill:"none",stroke:"#FFFFFF","stroke-width":2,"pointer-events":"none"}}],options:{distance:60,offset:0,action:function(t,e,n){e.model.remove({ui:true,tool:n.cid})}}});const Mo=po.extend({name:"boundary",tagName:"rect",options:{padding:10,useModelGeometry:false},attributes:{fill:"none",stroke:"#33334F","stroke-width":.5,"stroke-dasharray":"5, 5","pointer-events":"none"},onRender:function(){this.update()},update:function(){const{relatedView:t,options:e,vel:n}=this;const{useModelGeometry:r,rotate:i}=e;const o=normalizeSides(e.padding);let s=getViewBBox(t,r).moveAndExpand({x:-o.left,y:-o.top,width:o.left+o.right,height:o.top+o.bottom});var a=t.model;if(a.isElement()){var c=a.angle();if(c)if(i){var l=a.getBBox().center();n.rotate(c,l.x,l.y,{absolute:true})}else s=s.bbox(c)}n.attr(s.toJSON());return this}});const No=Co.extend({name:"connect",documentEvents:{mousemove:"drag",touchmove:"drag",mouseup:"dragend",touchend:"dragend",touchcancel:"dragend"},children:[{tagName:"circle",selector:"button",attributes:{r:7,fill:"#333333",cursor:"pointer"}},{tagName:"path",selector:"icon",attributes:{d:"M -4 -1 L 0 -1 L 0 -4 L 4 0 L 0 4 0 1 -4 1 z",fill:"#FFFFFF",stroke:"none","stroke-width":2,"pointer-events":"none"}}],options:{distance:80,offset:0,magnet:t=>t.el,action:(t,e,n)=>n.dragstart(t)},getMagnetNode:function(){const{options:t,relatedView:e}=this;const{magnet:n}=t;let r;switch(typeof n){case"function":r=n.call(this,e,this);break;case"string":r=e.findNode(n);break;default:r=n;break}r||(r=e.el);if(r instanceof SVGElement)return r;throw new Error("Connect: magnet must be an SVGElement")},dragstart:function(t){const{paper:e,relatedView:n}=this;const r=normalizeEvent(t);const{x:i,y:o}=e.clientToLocalPoint(r.clientX,r.clientY);n.dragLinkStart(r,this.getMagnetNode(),i,o);e.undelegateEvents();this.delegateDocumentEvents(null,r.data);this.focus()},drag:function(t){const{paper:e,relatedView:n}=this;const r=normalizeEvent(t);const{x:i,y:o}=e.snapToGrid(r.clientX,r.clientY);n.dragLink(r,i,o)},dragend:function(t){const{paper:e,relatedView:n}=this;const r=normalizeEvent(t);const{x:i,y:o}=e.snapToGrid(r.clientX,r.clientY);n.dragLinkEnd(r,i,o);this.undelegateDocumentEvents();e.delegateEvents();this.blur();n.checkMouseleave(r)}});const Oo=No.extend({name:"hover-connect",defaultMarkup:[{tagName:"circle",attributes:{r:7,fill:"#333333",cursor:"pointer"}},{tagName:"path",attributes:{d:"M -4 -1 L 0 -1 L 0 -4 L 4 0 L 0 4 0 1 -4 1 z",fill:"#FFFFFF",stroke:"none","stroke-width":2}}],children(){const{options:t,defaultMarkup:e}=this;return[{tagName:"path",selector:"track",attributes:{fill:"none",stroke:"transparent","stroke-width":t.trackWidth||15,cursor:"pointer"}},{tagName:"g",selector:"button",attributes:{"pointer-events":"none",display:"none"},children:t.markup||e}]},events:Object.assign({mousemove:"onMousemove",mouseenter:"onMouseenter",mouseleave:"onMouseleave"},No.prototype.events),onRender:function(){this.renderChildren();this.update()},trackPath:null,update(){const{childNodes:t}=this;this.trackPath=this.getTrackPath();No.prototype.update.apply(this,arguments);t.track.setAttribute("d",this.trackPath.serialize())},position(){const{el:t,childNodes:e}=this;e.button.setAttribute("transform",J.matrixToTransformString(this.getButtonMatrix()));t.setAttribute("transform",J.matrixToTransformString(this.getTrackMatrix()))},getButtonMatrix(){const{options:t,trackPath:e}=this;const{offset:n=0,distance:r=0,rotate:i,scale:o}=t;let s,a,c;s=isPercentage(r)?e.tangentAtRatio(parseFloat(r)/100):e.tangentAtLength(r);if(s){a=s.start;c=s.vector().vectorAngle(new Point(1,0))||0}else{a=e.start;c=0}let l=J.createSVGMatrix().translate(a.x,a.y).rotate(c).translate(0,n);i||(l=l.rotate(-c));o&&(l=l.scale(o));return l},getTrackPath(){return this.relatedView.getConnection()},getTrackMatrix(){return J.createSVGMatrix()},getTrackRatioFromEvent(t){const{relatedView:e,trackPath:n}=this;const r=e.paper.clientToLocalPoint(t.clientX,t.clientY);const i=J.transformPoint(r,this.getTrackMatrix().inverse());return n.closestPointLength(i)},canShowButton(){return $.event.has(this.paper.el)},showButton(){this.childNodes.button.style.display="block"},hideButton(){this.childNodes.button.style.display=""},onMousemove(t){const{trackPath:e}=this;if(!e)return;const{options:n}=this;n.distance=this.getTrackRatioFromEvent(t);this.position()},onMouseenter(){this.canShowButton()&&this.showButton()},onMouseleave(){this.hideButton()}});var Ro=Object.freeze(Object.defineProperty({__proto__:null,Boundary:Mo,Button:Co,Connect:No,Control:ko,HoverConnect:Oo,Remove:_o,RotateLabel:Lo,Segments:xo,SourceAnchor:Eo,SourceArrowhead:Po,TargetAnchor:So,TargetArrowhead:Ao,Vertices:yo},Symbol.toStringTag,{value:"Module"}));const Bo=Oo.extend({getTrackPath(){const{relatedView:t,options:e}=this;let{useModelGeometry:n,trackPath:r="M 0 0 H calc(w) V calc(h) H 0 Z"}=e;typeof r==="function"&&(r=r.call(this,t));if(isCalcExpression(r)){const e=getViewBBox(t,n);r=evalCalcExpression(r,e)}return new Path$1(J.normalizePathData(r))},getTrackMatrix(){const{relatedView:t,options:e}=this;let{useModelGeometry:n,rotate:r}=e;let i=getViewBBox(t,n);const o=t.model.angle();r||(i=i.bbox(o));let s=J.createSVGMatrix().translate(i.x+i.width/2,i.y+i.height/2);r&&(s=s.rotate(o));s=s.translate(-i.width/2,-i.height/2);return s}});var Io=Object.freeze(Object.defineProperty({__proto__:null,Boundary:Mo,Button:Co,Connect:No,Control:ko,HoverConnect:Bo,Remove:_o},Symbol.toStringTag,{value:"Module"}));var Fo="4.1.2";const Do=J;const Vo={PortLabel:Un,Port:Gn};const setTheme=function(t,e){e=e||{};invoke(Br,"setTheme",t,e);Ir.prototype.defaultTheme=t};export{J as V,Do as Vectorizer,Vi as anchors,nn as config,ci as connectionPoints,di as connectionStrategies,Nr as connectors,vo as dia,Io as elementTools,Yn as env,Z as g,ei as highlighters,Vo as layout,Si as linkAnchors,Ro as linkTools,Hr as mvc,Pi as routers,setTheme,vr as shapes,jn as util,Fo as version};

